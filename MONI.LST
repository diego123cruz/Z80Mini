0001   0000             ; ---------------------------------------------------------
0002   0000             ;   Z80 Mini  -  inicio 01/2022
0003   0000             ;   Diego Cruz - github.com/diego123cruz
0004   0000             ;
0005   0000             ;   Hardware baseado em: http://www.sunrise-ev.com/z80.htm
0006   0000             ;   Software próprio - em construção
0007   0000             ; ---------------------------------------------------------
0008   0000             ;   Z80@4Mhz
0009   0000             ;   ROM 32k - 28C256
0010   0000             ;   RAM 32k - 65256
0011   0000             ;   Display 7 segmentos 8 digitos
0012   0000             ;   Teclado 16 teclas + Fn (Tecla de função? ou outra coisa?)
0013   0000             ;   Entrada 40h
0014   0000             ;   Saida 40h
0015   0000             ;
0016   0000             ;
0017   0000             ; ---------------------------------------------------------
0018   0000             ;   Display 7 Segmentos - In(Port40) AND 00000111b
0019   0000             ; ---------------------------------------------------------
0020   0000             ;
0021   0000             ;   ------------------------------------------------
0022   0000             ;   | 00h | 01h | 02h | 03h | 04h | 05h | 06h | 07h |
0023   0000             ;   ------------------------------------------------
0024   0000             ;
0025   0000             ;               A(0)
0026   0000             ;            ---------
0027   0000             ;           |         |
0028   0000             ;      F(5) |         | B(1)
0029   0000             ;           |   G(6)  |
0030   0000             ;            ---------
0031   0000             ;           |         |
0032   0000             ;      E(4) |         | C(2)
0033   0000             ;           |         |
0034   0000             ;            ---------         Ponto(7)
0035   0000             ;               D(3) 
0036   0000             ;
0037   0000             ;
0038   0000             ;
0039   0000             ;
0040   0000             ;
0041   0000             ; ---------------------------------------------------------
0042   0000             ; Teclado 
0043   0000             ; ---------------------------------------------------------
0044   0000             ;   
0045   0000             ;   Keys:        
0046   0000             ;       Fn - In(Port40) AND 00010000b - pulldown
0047   0000             ;       0 - In(Port40) AND 00000111b
0048   0000             ;
0049   0000             ;
0050   0000             ;
0051   0000             ;
0052   0000             
0053   0000             
0054   0000             ; ---------------------------------------------------------
0055   0000             ; Constantes
0056   0000             ; ---------------------------------------------------------
0057   0000             
0058   0000             Port40        .equ    $40
0059   0000             PortC0        .equ    $C0
0060   0000             START_RAM     .equ    $8000
0061   0000             STACK         .equ    $FF00  
0062   0000             CKEY_TIMEOUT  .equ    100  ; 100ms +-
0063   0000             
0064   0000             ; ---------------------------------------------------------
0065   0000             ; RAM MAP - Monitor | $FF00 - $FFFF
0066   0000             ; ---------------------------------------------------------
0067   0000             ; Cada digito fica em um ponto da memoria RAM
0068   0000             DIG_0       .equ    $FF00   ;(1) endereço do digito 0 na memoria RAM
0069   0000             DIG_1       .equ    $FF01   ;(1) endereço do digito 1 na memoria RAM
0070   0000             DIG_2       .equ    $FF02   ;(1) endereço do digito 2 na memoria RAM
0071   0000             DIG_3       .equ    $FF03   ;(1) endereço do digito 3 na memoria RAM
0072   0000             DIG_4       .equ    $FF04   ;(1) endereço do digito 4 na memoria RAM
0073   0000             DIG_5       .equ    $FF05   ;(1) endereço do digito 5 na memoria RAM
0074   0000             DIG_6       .equ    $FF06   ;(1) endereço do digito 6 na memoria RAM
0075   0000             DIG_7       .equ    $FF07   ;(1) endereço do digito 7 na memoria RAM
0076   0000             KEY_PRESS   .equ    $FF08   ;(1) key atual
0077   0000             INPUT       .equ    $FF09   ;(1) temp input from int
0078   0000             TMP_KEY     .equ    $FF0A   ;(1) tmp key
0079   0000             KEY_TIMEOUT .equ    $FF0B   ;(1) tempo para retornar a tecla, CKEY_TIMEOUT
0080   0000             SHOW_DIG    .equ    $FF0C   ;(1) LIVRE
0081   0000             PC_RAM      .equ    $FF0D   ;(2) save pc to user start $8000
0082   0000             
0083   0000             SYSMODE     .equ    $FF0F   ;(1) System mode. 
0084   0000                                         ; 0 - User Mode
0085   0000                                         ; 1 - Monitor
0086   0000                                         ; 2 - Examine Memoria
0087   0000                                         ; 3 - Change Data(Memory)
0088   0000                                         ; 4 - Show register PC
0089   0000                                         ; 5 - Show register SP
0090   0000                                         ; 6 - Show register AF
0091   0000                                         ; 7 - Show register BC
0092   0000                                         ; 8 - Show register DE
0093   0000                                         ; 9 - Show register HL
0094   0000                                         ; A - Show register IX
0095   0000                                         ; B - Show register IY
0096   0000                                         ; C - Show register AF'
0097   0000                                         ; D - Show register BC'
0098   0000                                         ; E - Show register DE'
0099   0000                                         ; F - Show register HL'
0100   0000             TicCounter  .equ    $FF10   ;(2) TicCounter inc 1ms
0101   0000             EXM_COUNT   .equ    $FF12   ;(1) Count digits Examine function, 4 digits
0102   0000             MDF_COUNT   .equ    $FF13   ;(1) Count digits moDify function, 2 digits
0103   0000             USR_PC      .equ    $FF14   ;(2) PC 
0104   0000             USR_SP      .equ    $FF16   ;(2) SP
0105   0000             USR_HL      .equ    $FF18   ;(2) HL
0106   0000             USR_BC      .equ    $FF1A   ;(2) BC
0107   0000             USR_DE      .equ    $FF1C   ;(2) DE
0108   0000             USR_AF      .equ    $FF1E   ;(2) AF
0109   0000             USR_IX      .equ    $FF20   ;(2) IX
0110   0000             USR_IY      .equ    $FF22   ;(2) IY
0111   0000             USR_AFA     .equ    $FF24   ;(2) AF' (Aux)
0112   0000             USR_BCA     .equ    $FF26   ;(2) BC' (Aux)
0113   0000             USR_DEA     .equ    $FF28   ;(2) DE' (Aux)
0114   0000             USR_HLA     .equ    $FF2A   ;(2) HL' (Aux)
0115   0000             ; SP Temp   .equ    $FF2C
0116   0000             
0117   0000             
0118   0000             
0119   0000             ; Copy USER_DISPx to DIG_x WHEN USER_MODE
0120   0000             USER_DISP0  .equ    $FFD0   ; Mode User - Display Dig 0  - 01234567
0121   0000             USER_DISP1  .equ    $FFD1   ; Mode User - Display Dig 1  - 01234567
0122   0000             USER_DISP2  .equ    $FFD2   ; Mode User - Display Dig 2  - 01234567
0123   0000             USER_DISP3  .equ    $FFD3   ; Mode User - Display Dig 3  - 01234567
0124   0000             USER_DISP4  .equ    $FFD4   ; Mode User - Display Dig 4  - 01234567
0125   0000             USER_DISP5  .equ    $FFD5   ; Mode User - Display Dig 5  - 01234567
0126   0000             USER_DISP6  .equ    $FFD6   ; Mode User - Display Dig 6  - 01234567
0127   0000             USER_DISP7  .equ    $FFD7   ; Mode User - Display Dig 7  - 01234567
0128   0000             
0129   0000             
0130   0000             
0131   0000             ; =========================================================
0132   0000             ; Start ROM
0133   0000             ; =========================================================
0134   0000             .org    $0000
0135   0000 C3 12 09        JP  START
0136   0003             
0137   0003             ; =========================================================
0138   0003             ; Livre para colocar funções 0003h - 0037h 
0139   0003             ; =========================================================
0140   0003             
0141   0003             ; delay_100ms
0142   0003             
0143   0003             ; char7segFromA
0144   0003             
0145   0003             ; animacaoLeds
0146   0003             
0147   0003             ; Limpar RAM (FF).... etc
0148   0003             
0149   0003             
0150   0003             ; =========================================================
0151   0003             ; Int 38h
0152   0003             ; =========================================================
0153   0038             .org    $38
0154   0038 F3              DI                       ; Disable interrupt
0155   0039             
0156   0039 ED 73 16 FF     LD (USR_SP), SP          ; Save SP
0157   003D 22 18 FF        LD (USR_HL), HL          ; Save HL
0158   0040 E1              POP  HL                  ; Recupera PC da stack
0159   0041 22 14 FF        LD (USR_PC), HL          ; Save PC
0160   0044 E5              PUSH HL                  ;
0161   0045 21 2C FF        LD HL, $FF2C             ; Carrega Temp SP to HL
0162   0048 F9              LD SP, HL                ; Set temp HL
0163   0049 D9              EXX                      ; Inverte HL e HL', DE.... BC....
0164   004A E5              PUSH  HL                 ; Save HL'
0165   004B D5              PUSH  DE                 ; Save DE'                
0166   004C C5              PUSH  BC                 ; Save BC'
0167   004D 08              EX    AF, AF'
0168   004E F5              PUSH  AF                 ; Save AF'
0169   004F 08              EX    AF, AF'
0170   0050 D9              EXX                      ; Troca HL' e HL,, DE... BC...
0171   0051 FD E5           PUSH  IY                 ; Save IY
0172   0053 DD E5           PUSH  IX                 ; Save IX
0173   0055 F5              PUSH  AF                 ; Save AF
0174   0056 D5              PUSH  DE                 ; Save DE
0175   0057 C5              PUSH  BC                 ; Save BC
0176   0058 2A 16 FF        LD HL, (USR_SP)          ; Recupera SP
0177   005B F9              LD SP, HL                ; Devolve SP original
0178   005C             
0179   005C                 ; TicCounter
0180   005C 2A 10 FF        LD  HL, (TicCounter)     ; Increment 1ms, used to DELAY_A
0181   005F 23              INC  HL
0182   0060 22 10 FF        LD  (TicCounter), HL
0183   0063             
0184   0063                 ; Timeout Key
0185   0063 3A 0B FF         LD A, (KEY_TIMEOUT)
0186   0066 FE 00            CP 0
0187   0068 CA 6F 00         JP Z, ENTER_MAIN
0188   006B 3D               DEC A
0189   006C 32 0B FF         LD (KEY_TIMEOUT), A
0190   006F             
0191   006F                 ; Main
0192   006F             ENTER_MAIN:
0193   006F CD A7 00        CALL UPDATE_DISPLAYS
0194   0072 CD C3 00        CALL UPDATE_KEYS
0195   0075             
0196   0075                 ; Show atual digit
0197   0075 3A 0C FF        LD  A, (SHOW_DIG)
0198   0078 D3 40           OUT (Port40), A
0199   007A             
0200   007A                 ;CALL    TRATAMENTO_INT38H; Get key, update display   
0201   007A C3 12 01        JP      SYS_MAIN         ; Execute function monitor
0202   007D             
0203   007D             EXIT_SYS:
0204   007D E1              POP HL                   ; Troca o PC
0205   007E 2A 14 FF        LD HL, (USR_PC)          ; Recupera PC
0206   0081 E5              PUSH HL                  ; Devolve PC to stack
0207   0082             
0208   0082 2A 24 FF        LD HL, (USR_AFA)          ; Load AF' in HL
0209   0085 E5              PUSH  HL                 ; Push AF'
0210   0086 F1              POP AF                   ; Recovery AF'
0211   0087 08              EX AF, AF'
0212   0088             
0213   0088 2A 2A FF        LD HL, (USR_HLA)          ; Recovery HL'
0214   008B ED 5B 28 FF     LD DE, (USR_DEA)          ; Recovery DE'
0215   008F ED 4B 26 FF     LD BC, (USR_BCA)          ; Recovery BC'
0216   0093 D9              EXX
0217   0094             
0218   0094 2A 1E FF        LD HL, (USR_AF)          ; Load AF in HL
0219   0097 E5              PUSH  HL                 ; Push AF
0220   0098 F1              POP AF                   ; Recovery AF
0221   0099             
0222   0099 2A 18 FF        LD HL, (USR_HL)          ; Recovery HL
0223   009C ED 5B 1C FF     LD DE, (USR_DE)          ; Recovery DE
0224   00A0 ED 4B 1A FF     LD BC, (USR_BC)          ; Recovery BC
0225   00A4             
0226   00A4 FB              EI                       ; Enable interrupt
0227   00A5 ED 4D           RETI                     ; Return interrupt
0228   00A7             
0229   00A7             
0230   00A7             ; =========================================================
0231   00A7             ; Update display - Tratamento Int 38h
0232   00A7             ; =========================================================
0233   00A7             UPDATE_DISPLAYS:    
0234   00A7 DB 40           IN    A, (Port40)
0235   00A9 32 09 FF        LD    (INPUT), A
0236   00AC E6 07           AND   $07
0237   00AE FE 08           CP    $08
0238   00B0 D2 C2 00        JP    NC, UPDATE_DISPLAYS_RET ; IF A > 7 RET
0239   00B3 3C              INC   A
0240   00B4 FE 08           CP    $08
0241   00B6 C2 BB 00        JP    NZ, UPDATE_DISPLAYS_OK
0242   00B9 3E 00           LD    A, $00
0243   00BB             UPDATE_DISPLAYS_OK:
0244   00BB 26 FF           LD    H, $FF
0245   00BD 6F              LD    L, A
0246   00BE 7E              LD    A, (HL)
0247   00BF 32 0C FF        LD   (SHOW_DIG), A
0248   00C2             UPDATE_DISPLAYS_RET:
0249   00C2 C9              RET
0250   00C3             
0251   00C3             ; =========================================================
0252   00C3             ; Update KEY - Tratamento Int 38h
0253   00C3             ; =========================================================
0254   00C3             UPDATE_KEYS:    
0255   00C3 DB 40           IN    A, (Port40)
0256   00C5 32 09 FF        LD    (INPUT), A
0257   00C8 E6 07           AND   $07
0258   00CA FE 08           CP    $08
0259   00CC D2 F5 00        JP    NC, UPDATE_KEY_RET ; IF A > 7 RET
0260   00CF 3A 09 FF        LD  A,  (INPUT)
0261   00D2 CB 5F           BIT  3, A
0262   00D4 CA F6 00        JP  Z, TRATAB3
0263   00D7 3A 09 FF        LD  A,  (INPUT)
0264   00DA CB 67           BIT  4, A
0265   00DC CA FC 00        JP  Z, TRATAB4
0266   00DF C3 F5 00        JP  UPDATE_KEY_RET
0267   00E2             UPDATE_KEY_GET:
0268   00E2 32 09 FF        LD    (INPUT), A
0269   00E5 E6 07           AND   $07
0270   00E7 01 00 00        LD    BC, 0
0271   00EA 4F              LD    C, A
0272   00EB 09              ADD   HL, BC
0273   00EC 7E              LD    A, (HL)
0274   00ED 32 08 FF        LD   (KEY_PRESS), A
0275   00F0 3E 64           LD A, CKEY_TIMEOUT
0276   00F2 32 0B FF        LD (KEY_TIMEOUT), A
0277   00F5             UPDATE_KEY_RET:
0278   00F5 C9              RET
0279   00F6             
0280   00F6             TRATAB3:
0281   00F6 21 02 01        LD    HL, KEYSB3
0282   00F9 C3 E2 00        JP  UPDATE_KEY_GET
0283   00FC             
0284   00FC             TRATAB4:
0285   00FC 21 0A 01        LD    HL, KEYSB4
0286   00FF C3 E2 00        JP  UPDATE_KEY_GET
0287   0102             
0288   0102 000104070F02KEYSB3 .db $00, $01, $04, $07, $0F, $02, $05, $08
0288   0108 0508
0289   010A 0E0306090D0CKEYSB4 .db $0E, $03, $06, $09, $0D, $0C, $0B, $0A
0289   0110 0B0A
0290   0112             
0291   0112             
0292   0112             
0293   0112             ; =========================================================
0294   0112             ; SYS MAIN
0295   0112             ; =========================================================
0296   0112             SYS_MAIN:
0297   0112 3A 0F FF        LD  A, (SYSMODE)
0298   0115 FE 00           CP  $00                  ; User mode can back to monitor
0299   0117 CA 2D 06        JP  Z, USER_MODE        
0300   011A             
0301   011A 3A 0F FF        LD  A, (SYSMODE)
0302   011D FE 01           CP  $01                  ; monitor
0303   011F CA 43 06        JP  Z, MONITOR_MODE
0304   0122             
0305   0122 3A 0F FF        LD  A,  (SYSMODE)
0306   0125 FE 02           CP  $02                  ; Examine RAM
0307   0127 CA 95 01        JP  Z, EXAMINE_RAM
0308   012A             
0309   012A 3A 0F FF        LD  A, (SYSMODE)
0310   012D FE 03           CP  $03                  ; Modify Data (Memory)
0311   012F CA 2E 02        JP  Z,  MODIFY_RAM
0312   0132             
0313   0132 3A 0F FF        LD  A, (SYSMODE)
0314   0135 FE 04           CP  $04                  ; Show register PC
0315   0137 CA 7D 02        JP  Z,  SHOW_REG_PC
0316   013A             
0317   013A 3A 0F FF        LD  A, (SYSMODE)
0318   013D FE 05           CP  $05                  ; Show register SP
0319   013F CA C5 02        JP  Z,  SHOW_REG_SP
0320   0142             
0321   0142 3A 0F FF        LD  A, (SYSMODE)
0322   0145 FE 06           CP  $06                  ; Show register AF
0323   0147 CA 10 03        JP  Z,  SHOW_REG_AF
0324   014A             
0325   014A 3A 0F FF        LD  A, (SYSMODE)
0326   014D FE 07           CP  $07                  ; Show register BC
0327   014F CA 5B 03        JP  Z,  SHOW_REG_BC
0328   0152             
0329   0152 3A 0F FF        LD  A, (SYSMODE)
0330   0155 FE 08           CP  $08                  ; Show register DE
0331   0157 CA A6 03        JP  Z,  SHOW_REG_DE
0332   015A             
0333   015A 3A 0F FF        LD  A, (SYSMODE)
0334   015D FE 09           CP  $09                  ; Show register HL
0335   015F CA F1 03        JP  Z,  SHOW_REG_HL
0336   0162             
0337   0162 3A 0F FF        LD  A, (SYSMODE)
0338   0165 FE 0A           CP  $0A                  ; Show register IX
0339   0167 CA 3C 04        JP  Z,  SHOW_REG_IX
0340   016A             
0341   016A 3A 0F FF        LD  A, (SYSMODE)
0342   016D FE 0B           CP  $0B                  ; Show register IY
0343   016F CA 87 04        JP  Z,  SHOW_REG_IY
0344   0172             
0345   0172 3A 0F FF        LD  A, (SYSMODE)
0346   0175 FE 0C           CP  $0C                  ; Show register AF'
0347   0177 CA D2 04        JP  Z,  SHOW_REG_AFaux
0348   017A             
0349   017A 3A 0F FF        LD  A, (SYSMODE)
0350   017D FE 0D           CP  $0D                  ; Show register BC'
0351   017F CA 22 05        JP  Z,  SHOW_REG_BCaux
0352   0182             
0353   0182 3A 0F FF        LD  A, (SYSMODE)
0354   0185 FE 0E           CP  $0E                  ; Show register DE'
0355   0187 CA 72 05        JP  Z,  SHOW_REG_DEaux
0356   018A             
0357   018A 3A 0F FF        LD  A, (SYSMODE)
0358   018D FE 0F           CP  $0F                  ; Show register HL'
0359   018F CA C2 05        JP  Z,  SHOW_REG_HLaux
0360   0192             
0361   0192 C3 7D 00        JP  EXIT_SYS
0362   0195             
0363   0195             
0364   0195             ; =========================================================
0365   0195             ; Examine RAM Mode
0366   0195             ; =========================================================
0367   0195             EXAMINE_RAM:
0368   0195 CD 12 06        CALL GET_KEY_A
0369   0198 FE FF           CP  $FF
0370   019A CA 7D 00        JP  Z, EXIT_SYS
0371   019D             
0372   019D F5              PUSH  AF
0373   019E F5              PUSH  AF
0374   019F 3A 12 FF        LD  A, (EXM_COUNT)
0375   01A2 FE 03           CP  3
0376   01A4 CA C2 01        JP  Z, EXAMINE_KEY_POS_3
0377   01A7             
0378   01A7 3A 12 FF        LD  A, (EXM_COUNT)
0379   01AA FE 02           CP  2
0380   01AC CA E0 01        JP  Z, EXAMINE_KEY_POS_2
0381   01AF             
0382   01AF 3A 12 FF        LD  A, (EXM_COUNT)
0383   01B2 FE 01           CP  1
0384   01B4 CA FA 01        JP  Z, EXAMINE_KEY_POS_1
0385   01B7             
0386   01B7 3A 12 FF        LD  A, (EXM_COUNT)
0387   01BA FE 00           CP  0
0388   01BC CA 1B 02        JP  Z, EXAMINE_KEY_POS_0
0389   01BF             
0390   01BF C3 7D 00        JP  EXIT_SYS
0391   01C2             
0392   01C2             EXAMINE_KEY_POS_3:
0393   01C2 F1              POP  AF
0394   01C3 CB 07           RLC  A
0395   01C5 CB 07           RLC  A
0396   01C7 CB 07           RLC  A
0397   01C9 CB 07           RLC  A
0398   01CB 67              LD  H, A
0399   01CC 22 0D FF        LD  (PC_RAM), HL
0400   01CF F1              POP  AF
0401   01D0 CD 03 08        CALL GET_NUM_FROM_LOW
0402   01D3 32 00 FF        LD  (DIG_0), A
0403   01D6 3A 12 FF        LD  A, (EXM_COUNT)
0404   01D9 3D              DEC A
0405   01DA 32 12 FF        LD  (EXM_COUNT), A
0406   01DD C3 7D 00        JP  EXIT_SYS
0407   01E0             
0408   01E0             
0409   01E0             EXAMINE_KEY_POS_2:
0410   01E0 F1              POP  AF
0411   01E1 2A 0D FF        LD  HL, (PC_RAM)
0412   01E4 B4              OR  H
0413   01E5 67              LD  H, A
0414   01E6 22 0D FF        LD  (PC_RAM), HL
0415   01E9 F1              POP  AF
0416   01EA CD 03 08        CALL GET_NUM_FROM_LOW
0417   01ED 32 01 FF        LD  (DIG_1), A
0418   01F0 3A 12 FF        LD  A, (EXM_COUNT)
0419   01F3 3D              DEC A
0420   01F4 32 12 FF        LD  (EXM_COUNT), A
0421   01F7 C3 7D 00        JP  EXIT_SYS
0422   01FA             
0423   01FA             EXAMINE_KEY_POS_1:
0424   01FA F1              POP  AF
0425   01FB 2A 0D FF        LD  HL, (PC_RAM)
0426   01FE CB 07           RLC  A
0427   0200 CB 07           RLC  A
0428   0202 CB 07           RLC  A
0429   0204 CB 07           RLC  A
0430   0206 6F              LD  L, A
0431   0207 22 0D FF        LD  (PC_RAM), HL
0432   020A F1              POP  AF
0433   020B CD 03 08        CALL GET_NUM_FROM_LOW
0434   020E 32 02 FF        LD  (DIG_2), A
0435   0211 3A 12 FF        LD  A, (EXM_COUNT)
0436   0214 3D              DEC A
0437   0215 32 12 FF        LD  (EXM_COUNT), A
0438   0218 C3 7D 00        JP  EXIT_SYS
0439   021B             
0440   021B             
0441   021B             EXAMINE_KEY_POS_0:
0442   021B F1              POP  AF
0443   021C 2A 0D FF        LD  HL, (PC_RAM)
0444   021F B5              OR  L
0445   0220 6F              LD  L, A
0446   0221 22 0D FF        LD  (PC_RAM), HL
0447   0224 F1              POP  AF
0448   0225 CD 03 08        CALL GET_NUM_FROM_LOW
0449   0228 32 03 FF        LD  (DIG_3), A
0450   022B C3 24 07        JP  GO_MONITOR
0451   022E             
0452   022E             ; =========================================================
0453   022E             ; MODIFY RAM Mode
0454   022E             ; =========================================================
0455   022E             MODIFY_RAM:
0456   022E             
0457   022E CD 12 06        CALL GET_KEY_A
0458   0231 FE FF           CP  $FF
0459   0233 CA 7D 00        JP  Z, EXIT_SYS
0460   0236             
0461   0236 F5              PUSH  AF
0462   0237 F5              PUSH  AF
0463   0238 3A 13 FF        LD  A, (MDF_COUNT)
0464   023B FE 01           CP  1
0465   023D CA 4B 02        JP  Z, MODIFY_KEY_POS_1
0466   0240             
0467   0240 3A 13 FF        LD  A, (MDF_COUNT)
0468   0243 FE 00           CP  0
0469   0245 CA 69 02        JP  Z, MODIFY_KEY_POS_0
0470   0248             
0471   0248 C3 7D 00        JP  EXIT_SYS
0472   024B             
0473   024B             MODIFY_KEY_POS_1:
0474   024B F1              POP  AF
0475   024C CB 07           RLC  A
0476   024E CB 07           RLC  A
0477   0250 CB 07           RLC  A
0478   0252 CB 07           RLC  A
0479   0254 2A 0D FF        LD  HL, (PC_RAM)
0480   0257 77              LD  (HL), A
0481   0258             
0482   0258 F1              POP  AF
0483   0259 CD 03 08        CALL GET_NUM_FROM_LOW
0484   025C 32 06 FF        LD  (DIG_6), A
0485   025F 3A 13 FF        LD  A, (MDF_COUNT)
0486   0262 3D              DEC A
0487   0263 32 13 FF        LD  (MDF_COUNT), A
0488   0266 C3 7D 00        JP  EXIT_SYS
0489   0269             
0490   0269             MODIFY_KEY_POS_0:
0491   0269 F1              POP  AF
0492   026A 2A 0D FF        LD  HL, (PC_RAM)
0493   026D 46              LD  B, (HL)
0494   026E B0              OR  B
0495   026F 2A 0D FF        LD  HL, (PC_RAM)
0496   0272 77              LD  (HL), A
0497   0273             
0498   0273 F1              POP  AF
0499   0274 CD 03 08        CALL GET_NUM_FROM_LOW
0500   0277 32 07 FF        LD  (DIG_7), A
0501   027A C3 24 07        JP  GO_MONITOR
0502   027D                 
0503   027D             
0504   027D             SHOW_REG_PC:
0505   027D CD 12 06        CALL  GET_KEY_A
0506   0280 FE 00           CP  $00
0507   0282 CA 24 07        JP Z, GO_MONITOR
0508   0285 FE 01           CP  $01
0509   0287 CA 2F 07        JP Z, GO_SHOW_REG_PC
0510   028A FE 02           CP  $02
0511   028C CA 3A 07        JP Z, GO_SHOW_REG_SP
0512   028F FE 03           CP  $03
0513   0291 CA 45 07        JP Z, GO_SHOW_REG_AF
0514   0294 FE 04           CP  $04
0515   0296 CA 50 07        JP Z, GO_SHOW_REG_BC
0516   0299 FE 05           CP  $05
0517   029B CA 5B 07        JP Z, GO_SHOW_REG_DE
0518   029E FE 06           CP  $06
0519   02A0 CA 66 07        JP Z, GO_SHOW_REG_HL
0520   02A3 FE 07           CP  $07
0521   02A5 CA 71 07        JP Z, GO_SHOW_REG_IX
0522   02A8 FE 08           CP  $08
0523   02AA CA 7C 07        JP Z, GO_SHOW_REG_IY
0524   02AD             
0525   02AD 3E 50           LD  A, $50               ; R
0526   02AF 32 00 FF        LD  (DIG_0), A
0527   02B2             
0528   02B2 3E 73           LD  A, $73               ; P
0529   02B4 32 01 FF        LD  (DIG_1), A
0530   02B7             
0531   02B7 3E 39           LD  A, $39
0532   02B9 32 02 FF        LD  (DIG_2), A           ; C
0533   02BC             
0534   02BC 2A 14 FF        LD HL, (USR_PC)
0535   02BF CD B5 08        CALL PRINT_END_HL
0536   02C2 C3 7D 00        JP  EXIT_SYS
0537   02C5             
0538   02C5             
0539   02C5             SHOW_REG_SP:
0540   02C5 CD 12 06        CALL  GET_KEY_A
0541   02C8 FE 00           CP  $00
0542   02CA CA 24 07        JP Z, GO_MONITOR
0543   02CD FE 01           CP  $01
0544   02CF CA 2F 07        JP Z, GO_SHOW_REG_PC
0545   02D2 FE 02           CP  $02
0546   02D4 CA 3A 07        JP Z, GO_SHOW_REG_SP
0547   02D7 FE 03           CP  $03
0548   02D9 CA 45 07        JP Z, GO_SHOW_REG_AF
0549   02DC FE 04           CP  $04
0550   02DE CA 50 07        JP Z, GO_SHOW_REG_BC
0551   02E1 FE 05           CP  $05
0552   02E3 CA 5B 07        JP Z, GO_SHOW_REG_DE
0553   02E6 FE 06           CP  $06
0554   02E8 CA 66 07        JP Z, GO_SHOW_REG_HL
0555   02EB FE 07           CP  $07
0556   02ED CA 71 07        JP Z, GO_SHOW_REG_IX
0557   02F0 FE 08           CP  $08
0558   02F2 CA 7C 07        JP Z, GO_SHOW_REG_IY
0559   02F5             
0560   02F5 CD C9 07        CALL  CLEAR_DISPLAY
0561   02F8             
0562   02F8 3E 50           LD  A, $50               ; R
0563   02FA 32 00 FF        LD  (DIG_0), A
0564   02FD             
0565   02FD 3E 6D           LD  A, $6D               ; S
0566   02FF 32 01 FF        LD  (DIG_1), A
0567   0302             
0568   0302 3E 73           LD  A, $73               ; P
0569   0304 32 02 FF        LD  (DIG_2), A
0570   0307             
0571   0307 2A 16 FF        LD HL, (USR_SP)
0572   030A CD B5 08        CALL PRINT_END_HL
0573   030D C3 7D 00        JP  EXIT_SYS
0574   0310             
0575   0310             
0576   0310             SHOW_REG_AF:
0577   0310 CD 12 06        CALL  GET_KEY_A
0578   0313 FE 00           CP  $00
0579   0315 CA 24 07        JP Z, GO_MONITOR
0580   0318 FE 01           CP  $01
0581   031A CA 2F 07        JP Z, GO_SHOW_REG_PC
0582   031D FE 02           CP  $02
0583   031F CA 3A 07        JP Z, GO_SHOW_REG_SP
0584   0322 FE 03           CP  $03
0585   0324 CA 87 07        JP Z, GO_SHOW_REG_AFaux
0586   0327 FE 04           CP  $04
0587   0329 CA 50 07        JP Z, GO_SHOW_REG_BC
0588   032C FE 05           CP  $05
0589   032E CA 5B 07        JP Z, GO_SHOW_REG_DE
0590   0331 FE 06           CP  $06
0591   0333 CA 66 07        JP Z, GO_SHOW_REG_HL
0592   0336 FE 07           CP  $07
0593   0338 CA 71 07        JP Z, GO_SHOW_REG_IX
0594   033B FE 08           CP  $08
0595   033D CA 7C 07        JP Z, GO_SHOW_REG_IY
0596   0340             
0597   0340 CD C9 07        CALL  CLEAR_DISPLAY
0598   0343             
0599   0343 3E 50           LD  A, $50               ; R
0600   0345 32 00 FF        LD  (DIG_0), A
0601   0348             
0602   0348 3E 77           LD  A, $77               ; A
0603   034A 32 01 FF        LD  (DIG_1), A
0604   034D             
0605   034D 3E 71           LD  A, $71               ; F
0606   034F 32 02 FF        LD  (DIG_2), A
0607   0352             
0608   0352 2A 1E FF        LD HL, (USR_AF)
0609   0355 CD B5 08        CALL PRINT_END_HL
0610   0358 C3 7D 00        JP  EXIT_SYS
0611   035B             
0612   035B             
0613   035B             SHOW_REG_BC:
0614   035B CD 12 06        CALL  GET_KEY_A
0615   035E FE 00           CP  $00
0616   0360 CA 24 07        JP Z, GO_MONITOR
0617   0363 FE 01           CP  $01
0618   0365 CA 2F 07        JP Z, GO_SHOW_REG_PC
0619   0368 FE 02           CP  $02
0620   036A CA 3A 07        JP Z, GO_SHOW_REG_SP
0621   036D FE 03           CP  $03
0622   036F CA 45 07        JP Z, GO_SHOW_REG_AF
0623   0372 FE 04           CP  $04
0624   0374 CA 92 07        JP Z, GO_SHOW_REG_BCaux
0625   0377 FE 05           CP  $05
0626   0379 CA 5B 07        JP Z, GO_SHOW_REG_DE
0627   037C FE 06           CP  $06
0628   037E CA 66 07        JP Z, GO_SHOW_REG_HL
0629   0381 FE 07           CP  $07
0630   0383 CA 71 07        JP Z, GO_SHOW_REG_IX
0631   0386 FE 08           CP  $08
0632   0388 CA 7C 07        JP Z, GO_SHOW_REG_IY
0633   038B             
0634   038B CD C9 07        CALL  CLEAR_DISPLAY
0635   038E             
0636   038E 3E 50           LD  A, $50               ; R
0637   0390 32 00 FF        LD  (DIG_0), A
0638   0393             
0639   0393 3E 7C           LD  A, $7C               ; B
0640   0395 32 01 FF        LD  (DIG_1), A
0641   0398             
0642   0398 3E 39           LD  A, $39               ; C
0643   039A 32 02 FF        LD  (DIG_2), A
0644   039D             
0645   039D 2A 1A FF        LD HL, (USR_BC)
0646   03A0 CD B5 08        CALL PRINT_END_HL
0647   03A3 C3 7D 00        JP  EXIT_SYS
0648   03A6             
0649   03A6             SHOW_REG_DE:
0650   03A6 CD 12 06        CALL  GET_KEY_A
0651   03A9 FE 00           CP  $00
0652   03AB CA 24 07        JP Z, GO_MONITOR
0653   03AE FE 01           CP  $01
0654   03B0 CA 2F 07        JP Z, GO_SHOW_REG_PC
0655   03B3 FE 02           CP  $02
0656   03B5 CA 3A 07        JP Z, GO_SHOW_REG_SP
0657   03B8 FE 03           CP  $03
0658   03BA CA 45 07        JP Z, GO_SHOW_REG_AF
0659   03BD FE 04           CP  $04
0660   03BF CA 50 07        JP Z, GO_SHOW_REG_BC
0661   03C2 FE 05           CP  $05
0662   03C4 CA 9D 07        JP Z, GO_SHOW_REG_DEaux
0663   03C7 FE 06           CP  $06
0664   03C9 CA 66 07        JP Z, GO_SHOW_REG_HL
0665   03CC FE 07           CP  $07
0666   03CE CA 71 07        JP Z, GO_SHOW_REG_IX
0667   03D1 FE 08           CP  $08
0668   03D3 CA 7C 07        JP Z, GO_SHOW_REG_IY
0669   03D6             
0670   03D6 CD C9 07        CALL  CLEAR_DISPLAY
0671   03D9             
0672   03D9 3E 50           LD  A, $50               ; R
0673   03DB 32 00 FF        LD  (DIG_0), A
0674   03DE             
0675   03DE 3E 5E           LD  A, $5E               ; D
0676   03E0 32 01 FF        LD  (DIG_1), A
0677   03E3             
0678   03E3 3E 79           LD  A, $79               ; E
0679   03E5 32 02 FF        LD  (DIG_2), A
0680   03E8             
0681   03E8 2A 1C FF        LD HL, (USR_DE)
0682   03EB CD B5 08        CALL PRINT_END_HL
0683   03EE C3 7D 00        JP  EXIT_SYS
0684   03F1             
0685   03F1             SHOW_REG_HL:
0686   03F1 CD 12 06        CALL  GET_KEY_A
0687   03F4 FE 00           CP  $00
0688   03F6 CA 24 07        JP Z, GO_MONITOR
0689   03F9 FE 01           CP  $01
0690   03FB CA 2F 07        JP Z, GO_SHOW_REG_PC
0691   03FE FE 02           CP  $02
0692   0400 CA 3A 07        JP Z, GO_SHOW_REG_SP
0693   0403 FE 03           CP  $03
0694   0405 CA 45 07        JP Z, GO_SHOW_REG_AF
0695   0408 FE 04           CP  $04
0696   040A CA 50 07        JP Z, GO_SHOW_REG_BC
0697   040D FE 05           CP  $05
0698   040F CA 5B 07        JP Z, GO_SHOW_REG_DE
0699   0412 FE 06           CP  $06
0700   0414 CA A8 07        JP Z, GO_SHOW_REG_HLaux
0701   0417 FE 07           CP  $07
0702   0419 CA 71 07        JP Z, GO_SHOW_REG_IX
0703   041C FE 08           CP  $08
0704   041E CA 7C 07        JP Z, GO_SHOW_REG_IY
0705   0421             
0706   0421 CD C9 07        CALL  CLEAR_DISPLAY
0707   0424             
0708   0424 3E 50           LD  A, $50               ; R
0709   0426 32 00 FF        LD  (DIG_0), A
0710   0429             
0711   0429 3E 76           LD  A, $76               ; H
0712   042B 32 01 FF        LD  (DIG_1), A
0713   042E             
0714   042E 3E 38           LD  A, $38               ; L
0715   0430 32 02 FF        LD  (DIG_2), A
0716   0433             
0717   0433 2A 18 FF        LD HL, (USR_HL)
0718   0436 CD B5 08        CALL PRINT_END_HL
0719   0439 C3 7D 00        JP  EXIT_SYS
0720   043C             
0721   043C             SHOW_REG_IX:
0722   043C CD 12 06        CALL  GET_KEY_A
0723   043F FE 00           CP  $00
0724   0441 CA 24 07        JP Z, GO_MONITOR
0725   0444 FE 01           CP  $01
0726   0446 CA 2F 07        JP Z, GO_SHOW_REG_PC
0727   0449 FE 02           CP  $02
0728   044B CA 3A 07        JP Z, GO_SHOW_REG_SP
0729   044E FE 03           CP  $03
0730   0450 CA 45 07        JP Z, GO_SHOW_REG_AF
0731   0453 FE 04           CP  $04
0732   0455 CA 50 07        JP Z, GO_SHOW_REG_BC
0733   0458 FE 05           CP  $05
0734   045A CA 5B 07        JP Z, GO_SHOW_REG_DE
0735   045D FE 06           CP  $06
0736   045F CA 66 07        JP Z, GO_SHOW_REG_HL
0737   0462 FE 07           CP  $07
0738   0464 CA 71 07        JP Z, GO_SHOW_REG_IX
0739   0467 FE 08           CP  $08
0740   0469 CA 7C 07        JP Z, GO_SHOW_REG_IY
0741   046C             
0742   046C CD C9 07        CALL  CLEAR_DISPLAY
0743   046F             
0744   046F 3E 50           LD  A, $50               ; R
0745   0471 32 00 FF        LD  (DIG_0), A
0746   0474             
0747   0474 3E 06           LD  A, $06               ; I
0748   0476 32 01 FF        LD  (DIG_1), A
0749   0479             
0750   0479 3E 70           LD  A, $70               ; X
0751   047B 32 02 FF        LD  (DIG_2), A
0752   047E             
0753   047E 2A 20 FF        LD HL, (USR_IX)
0754   0481 CD B5 08        CALL PRINT_END_HL
0755   0484 C3 7D 00        JP  EXIT_SYS
0756   0487             
0757   0487             SHOW_REG_IY:
0758   0487 CD 12 06        CALL  GET_KEY_A
0759   048A FE 00           CP  $00
0760   048C CA 24 07        JP Z, GO_MONITOR
0761   048F FE 01           CP  $01
0762   0491 CA 2F 07        JP Z, GO_SHOW_REG_PC
0763   0494 FE 02           CP  $02
0764   0496 CA 3A 07        JP Z, GO_SHOW_REG_SP
0765   0499 FE 03           CP  $03
0766   049B CA 45 07        JP Z, GO_SHOW_REG_AF
0767   049E FE 04           CP  $04
0768   04A0 CA 50 07        JP Z, GO_SHOW_REG_BC
0769   04A3 FE 05           CP  $05
0770   04A5 CA 5B 07        JP Z, GO_SHOW_REG_DE
0771   04A8 FE 06           CP  $06
0772   04AA CA 66 07        JP Z, GO_SHOW_REG_HL
0773   04AD FE 07           CP  $07
0774   04AF CA 71 07        JP Z, GO_SHOW_REG_IX
0775   04B2 FE 08           CP  $08
0776   04B4 CA 7C 07        JP Z, GO_SHOW_REG_IY
0777   04B7             
0778   04B7 CD C9 07        CALL  CLEAR_DISPLAY
0779   04BA             
0780   04BA 3E 50           LD  A, $50               ; R
0781   04BC 32 00 FF        LD  (DIG_0), A
0782   04BF             
0783   04BF 3E 06           LD  A, $06               ; I
0784   04C1 32 01 FF        LD  (DIG_1), A
0785   04C4             
0786   04C4 3E 6E           LD  A, $6E               ; Y
0787   04C6 32 02 FF        LD  (DIG_2), A
0788   04C9             
0789   04C9 2A 22 FF        LD HL, (USR_IY)
0790   04CC CD B5 08        CALL PRINT_END_HL
0791   04CF C3 7D 00        JP  EXIT_SYS
0792   04D2             
0793   04D2             SHOW_REG_AFaux:
0794   04D2 CD 12 06        CALL  GET_KEY_A
0795   04D5 FE 00           CP  $00
0796   04D7 CA 24 07        JP Z, GO_MONITOR
0797   04DA FE 01           CP  $01
0798   04DC CA 2F 07        JP Z, GO_SHOW_REG_PC
0799   04DF FE 02           CP  $02
0800   04E1 CA 3A 07        JP Z, GO_SHOW_REG_SP
0801   04E4 FE 03           CP  $03
0802   04E6 CA 45 07        JP Z, GO_SHOW_REG_AF
0803   04E9 FE 04           CP  $04
0804   04EB CA 50 07        JP Z, GO_SHOW_REG_BC
0805   04EE FE 05           CP  $05
0806   04F0 CA 5B 07        JP Z, GO_SHOW_REG_DE
0807   04F3 FE 06           CP  $06
0808   04F5 CA 66 07        JP Z, GO_SHOW_REG_HL
0809   04F8 FE 07           CP  $07
0810   04FA CA 71 07        JP Z, GO_SHOW_REG_IX
0811   04FD FE 08           CP  $08
0812   04FF CA 7C 07        JP Z, GO_SHOW_REG_IY
0813   0502             
0814   0502 CD C9 07        CALL  CLEAR_DISPLAY
0815   0505             
0816   0505 3E 50           LD  A, $50               ; R
0817   0507 32 00 FF        LD  (DIG_0), A
0818   050A             
0819   050A 3E 77           LD  A, $77               ; A
0820   050C 32 01 FF        LD  (DIG_1), A
0821   050F             
0822   050F 3E 71           LD  A, $71               ; F
0823   0511 32 02 FF        LD  (DIG_2), A
0824   0514             
0825   0514 3E 20           LD  A, $20               ; '
0826   0516 32 03 FF        LD  (DIG_3), A
0827   0519             
0828   0519 2A 24 FF        LD HL, (USR_AFA)
0829   051C CD B5 08        CALL PRINT_END_HL
0830   051F C3 7D 00        JP  EXIT_SYS
0831   0522             
0832   0522             
0833   0522             SHOW_REG_BCaux:
0834   0522 CD 12 06        CALL  GET_KEY_A
0835   0525 FE 00           CP  $00
0836   0527 CA 24 07        JP Z, GO_MONITOR
0837   052A FE 01           CP  $01
0838   052C CA 2F 07        JP Z, GO_SHOW_REG_PC
0839   052F FE 02           CP  $02
0840   0531 CA 3A 07        JP Z, GO_SHOW_REG_SP
0841   0534 FE 03           CP  $03
0842   0536 CA 45 07        JP Z, GO_SHOW_REG_AF
0843   0539 FE 04           CP  $04
0844   053B CA 50 07        JP Z, GO_SHOW_REG_BC
0845   053E FE 05           CP  $05
0846   0540 CA 5B 07        JP Z, GO_SHOW_REG_DE
0847   0543 FE 06           CP  $06
0848   0545 CA 66 07        JP Z, GO_SHOW_REG_HL
0849   0548 FE 07           CP  $07
0850   054A CA 71 07        JP Z, GO_SHOW_REG_IX
0851   054D FE 08           CP  $08
0852   054F CA 7C 07        JP Z, GO_SHOW_REG_IY
0853   0552             
0854   0552 CD C9 07        CALL  CLEAR_DISPLAY
0855   0555             
0856   0555 3E 50           LD  A, $50               ; R
0857   0557 32 00 FF        LD  (DIG_0), A
0858   055A             
0859   055A 3E 7C           LD  A, $7C               ; B
0860   055C 32 01 FF        LD  (DIG_1), A
0861   055F             
0862   055F 3E 39           LD  A, $39               ; C
0863   0561 32 02 FF        LD  (DIG_2), A
0864   0564             
0865   0564 3E 20           LD  A, $20               ; '
0866   0566 32 03 FF        LD  (DIG_3), A
0867   0569             
0868   0569 2A 26 FF        LD HL, (USR_BCA)
0869   056C CD B5 08        CALL PRINT_END_HL
0870   056F C3 7D 00        JP  EXIT_SYS
0871   0572             
0872   0572             SHOW_REG_DEaux:
0873   0572 CD 12 06        CALL  GET_KEY_A
0874   0575 FE 00           CP  $00
0875   0577 CA 24 07        JP Z, GO_MONITOR
0876   057A FE 01           CP  $01
0877   057C CA 2F 07        JP Z, GO_SHOW_REG_PC
0878   057F FE 02           CP  $02
0879   0581 CA 3A 07        JP Z, GO_SHOW_REG_SP
0880   0584 FE 03           CP  $03
0881   0586 CA 45 07        JP Z, GO_SHOW_REG_AF
0882   0589 FE 04           CP  $04
0883   058B CA 50 07        JP Z, GO_SHOW_REG_BC
0884   058E FE 05           CP  $05
0885   0590 CA 5B 07        JP Z, GO_SHOW_REG_DE
0886   0593 FE 06           CP  $06
0887   0595 CA 66 07        JP Z, GO_SHOW_REG_HL
0888   0598 FE 07           CP  $07
0889   059A CA 71 07        JP Z, GO_SHOW_REG_IX
0890   059D FE 08           CP  $08
0891   059F CA 7C 07        JP Z, GO_SHOW_REG_IY
0892   05A2             
0893   05A2 CD C9 07        CALL  CLEAR_DISPLAY
0894   05A5             
0895   05A5 3E 50           LD  A, $50               ; R
0896   05A7 32 00 FF        LD  (DIG_0), A
0897   05AA             
0898   05AA 3E 5E           LD  A, $5E               ; D
0899   05AC 32 01 FF        LD  (DIG_1), A
0900   05AF             
0901   05AF 3E 79           LD  A, $79               ; E
0902   05B1 32 02 FF        LD  (DIG_2), A
0903   05B4             
0904   05B4 3E 20           LD  A, $20               ; '
0905   05B6 32 03 FF        LD  (DIG_3), A
0906   05B9             
0907   05B9 2A 28 FF        LD HL, (USR_DEA)
0908   05BC CD B5 08        CALL PRINT_END_HL
0909   05BF C3 7D 00        JP  EXIT_SYS
0910   05C2             
0911   05C2             SHOW_REG_HLaux:
0912   05C2 CD 12 06        CALL  GET_KEY_A
0913   05C5 FE 00           CP  $00
0914   05C7 CA 24 07        JP Z, GO_MONITOR
0915   05CA FE 01           CP  $01
0916   05CC CA 2F 07        JP Z, GO_SHOW_REG_PC
0917   05CF FE 02           CP  $02
0918   05D1 CA 3A 07        JP Z, GO_SHOW_REG_SP
0919   05D4 FE 03           CP  $03
0920   05D6 CA 45 07        JP Z, GO_SHOW_REG_AF
0921   05D9 FE 04           CP  $04
0922   05DB CA 50 07        JP Z, GO_SHOW_REG_BC
0923   05DE FE 05           CP  $05
0924   05E0 CA 5B 07        JP Z, GO_SHOW_REG_DE
0925   05E3 FE 06           CP  $06
0926   05E5 CA 66 07        JP Z, GO_SHOW_REG_HL
0927   05E8 FE 07           CP  $07
0928   05EA CA 71 07        JP Z, GO_SHOW_REG_IX
0929   05ED FE 08           CP  $08
0930   05EF CA 7C 07        JP Z, GO_SHOW_REG_IY
0931   05F2             
0932   05F2 CD C9 07        CALL  CLEAR_DISPLAY
0933   05F5             
0934   05F5 3E 50           LD  A, $50               ; R
0935   05F7 32 00 FF        LD  (DIG_0), A
0936   05FA             
0937   05FA 3E 76           LD  A, $76               ; H
0938   05FC 32 01 FF        LD  (DIG_1), A
0939   05FF             
0940   05FF 3E 38           LD  A, $38               ; L
0941   0601 32 02 FF        LD  (DIG_2), A
0942   0604             
0943   0604 3E 20           LD  A, $20               ; '
0944   0606 32 03 FF        LD  (DIG_3), A
0945   0609             
0946   0609 2A 2A FF        LD HL, (USR_HLA)
0947   060C CD B5 08        CALL PRINT_END_HL
0948   060F C3 7D 00        JP  EXIT_SYS
0949   0612             
0950   0612             
0951   0612             ; =========================================================
0952   0612             ; GET KEY IN A, IF A == FFh then no KEY
0953   0612             ; =========================================================
0954   0612             GET_KEY_A:
0955   0612 3A 0B FF        LD  A, (KEY_TIMEOUT)
0956   0615 FE 00           CP  0
0957   0617 CA 1D 06        JP  Z, RET_KEY
0958   061A 3E FF           LD  A, $FF
0959   061C C9              RET
0960   061D             
0961   061D             RET_KEY:
0962   061D 3E 64           LD A, CKEY_TIMEOUT
0963   061F 32 0B FF        LD (KEY_TIMEOUT), A
0964   0622             
0965   0622 3A 08 FF        LD  A, (KEY_PRESS)
0966   0625 F5              PUSH  AF
0967   0626 3E FF           LD  A, $FF
0968   0628 32 08 FF        LD  (KEY_PRESS), A
0969   062B F1              POP  AF
0970   062C C9              RET
0971   062D             
0972   062D             
0973   062D             ; =========================================================
0974   062D             ; MONITOR Mode
0975   062D             ; =========================================================
0976   062D             USER_MODE:
0977   062D 3A 09 FF        LD  A, (INPUT)
0978   0630 FE FB           CP  $FB
0979   0632 CA 24 07        JP  Z, GO_MONITOR
0980   0635                 
0981   0635                 ; Copy USER_DISPx to DIG_x
0982   0635 21 D0 FF        LD	HL, USER_DISP0
0983   0638 11 00 FF    	LD	DE, DIG_0
0984   063B 01 08 00    	LD	BC, $0008
0985   063E ED B0       	LDIR
0986   0640             
0987   0640 C3 7D 00        JP  EXIT_SYS
0988   0643             
0989   0643             MONITOR_MODE:
0990   0643                 ; Mostra o endereço
0991   0643 2A 0D FF        LD  HL, (PC_RAM)
0992   0646 CD 58 08        CALL PRINT_HL
0993   0649             
0994   0649                 ; Limpa digitos
0995   0649 3E 00           LD  A, 0
0996   064B 32 04 FF        LD  (DIG_4), A
0997   064E 32 05 FF        LD  (DIG_5), A
0998   0651             
0999   0651                 ; Mostra os dados no endereço
1000   0651 2A 0D FF        LD  HL, (PC_RAM)
1001   0654 7E              LD  A, (HL)
1002   0655 CD 2B 08        CALL  PRINT_A
1003   0658             
1004   0658             
1005   0658 CD 12 06        CALL  GET_KEY_A
1006   065B             
1007   065B                 ; Incrementa endereço
1008   065B 32 0A FF        LD (TMP_KEY), A
1009   065E FE 0A           CP  $0A
1010   0660 CA E0 06        JP  Z,  PC_RAM_INC
1011   0663             
1012   0663                 ; Decrementa endereço
1013   0663 3A 0A FF        LD  A, (TMP_KEY)
1014   0666 FE 0B           CP  $0B
1015   0668 CA D6 06        JP  Z,  PC_RAM_DEC
1016   066B             
1017   066B                 ; Examina memoria
1018   066B 3A 0A FF        LD  A, (TMP_KEY)
1019   066E FE 0E           CP  $0E
1020   0670 CA EA 06        JP  Z,  GO_EXAMINE
1021   0673             
1022   0673                 ; + moDify Memory
1023   0673 3A 0A FF        LD  A, (TMP_KEY)
1024   0676 FE 0C           CP  $0C
1025   0678 CA 05 07        JP  Z,  GO_ADD_MODIFY
1026   067B             
1027   067B                 ; moDify Memory
1028   067B 3A 0A FF        LD  A, (TMP_KEY)
1029   067E FE 0D           CP  $0D
1030   0680 CA 0F 07        JP  Z,  GO_MODIFY
1031   0683             
1032   0683                 ; RUN
1033   0683 3A 0A FF        LD  A, (TMP_KEY)
1034   0686 FE 0F           CP  $0F
1035   0688 CA B3 07        JP  Z,  FIRE
1036   068B             
1037   068B                 ; Show register PC
1038   068B 3A 0A FF        LD  A, (TMP_KEY)
1039   068E FE 01           CP  $01
1040   0690 CA 2F 07        JP  Z, GO_SHOW_REG_PC
1041   0693             
1042   0693                 ; Show register SP
1043   0693 3A 0A FF        LD  A, (TMP_KEY)
1044   0696 FE 02           CP  $02
1045   0698 CA 3A 07        JP  Z, GO_SHOW_REG_SP
1046   069B             
1047   069B                 ; Show register AF
1048   069B 3A 0A FF        LD  A, (TMP_KEY)
1049   069E FE 03           CP  $03
1050   06A0 CA 45 07        JP  Z, GO_SHOW_REG_AF
1051   06A3             
1052   06A3                 ; Show register BC
1053   06A3 3A 0A FF        LD  A, (TMP_KEY)
1054   06A6 FE 04           CP  $04
1055   06A8 CA 50 07        JP  Z, GO_SHOW_REG_BC
1056   06AB             
1057   06AB                 ; Show register DE
1058   06AB 3A 0A FF        LD  A, (TMP_KEY)
1059   06AE FE 05           CP  $05
1060   06B0 CA 5B 07        JP  Z, GO_SHOW_REG_DE
1061   06B3             
1062   06B3                 ; Show register HL
1063   06B3 3A 0A FF        LD  A, (TMP_KEY)
1064   06B6 FE 06           CP  $06
1065   06B8 CA 66 07        JP  Z, GO_SHOW_REG_HL
1066   06BB             
1067   06BB                 ; Show register IX
1068   06BB 3A 0A FF        LD  A, (TMP_KEY)
1069   06BE FE 07           CP  $07
1070   06C0 CA 71 07        JP  Z, GO_SHOW_REG_IX
1071   06C3             
1072   06C3                 ; Show register iY
1073   06C3 3A 0A FF        LD  A, (TMP_KEY)
1074   06C6 FE 08           CP  $08
1075   06C8 CA 7C 07        JP  Z, GO_SHOW_REG_IY
1076   06CB             
1077   06CB                 ; Back to user mode
1078   06CB 3A 0A FF        LD  A, (TMP_KEY)
1079   06CE FE 09           CP  $09
1080   06D0 CA C1 07        JP  Z, GO_USER_MODE
1081   06D3             
1082   06D3 C3 7D 00        JP  EXIT_SYS
1083   06D6                 
1084   06D6             
1085   06D6             PC_RAM_DEC:
1086   06D6 2A 0D FF        LD  HL, (PC_RAM)
1087   06D9 2B              DEC  HL
1088   06DA 22 0D FF        LD  (PC_RAM), HL
1089   06DD C3 7D 00        JP  EXIT_SYS
1090   06E0             
1091   06E0             PC_RAM_INC:
1092   06E0 2A 0D FF        LD  HL, (PC_RAM)
1093   06E3 23              INC  HL
1094   06E4 22 0D FF        LD  (PC_RAM), HL
1095   06E7 C3 7D 00        JP  EXIT_SYS
1096   06EA             
1097   06EA             GO_EXAMINE:
1098   06EA 3E 03           LD  A, $03
1099   06EC 32 12 FF        LD (EXM_COUNT), A        ; Set count 4 digits, position display
1100   06EF 3E 02           LD  A, $02
1101   06F1 32 0F FF        LD (SYSMODE), A          ; Examine mode
1102   06F4 3E 40           LD A, 01000000b
1103   06F6 32 00 FF        LD (DIG_0), A
1104   06F9 32 01 FF        LD (DIG_1), A
1105   06FC 32 02 FF        LD (DIG_2), A
1106   06FF 32 03 FF        LD (DIG_3), A
1107   0702 C3 7D 00        JP  EXIT_SYS
1108   0705             
1109   0705             GO_ADD_MODIFY:
1110   0705 2A 0D FF        LD  HL, (PC_RAM)
1111   0708 23              INC HL
1112   0709 22 0D FF        LD  (PC_RAM), HL
1113   070C CD 58 08        CALL  PRINT_HL
1114   070F             GO_MODIFY:
1115   070F 3E 01           LD  A, $01                  ; Set count 2 digits, position display
1116   0711 32 13 FF        LD  (MDF_COUNT), A
1117   0714 3E 03           LD  A, $03                  ; moDify mode (Memory)
1118   0716 32 0F FF        LD  (SYSMODE), A
1119   0719 3E 40           LD  A, 01000000b
1120   071B 32 06 FF        LD  (DIG_6), A
1121   071E 32 07 FF        LD  (DIG_7), A
1122   0721 C3 7D 00        JP  EXIT_SYS
1123   0724             
1124   0724             GO_MONITOR:
1125   0724 CD C9 07        CALL  CLEAR_DISPLAY
1126   0727 3E 01           LD  A, $01
1127   0729 32 0F FF        LD  (SYSMODE), A
1128   072C C3 7D 00        JP  EXIT_SYS
1129   072F             
1130   072F             GO_SHOW_REG_PC:
1131   072F CD C9 07        CALL CLEAR_DISPLAY
1132   0732 3E 04           LD  A, $04
1133   0734 32 0F FF        LD  (SYSMODE), A
1134   0737 C3 7D 00        JP  EXIT_SYS
1135   073A             
1136   073A             GO_SHOW_REG_SP:
1137   073A CD C9 07        CALL CLEAR_DISPLAY
1138   073D 3E 05           LD  A, $05
1139   073F 32 0F FF        LD  (SYSMODE), A
1140   0742 C3 7D 00        JP  EXIT_SYS
1141   0745             
1142   0745             GO_SHOW_REG_AF:
1143   0745 CD C9 07        CALL CLEAR_DISPLAY
1144   0748 3E 06           LD  A, $06
1145   074A 32 0F FF        LD  (SYSMODE), A
1146   074D C3 7D 00        JP  EXIT_SYS
1147   0750             
1148   0750             GO_SHOW_REG_BC:
1149   0750 CD C9 07        CALL CLEAR_DISPLAY
1150   0753 3E 07           LD  A, $07
1151   0755 32 0F FF        LD  (SYSMODE), A
1152   0758 C3 7D 00        JP  EXIT_SYS
1153   075B             
1154   075B             GO_SHOW_REG_DE:
1155   075B CD C9 07        CALL CLEAR_DISPLAY
1156   075E 3E 08           LD  A, $08
1157   0760 32 0F FF        LD  (SYSMODE), A
1158   0763 C3 7D 00        JP  EXIT_SYS
1159   0766             
1160   0766             GO_SHOW_REG_HL:
1161   0766 CD C9 07        CALL CLEAR_DISPLAY
1162   0769 3E 09           LD  A, $09
1163   076B 32 0F FF        LD  (SYSMODE), A
1164   076E C3 7D 00        JP  EXIT_SYS
1165   0771             
1166   0771             GO_SHOW_REG_IX:
1167   0771 CD C9 07        CALL CLEAR_DISPLAY
1168   0774 3E 0A           LD  A, $0A
1169   0776 32 0F FF        LD  (SYSMODE), A
1170   0779 C3 7D 00        JP  EXIT_SYS
1171   077C             
1172   077C             GO_SHOW_REG_IY:
1173   077C CD C9 07        CALL CLEAR_DISPLAY
1174   077F 3E 0B           LD  A, $0B
1175   0781 32 0F FF        LD  (SYSMODE), A
1176   0784 C3 7D 00        JP  EXIT_SYS
1177   0787             
1178   0787             GO_SHOW_REG_AFaux:
1179   0787 CD C9 07        CALL CLEAR_DISPLAY
1180   078A 3E 0C           LD  A, $0C
1181   078C 32 0F FF        LD  (SYSMODE), A
1182   078F C3 7D 00        JP  EXIT_SYS
1183   0792             
1184   0792             GO_SHOW_REG_BCaux:
1185   0792 CD C9 07        CALL CLEAR_DISPLAY
1186   0795 3E 0D           LD  A, $0D
1187   0797 32 0F FF        LD  (SYSMODE), A
1188   079A C3 7D 00        JP  EXIT_SYS
1189   079D             
1190   079D             GO_SHOW_REG_DEaux:
1191   079D CD C9 07        CALL CLEAR_DISPLAY
1192   07A0 3E 0E           LD  A, $0E
1193   07A2 32 0F FF        LD  (SYSMODE), A
1194   07A5 C3 7D 00        JP  EXIT_SYS
1195   07A8             
1196   07A8             GO_SHOW_REG_HLaux:
1197   07A8 CD C9 07        CALL CLEAR_DISPLAY
1198   07AB 3E 0F           LD  A, $0F
1199   07AD 32 0F FF        LD  (SYSMODE), A
1200   07B0 C3 7D 00        JP  EXIT_SYS
1201   07B3             
1202   07B3             FIRE:
1203   07B3 3E 01           LD  A, 1
1204   07B5 32 0F FF        LD (SYSMODE), A          ; Monitor mode
1205   07B8 2A 0D FF        LD  HL, (PC_RAM)
1206   07BB 22 14 FF        LD  (USR_PC), HL
1207   07BE C3 7D 00        JP  EXIT_SYS
1208   07C1             
1209   07C1             GO_USER_MODE:
1210   07C1 3E 00           LD  A, 0
1211   07C3 32 0F FF        LD  (SYSMODE), A
1212   07C6 C3 7D 00        JP  EXIT_SYS
1213   07C9             
1214   07C9             ; =========================================================
1215   07C9             ; LIMPA DISPLAY
1216   07C9             ; =========================================================
1217   07C9             CLEAR_DISPLAY:
1218   07C9 F5              PUSH  AF
1219   07CA 3E 00           LD  A, 0
1220   07CC 32 00 FF        LD  (DIG_0), A
1221   07CF 32 01 FF        LD  (DIG_1), A
1222   07D2 32 02 FF        LD  (DIG_2), A
1223   07D5 32 03 FF        LD  (DIG_3), A
1224   07D8 32 04 FF        LD  (DIG_4), A
1225   07DB 32 05 FF        LD  (DIG_5), A
1226   07DE 32 06 FF        LD  (DIG_6), A
1227   07E1 32 07 FF        LD  (DIG_7), A
1228   07E4 F1              POP  AF
1229   07E5 C9              RET
1230   07E6             
1231   07E6             ; =========================================================
1232   07E6             ; LIMPA USER DISPLAY
1233   07E6             ; =========================================================
1234   07E6             CLEAR_USER_DISPLAY:
1235   07E6 F5              PUSH  AF
1236   07E7 3E 00           LD  A, 0
1237   07E9 32 D0 FF        LD  (USER_DISP0), A
1238   07EC 32 D1 FF        LD  (USER_DISP1), A
1239   07EF 32 D2 FF        LD  (USER_DISP2), A
1240   07F2 32 D3 FF        LD  (USER_DISP3), A
1241   07F5 32 D4 FF        LD  (USER_DISP4), A
1242   07F8 32 D5 FF        LD  (USER_DISP5), A
1243   07FB 32 D6 FF        LD  (USER_DISP6), A
1244   07FE 32 D7 FF        LD  (USER_DISP7), A
1245   0801 F1              POP  AF
1246   0802 C9              RET
1247   0803             
1248   0803             
1249   0803             ; =========================================================
1250   0803             ; PEGA LOW NUM EM A E RETORNA CHAR 7SEG EM A
1251   0803             ; =========================================================
1252   0803             GET_NUM_FROM_LOW:
1253   0803 E5              PUSH    HL
1254   0804 C5              PUSH    BC
1255   0805 21 85 09        LD      HL, LED_FONT
1256   0808 E6 0F           AND     $0F
1257   080A 01 00 00        LD      BC, 0
1258   080D 4F              LD      C, A
1259   080E 09              ADD     HL, BC
1260   080F 7E              LD      A, (HL)
1261   0810 C1              POP     BC
1262   0811 E1              POP     HL
1263   0812 C9              RET
1264   0813             
1265   0813             ; =========================================================
1266   0813             ; PEGA HIGH NUM EM A E RETORNA CHAR 7SEG EM A
1267   0813             ; =========================================================
1268   0813             GET_NUM_FROM_HIGH:
1269   0813 E5              PUSH    HL
1270   0814 C5              PUSH    BC
1271   0815 21 85 09        LD      HL, LED_FONT
1272   0818 E6 F0           AND     $F0
1273   081A CB 0F           RRC     A
1274   081C CB 0F           RRC     A
1275   081E CB 0F           RRC     A
1276   0820 CB 0F           RRC     A
1277   0822 01 00 00        LD      BC, 0
1278   0825 4F              LD      C, A
1279   0826 09              ADD     HL, BC
1280   0827 7E              LD      A, (HL)
1281   0828 C1              POP     BC
1282   0829 E1              POP     HL
1283   082A C9              RET
1284   082B             
1285   082B             ; =========================================================
1286   082B             ; Mostra o que esta em A nos digitos 6 e 7
1287   082B             ; =========================================================
1288   082B             PRINT_A:
1289   082B E5              PUSH    HL
1290   082C C5              PUSH    BC
1291   082D F5              PUSH    AF
1292   082E F5              PUSH    AF
1293   082F             
1294   082F 21 85 09        LD	HL, LED_FONT
1295   0832 E6 0F           AND $0F
1296   0834 01 00 00        LD      BC, 0
1297   0837 4F              LD      C, A
1298   0838 09              ADD HL, BC
1299   0839 7E              LD  A, (HL)
1300   083A 32 07 FF        LD  (DIG_7), A
1301   083D             
1302   083D F1              POP    AF
1303   083E 21 85 09        LD	HL, LED_FONT
1304   0841 E6 F0           AND  $F0
1305   0843 CB 0F           RRC  A
1306   0845 CB 0F           RRC  A
1307   0847 CB 0F           RRC  A
1308   0849 CB 0F           RRC  A
1309   084B 01 00 00        LD      BC, 0
1310   084E 4F              LD      C, A
1311   084F 09              ADD HL, BC
1312   0850 7E              LD  A, (HL)
1313   0851 32 06 FF        LD  (DIG_6), A
1314   0854             
1315   0854 F1              POP     AF
1316   0855 C1              POP     BC
1317   0856 E1              POP     HL
1318   0857 C9              RET
1319   0858             
1320   0858             ; =========================================================
1321   0858             ; Mostra o que esta em HL - Display(HHLLXXXX)
1322   0858             ; =========================================================
1323   0858             PRINT_HL:
1324   0858 F5              PUSH  AF
1325   0859 E5              PUSH  HL
1326   085A C5              PUSH  BC
1327   085B             
1328   085B E5              PUSH  HL
1329   085C E5              PUSH  HL
1330   085D E5              PUSH  HL
1331   085E             
1332   085E 7D              LD  A, L
1333   085F 21 85 09        LD	HL, LED_FONT
1334   0862 E6 0F           AND $0F
1335   0864 01 00 00        LD      BC, 0
1336   0867 4F              LD      C, A
1337   0868 09              ADD HL, BC
1338   0869 7E              LD  A, (HL)
1339   086A 21 03 FF        LD  HL, DIG_3
1340   086D 77              LD  (HL), A
1341   086E             
1342   086E E1              POP  HL
1343   086F 7D              LD  A, L
1344   0870 21 85 09        LD	HL, LED_FONT
1345   0873 E6 F0           AND  $F0
1346   0875 CB 0F           RRC  A
1347   0877 CB 0F           RRC  A
1348   0879 CB 0F           RRC  A
1349   087B CB 0F           RRC  A
1350   087D 01 00 00        LD      BC, 0
1351   0880 4F              LD      C, A
1352   0881 09              ADD HL, BC
1353   0882 7E              LD  A, (HL)
1354   0883 21 02 FF        LD  HL, DIG_2
1355   0886 77              LD  (HL), A
1356   0887             
1357   0887 E1              POP  HL
1358   0888 7C              LD  A, H
1359   0889 21 85 09        LD	HL, LED_FONT
1360   088C E6 0F           AND $0F
1361   088E 01 00 00        LD      BC, 0
1362   0891 4F              LD      C, A
1363   0892 09              ADD HL, BC
1364   0893 7E              LD  A, (HL)
1365   0894 21 01 FF        LD  HL, DIG_1
1366   0897 77              LD  (HL), A
1367   0898             
1368   0898 E1              POP  HL
1369   0899 7C              LD  A, H
1370   089A 21 85 09        LD	HL, LED_FONT
1371   089D E6 F0           AND  $F0
1372   089F CB 0F           RRC  A
1373   08A1 CB 0F           RRC  A
1374   08A3 CB 0F           RRC  A
1375   08A5 CB 0F           RRC  A
1376   08A7 01 00 00        LD      BC, 0
1377   08AA 4F              LD      C, A
1378   08AB 09              ADD HL, BC
1379   08AC 7E              LD  A, (HL)
1380   08AD 21 00 FF        LD  HL, DIG_0
1381   08B0 77              LD  (HL), A
1382   08B1             
1383   08B1 C1              POP  BC
1384   08B2 E1              POP  HL
1385   08B3 F1              POP  AF
1386   08B4             
1387   08B4 C9              RET
1388   08B5             
1389   08B5             ; =========================================================
1390   08B5             ; Mostra o que esta em HL - Display(XXXXHHLL)
1391   08B5             ; =========================================================
1392   08B5             PRINT_END_HL:
1393   08B5 F5              PUSH  AF
1394   08B6 E5              PUSH  HL
1395   08B7 C5              PUSH  BC
1396   08B8             
1397   08B8 E5              PUSH  HL
1398   08B9 E5              PUSH  HL
1399   08BA E5              PUSH  HL
1400   08BB             
1401   08BB 7D              LD  A, L
1402   08BC 21 85 09        LD	HL, LED_FONT
1403   08BF E6 0F           AND $0F
1404   08C1 01 00 00        LD      BC, 0
1405   08C4 4F              LD      C, A
1406   08C5 09              ADD HL, BC
1407   08C6 7E              LD  A, (HL)
1408   08C7 21 07 FF        LD  HL, DIG_7
1409   08CA 77              LD  (HL), A
1410   08CB             
1411   08CB E1              POP  HL
1412   08CC 7D              LD  A, L
1413   08CD 21 85 09        LD	HL, LED_FONT
1414   08D0 E6 F0           AND  $F0
1415   08D2 CB 0F           RRC  A
1416   08D4 CB 0F           RRC  A
1417   08D6 CB 0F           RRC  A
1418   08D8 CB 0F           RRC  A
1419   08DA 01 00 00        LD      BC, 0
1420   08DD 4F              LD      C, A
1421   08DE 09              ADD HL, BC
1422   08DF 7E              LD  A, (HL)
1423   08E0 21 06 FF        LD  HL, DIG_6
1424   08E3 77              LD  (HL), A
1425   08E4             
1426   08E4 E1              POP  HL
1427   08E5 7C              LD  A, H
1428   08E6 21 85 09        LD	HL, LED_FONT
1429   08E9 E6 0F           AND $0F
1430   08EB 01 00 00        LD      BC, 0
1431   08EE 4F              LD      C, A
1432   08EF 09              ADD HL, BC
1433   08F0 7E              LD  A, (HL)
1434   08F1 21 05 FF        LD  HL, DIG_5
1435   08F4 77              LD  (HL), A
1436   08F5             
1437   08F5 E1              POP  HL
1438   08F6 7C              LD  A, H
1439   08F7 21 85 09        LD	HL, LED_FONT
1440   08FA E6 F0           AND  $F0
1441   08FC CB 0F           RRC  A
1442   08FE CB 0F           RRC  A
1443   0900 CB 0F           RRC  A
1444   0902 CB 0F           RRC  A
1445   0904 01 00 00        LD      BC, 0
1446   0907 4F              LD      C, A
1447   0908 09              ADD HL, BC
1448   0909 7E              LD  A, (HL)
1449   090A 21 04 FF        LD  HL, DIG_4
1450   090D 77              LD  (HL), A
1451   090E             
1452   090E C1              POP  BC
1453   090F E1              POP  HL
1454   0910 F1              POP  AF
1455   0911             
1456   0911 C9              RET
1457   0912             
1458   0912             ; =========================================================
1459   0912             ; Start Sistem ?
1460   0912             ; =========================================================
1461   0912             START:
1462   0912 31 00 FF        LD  SP, STACK
1463   0915 21 00 80        LD  HL, START_RAM
1464   0918 22 0D FF        LD  (PC_RAM), HL
1465   091B             
1466   091B                 ; start vars
1467   091B 3E 64           LD  A, CKEY_TIMEOUT
1468   091D 32 0B FF        LD  (KEY_TIMEOUT), A
1469   0920             
1470   0920 3E 01           LD  A, 1                 ; Monitor mode
1471   0922 32 0F FF        LD  (SYSMODE), A
1472   0925             
1473   0925 3E FF           LD A, $FF
1474   0927 32 08 FF        LD (KEY_PRESS), A
1475   092A             
1476   092A ED 56           IM  1
1477   092C FB              EI
1478   092D             
1479   092D AF              XOR A
1480   092E D3 40           OUT (Port40), A
1481   0930             
1482   0930             
1483   0930 3E 00           LD  A, $00
1484   0932 32 00 FF        LD  (DIG_0), A
1485   0935             
1486   0935 3E 00           LD  A, $00
1487   0937 32 01 FF        LD  (DIG_1), A
1488   093A             
1489   093A 3E 00           LD  A, $0
1490   093C 32 02 FF        LD  (DIG_2), A
1491   093F             
1492   093F 3E 00           LD  A, $00
1493   0941 32 03 FF        LD  (DIG_3), A
1494   0944             
1495   0944 3E 00           LD  A, $00
1496   0946 32 04 FF        LD  (DIG_4), A
1497   0949             
1498   0949 3E 00           LD  A, $00
1499   094B 32 05 FF        LD  (DIG_5), A
1500   094E             
1501   094E 3E 00           LD  A, $00
1502   0950 32 06 FF        LD  (DIG_6), A
1503   0953             
1504   0953 3E 00           LD  A, $00
1505   0955 32 07 FF        LD  (DIG_7), A
1506   0958             
1507   0958             START_LOOP:
1508   0958             
1509   0958 C3 58 09        JP START_LOOP
1510   095B             
1511   095B             
1512   095B             
1513   095B             
1514   095B             
1515   095B             
1516   095B             
1517   095B             
1518   095B             
1519   095B             ; =========================================================
1520   095B             ; Delay
1521   095B             ; =========================================================
1522   095B             delay:
1523   095B C5          	push bc                       ; 2.75 us
1524   095C 06 FF           ld b, 255                     ; 1.75 us
1525   095E             delay_loop_b:
1526   095E 0E FF       	ld c, 255                     ; 1.75 us
1527   0960             delay_loop:
1528   0960 0D          	dec c                         ; 1 us
1529   0961 C2 60 09        jp nz, delay_loop             ; true = 3 us, false 1.75 us
1530   0964 05              dec b                         ; 1 us
1531   0965 C2 5E 09        jp nz, delay_loop_b           ; true = 3 us, false 1.75 us
1532   0968 C1              pop bc                        ; 2.50 us
1533   0969 C9              ret                           ; 2.50 us
1534   096A             
1535   096A             
1536   096A             ;============================================================================
1537   096A             ;	Subroutine	Delay_A
1538   096A             ;
1539   096A             ;	Entry:	A = Millisecond count
1540   096A             ;============================================================================
1541   096A E5          DELAY_A:	PUSH	HL			; Save count
1542   096B 21 10 FF    		LD	HL,TicCounter
1543   096E 86          		ADD	A,(HL)			; A = cycle count
1544   096F BE          DlyLp		CP	(HL)			; Wait required TicCounter times
1545   0970 C2 6F 09    		JP	NZ,DlyLp		;  loop if not done
1546   0973 E1          		POP	HL
1547   0974 C9          		RET
1548   0975             
1549   0975             
1550   0975 0E 01       DELAY_100mS	LD	C,1
1551   0977 C5          DELAY_C		PUSH	BC
1552   0978 06 00       		LD	B,0
1553   097A C5          DELAY_LP	PUSH	BC
1554   097B 10 FE       		DJNZ	$		;13   * 256 / 4 = 832uSec
1555   097D C1          		POP	BC
1556   097E 10 FA       		DJNZ	DELAY_LP	;~100mSEC
1557   0980 0D          		DEC	C
1558   0981 20 F7       		JR  NZ,	DELAY_LP	;*4 ~= 7mSec
1559   0983 C1          		POP	BC
1560   0984 C9          		RET
1561   0985             
1562   0985             ; Mapa char to display 0-F
1563   0985 3F065B4F666DLED_FONT .db $3F, $06, $5B, $4F, $66, $6D, $7D, $07, $7F, $67 ; 0-9
1563   098B 7D077F67
1564   098F 777C395E7971         .DB $77, $7C, $39, $5E, $79, $71                     ; A-F
1565   0995             
1566   0995             
1567   0995             
1568   0995             ; ---------------------------------------------------------
1569   0995             ; Utilitys Program .ORG 1000h
1570   0995             ; ---------------------------------------------------------
1571   0100             .org 100h
1572   0100             ; ---------------------------------------------------------
1573   0100             ; RAM MAP - Utilitys Program | $FE00 - $FEFF
1574   0100             ; ---------------------------------------------------------
1575   0100             DIEGO      .equ    $FE00   ;(2) Temp Digits to countDown
1576   0100             
1577   0100             
1578   0100             ; ---------------------------------------------------------
1579   0100             ; Utilitys Program | CLEAR RAM
1580   0100             ; ---------------------------------------------------------
1581   0100             CLEAR_RAM_FF:
1582   0100 21 00 FE        LD  HL, $FE00
1583   0103 06 FF           LD  B, $FF
1584   0105             CLEAR_RAM_FF_LOOP:
1585   0105 2B              DEC HL
1586   0106 70              LD (HL), B
1587   0107 7C              LD A, H
1588   0108 FE 80           CP $80
1589   010A CA 10 01        JP Z, CLEAR_RAM_FF_CHECK_L
1590   010D C3 05 01        JP CLEAR_RAM_FF_LOOP
1591   0110             
1592   0110             CLEAR_RAM_FF_CHECK_L:
1593   0110 7D              LD A, L
1594   0111 FE 00           CP $00
1595   0113 CA 19 01        JP Z, CLEAR_RAM_FF_END
1596   0116 C3 05 01        JP CLEAR_RAM_FF_LOOP
1597   0119             CLEAR_RAM_FF_END:
1598   0119 3E C3           LD A, $C3
1599   011B 32 FD FD        LD ($FDFD), A
1600   011E AF              XOR A
1601   011F 32 FE FD        LD ($FDFE), A
1602   0122 3E 80           LD A, $80
1603   0124 32 FF FD        LD ($FDFF), A
1604   0127 CA 58 09        JP Z, START_LOOP
1605   012A             
1606   012A             
1607   012A             ; ---------------------------------------------------------
1608   012A             ; Utilitys Program | BLINKs (teste tempo monitor)
1609   012A             ; ---------------------------------------------------------
1610   012A             BLINK_TESTE:
1611   012A 3E 01           LD  A, 1
1612   012C             BLINK_TESTE_LOOP:
1613   012C EE 01           XOR 1
1614   012E D3 C0           OUT (PortC0), A 
1615   0130 C3 2C 01        JP BLINK_TESTE_LOOP
1616   0133             
1617   0133             
1618   0133             BLINK_DELAY_C:
1619   0133 3E 01           LD  A, 1
1620   0135             BLINK_DELAY_C_LOOP:
1621   0135 EE 01           XOR 1
1622   0137 D3 C0           OUT (PortC0), A
1623   0139 CD 75 09        CALL DELAY_100mS
1624   013C C3 35 01        JP BLINK_DELAY_C_LOOP
1625   013F             
1626   013F             
1627   013F             BLINK_DELAY_A:
1628   013F 3E 01           LD  A, 1
1629   0141             BLINK_DELAY_A_LOOP:
1630   0141 EE 01           XOR 1
1631   0143 D3 C0           OUT (PortC0), A
1632   0145 F5              PUSH  AF
1633   0146 3E 64           LD  A, 100
1634   0148 CD 6A 09        CALL DELAY_A
1635   014B F1              POP AF
1636   014C C3 41 01        JP BLINK_DELAY_A_LOOP
1637   014F             
1638   014F             
1639   014F             ; ---------------------------------------------------------
1640   014F             ; Utilitys Program | TESTE SOM 
1641   014F             ; 
1642   014F             ; Key F     = $00 - $FF na saida C0
1643   014F             ; Key A e B = Incrementa e Decrementa Saida C0
1644   014F             ; ---------------------------------------------------------
1645   014F             TESTE_SOM:
1646   014F 3E 00           LD  A, 0
1647   0151 32 0F FF        LD  (SYSMODE), A
1648   0154 3E 00           LD  A, 0
1649   0156 47              LD  B, A
1650   0157 CD E6 07        CALL CLEAR_USER_DISPLAY
1651   015A 3E 6D           LD  A, $6D ; S
1652   015C 32 D0 FF        LD  (USER_DISP0), A
1653   015F 3E 3F           LD  A, $3F ; O
1654   0161 32 D1 FF        LD  (USER_DISP1), A
1655   0164 3E 1C           LD  A, $1C ; U
1656   0166 32 D2 FF        LD  (USER_DISP2), A
1657   0169 3E 54           LD  A, $54 ; N
1658   016B 32 D3 FF        LD  (USER_DISP3), A
1659   016E 3E 5E           LD  A, $5E ; D
1660   0170 32 D4 FF        LD  (USER_DISP4), A
1661   0173             LOOP_SOM:
1662   0173 78              LD  A, B
1663   0174 CD 03 08        CALL GET_NUM_FROM_LOW
1664   0177 32 D7 FF        LD  (USER_DISP7), A
1665   017A 78              LD  A, B
1666   017B CD 13 08        CALL GET_NUM_FROM_HIGH
1667   017E 32 D6 FF        LD  (USER_DISP6), A
1668   0181             
1669   0181 CD 12 06        CALL GET_KEY_A
1670   0184 FE 0A           CP  $0A
1671   0186 CA 96 01        JP  Z, SOM_INC
1672   0189 FE 0B           CP  $0B
1673   018B CA A1 01        JP  Z, SOM_DEC
1674   018E FE 0F           CP  $0F
1675   0190 CA AC 01        JP  Z, SOM_LOOP_INC
1676   0193 C3 73 01        JP  LOOP_SOM
1677   0196             
1678   0196             
1679   0196             SOM_INC:
1680   0196 04              INC B
1681   0197 0E C0           LD  C, $C0
1682   0199 ED 41           OUT (C), B
1683   019B CD 75 09        CALL DELAY_100mS
1684   019E C3 73 01        JP  LOOP_SOM
1685   01A1             
1686   01A1             SOM_DEC:
1687   01A1 05              DEC B
1688   01A2 0E C0           LD  C, $C0
1689   01A4 ED 41           OUT (C), B
1690   01A6 CD 75 09        CALL DELAY_100mS
1691   01A9 C3 73 01        JP  LOOP_SOM
1692   01AC             
1693   01AC             SOM_LOOP_INC:
1694   01AC 78              LD  A, B
1695   01AD CD 03 08        CALL GET_NUM_FROM_LOW
1696   01B0 32 D7 FF        LD  (USER_DISP7), A
1697   01B3 78              LD  A, B
1698   01B4 CD 13 08        CALL GET_NUM_FROM_HIGH
1699   01B7 32 D6 FF        LD  (USER_DISP6), A
1700   01BA 04              INC B
1701   01BB 0E C0           LD  C, $C0
1702   01BD ED 41           OUT (C), B
1703   01BF CD 75 09        CALL DELAY_100mS
1704   01C2 CD 75 09        CALL DELAY_100mS
1705   01C5 C3 AC 01        JP  SOM_LOOP_INC
1706   01C8             
1707   01C8             
1708   01C8             ; ---------------------------------------------------------
1709   01C8             ; Utilitys Program | Animação led
1710   01C8             ; ---------------------------------------------------------
1711   01C8             ANIMATE_LED1:
1712   01C8 CD E6 07        CALL CLEAR_USER_DISPLAY
1713   01CB 3E 00           LD  A, 0                 ; user mode
1714   01CD 32 0F FF        LD (SYSMODE), A
1715   01D0             
1716   01D0 06 08           LD  B, $08
1717   01D2 21 D0 FF        LD  HL, USER_DISP0
1718   01D5 3E 08           LD  A, 8
1719   01D7             
1720   01D7             LEDS_LOOP:
1721   01D7 CD E6 07        CALL CLEAR_USER_DISPLAY
1722   01DA 70              LD  (HL), B
1723   01DB CD 75 09        CALL DELAY_100mS
1724   01DE 23              INC HL
1725   01DF 3D              DEC A
1726   01E0 FE 00           CP 0
1727   01E2 C2 D7 01        JP NZ, LEDS_LOOP
1728   01E5             
1729   01E5 3E 08           LD A, 8
1730   01E7 21 D7 FF        LD  HL, USER_DISP7
1731   01EA 06 40           LD  B, $40
1732   01EC             
1733   01EC             LEDS_LOOP2:
1734   01EC CD E6 07        CALL CLEAR_USER_DISPLAY
1735   01EF 70              LD  (HL), B
1736   01F0 CD 75 09        CALL DELAY_100mS
1737   01F3 2B              DEC HL
1738   01F4 3D              DEC A
1739   01F5 FE 00           CP 0
1740   01F7 C2 EC 01        JP NZ, LEDS_LOOP2
1741   01FA             
1742   01FA 3E 08           LD  A, 8
1743   01FC 21 D0 FF        LD  HL, USER_DISP0
1744   01FF 06 08           LD  B, $08
1745   0201 C3 D7 01        JP LEDS_LOOP
1746   0204             
1747   0204             
1748   0204             ; ---------------------------------------------------------
1749   0204             ; Utilitys Program | CountDown XX
1750   0204             ; OBS: Usa a placa de som para o alarme
1751   0204             ; ---------------------------------------------------------
1752   0204             COUNT_DOWN_ALERME:
1753   0204                 ; timer count down
1754   0204             
1755   0204 CD E6 07        CALL CLEAR_USER_DISPLAY
1756   0207 3E 39           LD  A, $39
1757   0209 32 D0 FF        LD  (USER_DISP0), A
1758   020C             
1759   020C 3E 3F           LD  A, $3F
1760   020E 32 D1 FF        LD  (USER_DISP1), A
1761   0211             
1762   0211 3E 1C           LD  A, $1C
1763   0213 32 D2 FF        LD  (USER_DISP2), A
1764   0216             
1765   0216 3E 54           LD  A, $54
1766   0218 32 D3 FF        LD  (USER_DISP3), A
1767   021B             
1768   021B 3E 78           LD  A, $78
1769   021D 32 D4 FF        LD  (USER_DISP4), A
1770   0220             
1771   0220 3E 00           LD  A, $00
1772   0222 32 D5 FF        LD  (USER_DISP5), A
1773   0225             
1774   0225             
1775   0225             
1776   0225 3E 40           LD  A, $40
1777   0227 32 D6 FF        LD  (USER_DISP6), A
1778   022A             
1779   022A 3E 40           LD  A, $40
1780   022C 32 D7 FF        LD  (USER_DISP7), A
1781   022F             
1782   022F 3E 00           LD  A, 0                 ; user mode
1783   0231 32 0F FF        LD (SYSMODE), A
1784   0234             
1785   0234             READ:
1786   0234 CD 12 06        CALL GET_KEY_A
1787   0237 FE FF           CP  $FF
1788   0239 CA 34 02        JP  Z, READ
1789   023C             
1790   023C CD 4D 02        CALL  MODIFY_KEY_POS_1D
1791   023F             
1792   023F             READ2
1793   023F CD 12 06        CALL GET_KEY_A
1794   0242 FE FF           CP  $FF
1795   0244 CA 3F 02        JP  Z, READ2
1796   0247             
1797   0247 CD 59 02        CALL MODIFY_KEY_POS_0D
1798   024A             
1799   024A C3 64 02        JP  LOOP
1800   024D             
1801   024D             
1802   024D             MODIFY_KEY_POS_1D:
1803   024D 21 00 FE        LD  HL, DIEGO
1804   0250 23              INC HL
1805   0251 77              LD  (HL), A
1806   0252 CD 03 08        CALL GET_NUM_FROM_LOW
1807   0255 32 D6 FF        LD  (USER_DISP6), A
1808   0258 C9              RET
1809   0259             
1810   0259             MODIFY_KEY_POS_0D:
1811   0259 21 00 FE        LD  HL, DIEGO
1812   025C 77              LD  (HL), A
1813   025D CD 03 08        CALL GET_NUM_FROM_LOW
1814   0260 32 D7 FF        LD  (USER_DISP7), A
1815   0263 C9              RET
1816   0264             
1817   0264             LOOP:
1818   0264 2A 00 FE        LD  HL, (DIEGO)
1819   0267             
1820   0267             LOOP_DOWN:
1821   0267 7C              LD  A, H
1822   0268 CD 03 08        CALL GET_NUM_FROM_LOW
1823   026B 32 D6 FF        LD  (USER_DISP6), A
1824   026E             
1825   026E 7D              LD  A, L
1826   026F CD 03 08        CALL GET_NUM_FROM_LOW
1827   0272 32 D7 FF        LD  (USER_DISP7), A
1828   0275             
1829   0275 0E 07           LD C, 7    ; 10 x 100ms = 1seg
1830   0277 CD 77 09        CALL DELAY_C
1831   027A             
1832   027A 7D              LD A, L
1833   027B FE 00           CP 0
1834   027D CA 85 02        JP Z, DEC_H
1835   0280 3D              DEC A
1836   0281 6F              LD L, A
1837   0282 C3 67 02        JP LOOP_DOWN
1838   0285             
1839   0285             DEC_H:
1840   0285 7C              LD  A, H
1841   0286 FE 00           CP 0
1842   0288 CA 93 02        JP Z, CHECK_L
1843   028B 3D              DEC A
1844   028C 67              LD H, A
1845   028D 3E 09           LD A, 9
1846   028F 6F              LD L, A
1847   0290 C3 67 02        JP LOOP_DOWN
1848   0293             
1849   0293             CHECK_L:
1850   0293 7D              LD  A, L
1851   0294 FE 00           CP 0
1852   0296 CA 99 02        JP Z, BEEP
1853   0299             
1854   0299             BEEP:
1855   0299 3E 80           LD  A, $80
1856   029B D3 C0           OUT  (PortC0), A
1857   029D CD 75 09        CALL DELAY_100mS
1858   02A0             
1859   02A0 3E C0           LD  A, $C0
1860   02A2 D3 C0           OUT  (PortC0), A
1861   02A4 CD 75 09        CALL DELAY_100mS
1862   02A7 C3 99 02        JP BEEP
1863   02AA             
1864   02AA             
1865   02AA             ; ---------------------------------------------------------
1866   02AA             ; Utilitys Program | PROGRAM X
1867   02AA             ; ---------------------------------------------------------
1868   02AA             
1869   02AA             
1870   02AA             
1871   02AA             
1872   02AA             
1873   02AA             ; =========================================================
1874   02AA             ; Tabela display
1875   02AA             ; =========================================================
1876   02AA             ; 
1877   02AA             ;   0 - $3F     A - $77     K - $7A     U - $1C     . - $80
1878   02AA             ;   1 - $06     B - $7C     L - $38     V - $3E     Ñ - $55
1879   02AA             ;   2 - $5B     C - $39     M - $37     W - $1D     : - $41
1880   02AA             ;   3 - $4F     D - $5E     N - $54     X - $70     ; - $88
1881   02AA             ;   4 - $66     E - $79     O - $3F     Y - $6E     _ - $08
1882   02AA             ;   5 - $6D     F - $71     P - $73     Z - $49     ~ - $01
1883   02AA             ;   6 - $7D     G - $6F     Q - $67                 ' - $20
1884   02AA             ;   7 - $07     H - $76     R - $50     + - $46     
1885   02AA             ;   8 - $7F     I - $06     S - $6D     , - $04     
1886   02AA             ;   9 - $67     J - $1E     T - $78     - - $40     
1887   02AA             
1888   02AA             .end
tasm: Number of errors = 0
