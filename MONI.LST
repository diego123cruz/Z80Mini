0001   0000             ; ---------------------------------------------------------
0002   0000             ;   Z80 Mini  -  inicio 01/2022
0003   0000             ;   Diego Cruz - github.com/diego123cruz
0004   0000             ;
0005   0000             ;   Hardware baseado em: http://www.sunrise-ev.com/z80.htm
0006   0000             ;   Software próprio - em construção
0007   0000             ; ---------------------------------------------------------
0008   0000             ;   Z80@4Mhz
0009   0000             ;   ROM 32k - 28C256
0010   0000             ;   RAM 32k - 65256
0011   0000             ;   Display 7 segmentos 8 digitos
0012   0000             ;   Teclado 16 teclas + Fn (Tecla de função? ou outra coisa?)
0013   0000             ;   Entrada 40h
0014   0000             ;   Saida 40h
0015   0000             ;
0016   0000             ;
0017   0000             ; ---------------------------------------------------------
0018   0000             ;   Display 7 Segmentos - In(Port40) AND 00000111b
0019   0000             ; ---------------------------------------------------------
0020   0000             ;
0021   0000             ;   ------------------------------------------------
0022   0000             ;   | 00h | 01h | 02h | 03h | 04h | 05h | 06h | 07h |
0023   0000             ;   ------------------------------------------------
0024   0000             ;
0025   0000             ;               A(0)
0026   0000             ;            ---------
0027   0000             ;           |         |
0028   0000             ;      F(5) |         | B(1)
0029   0000             ;           |   G(6)  |
0030   0000             ;            ---------
0031   0000             ;           |         |
0032   0000             ;      E(4) |         | C(2)
0033   0000             ;           |         |
0034   0000             ;            ---------         Ponto(7)
0035   0000             ;               D(3) 
0036   0000             ;
0037   0000             ;
0038   0000             ;
0039   0000             ;
0040   0000             ;
0041   0000             ; ---------------------------------------------------------
0042   0000             ; Teclado 
0043   0000             ; ---------------------------------------------------------
0044   0000             ;   
0045   0000             ;   Keys:        
0046   0000             ;       Fn - In(Port40) AND 00010000b - pulldown
0047   0000             ;       0 - In(Port40) AND 00000111b
0048   0000             ;
0049   0000             ;
0050   0000             ;
0051   0000             ;
0052   0000             
0053   0000             
0054   0000             ; ---------------------------------------------------------
0055   0000             ; Constantes
0056   0000             ; ---------------------------------------------------------
0057   0000             
0058   0000             Port40        .equ    $40
0059   0000             PortC0        .equ    $C0
0060   0000             START_RAM     .equ    $8000
0061   0000             STACK         .equ    $FF00  
0062   0000             CKEY_TIMEOUT  .equ    100  ; 100ms +-
0063   0000             
0064   0000             ; ---------------------------------------------------------
0065   0000             ; RAM MAP - Monitor | $FF00 - $FFFF
0066   0000             ; ---------------------------------------------------------
0067   0000             ; Cada digito fica em um ponto da memoria RAM
0068   0000             DIG_0       .equ    $FF00   ;(1) endereço do digito 0 na memoria RAM
0069   0000             DIG_1       .equ    $FF01   ;(1) endereço do digito 1 na memoria RAM
0070   0000             DIG_2       .equ    $FF02   ;(1) endereço do digito 2 na memoria RAM
0071   0000             DIG_3       .equ    $FF03   ;(1) endereço do digito 3 na memoria RAM
0072   0000             DIG_4       .equ    $FF04   ;(1) endereço do digito 4 na memoria RAM
0073   0000             DIG_5       .equ    $FF05   ;(1) endereço do digito 5 na memoria RAM
0074   0000             DIG_6       .equ    $FF06   ;(1) endereço do digito 6 na memoria RAM
0075   0000             DIG_7       .equ    $FF07   ;(1) endereço do digito 7 na memoria RAM
0076   0000             KEY_PRESS   .equ    $FF08   ;(1) key atual
0077   0000             INPUT       .equ    $FF09   ;(1) temp input from int
0078   0000             TMP_KEY     .equ    $FF0A   ;(1) tmp key
0079   0000             KEY_TIMEOUT .equ    $FF0B   ;(1) tempo para retornar a tecla, CKEY_TIMEOUT
0080   0000             SHOW_DIG    .equ    $FF0C   ;(1) Atual digito no display
0081   0000             PC_RAM      .equ    $FF0D   ;(2) save pc to user start $8000
0082   0000             
0083   0000             SYSMODE     .equ    $FF0F   ;(1) System mode. 
0084   0000                                         ; 0 - User Mode
0085   0000                                         ; 1 - Monitor
0086   0000                                         ; 2 - Examine Memoria
0087   0000                                         ; 3 - Change Data(Memory)
0088   0000                                         ; 4 - Show register PC
0089   0000                                         ; 5 - Show register SP
0090   0000                                         ; 6 - Show register AF
0091   0000                                         ; 7 - Show register BC
0092   0000                                         ; 8 - Show register DE
0093   0000                                         ; 9 - Show register HL
0094   0000                                         ; A - Show register IX
0095   0000                                         ; B - Show register IY
0096   0000                                         ; C - Show register AF'
0097   0000                                         ; D - Show register BC'
0098   0000                                         ; E - Show register DE'
0099   0000                                         ; F - Show register HL'
0100   0000                                         ; 76 - HALT
0101   0000             TicCounter  .equ    $FF10   ;(2) TicCounter inc 1ms
0102   0000             EXM_COUNT   .equ    $FF12   ;(1) Count digits Examine function, 4 digits
0103   0000             MDF_COUNT   .equ    $FF13   ;(1) Count digits moDify function, 2 digits
0104   0000             USR_PC      .equ    $FF14   ;(2) PC 
0105   0000             USR_SP      .equ    $FF16   ;(2) SP
0106   0000             USR_HL      .equ    $FF18   ;(2) HL
0107   0000             USR_BC      .equ    $FF1A   ;(2) BC
0108   0000             USR_DE      .equ    $FF1C   ;(2) DE
0109   0000             USR_AF      .equ    $FF1E   ;(2) AF
0110   0000             USR_IX      .equ    $FF20   ;(2) IX
0111   0000             USR_IY      .equ    $FF22   ;(2) IY
0112   0000             USR_AFA     .equ    $FF24   ;(2) AF' (Aux)
0113   0000             USR_BCA     .equ    $FF26   ;(2) BC' (Aux)
0114   0000             USR_DEA     .equ    $FF28   ;(2) DE' (Aux)
0115   0000             USR_HLA     .equ    $FF2A   ;(2) HL' (Aux)
0116   0000             ; SP Temp   .equ    $FF2C
0117   0000             CPU_FLAGS   .equ    $FF2C   ;(1) Flags atual (AF ou AF') SYSMODE
0118   0000             
0119   0000             
0120   0000             
0121   0000             ; Copy USER_DISPx to DIG_x WHEN USER_MODE
0122   0000             USER_DISP0  .equ    $FFD0   ; Mode User - Display Dig 0  - 01234567
0123   0000             USER_DISP1  .equ    $FFD1   ; Mode User - Display Dig 1  - 01234567
0124   0000             USER_DISP2  .equ    $FFD2   ; Mode User - Display Dig 2  - 01234567
0125   0000             USER_DISP3  .equ    $FFD3   ; Mode User - Display Dig 3  - 01234567
0126   0000             USER_DISP4  .equ    $FFD4   ; Mode User - Display Dig 4  - 01234567
0127   0000             USER_DISP5  .equ    $FFD5   ; Mode User - Display Dig 5  - 01234567
0128   0000             USER_DISP6  .equ    $FFD6   ; Mode User - Display Dig 6  - 01234567
0129   0000             USER_DISP7  .equ    $FFD7   ; Mode User - Display Dig 7  - 01234567
0130   0000             
0131   0000             
0132   0000             
0133   0000             ; =========================================================
0134   0000             ; Start ROM
0135   0000             ; =========================================================
0136   0000             .org    $0000
0137   0000 C3 1C 0A        JP  START
0138   0003             
0139   0003             ; =========================================================
0140   0003             ; Livre para colocar funções 0003h - 0037h 
0141   0003             ; =========================================================
0142   0003             
0143   0003             ; delay_100ms
0144   0003             
0145   0003             ; char7segFromA
0146   0003             
0147   0003             ; animacaoLeds
0148   0003             
0149   0003             ; Limpar RAM (FF).... etc
0150   0003             
0151   0003             
0152   0003             ; =========================================================
0153   0003             ; Int 38h
0154   0003             ; =========================================================
0155   0038             .org    $38
0156   0038 F3              DI                       ; Disable interrupt
0157   0039             
0158   0039 ED 73 16 FF     LD (USR_SP), SP          ; Save SP
0159   003D 22 18 FF        LD (USR_HL), HL          ; Save HL
0160   0040 E1              POP  HL                  ; Recupera PC da stack
0161   0041 22 14 FF        LD (USR_PC), HL          ; Save PC
0162   0044 E5              PUSH HL                  ;
0163   0045 21 2C FF        LD HL, $FF2C             ; Carrega Temp SP to HL
0164   0048 F9              LD SP, HL                ; Set temp HL
0165   0049 D9              EXX                      ; Inverte HL e HL', DE.... BC....
0166   004A E5              PUSH  HL                 ; Save HL'
0167   004B D5              PUSH  DE                 ; Save DE'                
0168   004C C5              PUSH  BC                 ; Save BC'
0169   004D 08              EX    AF, AF'
0170   004E F5              PUSH  AF                 ; Save AF'
0171   004F 08              EX    AF, AF'
0172   0050 D9              EXX                      ; Troca HL' e HL,, DE... BC...
0173   0051 FD E5           PUSH  IY                 ; Save IY
0174   0053 DD E5           PUSH  IX                 ; Save IX
0175   0055 F5              PUSH  AF                 ; Save AF
0176   0056 D5              PUSH  DE                 ; Save DE
0177   0057 C5              PUSH  BC                 ; Save BC
0178   0058 2A 16 FF        LD HL, (USR_SP)          ; Recupera SP
0179   005B F9              LD SP, HL                ; Devolve SP original
0180   005C             
0181   005C                 ; TicCounter
0182   005C 2A 10 FF        LD  HL, (TicCounter)     ; Increment 1ms, used to DELAY_A
0183   005F 23              INC  HL
0184   0060 22 10 FF        LD  (TicCounter), HL
0185   0063             
0186   0063                 ; Timeout Key
0187   0063 3A 0B FF         LD A, (KEY_TIMEOUT)
0188   0066 FE 00            CP 0
0189   0068 CA 6F 00         JP Z, ENTER_MAIN
0190   006B 3D               DEC A
0191   006C 32 0B FF         LD (KEY_TIMEOUT), A
0192   006F             
0193   006F                 ; Main
0194   006F             ENTER_MAIN:
0195   006F CD AA 00        CALL UPDATE_DISPLAYS
0196   0072 CD C6 00        CALL UPDATE_KEYS
0197   0075 CD 15 01        CALL UPDATE_FLAGS
0198   0078             
0199   0078                 ; Show atual digit
0200   0078 3A 0C FF        LD  A, (SHOW_DIG)
0201   007B D3 40           OUT (Port40), A
0202   007D             
0203   007D                 ;CALL    TRATAMENTO_INT38H; Get key, update display   
0204   007D C3 C5 01        JP      SYS_MAIN         ; Execute function monitor
0205   0080             
0206   0080             EXIT_SYS:
0207   0080 E1              POP HL                   ; Troca o PC
0208   0081 2A 14 FF        LD HL, (USR_PC)          ; Recupera PC
0209   0084 E5              PUSH HL                  ; Devolve PC to stack
0210   0085             
0211   0085 2A 24 FF        LD HL, (USR_AFA)          ; Load AF' in HL
0212   0088 E5              PUSH  HL                 ; Push AF'
0213   0089 F1              POP AF                   ; Recovery AF'
0214   008A 08              EX AF, AF'
0215   008B             
0216   008B 2A 2A FF        LD HL, (USR_HLA)          ; Recovery HL'
0217   008E ED 5B 28 FF     LD DE, (USR_DEA)          ; Recovery DE'
0218   0092 ED 4B 26 FF     LD BC, (USR_BCA)          ; Recovery BC'
0219   0096 D9              EXX
0220   0097             
0221   0097 2A 1E FF        LD HL, (USR_AF)          ; Load AF in HL
0222   009A E5              PUSH  HL                 ; Push AF
0223   009B F1              POP AF                   ; Recovery AF
0224   009C             
0225   009C 2A 18 FF        LD HL, (USR_HL)          ; Recovery HL
0226   009F ED 5B 1C FF     LD DE, (USR_DE)          ; Recovery DE
0227   00A3 ED 4B 1A FF     LD BC, (USR_BC)          ; Recovery BC
0228   00A7             
0229   00A7 FB              EI                       ; Enable interrupt
0230   00A8 ED 4D           RETI                     ; Return interrupt
0231   00AA             
0232   00AA             
0233   00AA             ; =========================================================
0234   00AA             ; Update display - Tratamento Int 38h
0235   00AA             ; =========================================================
0236   00AA             UPDATE_DISPLAYS:    
0237   00AA DB 40           IN    A, (Port40)
0238   00AC 32 09 FF        LD    (INPUT), A
0239   00AF E6 07           AND   $07
0240   00B1 FE 08           CP    $08
0241   00B3 D2 C5 00        JP    NC, UPDATE_DISPLAYS_RET ; IF A > 7 RET
0242   00B6 3C              INC   A
0243   00B7 FE 08           CP    $08
0244   00B9 C2 BE 00        JP    NZ, UPDATE_DISPLAYS_OK
0245   00BC 3E 00           LD    A, $00
0246   00BE             UPDATE_DISPLAYS_OK:
0247   00BE 26 FF           LD    H, $FF
0248   00C0 6F              LD    L, A
0249   00C1 7E              LD    A, (HL)
0250   00C2 32 0C FF        LD   (SHOW_DIG), A
0251   00C5             UPDATE_DISPLAYS_RET:
0252   00C5 C9              RET
0253   00C6             
0254   00C6             ; =========================================================
0255   00C6             ; Update KEY - Tratamento Int 38h
0256   00C6             ; =========================================================
0257   00C6             UPDATE_KEYS:    
0258   00C6 DB 40           IN    A, (Port40)
0259   00C8 32 09 FF        LD    (INPUT), A
0260   00CB E6 07           AND   $07
0261   00CD FE 08           CP    $08
0262   00CF D2 F8 00        JP    NC, UPDATE_KEY_RET ; IF A > 7 RET
0263   00D2 3A 09 FF        LD  A,  (INPUT)
0264   00D5 CB 5F           BIT  3, A
0265   00D7 CA F9 00        JP  Z, TRATAB3
0266   00DA 3A 09 FF        LD  A,  (INPUT)
0267   00DD CB 67           BIT  4, A
0268   00DF CA FF 00        JP  Z, TRATAB4
0269   00E2 C3 F8 00        JP  UPDATE_KEY_RET
0270   00E5             UPDATE_KEY_GET:
0271   00E5 32 09 FF        LD    (INPUT), A
0272   00E8 E6 07           AND   $07
0273   00EA 01 00 00        LD    BC, 0
0274   00ED 4F              LD    C, A
0275   00EE 09              ADD   HL, BC
0276   00EF 7E              LD    A, (HL)
0277   00F0 32 08 FF        LD   (KEY_PRESS), A
0278   00F3 3E 64           LD A, CKEY_TIMEOUT
0279   00F5 32 0B FF        LD (KEY_TIMEOUT), A
0280   00F8             UPDATE_KEY_RET:
0281   00F8 C9              RET
0282   00F9             
0283   00F9             TRATAB3:
0284   00F9 21 05 01        LD    HL, KEYSB3
0285   00FC C3 E5 00        JP  UPDATE_KEY_GET
0286   00FF             
0287   00FF             TRATAB4:
0288   00FF 21 0D 01        LD    HL, KEYSB4
0289   0102 C3 E5 00        JP  UPDATE_KEY_GET
0290   0105             
0291   0105 000104070F02KEYSB3 .db $00, $01, $04, $07, $0F, $02, $05, $08
0291   010B 0508
0292   010D 0E0306090D0CKEYSB4 .db $0E, $03, $06, $09, $0D, $0C, $0B, $0A
0292   0113 0B0A
0293   0115             
0294   0115             
0295   0115             ; =========================================================
0296   0115             ; Update Flags - Tratamento Int 38h
0297   0115             ; =========================================================
0298   0115             UPDATE_FLAGS:
0299   0115 3A 0F FF        LD    A, (SYSMODE)
0300   0118 FE 06           CP    $06
0301   011A CA 23 01        JP    Z, UPDATE_FLAGS_MAIN
0302   011D FE 0C           CP    $0C
0303   011F CA 23 01        JP    Z, UPDATE_FLAGS_MAIN
0304   0122             UPDATE_FLAGS_RET:
0305   0122 C9              RET
0306   0123             
0307   0123             UPDATE_FLAGS_MAIN:
0308   0123 3A 09 FF        LD    A, (INPUT)
0309   0126 E6 07           AND   $07
0310   0128             
0311   0128 FE 07           CP    $07
0312   012A CA 53 01        JP    Z, UPDATE_FLAG_S
0313   012D FE 00           CP    $00
0314   012F CA 5F 01        JP    Z, UPDATE_FLAG_Z
0315   0132 FE 01           CP    $01
0316   0134 CA 6B 01        JP    Z, UPDATE_FLAG_X1
0317   0137 FE 02           CP    $02
0318   0139 CA 77 01        JP    Z, UPDATE_FLAG_H
0319   013C FE 03           CP    $03
0320   013E CA 83 01        JP    Z, UPDATE_FLAG_X2
0321   0141 FE 04           CP    $04
0322   0143 CA 8F 01        JP    Z, UPDATE_FLAG_PV
0323   0146 FE 05           CP    $05
0324   0148 CA 9B 01        JP    Z, UPDATE_FLAG_N
0325   014B FE 06           CP    $06
0326   014D CA A7 01        JP    Z, UPDATE_FLAG_C
0327   0150 C3 22 01        JP    UPDATE_FLAGS_RET
0328   0153             
0329   0153             UPDATE_FLAG_S:
0330   0153 CD B3 01        CALL  SHOW_DIG_FLAG_ON
0331   0156 3A 2C FF        LD  A, (CPU_FLAGS)
0332   0159 CB 7F           BIT 7, A
0333   015B CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0334   015E C9              RET
0335   015F             
0336   015F             UPDATE_FLAG_Z:
0337   015F CD B3 01        CALL  SHOW_DIG_FLAG_ON
0338   0162 3A 2C FF        LD  A, (CPU_FLAGS)
0339   0165 CB 77           BIT 6, A
0340   0167 CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0341   016A C9              RET
0342   016B             
0343   016B             UPDATE_FLAG_X1:
0344   016B CD B3 01        CALL  SHOW_DIG_FLAG_ON
0345   016E 3A 2C FF        LD  A, (CPU_FLAGS)
0346   0171 CB 6F           BIT 5, A
0347   0173 CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0348   0176 C9              RET
0349   0177             
0350   0177             UPDATE_FLAG_H:
0351   0177 CD B3 01        CALL  SHOW_DIG_FLAG_ON
0352   017A 3A 2C FF        LD  A, (CPU_FLAGS)
0353   017D CB 67           BIT 4, A
0354   017F CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0355   0182 C9              RET
0356   0183             
0357   0183             UPDATE_FLAG_X2:
0358   0183 CD B3 01        CALL  SHOW_DIG_FLAG_ON
0359   0186 3A 2C FF        LD  A, (CPU_FLAGS)
0360   0189 CB 5F           BIT 3, A
0361   018B CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0362   018E C9              RET
0363   018F             
0364   018F             UPDATE_FLAG_PV:
0365   018F CD B3 01        CALL  SHOW_DIG_FLAG_ON
0366   0192 3A 2C FF        LD  A, (CPU_FLAGS)
0367   0195 CB 57           BIT 2, A
0368   0197 CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0369   019A C9              RET
0370   019B             
0371   019B             UPDATE_FLAG_N:
0372   019B CD B3 01        CALL  SHOW_DIG_FLAG_ON
0373   019E 3A 2C FF        LD  A, (CPU_FLAGS)
0374   01A1 CB 4F           BIT 1, A
0375   01A3 CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0376   01A6 C9              RET
0377   01A7             
0378   01A7             UPDATE_FLAG_C:
0379   01A7 CD B3 01        CALL  SHOW_DIG_FLAG_ON
0380   01AA 3A 2C FF        LD  A, (CPU_FLAGS)
0381   01AD CB 47           BIT 0, A
0382   01AF CC BC 01        CALL Z, SHOW_DIG_FLAG_OFF
0383   01B2 C9              RET
0384   01B3             
0385   01B3             SHOW_DIG_FLAG_ON:
0386   01B3 3A 0C FF        LD  A, (SHOW_DIG)
0387   01B6 F6 80           OR  $80
0388   01B8 32 0C FF        LD  (SHOW_DIG), A
0389   01BB C9              RET
0390   01BC             
0391   01BC             SHOW_DIG_FLAG_OFF:
0392   01BC 3A 0C FF        LD  A, (SHOW_DIG)
0393   01BF E6 7F           AND  $7F
0394   01C1 32 0C FF        LD  (SHOW_DIG), A 
0395   01C4 C9              RET
0396   01C5             
0397   01C5             ; =========================================================
0398   01C5             ; SYS MAIN
0399   01C5             ; =========================================================
0400   01C5             SYS_MAIN:
0401   01C5 2A 14 FF        LD  HL, (USR_PC)        ; Check halt
0402   01C8 2B              DEC HL
0403   01C9 7E              LD  A, (HL)
0404   01CA FE 76           CP $76
0405   01CC CA AF 08        JP Z, GO_HALT
0406   01CF             
0407   01CF 3A 0F FF        LD  A, (SYSMODE)
0408   01D2 FE 00           CP  $00                  ; User mode can back to monitor
0409   01D4 CA 29 07        JP  Z, USER_MODE        
0410   01D7             
0411   01D7 3A 0F FF        LD  A, (SYSMODE)
0412   01DA FE 01           CP  $01                  ; monitor
0413   01DC CA 3F 07        JP  Z, MONITOR_MODE
0414   01DF             
0415   01DF 3A 0F FF        LD  A,  (SYSMODE)
0416   01E2 FE 02           CP  $02                  ; Examine RAM
0417   01E4 CA 5A 02        JP  Z, EXAMINE_RAM
0418   01E7             
0419   01E7 3A 0F FF        LD  A, (SYSMODE)
0420   01EA FE 03           CP  $03                  ; Modify Data (Memory)
0421   01EC CA F3 02        JP  Z,  MODIFY_RAM
0422   01EF             
0423   01EF 3A 0F FF        LD  A, (SYSMODE)
0424   01F2 FE 04           CP  $04                  ; Show register PC
0425   01F4 CA 42 03        JP  Z,  SHOW_REG_PC
0426   01F7             
0427   01F7 3A 0F FF        LD  A, (SYSMODE)
0428   01FA FE 05           CP  $05                  ; Show register SP
0429   01FC CA 8A 03        JP  Z,  SHOW_REG_SP
0430   01FF             
0431   01FF 3A 0F FF        LD  A, (SYSMODE)
0432   0202 FE 06           CP  $06                  ; Show register AF
0433   0204 CA D5 03        JP  Z,  SHOW_REG_AF
0434   0207             
0435   0207 3A 0F FF        LD  A, (SYSMODE)
0436   020A FE 07           CP  $07                  ; Show register BC
0437   020C CA 24 04        JP  Z,  SHOW_REG_BC
0438   020F             
0439   020F 3A 0F FF        LD  A, (SYSMODE)
0440   0212 FE 08           CP  $08                  ; Show register DE
0441   0214 CA 6F 04        JP  Z,  SHOW_REG_DE
0442   0217             
0443   0217 3A 0F FF        LD  A, (SYSMODE)
0444   021A FE 09           CP  $09                  ; Show register HL
0445   021C CA BA 04        JP  Z,  SHOW_REG_HL
0446   021F             
0447   021F 3A 0F FF        LD  A, (SYSMODE)
0448   0222 FE 0A           CP  $0A                  ; Show register IX
0449   0224 CA 05 05        JP  Z,  SHOW_REG_IX
0450   0227             
0451   0227 3A 0F FF        LD  A, (SYSMODE)
0452   022A FE 0B           CP  $0B                  ; Show register IY
0453   022C CA 50 05        JP  Z,  SHOW_REG_IY
0454   022F             
0455   022F 3A 0F FF        LD  A, (SYSMODE)
0456   0232 FE 0C           CP  $0C                  ; Show register AF'
0457   0234 CA 9B 05        JP  Z,  SHOW_REG_AFaux
0458   0237             
0459   0237 3A 0F FF        LD  A, (SYSMODE)
0460   023A FE 0D           CP  $0D                  ; Show register BC'
0461   023C CA EF 05        JP  Z,  SHOW_REG_BCaux
0462   023F             
0463   023F 3A 0F FF        LD  A, (SYSMODE)
0464   0242 FE 0E           CP  $0E                  ; Show register DE'
0465   0244 CA 3F 06        JP  Z,  SHOW_REG_DEaux
0466   0247             
0467   0247 3A 0F FF        LD  A, (SYSMODE)
0468   024A FE 0F           CP  $0F                  ; Show register HL'
0469   024C CA 8F 06        JP  Z,  SHOW_REG_HLaux
0470   024F             
0471   024F             
0472   024F 3A 0F FF        LD  A, (SYSMODE)
0473   0252 FE 76           CP  $76
0474   0254 CA DF 06        JP  Z, SHOW_HALT
0475   0257             
0476   0257 C3 80 00        JP  EXIT_SYS
0477   025A             
0478   025A             
0479   025A             ; =========================================================
0480   025A             ; Examine RAM Mode
0481   025A             ; =========================================================
0482   025A             EXAMINE_RAM:
0483   025A CD 0E 07        CALL GET_KEY_A
0484   025D FE FF           CP  $FF
0485   025F CA 80 00        JP  Z, EXIT_SYS
0486   0262             
0487   0262 F5              PUSH  AF
0488   0263 F5              PUSH  AF
0489   0264 3A 12 FF        LD  A, (EXM_COUNT)
0490   0267 FE 03           CP  3
0491   0269 CA 87 02        JP  Z, EXAMINE_KEY_POS_3
0492   026C             
0493   026C 3A 12 FF        LD  A, (EXM_COUNT)
0494   026F FE 02           CP  2
0495   0271 CA A5 02        JP  Z, EXAMINE_KEY_POS_2
0496   0274             
0497   0274 3A 12 FF        LD  A, (EXM_COUNT)
0498   0277 FE 01           CP  1
0499   0279 CA BF 02        JP  Z, EXAMINE_KEY_POS_1
0500   027C             
0501   027C 3A 12 FF        LD  A, (EXM_COUNT)
0502   027F FE 00           CP  0
0503   0281 CA E0 02        JP  Z, EXAMINE_KEY_POS_0
0504   0284             
0505   0284 C3 80 00        JP  EXIT_SYS
0506   0287             
0507   0287             EXAMINE_KEY_POS_3:
0508   0287 F1              POP  AF
0509   0288 CB 07           RLC  A
0510   028A CB 07           RLC  A
0511   028C CB 07           RLC  A
0512   028E CB 07           RLC  A
0513   0290 67              LD  H, A
0514   0291 22 0D FF        LD  (PC_RAM), HL
0515   0294 F1              POP  AF
0516   0295 CD 0D 09        CALL GET_NUM_FROM_LOW
0517   0298 32 00 FF        LD  (DIG_0), A
0518   029B 3A 12 FF        LD  A, (EXM_COUNT)
0519   029E 3D              DEC A
0520   029F 32 12 FF        LD  (EXM_COUNT), A
0521   02A2 C3 80 00        JP  EXIT_SYS
0522   02A5             
0523   02A5             
0524   02A5             EXAMINE_KEY_POS_2:
0525   02A5 F1              POP  AF
0526   02A6 2A 0D FF        LD  HL, (PC_RAM)
0527   02A9 B4              OR  H
0528   02AA 67              LD  H, A
0529   02AB 22 0D FF        LD  (PC_RAM), HL
0530   02AE F1              POP  AF
0531   02AF CD 0D 09        CALL GET_NUM_FROM_LOW
0532   02B2 32 01 FF        LD  (DIG_1), A
0533   02B5 3A 12 FF        LD  A, (EXM_COUNT)
0534   02B8 3D              DEC A
0535   02B9 32 12 FF        LD  (EXM_COUNT), A
0536   02BC C3 80 00        JP  EXIT_SYS
0537   02BF             
0538   02BF             EXAMINE_KEY_POS_1:
0539   02BF F1              POP  AF
0540   02C0 2A 0D FF        LD  HL, (PC_RAM)
0541   02C3 CB 07           RLC  A
0542   02C5 CB 07           RLC  A
0543   02C7 CB 07           RLC  A
0544   02C9 CB 07           RLC  A
0545   02CB 6F              LD  L, A
0546   02CC 22 0D FF        LD  (PC_RAM), HL
0547   02CF F1              POP  AF
0548   02D0 CD 0D 09        CALL GET_NUM_FROM_LOW
0549   02D3 32 02 FF        LD  (DIG_2), A
0550   02D6 3A 12 FF        LD  A, (EXM_COUNT)
0551   02D9 3D              DEC A
0552   02DA 32 12 FF        LD  (EXM_COUNT), A
0553   02DD C3 80 00        JP  EXIT_SYS
0554   02E0             
0555   02E0             
0556   02E0             EXAMINE_KEY_POS_0:
0557   02E0 F1              POP  AF
0558   02E1 2A 0D FF        LD  HL, (PC_RAM)
0559   02E4 B5              OR  L
0560   02E5 6F              LD  L, A
0561   02E6 22 0D FF        LD  (PC_RAM), HL
0562   02E9 F1              POP  AF
0563   02EA CD 0D 09        CALL GET_NUM_FROM_LOW
0564   02ED 32 03 FF        LD  (DIG_3), A
0565   02F0 C3 20 08        JP  GO_MONITOR
0566   02F3             
0567   02F3             ; =========================================================
0568   02F3             ; MODIFY RAM Mode
0569   02F3             ; =========================================================
0570   02F3             MODIFY_RAM:
0571   02F3             
0572   02F3 CD 0E 07        CALL GET_KEY_A
0573   02F6 FE FF           CP  $FF
0574   02F8 CA 80 00        JP  Z, EXIT_SYS
0575   02FB             
0576   02FB F5              PUSH  AF
0577   02FC F5              PUSH  AF
0578   02FD 3A 13 FF        LD  A, (MDF_COUNT)
0579   0300 FE 01           CP  1
0580   0302 CA 10 03        JP  Z, MODIFY_KEY_POS_1
0581   0305             
0582   0305 3A 13 FF        LD  A, (MDF_COUNT)
0583   0308 FE 00           CP  0
0584   030A CA 2E 03        JP  Z, MODIFY_KEY_POS_0
0585   030D             
0586   030D C3 80 00        JP  EXIT_SYS
0587   0310             
0588   0310             MODIFY_KEY_POS_1:
0589   0310 F1              POP  AF
0590   0311 CB 07           RLC  A
0591   0313 CB 07           RLC  A
0592   0315 CB 07           RLC  A
0593   0317 CB 07           RLC  A
0594   0319 2A 0D FF        LD  HL, (PC_RAM)
0595   031C 77              LD  (HL), A
0596   031D             
0597   031D F1              POP  AF
0598   031E CD 0D 09        CALL GET_NUM_FROM_LOW
0599   0321 32 06 FF        LD  (DIG_6), A
0600   0324 3A 13 FF        LD  A, (MDF_COUNT)
0601   0327 3D              DEC A
0602   0328 32 13 FF        LD  (MDF_COUNT), A
0603   032B C3 80 00        JP  EXIT_SYS
0604   032E             
0605   032E             MODIFY_KEY_POS_0:
0606   032E F1              POP  AF
0607   032F 2A 0D FF        LD  HL, (PC_RAM)
0608   0332 46              LD  B, (HL)
0609   0333 B0              OR  B
0610   0334 2A 0D FF        LD  HL, (PC_RAM)
0611   0337 77              LD  (HL), A
0612   0338             
0613   0338 F1              POP  AF
0614   0339 CD 0D 09        CALL GET_NUM_FROM_LOW
0615   033C 32 07 FF        LD  (DIG_7), A
0616   033F C3 20 08        JP  GO_MONITOR
0617   0342                 
0618   0342             
0619   0342             SHOW_REG_PC:
0620   0342 CD 0E 07        CALL  GET_KEY_A
0621   0345 FE 00           CP  $00
0622   0347 CA 20 08        JP Z, GO_MONITOR
0623   034A FE 01           CP  $01
0624   034C CA 2B 08        JP Z, GO_SHOW_REG_PC
0625   034F FE 02           CP  $02
0626   0351 CA 36 08        JP Z, GO_SHOW_REG_SP
0627   0354 FE 03           CP  $03
0628   0356 CA 41 08        JP Z, GO_SHOW_REG_AF
0629   0359 FE 04           CP  $04
0630   035B CA 4C 08        JP Z, GO_SHOW_REG_BC
0631   035E FE 05           CP  $05
0632   0360 CA 57 08        JP Z, GO_SHOW_REG_DE
0633   0363 FE 06           CP  $06
0634   0365 CA 62 08        JP Z, GO_SHOW_REG_HL
0635   0368 FE 07           CP  $07
0636   036A CA 6D 08        JP Z, GO_SHOW_REG_IX
0637   036D FE 08           CP  $08
0638   036F CA 78 08        JP Z, GO_SHOW_REG_IY
0639   0372             
0640   0372 3E 50           LD  A, $50               ; R
0641   0374 32 00 FF        LD  (DIG_0), A
0642   0377             
0643   0377 3E 73           LD  A, $73               ; P
0644   0379 32 01 FF        LD  (DIG_1), A
0645   037C             
0646   037C 3E 39           LD  A, $39
0647   037E 32 02 FF        LD  (DIG_2), A           ; C
0648   0381             
0649   0381 2A 14 FF        LD HL, (USR_PC)
0650   0384 CD BF 09        CALL PRINT_END_HL
0651   0387 C3 80 00        JP  EXIT_SYS
0652   038A             
0653   038A             
0654   038A             SHOW_REG_SP:
0655   038A CD 0E 07        CALL  GET_KEY_A
0656   038D FE 00           CP  $00
0657   038F CA 20 08        JP Z, GO_MONITOR
0658   0392 FE 01           CP  $01
0659   0394 CA 2B 08        JP Z, GO_SHOW_REG_PC
0660   0397 FE 02           CP  $02
0661   0399 CA 36 08        JP Z, GO_SHOW_REG_SP
0662   039C FE 03           CP  $03
0663   039E CA 41 08        JP Z, GO_SHOW_REG_AF
0664   03A1 FE 04           CP  $04
0665   03A3 CA 4C 08        JP Z, GO_SHOW_REG_BC
0666   03A6 FE 05           CP  $05
0667   03A8 CA 57 08        JP Z, GO_SHOW_REG_DE
0668   03AB FE 06           CP  $06
0669   03AD CA 62 08        JP Z, GO_SHOW_REG_HL
0670   03B0 FE 07           CP  $07
0671   03B2 CA 6D 08        JP Z, GO_SHOW_REG_IX
0672   03B5 FE 08           CP  $08
0673   03B7 CA 78 08        JP Z, GO_SHOW_REG_IY
0674   03BA             
0675   03BA CD D3 08        CALL  CLEAR_DISPLAY
0676   03BD             
0677   03BD 3E 50           LD  A, $50               ; R
0678   03BF 32 00 FF        LD  (DIG_0), A
0679   03C2             
0680   03C2 3E 6D           LD  A, $6D               ; S
0681   03C4 32 01 FF        LD  (DIG_1), A
0682   03C7             
0683   03C7 3E 73           LD  A, $73               ; P
0684   03C9 32 02 FF        LD  (DIG_2), A
0685   03CC             
0686   03CC 2A 16 FF        LD HL, (USR_SP)
0687   03CF CD BF 09        CALL PRINT_END_HL
0688   03D2 C3 80 00        JP  EXIT_SYS
0689   03D5             
0690   03D5             
0691   03D5             SHOW_REG_AF:
0692   03D5 CD 0E 07        CALL  GET_KEY_A
0693   03D8 FE 00           CP  $00
0694   03DA CA 20 08        JP Z, GO_MONITOR
0695   03DD FE 01           CP  $01
0696   03DF CA 2B 08        JP Z, GO_SHOW_REG_PC
0697   03E2 FE 02           CP  $02
0698   03E4 CA 36 08        JP Z, GO_SHOW_REG_SP
0699   03E7 FE 03           CP  $03
0700   03E9 CA 83 08        JP Z, GO_SHOW_REG_AFaux
0701   03EC FE 04           CP  $04
0702   03EE CA 4C 08        JP Z, GO_SHOW_REG_BC
0703   03F1 FE 05           CP  $05
0704   03F3 CA 57 08        JP Z, GO_SHOW_REG_DE
0705   03F6 FE 06           CP  $06
0706   03F8 CA 62 08        JP Z, GO_SHOW_REG_HL
0707   03FB FE 07           CP  $07
0708   03FD CA 6D 08        JP Z, GO_SHOW_REG_IX
0709   0400 FE 08           CP  $08
0710   0402 CA 78 08        JP Z, GO_SHOW_REG_IY
0711   0405             
0712   0405 CD D3 08        CALL  CLEAR_DISPLAY
0713   0408             
0714   0408 3E 50           LD  A, $50               ; R
0715   040A 32 00 FF        LD  (DIG_0), A
0716   040D             
0717   040D 3E 77           LD  A, $77               ; A
0718   040F 32 01 FF        LD  (DIG_1), A
0719   0412             
0720   0412 3E 71           LD  A, $71               ; F
0721   0414 32 02 FF        LD  (DIG_2), A
0722   0417             
0723   0417 2A 1E FF        LD  HL, (USR_AF)
0724   041A 7D              LD  A, L
0725   041B 32 2C FF        LD (CPU_FLAGS), A
0726   041E CD BF 09        CALL PRINT_END_HL
0727   0421 C3 80 00        JP  EXIT_SYS
0728   0424             
0729   0424             
0730   0424             SHOW_REG_BC:
0731   0424 CD 0E 07        CALL  GET_KEY_A
0732   0427 FE 00           CP  $00
0733   0429 CA 20 08        JP Z, GO_MONITOR
0734   042C FE 01           CP  $01
0735   042E CA 2B 08        JP Z, GO_SHOW_REG_PC
0736   0431 FE 02           CP  $02
0737   0433 CA 36 08        JP Z, GO_SHOW_REG_SP
0738   0436 FE 03           CP  $03
0739   0438 CA 41 08        JP Z, GO_SHOW_REG_AF
0740   043B FE 04           CP  $04
0741   043D CA 8E 08        JP Z, GO_SHOW_REG_BCaux
0742   0440 FE 05           CP  $05
0743   0442 CA 57 08        JP Z, GO_SHOW_REG_DE
0744   0445 FE 06           CP  $06
0745   0447 CA 62 08        JP Z, GO_SHOW_REG_HL
0746   044A FE 07           CP  $07
0747   044C CA 6D 08        JP Z, GO_SHOW_REG_IX
0748   044F FE 08           CP  $08
0749   0451 CA 78 08        JP Z, GO_SHOW_REG_IY
0750   0454             
0751   0454 CD D3 08        CALL  CLEAR_DISPLAY
0752   0457             
0753   0457 3E 50           LD  A, $50               ; R
0754   0459 32 00 FF        LD  (DIG_0), A
0755   045C             
0756   045C 3E 7C           LD  A, $7C               ; B
0757   045E 32 01 FF        LD  (DIG_1), A
0758   0461             
0759   0461 3E 39           LD  A, $39               ; C
0760   0463 32 02 FF        LD  (DIG_2), A
0761   0466             
0762   0466 2A 1A FF        LD HL, (USR_BC)
0763   0469 CD BF 09        CALL PRINT_END_HL
0764   046C C3 80 00        JP  EXIT_SYS
0765   046F             
0766   046F             SHOW_REG_DE:
0767   046F CD 0E 07        CALL  GET_KEY_A
0768   0472 FE 00           CP  $00
0769   0474 CA 20 08        JP Z, GO_MONITOR
0770   0477 FE 01           CP  $01
0771   0479 CA 2B 08        JP Z, GO_SHOW_REG_PC
0772   047C FE 02           CP  $02
0773   047E CA 36 08        JP Z, GO_SHOW_REG_SP
0774   0481 FE 03           CP  $03
0775   0483 CA 41 08        JP Z, GO_SHOW_REG_AF
0776   0486 FE 04           CP  $04
0777   0488 CA 4C 08        JP Z, GO_SHOW_REG_BC
0778   048B FE 05           CP  $05
0779   048D CA 99 08        JP Z, GO_SHOW_REG_DEaux
0780   0490 FE 06           CP  $06
0781   0492 CA 62 08        JP Z, GO_SHOW_REG_HL
0782   0495 FE 07           CP  $07
0783   0497 CA 6D 08        JP Z, GO_SHOW_REG_IX
0784   049A FE 08           CP  $08
0785   049C CA 78 08        JP Z, GO_SHOW_REG_IY
0786   049F             
0787   049F CD D3 08        CALL  CLEAR_DISPLAY
0788   04A2             
0789   04A2 3E 50           LD  A, $50               ; R
0790   04A4 32 00 FF        LD  (DIG_0), A
0791   04A7             
0792   04A7 3E 5E           LD  A, $5E               ; D
0793   04A9 32 01 FF        LD  (DIG_1), A
0794   04AC             
0795   04AC 3E 79           LD  A, $79               ; E
0796   04AE 32 02 FF        LD  (DIG_2), A
0797   04B1             
0798   04B1 2A 1C FF        LD HL, (USR_DE)
0799   04B4 CD BF 09        CALL PRINT_END_HL
0800   04B7 C3 80 00        JP  EXIT_SYS
0801   04BA             
0802   04BA             SHOW_REG_HL:
0803   04BA CD 0E 07        CALL  GET_KEY_A
0804   04BD FE 00           CP  $00
0805   04BF CA 20 08        JP Z, GO_MONITOR
0806   04C2 FE 01           CP  $01
0807   04C4 CA 2B 08        JP Z, GO_SHOW_REG_PC
0808   04C7 FE 02           CP  $02
0809   04C9 CA 36 08        JP Z, GO_SHOW_REG_SP
0810   04CC FE 03           CP  $03
0811   04CE CA 41 08        JP Z, GO_SHOW_REG_AF
0812   04D1 FE 04           CP  $04
0813   04D3 CA 4C 08        JP Z, GO_SHOW_REG_BC
0814   04D6 FE 05           CP  $05
0815   04D8 CA 57 08        JP Z, GO_SHOW_REG_DE
0816   04DB FE 06           CP  $06
0817   04DD CA A4 08        JP Z, GO_SHOW_REG_HLaux
0818   04E0 FE 07           CP  $07
0819   04E2 CA 6D 08        JP Z, GO_SHOW_REG_IX
0820   04E5 FE 08           CP  $08
0821   04E7 CA 78 08        JP Z, GO_SHOW_REG_IY
0822   04EA             
0823   04EA CD D3 08        CALL  CLEAR_DISPLAY
0824   04ED             
0825   04ED 3E 50           LD  A, $50               ; R
0826   04EF 32 00 FF        LD  (DIG_0), A
0827   04F2             
0828   04F2 3E 76           LD  A, $76               ; H
0829   04F4 32 01 FF        LD  (DIG_1), A
0830   04F7             
0831   04F7 3E 38           LD  A, $38               ; L
0832   04F9 32 02 FF        LD  (DIG_2), A
0833   04FC             
0834   04FC 2A 18 FF        LD HL, (USR_HL)
0835   04FF CD BF 09        CALL PRINT_END_HL
0836   0502 C3 80 00        JP  EXIT_SYS
0837   0505             
0838   0505             SHOW_REG_IX:
0839   0505 CD 0E 07        CALL  GET_KEY_A
0840   0508 FE 00           CP  $00
0841   050A CA 20 08        JP Z, GO_MONITOR
0842   050D FE 01           CP  $01
0843   050F CA 2B 08        JP Z, GO_SHOW_REG_PC
0844   0512 FE 02           CP  $02
0845   0514 CA 36 08        JP Z, GO_SHOW_REG_SP
0846   0517 FE 03           CP  $03
0847   0519 CA 41 08        JP Z, GO_SHOW_REG_AF
0848   051C FE 04           CP  $04
0849   051E CA 4C 08        JP Z, GO_SHOW_REG_BC
0850   0521 FE 05           CP  $05
0851   0523 CA 57 08        JP Z, GO_SHOW_REG_DE
0852   0526 FE 06           CP  $06
0853   0528 CA 62 08        JP Z, GO_SHOW_REG_HL
0854   052B FE 07           CP  $07
0855   052D CA 6D 08        JP Z, GO_SHOW_REG_IX
0856   0530 FE 08           CP  $08
0857   0532 CA 78 08        JP Z, GO_SHOW_REG_IY
0858   0535             
0859   0535 CD D3 08        CALL  CLEAR_DISPLAY
0860   0538             
0861   0538 3E 50           LD  A, $50               ; R
0862   053A 32 00 FF        LD  (DIG_0), A
0863   053D             
0864   053D 3E 06           LD  A, $06               ; I
0865   053F 32 01 FF        LD  (DIG_1), A
0866   0542             
0867   0542 3E 70           LD  A, $70               ; X
0868   0544 32 02 FF        LD  (DIG_2), A
0869   0547             
0870   0547 2A 20 FF        LD HL, (USR_IX)
0871   054A CD BF 09        CALL PRINT_END_HL
0872   054D C3 80 00        JP  EXIT_SYS
0873   0550             
0874   0550             SHOW_REG_IY:
0875   0550 CD 0E 07        CALL  GET_KEY_A
0876   0553 FE 00           CP  $00
0877   0555 CA 20 08        JP Z, GO_MONITOR
0878   0558 FE 01           CP  $01
0879   055A CA 2B 08        JP Z, GO_SHOW_REG_PC
0880   055D FE 02           CP  $02
0881   055F CA 36 08        JP Z, GO_SHOW_REG_SP
0882   0562 FE 03           CP  $03
0883   0564 CA 41 08        JP Z, GO_SHOW_REG_AF
0884   0567 FE 04           CP  $04
0885   0569 CA 4C 08        JP Z, GO_SHOW_REG_BC
0886   056C FE 05           CP  $05
0887   056E CA 57 08        JP Z, GO_SHOW_REG_DE
0888   0571 FE 06           CP  $06
0889   0573 CA 62 08        JP Z, GO_SHOW_REG_HL
0890   0576 FE 07           CP  $07
0891   0578 CA 6D 08        JP Z, GO_SHOW_REG_IX
0892   057B FE 08           CP  $08
0893   057D CA 78 08        JP Z, GO_SHOW_REG_IY
0894   0580             
0895   0580 CD D3 08        CALL  CLEAR_DISPLAY
0896   0583             
0897   0583 3E 50           LD  A, $50               ; R
0898   0585 32 00 FF        LD  (DIG_0), A
0899   0588             
0900   0588 3E 06           LD  A, $06               ; I
0901   058A 32 01 FF        LD  (DIG_1), A
0902   058D             
0903   058D 3E 6E           LD  A, $6E               ; Y
0904   058F 32 02 FF        LD  (DIG_2), A
0905   0592             
0906   0592 2A 22 FF        LD HL, (USR_IY)
0907   0595 CD BF 09        CALL PRINT_END_HL
0908   0598 C3 80 00        JP  EXIT_SYS
0909   059B             
0910   059B             SHOW_REG_AFaux:
0911   059B CD 0E 07        CALL  GET_KEY_A
0912   059E FE 00           CP  $00
0913   05A0 CA 20 08        JP Z, GO_MONITOR
0914   05A3 FE 01           CP  $01
0915   05A5 CA 2B 08        JP Z, GO_SHOW_REG_PC
0916   05A8 FE 02           CP  $02
0917   05AA CA 36 08        JP Z, GO_SHOW_REG_SP
0918   05AD FE 03           CP  $03
0919   05AF CA 41 08        JP Z, GO_SHOW_REG_AF
0920   05B2 FE 04           CP  $04
0921   05B4 CA 4C 08        JP Z, GO_SHOW_REG_BC
0922   05B7 FE 05           CP  $05
0923   05B9 CA 57 08        JP Z, GO_SHOW_REG_DE
0924   05BC FE 06           CP  $06
0925   05BE CA 62 08        JP Z, GO_SHOW_REG_HL
0926   05C1 FE 07           CP  $07
0927   05C3 CA 6D 08        JP Z, GO_SHOW_REG_IX
0928   05C6 FE 08           CP  $08
0929   05C8 CA 78 08        JP Z, GO_SHOW_REG_IY
0930   05CB             
0931   05CB CD D3 08        CALL  CLEAR_DISPLAY
0932   05CE             
0933   05CE 3E 50           LD  A, $50               ; R
0934   05D0 32 00 FF        LD  (DIG_0), A
0935   05D3             
0936   05D3 3E 77           LD  A, $77               ; A
0937   05D5 32 01 FF        LD  (DIG_1), A
0938   05D8             
0939   05D8 3E 71           LD  A, $71               ; F
0940   05DA 32 02 FF        LD  (DIG_2), A
0941   05DD             
0942   05DD 3E 20           LD  A, $20               ; '
0943   05DF 32 03 FF        LD  (DIG_3), A
0944   05E2             
0945   05E2 2A 24 FF        LD HL, (USR_AFA)
0946   05E5 7D              LD  A, L
0947   05E6 32 2C FF        LD (CPU_FLAGS), A
0948   05E9 CD BF 09        CALL PRINT_END_HL
0949   05EC C3 80 00        JP  EXIT_SYS
0950   05EF             
0951   05EF             
0952   05EF             SHOW_REG_BCaux:
0953   05EF CD 0E 07        CALL  GET_KEY_A
0954   05F2 FE 00           CP  $00
0955   05F4 CA 20 08        JP Z, GO_MONITOR
0956   05F7 FE 01           CP  $01
0957   05F9 CA 2B 08        JP Z, GO_SHOW_REG_PC
0958   05FC FE 02           CP  $02
0959   05FE CA 36 08        JP Z, GO_SHOW_REG_SP
0960   0601 FE 03           CP  $03
0961   0603 CA 41 08        JP Z, GO_SHOW_REG_AF
0962   0606 FE 04           CP  $04
0963   0608 CA 4C 08        JP Z, GO_SHOW_REG_BC
0964   060B FE 05           CP  $05
0965   060D CA 57 08        JP Z, GO_SHOW_REG_DE
0966   0610 FE 06           CP  $06
0967   0612 CA 62 08        JP Z, GO_SHOW_REG_HL
0968   0615 FE 07           CP  $07
0969   0617 CA 6D 08        JP Z, GO_SHOW_REG_IX
0970   061A FE 08           CP  $08
0971   061C CA 78 08        JP Z, GO_SHOW_REG_IY
0972   061F             
0973   061F CD D3 08        CALL  CLEAR_DISPLAY
0974   0622             
0975   0622 3E 50           LD  A, $50               ; R
0976   0624 32 00 FF        LD  (DIG_0), A
0977   0627             
0978   0627 3E 7C           LD  A, $7C               ; B
0979   0629 32 01 FF        LD  (DIG_1), A
0980   062C             
0981   062C 3E 39           LD  A, $39               ; C
0982   062E 32 02 FF        LD  (DIG_2), A
0983   0631             
0984   0631 3E 20           LD  A, $20               ; '
0985   0633 32 03 FF        LD  (DIG_3), A
0986   0636             
0987   0636 2A 26 FF        LD HL, (USR_BCA)
0988   0639 CD BF 09        CALL PRINT_END_HL
0989   063C C3 80 00        JP  EXIT_SYS
0990   063F             
0991   063F             SHOW_REG_DEaux:
0992   063F CD 0E 07        CALL  GET_KEY_A
0993   0642 FE 00           CP  $00
0994   0644 CA 20 08        JP Z, GO_MONITOR
0995   0647 FE 01           CP  $01
0996   0649 CA 2B 08        JP Z, GO_SHOW_REG_PC
0997   064C FE 02           CP  $02
0998   064E CA 36 08        JP Z, GO_SHOW_REG_SP
0999   0651 FE 03           CP  $03
1000   0653 CA 41 08        JP Z, GO_SHOW_REG_AF
1001   0656 FE 04           CP  $04
1002   0658 CA 4C 08        JP Z, GO_SHOW_REG_BC
1003   065B FE 05           CP  $05
1004   065D CA 57 08        JP Z, GO_SHOW_REG_DE
1005   0660 FE 06           CP  $06
1006   0662 CA 62 08        JP Z, GO_SHOW_REG_HL
1007   0665 FE 07           CP  $07
1008   0667 CA 6D 08        JP Z, GO_SHOW_REG_IX
1009   066A FE 08           CP  $08
1010   066C CA 78 08        JP Z, GO_SHOW_REG_IY
1011   066F             
1012   066F CD D3 08        CALL  CLEAR_DISPLAY
1013   0672             
1014   0672 3E 50           LD  A, $50               ; R
1015   0674 32 00 FF        LD  (DIG_0), A
1016   0677             
1017   0677 3E 5E           LD  A, $5E               ; D
1018   0679 32 01 FF        LD  (DIG_1), A
1019   067C             
1020   067C 3E 79           LD  A, $79               ; E
1021   067E 32 02 FF        LD  (DIG_2), A
1022   0681             
1023   0681 3E 20           LD  A, $20               ; '
1024   0683 32 03 FF        LD  (DIG_3), A
1025   0686             
1026   0686 2A 28 FF        LD HL, (USR_DEA)
1027   0689 CD BF 09        CALL PRINT_END_HL
1028   068C C3 80 00        JP  EXIT_SYS
1029   068F             
1030   068F             SHOW_REG_HLaux:
1031   068F CD 0E 07        CALL  GET_KEY_A
1032   0692 FE 00           CP  $00
1033   0694 CA 20 08        JP Z, GO_MONITOR
1034   0697 FE 01           CP  $01
1035   0699 CA 2B 08        JP Z, GO_SHOW_REG_PC
1036   069C FE 02           CP  $02
1037   069E CA 36 08        JP Z, GO_SHOW_REG_SP
1038   06A1 FE 03           CP  $03
1039   06A3 CA 41 08        JP Z, GO_SHOW_REG_AF
1040   06A6 FE 04           CP  $04
1041   06A8 CA 4C 08        JP Z, GO_SHOW_REG_BC
1042   06AB FE 05           CP  $05
1043   06AD CA 57 08        JP Z, GO_SHOW_REG_DE
1044   06B0 FE 06           CP  $06
1045   06B2 CA 62 08        JP Z, GO_SHOW_REG_HL
1046   06B5 FE 07           CP  $07
1047   06B7 CA 6D 08        JP Z, GO_SHOW_REG_IX
1048   06BA FE 08           CP  $08
1049   06BC CA 78 08        JP Z, GO_SHOW_REG_IY
1050   06BF             
1051   06BF CD D3 08        CALL  CLEAR_DISPLAY
1052   06C2             
1053   06C2 3E 50           LD  A, $50               ; R
1054   06C4 32 00 FF        LD  (DIG_0), A
1055   06C7             
1056   06C7 3E 76           LD  A, $76               ; H
1057   06C9 32 01 FF        LD  (DIG_1), A
1058   06CC             
1059   06CC 3E 38           LD  A, $38               ; L
1060   06CE 32 02 FF        LD  (DIG_2), A
1061   06D1             
1062   06D1 3E 20           LD  A, $20               ; '
1063   06D3 32 03 FF        LD  (DIG_3), A
1064   06D6             
1065   06D6 2A 2A FF        LD HL, (USR_HLA)
1066   06D9 CD BF 09        CALL PRINT_END_HL
1067   06DC C3 80 00        JP  EXIT_SYS
1068   06DF             
1069   06DF             SHOW_HALT:
1070   06DF 3A 09 FF        LD  A, (INPUT)
1071   06E2 FE FB           CP  $FB
1072   06E4 CA 20 08        JP  Z, GO_MONITOR
1073   06E7             
1074   06E7 3E 40           LD  A, $40               ; -
1075   06E9 32 00 FF        LD  (DIG_0), A
1076   06EC 32 01 FF        LD  (DIG_1), A
1077   06EF             
1078   06EF 3E 76           LD  A, $76               ; H
1079   06F1 32 02 FF        LD  (DIG_2), A
1080   06F4             
1081   06F4 3E 77           LD  A, $77               ; A
1082   06F6 32 03 FF        LD  (DIG_3), A
1083   06F9             
1084   06F9 3E 38           LD  A, $38               ; L
1085   06FB 32 04 FF        LD  (DIG_4), A
1086   06FE             
1087   06FE 3E 78           LD  A, $78               ; T
1088   0700 32 05 FF        LD  (DIG_5), A
1089   0703             
1090   0703 3E 40           LD  A, $40               ; -
1091   0705 32 06 FF        LD  (DIG_6), A
1092   0708 32 07 FF        LD  (DIG_7), A
1093   070B             
1094   070B C3 80 00        JP EXIT_SYS
1095   070E             
1096   070E             ; =========================================================
1097   070E             ; GET KEY IN A, IF A == FFh then no KEY
1098   070E             ; =========================================================
1099   070E             GET_KEY_A:
1100   070E 3A 0B FF        LD  A, (KEY_TIMEOUT)
1101   0711 FE 00           CP  0
1102   0713 CA 19 07        JP  Z, RET_KEY
1103   0716 3E FF           LD  A, $FF
1104   0718 C9              RET
1105   0719             
1106   0719             RET_KEY:
1107   0719 3E 64           LD A, CKEY_TIMEOUT
1108   071B 32 0B FF        LD (KEY_TIMEOUT), A
1109   071E             
1110   071E 3A 08 FF        LD  A, (KEY_PRESS)
1111   0721 F5              PUSH  AF
1112   0722 3E FF           LD  A, $FF
1113   0724 32 08 FF        LD  (KEY_PRESS), A
1114   0727 F1              POP  AF
1115   0728 C9              RET
1116   0729             
1117   0729             
1118   0729             ; =========================================================
1119   0729             ; MONITOR Mode
1120   0729             ; =========================================================
1121   0729             USER_MODE:
1122   0729 3A 09 FF        LD  A, (INPUT)
1123   072C FE FB           CP  $FB
1124   072E CA 20 08        JP  Z, GO_MONITOR
1125   0731                 
1126   0731                 ; Copy USER_DISPx to DIG_x
1127   0731 21 D0 FF        LD	HL, USER_DISP0
1128   0734 11 00 FF    	LD	DE, DIG_0
1129   0737 01 08 00    	LD	BC, $0008
1130   073A ED B0       	LDIR
1131   073C             
1132   073C C3 80 00        JP  EXIT_SYS
1133   073F             
1134   073F             MONITOR_MODE:
1135   073F                 ; Mostra o endereço
1136   073F 2A 0D FF        LD  HL, (PC_RAM)
1137   0742 CD 62 09        CALL PRINT_HL
1138   0745             
1139   0745                 ; Limpa digitos
1140   0745 3E 00           LD  A, 0
1141   0747 32 04 FF        LD  (DIG_4), A
1142   074A 32 05 FF        LD  (DIG_5), A
1143   074D             
1144   074D                 ; Mostra os dados no endereço
1145   074D 2A 0D FF        LD  HL, (PC_RAM)
1146   0750 7E              LD  A, (HL)
1147   0751 CD 35 09        CALL  PRINT_A
1148   0754             
1149   0754             
1150   0754 CD 0E 07        CALL  GET_KEY_A
1151   0757             
1152   0757                 ; Incrementa endereço
1153   0757 32 0A FF        LD (TMP_KEY), A
1154   075A FE 0A           CP  $0A
1155   075C CA DC 07        JP  Z,  PC_RAM_INC
1156   075F             
1157   075F                 ; Decrementa endereço
1158   075F 3A 0A FF        LD  A, (TMP_KEY)
1159   0762 FE 0B           CP  $0B
1160   0764 CA D2 07        JP  Z,  PC_RAM_DEC
1161   0767             
1162   0767                 ; Examina memoria
1163   0767 3A 0A FF        LD  A, (TMP_KEY)
1164   076A FE 0E           CP  $0E
1165   076C CA E6 07        JP  Z,  GO_EXAMINE
1166   076F             
1167   076F                 ; + moDify Memory
1168   076F 3A 0A FF        LD  A, (TMP_KEY)
1169   0772 FE 0C           CP  $0C
1170   0774 CA 01 08        JP  Z,  GO_ADD_MODIFY
1171   0777             
1172   0777                 ; moDify Memory
1173   0777 3A 0A FF        LD  A, (TMP_KEY)
1174   077A FE 0D           CP  $0D
1175   077C CA 0B 08        JP  Z,  GO_MODIFY
1176   077F             
1177   077F                 ; RUN
1178   077F 3A 0A FF        LD  A, (TMP_KEY)
1179   0782 FE 0F           CP  $0F
1180   0784 CA BD 08        JP  Z,  FIRE
1181   0787             
1182   0787                 ; Show register PC
1183   0787 3A 0A FF        LD  A, (TMP_KEY)
1184   078A FE 01           CP  $01
1185   078C CA 2B 08        JP  Z, GO_SHOW_REG_PC
1186   078F             
1187   078F                 ; Show register SP
1188   078F 3A 0A FF        LD  A, (TMP_KEY)
1189   0792 FE 02           CP  $02
1190   0794 CA 36 08        JP  Z, GO_SHOW_REG_SP
1191   0797             
1192   0797                 ; Show register AF
1193   0797 3A 0A FF        LD  A, (TMP_KEY)
1194   079A FE 03           CP  $03
1195   079C CA 41 08        JP  Z, GO_SHOW_REG_AF
1196   079F             
1197   079F                 ; Show register BC
1198   079F 3A 0A FF        LD  A, (TMP_KEY)
1199   07A2 FE 04           CP  $04
1200   07A4 CA 4C 08        JP  Z, GO_SHOW_REG_BC
1201   07A7             
1202   07A7                 ; Show register DE
1203   07A7 3A 0A FF        LD  A, (TMP_KEY)
1204   07AA FE 05           CP  $05
1205   07AC CA 57 08        JP  Z, GO_SHOW_REG_DE
1206   07AF             
1207   07AF                 ; Show register HL
1208   07AF 3A 0A FF        LD  A, (TMP_KEY)
1209   07B2 FE 06           CP  $06
1210   07B4 CA 62 08        JP  Z, GO_SHOW_REG_HL
1211   07B7             
1212   07B7                 ; Show register IX
1213   07B7 3A 0A FF        LD  A, (TMP_KEY)
1214   07BA FE 07           CP  $07
1215   07BC CA 6D 08        JP  Z, GO_SHOW_REG_IX
1216   07BF             
1217   07BF                 ; Show register iY
1218   07BF 3A 0A FF        LD  A, (TMP_KEY)
1219   07C2 FE 08           CP  $08
1220   07C4 CA 78 08        JP  Z, GO_SHOW_REG_IY
1221   07C7             
1222   07C7                 ; Back to user mode
1223   07C7 3A 0A FF        LD  A, (TMP_KEY)
1224   07CA FE 09           CP  $09
1225   07CC CA CB 08        JP  Z, GO_USER_MODE
1226   07CF             
1227   07CF C3 80 00        JP  EXIT_SYS
1228   07D2                 
1229   07D2             
1230   07D2             PC_RAM_DEC:
1231   07D2 2A 0D FF        LD  HL, (PC_RAM)
1232   07D5 2B              DEC  HL
1233   07D6 22 0D FF        LD  (PC_RAM), HL
1234   07D9 C3 80 00        JP  EXIT_SYS
1235   07DC             
1236   07DC             PC_RAM_INC:
1237   07DC 2A 0D FF        LD  HL, (PC_RAM)
1238   07DF 23              INC  HL
1239   07E0 22 0D FF        LD  (PC_RAM), HL
1240   07E3 C3 80 00        JP  EXIT_SYS
1241   07E6             
1242   07E6             GO_EXAMINE:
1243   07E6 3E 03           LD  A, $03
1244   07E8 32 12 FF        LD (EXM_COUNT), A        ; Set count 4 digits, position display
1245   07EB 3E 02           LD  A, $02
1246   07ED 32 0F FF        LD (SYSMODE), A          ; Examine mode
1247   07F0 3E 40           LD A, 01000000b
1248   07F2 32 00 FF        LD (DIG_0), A
1249   07F5 32 01 FF        LD (DIG_1), A
1250   07F8 32 02 FF        LD (DIG_2), A
1251   07FB 32 03 FF        LD (DIG_3), A
1252   07FE C3 80 00        JP  EXIT_SYS
1253   0801             
1254   0801             GO_ADD_MODIFY:
1255   0801 2A 0D FF        LD  HL, (PC_RAM)
1256   0804 23              INC HL
1257   0805 22 0D FF        LD  (PC_RAM), HL
1258   0808 CD 62 09        CALL  PRINT_HL
1259   080B             GO_MODIFY:
1260   080B 3E 01           LD  A, $01                  ; Set count 2 digits, position display
1261   080D 32 13 FF        LD  (MDF_COUNT), A
1262   0810 3E 03           LD  A, $03                  ; moDify mode (Memory)
1263   0812 32 0F FF        LD  (SYSMODE), A
1264   0815 3E 40           LD  A, 01000000b
1265   0817 32 06 FF        LD  (DIG_6), A
1266   081A 32 07 FF        LD  (DIG_7), A
1267   081D C3 80 00        JP  EXIT_SYS
1268   0820             
1269   0820             GO_MONITOR:
1270   0820 CD D3 08        CALL  CLEAR_DISPLAY
1271   0823 3E 01           LD  A, $01
1272   0825 32 0F FF        LD  (SYSMODE), A
1273   0828 C3 80 00        JP  EXIT_SYS
1274   082B             
1275   082B             GO_SHOW_REG_PC:
1276   082B CD D3 08        CALL CLEAR_DISPLAY
1277   082E 3E 04           LD  A, $04
1278   0830 32 0F FF        LD  (SYSMODE), A
1279   0833 C3 80 00        JP  EXIT_SYS
1280   0836             
1281   0836             GO_SHOW_REG_SP:
1282   0836 CD D3 08        CALL CLEAR_DISPLAY
1283   0839 3E 05           LD  A, $05
1284   083B 32 0F FF        LD  (SYSMODE), A
1285   083E C3 80 00        JP  EXIT_SYS
1286   0841             
1287   0841             GO_SHOW_REG_AF:
1288   0841 CD D3 08        CALL CLEAR_DISPLAY
1289   0844 3E 06           LD  A, $06
1290   0846 32 0F FF        LD  (SYSMODE), A
1291   0849 C3 80 00        JP  EXIT_SYS
1292   084C             
1293   084C             GO_SHOW_REG_BC:
1294   084C CD D3 08        CALL CLEAR_DISPLAY
1295   084F 3E 07           LD  A, $07
1296   0851 32 0F FF        LD  (SYSMODE), A
1297   0854 C3 80 00        JP  EXIT_SYS
1298   0857             
1299   0857             GO_SHOW_REG_DE:
1300   0857 CD D3 08        CALL CLEAR_DISPLAY
1301   085A 3E 08           LD  A, $08
1302   085C 32 0F FF        LD  (SYSMODE), A
1303   085F C3 80 00        JP  EXIT_SYS
1304   0862             
1305   0862             GO_SHOW_REG_HL:
1306   0862 CD D3 08        CALL CLEAR_DISPLAY
1307   0865 3E 09           LD  A, $09
1308   0867 32 0F FF        LD  (SYSMODE), A
1309   086A C3 80 00        JP  EXIT_SYS
1310   086D             
1311   086D             GO_SHOW_REG_IX:
1312   086D CD D3 08        CALL CLEAR_DISPLAY
1313   0870 3E 0A           LD  A, $0A
1314   0872 32 0F FF        LD  (SYSMODE), A
1315   0875 C3 80 00        JP  EXIT_SYS
1316   0878             
1317   0878             GO_SHOW_REG_IY:
1318   0878 CD D3 08        CALL CLEAR_DISPLAY
1319   087B 3E 0B           LD  A, $0B
1320   087D 32 0F FF        LD  (SYSMODE), A
1321   0880 C3 80 00        JP  EXIT_SYS
1322   0883             
1323   0883             GO_SHOW_REG_AFaux:
1324   0883 CD D3 08        CALL CLEAR_DISPLAY
1325   0886 3E 0C           LD  A, $0C
1326   0888 32 0F FF        LD  (SYSMODE), A
1327   088B C3 80 00        JP  EXIT_SYS
1328   088E             
1329   088E             GO_SHOW_REG_BCaux:
1330   088E CD D3 08        CALL CLEAR_DISPLAY
1331   0891 3E 0D           LD  A, $0D
1332   0893 32 0F FF        LD  (SYSMODE), A
1333   0896 C3 80 00        JP  EXIT_SYS
1334   0899             
1335   0899             GO_SHOW_REG_DEaux:
1336   0899 CD D3 08        CALL CLEAR_DISPLAY
1337   089C 3E 0E           LD  A, $0E
1338   089E 32 0F FF        LD  (SYSMODE), A
1339   08A1 C3 80 00        JP  EXIT_SYS
1340   08A4             
1341   08A4             GO_SHOW_REG_HLaux:
1342   08A4 CD D3 08        CALL CLEAR_DISPLAY
1343   08A7 3E 0F           LD  A, $0F
1344   08A9 32 0F FF        LD  (SYSMODE), A
1345   08AC C3 80 00        JP  EXIT_SYS
1346   08AF             
1347   08AF             GO_HALT:
1348   08AF 3E 76           LD  A, $76
1349   08B1 32 0F FF        LD  (SYSMODE), A
1350   08B4 21 58 0A        LD  HL, START_LOOP
1351   08B7 22 14 FF        LD  (USR_PC), HL
1352   08BA C3 80 00        JP  EXIT_SYS
1353   08BD             
1354   08BD             FIRE:
1355   08BD 3E 01           LD  A, 1
1356   08BF 32 0F FF        LD (SYSMODE), A          ; Monitor mode
1357   08C2 2A 0D FF        LD  HL, (PC_RAM)
1358   08C5 22 14 FF        LD  (USR_PC), HL
1359   08C8 C3 80 00        JP  EXIT_SYS
1360   08CB             
1361   08CB             GO_USER_MODE:
1362   08CB 3E 00           LD  A, 0
1363   08CD 32 0F FF        LD  (SYSMODE), A
1364   08D0 C3 80 00        JP  EXIT_SYS
1365   08D3             
1366   08D3             ; =========================================================
1367   08D3             ; LIMPA DISPLAY
1368   08D3             ; =========================================================
1369   08D3             CLEAR_DISPLAY:
1370   08D3 F5              PUSH  AF
1371   08D4 3E 00           LD  A, 0
1372   08D6 32 00 FF        LD  (DIG_0), A
1373   08D9 32 01 FF        LD  (DIG_1), A
1374   08DC 32 02 FF        LD  (DIG_2), A
1375   08DF 32 03 FF        LD  (DIG_3), A
1376   08E2 32 04 FF        LD  (DIG_4), A
1377   08E5 32 05 FF        LD  (DIG_5), A
1378   08E8 32 06 FF        LD  (DIG_6), A
1379   08EB 32 07 FF        LD  (DIG_7), A
1380   08EE F1              POP  AF
1381   08EF C9              RET
1382   08F0             
1383   08F0             ; =========================================================
1384   08F0             ; LIMPA USER DISPLAY
1385   08F0             ; =========================================================
1386   08F0             CLEAR_USER_DISPLAY:
1387   08F0 F5              PUSH  AF
1388   08F1 3E 00           LD  A, 0
1389   08F3 32 D0 FF        LD  (USER_DISP0), A
1390   08F6 32 D1 FF        LD  (USER_DISP1), A
1391   08F9 32 D2 FF        LD  (USER_DISP2), A
1392   08FC 32 D3 FF        LD  (USER_DISP3), A
1393   08FF 32 D4 FF        LD  (USER_DISP4), A
1394   0902 32 D5 FF        LD  (USER_DISP5), A
1395   0905 32 D6 FF        LD  (USER_DISP6), A
1396   0908 32 D7 FF        LD  (USER_DISP7), A
1397   090B F1              POP  AF
1398   090C C9              RET
1399   090D             
1400   090D             
1401   090D             ; =========================================================
1402   090D             ; PEGA LOW NUM EM A E RETORNA CHAR 7SEG EM A
1403   090D             ; =========================================================
1404   090D             GET_NUM_FROM_LOW:
1405   090D E5              PUSH    HL
1406   090E C5              PUSH    BC
1407   090F 21 85 0A        LD      HL, LED_FONT
1408   0912 E6 0F           AND     $0F
1409   0914 01 00 00        LD      BC, 0
1410   0917 4F              LD      C, A
1411   0918 09              ADD     HL, BC
1412   0919 7E              LD      A, (HL)
1413   091A C1              POP     BC
1414   091B E1              POP     HL
1415   091C C9              RET
1416   091D             
1417   091D             ; =========================================================
1418   091D             ; PEGA HIGH NUM EM A E RETORNA CHAR 7SEG EM A
1419   091D             ; =========================================================
1420   091D             GET_NUM_FROM_HIGH:
1421   091D E5              PUSH    HL
1422   091E C5              PUSH    BC
1423   091F 21 85 0A        LD      HL, LED_FONT
1424   0922 E6 F0           AND     $F0
1425   0924 CB 0F           RRC     A
1426   0926 CB 0F           RRC     A
1427   0928 CB 0F           RRC     A
1428   092A CB 0F           RRC     A
1429   092C 01 00 00        LD      BC, 0
1430   092F 4F              LD      C, A
1431   0930 09              ADD     HL, BC
1432   0931 7E              LD      A, (HL)
1433   0932 C1              POP     BC
1434   0933 E1              POP     HL
1435   0934 C9              RET
1436   0935             
1437   0935             ; =========================================================
1438   0935             ; Mostra o que esta em A nos digitos 6 e 7
1439   0935             ; =========================================================
1440   0935             PRINT_A:
1441   0935 E5              PUSH    HL
1442   0936 C5              PUSH    BC
1443   0937 F5              PUSH    AF
1444   0938 F5              PUSH    AF
1445   0939             
1446   0939 21 85 0A        LD	HL, LED_FONT
1447   093C E6 0F           AND $0F
1448   093E 01 00 00        LD      BC, 0
1449   0941 4F              LD      C, A
1450   0942 09              ADD HL, BC
1451   0943 7E              LD  A, (HL)
1452   0944 32 07 FF        LD  (DIG_7), A
1453   0947             
1454   0947 F1              POP    AF
1455   0948 21 85 0A        LD	HL, LED_FONT
1456   094B E6 F0           AND  $F0
1457   094D CB 0F           RRC  A
1458   094F CB 0F           RRC  A
1459   0951 CB 0F           RRC  A
1460   0953 CB 0F           RRC  A
1461   0955 01 00 00        LD      BC, 0
1462   0958 4F              LD      C, A
1463   0959 09              ADD HL, BC
1464   095A 7E              LD  A, (HL)
1465   095B 32 06 FF        LD  (DIG_6), A
1466   095E             
1467   095E F1              POP     AF
1468   095F C1              POP     BC
1469   0960 E1              POP     HL
1470   0961 C9              RET
1471   0962             
1472   0962             ; =========================================================
1473   0962             ; Mostra o que esta em HL - Display(HHLLXXXX)
1474   0962             ; =========================================================
1475   0962             PRINT_HL:
1476   0962 F5              PUSH  AF
1477   0963 E5              PUSH  HL
1478   0964 C5              PUSH  BC
1479   0965             
1480   0965 E5              PUSH  HL
1481   0966 E5              PUSH  HL
1482   0967 E5              PUSH  HL
1483   0968             
1484   0968 7D              LD  A, L
1485   0969 21 85 0A        LD	HL, LED_FONT
1486   096C E6 0F           AND $0F
1487   096E 01 00 00        LD      BC, 0
1488   0971 4F              LD      C, A
1489   0972 09              ADD HL, BC
1490   0973 7E              LD  A, (HL)
1491   0974 21 03 FF        LD  HL, DIG_3
1492   0977 77              LD  (HL), A
1493   0978             
1494   0978 E1              POP  HL
1495   0979 7D              LD  A, L
1496   097A 21 85 0A        LD	HL, LED_FONT
1497   097D E6 F0           AND  $F0
1498   097F CB 0F           RRC  A
1499   0981 CB 0F           RRC  A
1500   0983 CB 0F           RRC  A
1501   0985 CB 0F           RRC  A
1502   0987 01 00 00        LD      BC, 0
1503   098A 4F              LD      C, A
1504   098B 09              ADD HL, BC
1505   098C 7E              LD  A, (HL)
1506   098D 21 02 FF        LD  HL, DIG_2
1507   0990 77              LD  (HL), A
1508   0991             
1509   0991 E1              POP  HL
1510   0992 7C              LD  A, H
1511   0993 21 85 0A        LD	HL, LED_FONT
1512   0996 E6 0F           AND $0F
1513   0998 01 00 00        LD      BC, 0
1514   099B 4F              LD      C, A
1515   099C 09              ADD HL, BC
1516   099D 7E              LD  A, (HL)
1517   099E 21 01 FF        LD  HL, DIG_1
1518   09A1 77              LD  (HL), A
1519   09A2             
1520   09A2 E1              POP  HL
1521   09A3 7C              LD  A, H
1522   09A4 21 85 0A        LD	HL, LED_FONT
1523   09A7 E6 F0           AND  $F0
1524   09A9 CB 0F           RRC  A
1525   09AB CB 0F           RRC  A
1526   09AD CB 0F           RRC  A
1527   09AF CB 0F           RRC  A
1528   09B1 01 00 00        LD      BC, 0
1529   09B4 4F              LD      C, A
1530   09B5 09              ADD HL, BC
1531   09B6 7E              LD  A, (HL)
1532   09B7 21 00 FF        LD  HL, DIG_0
1533   09BA 77              LD  (HL), A
1534   09BB             
1535   09BB C1              POP  BC
1536   09BC E1              POP  HL
1537   09BD F1              POP  AF
1538   09BE             
1539   09BE C9              RET
1540   09BF             
1541   09BF             ; =========================================================
1542   09BF             ; Mostra o que esta em HL - Display(XXXXHHLL)
1543   09BF             ; =========================================================
1544   09BF             PRINT_END_HL:
1545   09BF F5              PUSH  AF
1546   09C0 E5              PUSH  HL
1547   09C1 C5              PUSH  BC
1548   09C2             
1549   09C2 E5              PUSH  HL
1550   09C3 E5              PUSH  HL
1551   09C4 E5              PUSH  HL
1552   09C5             
1553   09C5 7D              LD  A, L
1554   09C6 21 85 0A        LD	HL, LED_FONT
1555   09C9 E6 0F           AND $0F
1556   09CB 01 00 00        LD      BC, 0
1557   09CE 4F              LD      C, A
1558   09CF 09              ADD HL, BC
1559   09D0 7E              LD  A, (HL)
1560   09D1 21 07 FF        LD  HL, DIG_7
1561   09D4 77              LD  (HL), A
1562   09D5             
1563   09D5 E1              POP  HL
1564   09D6 7D              LD  A, L
1565   09D7 21 85 0A        LD	HL, LED_FONT
1566   09DA E6 F0           AND  $F0
1567   09DC CB 0F           RRC  A
1568   09DE CB 0F           RRC  A
1569   09E0 CB 0F           RRC  A
1570   09E2 CB 0F           RRC  A
1571   09E4 01 00 00        LD      BC, 0
1572   09E7 4F              LD      C, A
1573   09E8 09              ADD HL, BC
1574   09E9 7E              LD  A, (HL)
1575   09EA 21 06 FF        LD  HL, DIG_6
1576   09ED 77              LD  (HL), A
1577   09EE             
1578   09EE E1              POP  HL
1579   09EF 7C              LD  A, H
1580   09F0 21 85 0A        LD	HL, LED_FONT
1581   09F3 E6 0F           AND $0F
1582   09F5 01 00 00        LD      BC, 0
1583   09F8 4F              LD      C, A
1584   09F9 09              ADD HL, BC
1585   09FA 7E              LD  A, (HL)
1586   09FB 21 05 FF        LD  HL, DIG_5
1587   09FE 77              LD  (HL), A
1588   09FF             
1589   09FF E1              POP  HL
1590   0A00 7C              LD  A, H
1591   0A01 21 85 0A        LD	HL, LED_FONT
1592   0A04 E6 F0           AND  $F0
1593   0A06 CB 0F           RRC  A
1594   0A08 CB 0F           RRC  A
1595   0A0A CB 0F           RRC  A
1596   0A0C CB 0F           RRC  A
1597   0A0E 01 00 00        LD      BC, 0
1598   0A11 4F              LD      C, A
1599   0A12 09              ADD HL, BC
1600   0A13 7E              LD  A, (HL)
1601   0A14 21 04 FF        LD  HL, DIG_4
1602   0A17 77              LD  (HL), A
1603   0A18             
1604   0A18 C1              POP  BC
1605   0A19 E1              POP  HL
1606   0A1A F1              POP  AF
1607   0A1B             
1608   0A1B C9              RET
1609   0A1C             
1610   0A1C             ; =========================================================
1611   0A1C             ; Start Sistem ?
1612   0A1C             ; =========================================================
1613   0A1C             START:
1614   0A1C 31 00 FF        LD  SP, STACK
1615   0A1F E5              PUSH HL                  ; Save HL
1616   0A20 F5              PUSH AF                  ; Save AF
1617   0A21             
1618   0A21 21 00 80        LD  HL, START_RAM
1619   0A24 22 0D FF        LD  (PC_RAM), HL
1620   0A27             
1621   0A27                 ; start vars
1622   0A27 3E 64           LD  A, CKEY_TIMEOUT
1623   0A29 32 0B FF        LD  (KEY_TIMEOUT), A
1624   0A2C             
1625   0A2C 3E 01           LD  A, 1                 ; Monitor mode
1626   0A2E 32 0F FF        LD  (SYSMODE), A
1627   0A31             
1628   0A31 3E FF           LD A, $FF
1629   0A33 32 08 FF        LD (KEY_PRESS), A
1630   0A36             
1631   0A36 3E 00           LD  A, $00
1632   0A38 32 00 FF        LD  (DIG_0), A
1633   0A3B 32 01 FF        LD  (DIG_1), A
1634   0A3E 32 02 FF        LD  (DIG_2), A
1635   0A41 32 03 FF        LD  (DIG_3), A
1636   0A44 32 04 FF        LD  (DIG_4), A
1637   0A47 32 05 FF        LD  (DIG_5), A
1638   0A4A 32 06 FF        LD  (DIG_6), A
1639   0A4D 32 07 FF        LD  (DIG_7), A
1640   0A50             
1641   0A50             
1642   0A50 ED 56           IM  1
1643   0A52 FB              EI
1644   0A53             
1645   0A53 AF              XOR A
1646   0A54 D3 40           OUT (Port40), A
1647   0A56             
1648   0A56 F1              POP AF                   ; Recovery AF
1649   0A57 E1              POP HL                   ; Recovery HL
1650   0A58             START_LOOP:
1651   0A58             
1652   0A58 C3 58 0A        JP START_LOOP
1653   0A5B             
1654   0A5B             
1655   0A5B             
1656   0A5B             
1657   0A5B             
1658   0A5B             
1659   0A5B             
1660   0A5B             
1661   0A5B             
1662   0A5B             ; =========================================================
1663   0A5B             ; Delay
1664   0A5B             ; =========================================================
1665   0A5B             delay:
1666   0A5B C5          	push bc                       ; 2.75 us
1667   0A5C 06 FF           ld b, 255                     ; 1.75 us
1668   0A5E             delay_loop_b:
1669   0A5E 0E FF       	ld c, 255                     ; 1.75 us
1670   0A60             delay_loop:
1671   0A60 0D          	dec c                         ; 1 us
1672   0A61 C2 60 0A        jp nz, delay_loop             ; true = 3 us, false 1.75 us
1673   0A64 05              dec b                         ; 1 us
1674   0A65 C2 5E 0A        jp nz, delay_loop_b           ; true = 3 us, false 1.75 us
1675   0A68 C1              pop bc                        ; 2.50 us
1676   0A69 C9              ret                           ; 2.50 us
1677   0A6A             
1678   0A6A             
1679   0A6A             ;============================================================================
1680   0A6A             ;	Subroutine	Delay_A
1681   0A6A             ;
1682   0A6A             ;	Entry:	A = Millisecond count
1683   0A6A             ;============================================================================
1684   0A6A E5          DELAY_A:	PUSH	HL			; Save count
1685   0A6B 21 10 FF    		LD	HL,TicCounter
1686   0A6E 86          		ADD	A,(HL)			; A = cycle count
1687   0A6F BE          DlyLp		CP	(HL)			; Wait required TicCounter times
1688   0A70 C2 6F 0A    		JP	NZ,DlyLp		;  loop if not done
1689   0A73 E1          		POP	HL
1690   0A74 C9          		RET
1691   0A75             
1692   0A75             
1693   0A75 0E 01       DELAY_100mS	LD	C,1
1694   0A77 C5          DELAY_C		PUSH	BC
1695   0A78 06 00       		LD	B,0
1696   0A7A C5          DELAY_LP	PUSH	BC
1697   0A7B 10 FE       		DJNZ	$		;13   * 256 / 4 = 832uSec
1698   0A7D C1          		POP	BC
1699   0A7E 10 FA       		DJNZ	DELAY_LP	;~100mSEC
1700   0A80 0D          		DEC	C
1701   0A81 20 F7       		JR  NZ,	DELAY_LP	;*4 ~= 7mSec
1702   0A83 C1          		POP	BC
1703   0A84 C9          		RET
1704   0A85             
1705   0A85             ; Mapa char to display 0-F
1706   0A85 3F065B4F666DLED_FONT .db $3F, $06, $5B, $4F, $66, $6D, $7D, $07, $7F, $67 ; 0-9
1706   0A8B 7D077F67
1707   0A8F 777C395E7971         .DB $77, $7C, $39, $5E, $79, $71                     ; A-F
1708   0A95             
1709   0A95             
1710   0A95             
1711   0A95             ; ---------------------------------------------------------
1712   0A95             ; Utilitys Program .ORG 2000h
1713   0A95             ; ---------------------------------------------------------
1714   2000             .org 2000h
1715   2000             ; ---------------------------------------------------------
1716   2000             ; RAM MAP - Utilitys Program | $FE00 - $FEFF
1717   2000             ; ---------------------------------------------------------
1718   2000             DIEGO      .equ    $FE00   ;(2) Temp Digits to countDown
1719   2000             
1720   2000             
1721   2000             ; ---------------------------------------------------------
1722   2000             ; Utilitys Program | CLEAR RAM
1723   2000             ; ---------------------------------------------------------
1724   2000             CLEAR_RAM_FF:
1725   2000 21 00 FE        LD  HL, $FE00
1726   2003 06 FF           LD  B, $FF
1727   2005             CLEAR_RAM_FF_LOOP:
1728   2005 2B              DEC HL
1729   2006 70              LD (HL), B
1730   2007 7C              LD A, H
1731   2008 FE 80           CP $80
1732   200A CA 10 20        JP Z, CLEAR_RAM_FF_CHECK_L
1733   200D C3 05 20        JP CLEAR_RAM_FF_LOOP
1734   2010             
1735   2010             CLEAR_RAM_FF_CHECK_L:
1736   2010 7D              LD A, L
1737   2011 FE 00           CP $00
1738   2013 CA 19 20        JP Z, CLEAR_RAM_FF_END
1739   2016 C3 05 20        JP CLEAR_RAM_FF_LOOP
1740   2019             CLEAR_RAM_FF_END:
1741   2019 3E C3           LD A, $C3
1742   201B 32 FD FD        LD ($FDFD), A
1743   201E AF              XOR A
1744   201F 32 FE FD        LD ($FDFE), A
1745   2022 3E 80           LD A, $80
1746   2024 32 FF FD        LD ($FDFF), A
1747   2027 CA 58 0A        JP Z, START_LOOP
1748   202A             
1749   202A             
1750   202A             ; ---------------------------------------------------------
1751   202A             ; Utilitys Program | BLINKs (teste tempo monitor)
1752   202A             ; ---------------------------------------------------------
1753   202A             BLINK_TESTE:
1754   202A 3E 01           LD  A, 1
1755   202C             BLINK_TESTE_LOOP:
1756   202C EE 01           XOR 1
1757   202E D3 C0           OUT (PortC0), A 
1758   2030 C3 2C 20        JP BLINK_TESTE_LOOP
1759   2033             
1760   2033             
1761   2033             BLINK_DELAY_C:
1762   2033 3E 01           LD  A, 1
1763   2035             BLINK_DELAY_C_LOOP:
1764   2035 EE 01           XOR 1
1765   2037 D3 C0           OUT (PortC0), A
1766   2039 CD 75 0A        CALL DELAY_100mS
1767   203C C3 35 20        JP BLINK_DELAY_C_LOOP
1768   203F             
1769   203F             
1770   203F             BLINK_DELAY_A:
1771   203F 3E 01           LD  A, 1
1772   2041             BLINK_DELAY_A_LOOP:
1773   2041 EE 01           XOR 1
1774   2043 D3 C0           OUT (PortC0), A
1775   2045 F5              PUSH  AF
1776   2046 3E 64           LD  A, 100
1777   2048 CD 6A 0A        CALL DELAY_A
1778   204B F1              POP AF
1779   204C C3 41 20        JP BLINK_DELAY_A_LOOP
1780   204F             
1781   204F             
1782   204F             ; ---------------------------------------------------------
1783   204F             ; Utilitys Program | TESTE SOM 
1784   204F             ; 
1785   204F             ; Key F     = $00 - $FF na saida C0
1786   204F             ; Key A e B = Incrementa e Decrementa Saida C0
1787   204F             ; ---------------------------------------------------------
1788   204F             TESTE_SOM:
1789   204F 3E 00           LD  A, 0
1790   2051 32 0F FF        LD  (SYSMODE), A
1791   2054 3E 00           LD  A, 0
1792   2056 47              LD  B, A
1793   2057 CD F0 08        CALL CLEAR_USER_DISPLAY
1794   205A 3E 6D           LD  A, $6D ; S
1795   205C 32 D0 FF        LD  (USER_DISP0), A
1796   205F 3E 3F           LD  A, $3F ; O
1797   2061 32 D1 FF        LD  (USER_DISP1), A
1798   2064 3E 1C           LD  A, $1C ; U
1799   2066 32 D2 FF        LD  (USER_DISP2), A
1800   2069 3E 54           LD  A, $54 ; N
1801   206B 32 D3 FF        LD  (USER_DISP3), A
1802   206E 3E 5E           LD  A, $5E ; D
1803   2070 32 D4 FF        LD  (USER_DISP4), A
1804   2073             LOOP_SOM:
1805   2073 78              LD  A, B
1806   2074 CD 0D 09        CALL GET_NUM_FROM_LOW
1807   2077 32 D7 FF        LD  (USER_DISP7), A
1808   207A 78              LD  A, B
1809   207B CD 1D 09        CALL GET_NUM_FROM_HIGH
1810   207E 32 D6 FF        LD  (USER_DISP6), A
1811   2081             
1812   2081 CD 0E 07        CALL GET_KEY_A
1813   2084 FE 0A           CP  $0A
1814   2086 CA 96 20        JP  Z, SOM_INC
1815   2089 FE 0B           CP  $0B
1816   208B CA A1 20        JP  Z, SOM_DEC
1817   208E FE 0F           CP  $0F
1818   2090 CA AC 20        JP  Z, SOM_LOOP_INC
1819   2093 C3 73 20        JP  LOOP_SOM
1820   2096             
1821   2096             
1822   2096             SOM_INC:
1823   2096 04              INC B
1824   2097 0E C0           LD  C, $C0
1825   2099 ED 41           OUT (C), B
1826   209B CD 75 0A        CALL DELAY_100mS
1827   209E C3 73 20        JP  LOOP_SOM
1828   20A1             
1829   20A1             SOM_DEC:
1830   20A1 05              DEC B
1831   20A2 0E C0           LD  C, $C0
1832   20A4 ED 41           OUT (C), B
1833   20A6 CD 75 0A        CALL DELAY_100mS
1834   20A9 C3 73 20        JP  LOOP_SOM
1835   20AC             
1836   20AC             SOM_LOOP_INC:
1837   20AC 78              LD  A, B
1838   20AD CD 0D 09        CALL GET_NUM_FROM_LOW
1839   20B0 32 D7 FF        LD  (USER_DISP7), A
1840   20B3 78              LD  A, B
1841   20B4 CD 1D 09        CALL GET_NUM_FROM_HIGH
1842   20B7 32 D6 FF        LD  (USER_DISP6), A
1843   20BA 04              INC B
1844   20BB 0E C0           LD  C, $C0
1845   20BD ED 41           OUT (C), B
1846   20BF CD 75 0A        CALL DELAY_100mS
1847   20C2 CD 75 0A        CALL DELAY_100mS
1848   20C5 C3 AC 20        JP  SOM_LOOP_INC
1849   20C8             
1850   20C8             
1851   20C8             ; ---------------------------------------------------------
1852   20C8             ; Utilitys Program | Animação led
1853   20C8             ; ---------------------------------------------------------
1854   20C8             ANIMATE_LED1:
1855   20C8 CD F0 08        CALL CLEAR_USER_DISPLAY
1856   20CB 3E 00           LD  A, 0                 ; user mode
1857   20CD 32 0F FF        LD (SYSMODE), A
1858   20D0             
1859   20D0 06 08           LD  B, $08
1860   20D2 21 D0 FF        LD  HL, USER_DISP0
1861   20D5 3E 08           LD  A, 8
1862   20D7             
1863   20D7             LEDS_LOOP:
1864   20D7 CD F0 08        CALL CLEAR_USER_DISPLAY
1865   20DA 70              LD  (HL), B
1866   20DB CD 75 0A        CALL DELAY_100mS
1867   20DE 23              INC HL
1868   20DF 3D              DEC A
1869   20E0 FE 00           CP 0
1870   20E2 C2 D7 20        JP NZ, LEDS_LOOP
1871   20E5             
1872   20E5 3E 08           LD A, 8
1873   20E7 21 D7 FF        LD  HL, USER_DISP7
1874   20EA 06 40           LD  B, $40
1875   20EC             
1876   20EC             LEDS_LOOP2:
1877   20EC CD F0 08        CALL CLEAR_USER_DISPLAY
1878   20EF 70              LD  (HL), B
1879   20F0 CD 75 0A        CALL DELAY_100mS
1880   20F3 2B              DEC HL
1881   20F4 3D              DEC A
1882   20F5 FE 00           CP 0
1883   20F7 C2 EC 20        JP NZ, LEDS_LOOP2
1884   20FA             
1885   20FA 3E 08           LD  A, 8
1886   20FC 21 D0 FF        LD  HL, USER_DISP0
1887   20FF 06 08           LD  B, $08
1888   2101 C3 D7 20        JP LEDS_LOOP
1889   2104             
1890   2104             
1891   2104             ; ---------------------------------------------------------
1892   2104             ; Utilitys Program | CountDown XX
1893   2104             ; OBS: Usa a placa de som para o alarme
1894   2104             ; ---------------------------------------------------------
1895   2104             COUNT_DOWN_ALERME:
1896   2104                 ; timer count down
1897   2104             
1898   2104 CD F0 08        CALL CLEAR_USER_DISPLAY
1899   2107 3E 39           LD  A, $39
1900   2109 32 D0 FF        LD  (USER_DISP0), A
1901   210C             
1902   210C 3E 3F           LD  A, $3F
1903   210E 32 D1 FF        LD  (USER_DISP1), A
1904   2111             
1905   2111 3E 1C           LD  A, $1C
1906   2113 32 D2 FF        LD  (USER_DISP2), A
1907   2116             
1908   2116 3E 54           LD  A, $54
1909   2118 32 D3 FF        LD  (USER_DISP3), A
1910   211B             
1911   211B 3E 78           LD  A, $78
1912   211D 32 D4 FF        LD  (USER_DISP4), A
1913   2120             
1914   2120 3E 00           LD  A, $00
1915   2122 32 D5 FF        LD  (USER_DISP5), A
1916   2125             
1917   2125             
1918   2125             
1919   2125 3E 40           LD  A, $40
1920   2127 32 D6 FF        LD  (USER_DISP6), A
1921   212A             
1922   212A 3E 40           LD  A, $40
1923   212C 32 D7 FF        LD  (USER_DISP7), A
1924   212F             
1925   212F 3E 00           LD  A, 0                 ; user mode
1926   2131 32 0F FF        LD (SYSMODE), A
1927   2134             
1928   2134             READ:
1929   2134 CD 0E 07        CALL GET_KEY_A
1930   2137 FE FF           CP  $FF
1931   2139 CA 34 21        JP  Z, READ
1932   213C             
1933   213C CD 4D 21        CALL  MODIFY_KEY_POS_1D
1934   213F             
1935   213F             READ2
1936   213F CD 0E 07        CALL GET_KEY_A
1937   2142 FE FF           CP  $FF
1938   2144 CA 3F 21        JP  Z, READ2
1939   2147             
1940   2147 CD 59 21        CALL MODIFY_KEY_POS_0D
1941   214A             
1942   214A C3 64 21        JP  LOOP
1943   214D             
1944   214D             
1945   214D             MODIFY_KEY_POS_1D:
1946   214D 21 00 FE        LD  HL, DIEGO
1947   2150 23              INC HL
1948   2151 77              LD  (HL), A
1949   2152 CD 0D 09        CALL GET_NUM_FROM_LOW
1950   2155 32 D6 FF        LD  (USER_DISP6), A
1951   2158 C9              RET
1952   2159             
1953   2159             MODIFY_KEY_POS_0D:
1954   2159 21 00 FE        LD  HL, DIEGO
1955   215C 77              LD  (HL), A
1956   215D CD 0D 09        CALL GET_NUM_FROM_LOW
1957   2160 32 D7 FF        LD  (USER_DISP7), A
1958   2163 C9              RET
1959   2164             
1960   2164             LOOP:
1961   2164 2A 00 FE        LD  HL, (DIEGO)
1962   2167             
1963   2167             LOOP_DOWN:
1964   2167 7C              LD  A, H
1965   2168 CD 0D 09        CALL GET_NUM_FROM_LOW
1966   216B 32 D6 FF        LD  (USER_DISP6), A
1967   216E             
1968   216E 7D              LD  A, L
1969   216F CD 0D 09        CALL GET_NUM_FROM_LOW
1970   2172 32 D7 FF        LD  (USER_DISP7), A
1971   2175             
1972   2175 0E 07           LD C, 7    ; 10 x 100ms = 1seg
1973   2177 CD 77 0A        CALL DELAY_C
1974   217A             
1975   217A 7D              LD A, L
1976   217B FE 00           CP 0
1977   217D CA 85 21        JP Z, DEC_H
1978   2180 3D              DEC A
1979   2181 6F              LD L, A
1980   2182 C3 67 21        JP LOOP_DOWN
1981   2185             
1982   2185             DEC_H:
1983   2185 7C              LD  A, H
1984   2186 FE 00           CP 0
1985   2188 CA 93 21        JP Z, CHECK_L
1986   218B 3D              DEC A
1987   218C 67              LD H, A
1988   218D 3E 09           LD A, 9
1989   218F 6F              LD L, A
1990   2190 C3 67 21        JP LOOP_DOWN
1991   2193             
1992   2193             CHECK_L:
1993   2193 7D              LD  A, L
1994   2194 FE 00           CP 0
1995   2196 CA 99 21        JP Z, BEEP
1996   2199             
1997   2199             BEEP:
1998   2199 3E 80           LD  A, $80
1999   219B D3 C0           OUT  (PortC0), A
2000   219D CD 75 0A        CALL DELAY_100mS
2001   21A0             
2002   21A0 3E C0           LD  A, $C0
2003   21A2 D3 C0           OUT  (PortC0), A
2004   21A4 CD 75 0A        CALL DELAY_100mS
2005   21A7 C3 99 21        JP BEEP
2006   21AA             
2007   21AA             
2008   21AA             ; ---------------------------------------------------------
2009   21AA             ; Utilitys Program | IR Sensor
2010   21AA             ; ---------------------------------------------------------
2011   21AA             CONTROLE_IR:
2012   21AA 3E 00           LD  A, 0                 ; user mode
2013   21AC 32 0F FF        LD (SYSMODE), A
2014   21AF             
2015   21AF CD F0 08        CALL CLEAR_USER_DISPLAY
2016   21B2 21 00 00        LD  HL, 0
2017   21B5             CONTROLE_IR_LOOP:
2018   21B5 DB 40           IN A, (Port40)
2019   21B7 CB 7F           BIT 7, A
2020   21B9 C2 B5 21        JP NZ, CONTROLE_IR_LOOP
2021   21BC             CONTROLE_IR_LOOP2:
2022   21BC 23              INC HL
2023   21BD DB 40           IN A, (Port40)
2024   21BF CB 7F           BIT 7, A
2025   21C1 CA BC 21        JP Z, CONTROLE_IR_LOOP2
2026   21C4             
2027   21C4 7C              LD A, H
2028   21C5 CD 1D 09        CALL GET_NUM_FROM_HIGH
2029   21C8 32 D4 FF        LD (USER_DISP4), A
2030   21CB             
2031   21CB 7C              LD A, H
2032   21CC CD 0D 09        CALL GET_NUM_FROM_LOW
2033   21CF 32 D5 FF        LD (USER_DISP5), A
2034   21D2             
2035   21D2 7D              LD A, L
2036   21D3 CD 1D 09        CALL GET_NUM_FROM_HIGH
2037   21D6 32 D6 FF        LD (USER_DISP6), A
2038   21D9             
2039   21D9 7D              LD A, L
2040   21DA CD 0D 09        CALL GET_NUM_FROM_LOW
2041   21DD 32 D7 FF        LD (USER_DISP7), A
2042   21E0                 
2043   21E0             CONTROLE_IR_LOOP3:
2044   21E0 C3 E0 21        JP CONTROLE_IR_LOOP3
2045   21E3             
2046   21E3             ; ---------------------------------------------------------
2047   21E3             ; Utilitys Program | PROGRAM X
2048   21E3             ; ---------------------------------------------------------
2049   21E3 3E 00           LD  A, 0                 ; user mode
2050   21E5 32 0F FF        LD (SYSMODE), A
2051   21E8             
2052   21E8             
2053   21E8             
2054   21E8             
2055   21E8             ; =========================================================
2056   21E8             ; Tabela display
2057   21E8             ; =========================================================
2058   21E8             ; 
2059   21E8             ;   0 - $3F     A - $77     K - $7A     U - $1C     . - $80
2060   21E8             ;   1 - $06     B - $7C     L - $38     V - $3E     Ñ - $55
2061   21E8             ;   2 - $5B     C - $39     M - $37     W - $1D     : - $41
2062   21E8             ;   3 - $4F     D - $5E     N - $54     X - $70     ; - $88
2063   21E8             ;   4 - $66     E - $79     O - $3F     Y - $6E     _ - $08
2064   21E8             ;   5 - $6D     F - $71     P - $73     Z - $49     ~ - $01
2065   21E8             ;   6 - $7D     G - $6F     Q - $67                 ' - $20
2066   21E8             ;   7 - $07     H - $76     R - $50     + - $46     
2067   21E8             ;   8 - $7F     I - $06     S - $6D     , - $04     
2068   21E8             ;   9 - $67     J - $1E     T - $78     - - $40     
2069   21E8             
2070   21E8             .end
tasm: Number of errors = 0
