0001   0000             ; ---------------------------------------------------------
0002   0000             ;   Z80 Mini  -  inicio 01/2022
0003   0000             ;   Diego Cruz - github.com/diego123cruz
0004   0000             ;
0005   0000             ;   Hardware baseado em: http://www.sunrise-ev.com/z80.htm
0006   0000             ;   Software próprio - em construção
0007   0000             ; ---------------------------------------------------------
0008   0000             ;   Z80@4Mhz
0009   0000             ;   ROM 32k - 28C256
0010   0000             ;   RAM 32k - 65256
0011   0000             ;   Display 7 segmentos 8 digitos
0012   0000             ;   Teclado 16 teclas + Fn (Tecla de função? ou outra coisa?)
0013   0000             ;   Entrada 40h
0014   0000             ;   Saida 40h
0015   0000             ;
0016   0000             ;
0017   0000             ; ---------------------------------------------------------
0018   0000             ;   Display 7 Segmentos - In(Port40) AND 00000111b
0019   0000             ; ---------------------------------------------------------
0020   0000             ;
0021   0000             ;   ------------------------------------------------
0022   0000             ;   | 00h | 01h | 02h | 03h | 04h | 05h | 06h | 07h |
0023   0000             ;   ------------------------------------------------
0024   0000             ;
0025   0000             ;               A(0)
0026   0000             ;            ---------
0027   0000             ;           |         |
0028   0000             ;      F(5) |         | B(1)
0029   0000             ;           |   G(6)  |
0030   0000             ;            ---------
0031   0000             ;           |         |
0032   0000             ;      E(4) |         | C(2)
0033   0000             ;           |         |
0034   0000             ;            ---------         Ponto(7)
0035   0000             ;               D(3) 
0036   0000             ;
0037   0000             ;
0038   0000             ;
0039   0000             ;
0040   0000             ;
0041   0000             ; ---------------------------------------------------------
0042   0000             ; Teclado 
0043   0000             ; ---------------------------------------------------------
0044   0000             ;   
0045   0000             ;   Keys:        
0046   0000             ;       Fn - In(Port40) AND 00010000b - pulldown
0047   0000             ;       0 - In(Port40) AND 00000111b
0048   0000             ;
0049   0000             ;
0050   0000             ;
0051   0000             ;
0052   0000             
0053   0000             
0054   0000             ; ---------------------------------------------------------
0055   0000             ; Constantes
0056   0000             ; ---------------------------------------------------------
0057   0000             
0058   0000             Port40        .equ    $40
0059   0000             PortC0        .equ    $C0
0060   0000             START_RAM     .equ    $8000
0061   0000             STACK         .equ    $FF00  
0062   0000             CKEY_TIMEOUT  .equ    100  ; 100ms +-
0063   0000             
0064   0000             ; ---------------------------------------------------------
0065   0000             ; RAM MAP - Monitor | $FF00 - $FFFF
0066   0000             ; ---------------------------------------------------------
0067   0000             ; Cada digito fica em um ponto da memoria RAM
0068   0000             DIG_0       .equ    $FF00   ;(1) endereço do digito 0 na memoria RAM
0069   0000             DIG_1       .equ    $FF01   ;(1) endereço do digito 1 na memoria RAM
0070   0000             DIG_2       .equ    $FF02   ;(1) endereço do digito 2 na memoria RAM
0071   0000             DIG_3       .equ    $FF03   ;(1) endereço do digito 3 na memoria RAM
0072   0000             DIG_4       .equ    $FF04   ;(1) endereço do digito 4 na memoria RAM
0073   0000             DIG_5       .equ    $FF05   ;(1) endereço do digito 5 na memoria RAM
0074   0000             DIG_6       .equ    $FF06   ;(1) endereço do digito 6 na memoria RAM
0075   0000             DIG_7       .equ    $FF07   ;(1) endereço do digito 7 na memoria RAM
0076   0000             KEY_PRESS   .equ    $FF08   ;(1) key atual
0077   0000             INPUT       .equ    $FF09   ;(1) temp input from int
0078   0000             TMP_KEY     .equ    $FF0A   ;(1) tmp key
0079   0000             KEY_TIMEOUT .equ    $FF0B   ;(1) tempo para retornar a tecla, CKEY_TIMEOUT
0080   0000             SHOW_DIG    .equ    $FF0C   ;(1) LIVRE
0081   0000             PC_RAM      .equ    $FF0D   ;(2) save pc to user start $8000
0082   0000             
0083   0000             SYSMODE     .equ    $FF0F   ;(1) System mode. 
0084   0000                                         ; 0 - User Mode
0085   0000                                         ; 1 - Monitor
0086   0000                                         ; 2 - Examine Memoria
0087   0000                                         ; 3 - Change Data(Memory)
0088   0000                                         ; 4 - Show register PC
0089   0000                                         ; 5 - Show register SP
0090   0000                                         ; 6 - Show register AF
0091   0000                                         ; 7 - Show register BC
0092   0000                                         ; 8 - Show register DE
0093   0000                                         ; 9 - Show register HL
0094   0000                                         ; A - Show register IX
0095   0000                                         ; B - Show register IY
0096   0000                                         ; C - Show register AF'
0097   0000                                         ; D - Show register BC'
0098   0000                                         ; E - Show register DE'
0099   0000                                         ; F - Show register HL'
0100   0000             TicCounter  .equ    $FF10   ;(2) TicCounter inc 1ms
0101   0000             EXM_COUNT   .equ    $FF12   ;(1) Count digits Examine function, 4 digits
0102   0000             MDF_COUNT   .equ    $FF13   ;(1) Count digits moDify function, 2 digits
0103   0000             USR_PC      .equ    $FF14   ;(2) PC 
0104   0000             USR_SP      .equ    $FF16   ;(2) SP
0105   0000             USR_HL      .equ    $FF18   ;(2) HL
0106   0000             USR_BC      .equ    $FF1A   ;(2) BC
0107   0000             USR_DE      .equ    $FF1C   ;(2) DE
0108   0000             USR_AF      .equ    $FF1E   ;(2) AF
0109   0000             USR_IX      .equ    $FF20   ;(2) IX
0110   0000             USR_IY      .equ    $FF22   ;(2) IY
0111   0000             USR_AFA     .equ    $FF24   ;(2) AF' (Aux)
0112   0000             USR_BCA     .equ    $FF26   ;(2) BC' (Aux)
0113   0000             USR_DEA     .equ    $FF28   ;(2) DE' (Aux)
0114   0000             USR_HLA     .equ    $FF2A   ;(2) HL' (Aux)
0115   0000             ; SP Temp   .equ    $FF2C
0116   0000             
0117   0000             
0118   0000             
0119   0000             ; Copy USER_DISPx to DIG_x WHEN USER_MODE
0120   0000             USER_DISP0  .equ    $FFD0   ; Mode User - Display Dig 0  - 01234567
0121   0000             USER_DISP1  .equ    $FFD1   ; Mode User - Display Dig 1  - 01234567
0122   0000             USER_DISP2  .equ    $FFD2   ; Mode User - Display Dig 2  - 01234567
0123   0000             USER_DISP3  .equ    $FFD3   ; Mode User - Display Dig 3  - 01234567
0124   0000             USER_DISP4  .equ    $FFD4   ; Mode User - Display Dig 4  - 01234567
0125   0000             USER_DISP5  .equ    $FFD5   ; Mode User - Display Dig 5  - 01234567
0126   0000             USER_DISP6  .equ    $FFD6   ; Mode User - Display Dig 6  - 01234567
0127   0000             USER_DISP7  .equ    $FFD7   ; Mode User - Display Dig 7  - 01234567
0128   0000             
0129   0000             
0130   0000             
0131   0000             ; =========================================================
0132   0000             ; Start ROM
0133   0000             ; =========================================================
0134   0000             .org    $0000
0135   0000 C3 49 07        JP  START
0136   0003             
0137   0003             ; =========================================================
0138   0003             ; Livre para colocar funções 0003h - 0037h 
0139   0003             ; =========================================================
0140   0003             
0141   0003             ; delay_100ms
0142   0003             
0143   0003             ; char7segFromA
0144   0003             
0145   0003             ; animacaoLeds
0146   0003             
0147   0003             ; Limpar RAM (FF).... etc
0148   0003             
0149   0003             
0150   0003             ; =========================================================
0151   0003             ; Int 38h
0152   0003             ; =========================================================
0153   0038             .org    $38
0154   0038 F3              DI                       ; Disable interrupt
0155   0039             
0156   0039 ED 73 16 FF     LD (USR_SP), SP          ; Save SP
0157   003D 22 18 FF        LD (USR_HL), HL          ; Save HL
0158   0040 E1              POP  HL                  ; Recupera PC da stack
0159   0041 22 14 FF        LD (USR_PC), HL          ; Save PC
0160   0044 E5              PUSH HL                  ;
0161   0045 21 2C FF        LD HL, $FF2C             ; Carrega Temp SP to HL
0162   0048 F9              LD SP, HL                ; Set temp HL
0163   0049 D9              EXX                      ; Inverte HL e HL', DE.... BC....
0164   004A E5              PUSH  HL                 ; Save HL'
0165   004B D5              PUSH  DE                 ; Save DE'                
0166   004C C5              PUSH  BC                 ; Save BC'
0167   004D F5              PUSH  AF                 ; Save AF'
0168   004E D9              EXX                      ; Troca HL' e HL,, DE... BC...
0169   004F FD E5           PUSH  IY                 ; Save IY
0170   0051 DD E5           PUSH  IX                 ; Save IX
0171   0053 F5              PUSH  AF                 ; Save AF
0172   0054 D5              PUSH  DE                 ; Save DE
0173   0055 C5              PUSH  BC                 ; Save BC
0174   0056 2A 16 FF        LD HL, (USR_SP)          ; Recupera SP
0175   0059 F9              LD SP, HL                ; Devolve SP original
0176   005A             
0177   005A                 ; TicCounter
0178   005A 2A 10 FF        LD  HL, (TicCounter)     ; Increment 1ms, used to DELAY_A
0179   005D 23              INC  HL
0180   005E 22 10 FF        LD  (TicCounter), HL
0181   0061             
0182   0061                 ; Timeout Key
0183   0061 3A 0B FF         LD A, (KEY_TIMEOUT)
0184   0064 FE 00            CP 0
0185   0066 CA 6D 00         JP Z, ENTER_MAIN
0186   0069 3D               DEC A
0187   006A 32 0B FF         LD (KEY_TIMEOUT), A
0188   006D             
0189   006D                 ; Main
0190   006D             ENTER_MAIN:
0191   006D CD 93 00        CALL UPDATE_DISPLAYS
0192   0070 CD AF 00        CALL UPDATE_KEYS
0193   0073             
0194   0073                 ; Show atual digit
0195   0073 3A 0C FF        LD  A, (SHOW_DIG)
0196   0076 D3 40           OUT (Port40), A
0197   0078             
0198   0078                 ;CALL    TRATAMENTO_INT38H; Get key, update display   
0199   0078 C3 FE 00        JP      SYS_MAIN         ; Execute function monitor
0200   007B             
0201   007B             EXIT_SYS:
0202   007B E1              POP HL                   ; Troca o PC
0203   007C 2A 14 FF        LD HL, (USR_PC)          ; Recupera PC
0204   007F E5              PUSH HL                  ; Devolve PC to stack
0205   0080             
0206   0080 2A 1E FF        LD HL, (USR_AF)          ; Load AF in HL
0207   0083 E5              PUSH  HL                 ; Push AF
0208   0084 F1              POP AF                   ; Recovery AF
0209   0085 2A 18 FF        LD HL, (USR_HL)          ; Recovery HL
0210   0088 ED 5B 1C FF     LD DE, (USR_DE)          ; Recovery DE
0211   008C ED 4B 1A FF     LD BC, (USR_BC)          ; Recovery BC
0212   0090             
0213   0090 FB              EI                       ; Enable interrupt
0214   0091 ED 4D           RETI                     ; Return interrupt
0215   0093             
0216   0093             
0217   0093             ; =========================================================
0218   0093             ; Update display - Tratamento Int 38h
0219   0093             ; =========================================================
0220   0093             UPDATE_DISPLAYS:    
0221   0093 DB 40           IN    A, (Port40)
0222   0095 32 09 FF        LD    (INPUT), A
0223   0098 E6 07           AND   $07
0224   009A FE 08           CP    $08
0225   009C D2 AE 00        JP    NC, UPDATE_DISPLAYS_RET ; IF A > 7 RET
0226   009F 3C              INC   A
0227   00A0 FE 08           CP    $08
0228   00A2 C2 A7 00        JP    NZ, UPDATE_DISPLAYS_OK
0229   00A5 3E 00           LD    A, $00
0230   00A7             UPDATE_DISPLAYS_OK:
0231   00A7 26 FF           LD    H, $FF
0232   00A9 6F              LD    L, A
0233   00AA 7E              LD    A, (HL)
0234   00AB 32 0C FF        LD   (SHOW_DIG), A
0235   00AE             UPDATE_DISPLAYS_RET:
0236   00AE C9              RET
0237   00AF             
0238   00AF             ; =========================================================
0239   00AF             ; Update KEY - Tratamento Int 38h
0240   00AF             ; =========================================================
0241   00AF             UPDATE_KEYS:    
0242   00AF DB 40           IN    A, (Port40)
0243   00B1 32 09 FF        LD    (INPUT), A
0244   00B4 E6 07           AND   $07
0245   00B6 FE 08           CP    $08
0246   00B8 D2 E1 00        JP    NC, UPDATE_KEY_RET ; IF A > 7 RET
0247   00BB 3A 09 FF        LD  A,  (INPUT)
0248   00BE CB 5F           BIT  3, A
0249   00C0 CA E2 00        JP  Z, TRATAB3
0250   00C3 3A 09 FF        LD  A,  (INPUT)
0251   00C6 CB 67           BIT  4, A
0252   00C8 CA E8 00        JP  Z, TRATAB4
0253   00CB C3 E1 00        JP  UPDATE_KEY_RET
0254   00CE             UPDATE_KEY_GET:
0255   00CE 32 09 FF        LD    (INPUT), A
0256   00D1 E6 07           AND   $07
0257   00D3 01 00 00        LD    BC, 0
0258   00D6 4F              LD    C, A
0259   00D7 09              ADD   HL, BC
0260   00D8 7E              LD    A, (HL)
0261   00D9 32 08 FF        LD   (KEY_PRESS), A
0262   00DC 3E 64           LD A, CKEY_TIMEOUT
0263   00DE 32 0B FF        LD (KEY_TIMEOUT), A
0264   00E1             UPDATE_KEY_RET:
0265   00E1 C9              RET
0266   00E2             
0267   00E2             TRATAB3:
0268   00E2 21 EE 00        LD    HL, KEYSB3
0269   00E5 C3 CE 00        JP  UPDATE_KEY_GET
0270   00E8             
0271   00E8             TRATAB4:
0272   00E8 21 F6 00        LD    HL, KEYSB4
0273   00EB C3 CE 00        JP  UPDATE_KEY_GET
0274   00EE             
0275   00EE 000104070F02KEYSB3 .db $00, $01, $04, $07, $0F, $02, $05, $08
0275   00F4 0508
0276   00F6 0E0306090D0CKEYSB4 .db $0E, $03, $06, $09, $0D, $0C, $0B, $0A
0276   00FC 0B0A
0277   00FE             
0278   00FE             
0279   00FE             
0280   00FE             ; =========================================================
0281   00FE             ; SYS MAIN
0282   00FE             ; =========================================================
0283   00FE             SYS_MAIN:
0284   00FE 3A 0F FF        LD  A, (SYSMODE)
0285   0101 FE 00           CP  $00                  ; User mode can back to monitor
0286   0103 CA 64 04        JP  Z, USER_MODE        
0287   0106             
0288   0106 3A 0F FF        LD  A, (SYSMODE)
0289   0109 FE 01           CP  $01                  ; monitor
0290   010B CA 7A 04        JP  Z, MONITOR_MODE
0291   010E             
0292   010E 3A 0F FF        LD  A,  (SYSMODE)
0293   0111 FE 02           CP  $02                  ; Examine RAM
0294   0113 CA 81 01        JP  Z, EXAMINE_RAM
0295   0116             
0296   0116 3A 0F FF        LD  A, (SYSMODE)
0297   0119 FE 03           CP  $03                  ; Modify Data (Memory)
0298   011B CA 1A 02        JP  Z,  MODIFY_RAM
0299   011E             
0300   011E 3A 0F FF        LD  A, (SYSMODE)
0301   0121 FE 04           CP  $04                  ; Show register PC
0302   0123 CA 69 02        JP  Z,  SHOW_REG_PC
0303   0126             
0304   0126 3A 0F FF        LD  A, (SYSMODE)
0305   0129 FE 05           CP  $05                  ; Show register SP
0306   012B CA 8C 02        JP  Z,  SHOW_REG_SP
0307   012E             
0308   012E 3A 0F FF        LD  A, (SYSMODE)
0309   0131 FE 06           CP  $06                  ; Show register AF
0310   0133 CA AF 02        JP  Z,  SHOW_REG_AF
0311   0136             
0312   0136 3A 0F FF        LD  A, (SYSMODE)
0313   0139 FE 07           CP  $07                  ; Show register BC
0314   013B CA D7 02        JP  Z,  SHOW_REG_BC
0315   013E             
0316   013E 3A 0F FF        LD  A, (SYSMODE)
0317   0141 FE 08           CP  $08                  ; Show register DE
0318   0143 CA FF 02        JP  Z,  SHOW_REG_DE
0319   0146             
0320   0146 3A 0F FF        LD  A, (SYSMODE)
0321   0149 FE 09           CP  $09                  ; Show register HL
0322   014B CA 27 03        JP  Z,  SHOW_REG_HL
0323   014E             
0324   014E 3A 0F FF        LD  A, (SYSMODE)
0325   0151 FE 0A           CP  $0A                  ; Show register IX
0326   0153 CA 4F 03        JP  Z,  SHOW_REG_IX
0327   0156             
0328   0156 3A 0F FF        LD  A, (SYSMODE)
0329   0159 FE 0B           CP  $0B                  ; Show register IY
0330   015B CA 72 03        JP  Z,  SHOW_REG_IY
0331   015E             
0332   015E 3A 0F FF        LD  A, (SYSMODE)
0333   0161 FE 0C           CP  $0C                  ; Show register AF'
0334   0163 CA 95 03        JP  Z,  SHOW_REG_AFaux
0335   0166             
0336   0166 3A 0F FF        LD  A, (SYSMODE)
0337   0169 FE 0D           CP  $0D                  ; Show register BC'
0338   016B CA C2 03        JP  Z,  SHOW_REG_BCaux
0339   016E             
0340   016E 3A 0F FF        LD  A, (SYSMODE)
0341   0171 FE 0E           CP  $0E                  ; Show register DE'
0342   0173 CA EF 03        JP  Z,  SHOW_REG_DEaux
0343   0176             
0344   0176 3A 0F FF        LD  A, (SYSMODE)
0345   0179 FE 0F           CP  $0F                  ; Show register HL'
0346   017B CA 1C 04        JP  Z,  SHOW_REG_HLaux
0347   017E             
0348   017E C3 7B 00        JP  EXIT_SYS
0349   0181             
0350   0181             
0351   0181             ; =========================================================
0352   0181             ; Examine RAM Mode
0353   0181             ; =========================================================
0354   0181             EXAMINE_RAM:
0355   0181 CD 49 04        CALL GET_KEY_A
0356   0184 FE FF           CP  $FF
0357   0186 CA 7B 00        JP  Z, EXIT_SYS
0358   0189             
0359   0189 F5              PUSH  AF
0360   018A F5              PUSH  AF
0361   018B 3A 12 FF        LD  A, (EXM_COUNT)
0362   018E FE 03           CP  3
0363   0190 CA AE 01        JP  Z, EXAMINE_KEY_POS_3
0364   0193             
0365   0193 3A 12 FF        LD  A, (EXM_COUNT)
0366   0196 FE 02           CP  2
0367   0198 CA CC 01        JP  Z, EXAMINE_KEY_POS_2
0368   019B             
0369   019B 3A 12 FF        LD  A, (EXM_COUNT)
0370   019E FE 01           CP  1
0371   01A0 CA E6 01        JP  Z, EXAMINE_KEY_POS_1
0372   01A3             
0373   01A3 3A 12 FF        LD  A, (EXM_COUNT)
0374   01A6 FE 00           CP  0
0375   01A8 CA 07 02        JP  Z, EXAMINE_KEY_POS_0
0376   01AB             
0377   01AB C3 7B 00        JP  EXIT_SYS
0378   01AE             
0379   01AE             EXAMINE_KEY_POS_3:
0380   01AE F1              POP  AF
0381   01AF CB 07           RLC  A
0382   01B1 CB 07           RLC  A
0383   01B3 CB 07           RLC  A
0384   01B5 CB 07           RLC  A
0385   01B7 67              LD  H, A
0386   01B8 22 0D FF        LD  (PC_RAM), HL
0387   01BB F1              POP  AF
0388   01BC CD 3A 06        CALL GET_NUM_FROM_LOW
0389   01BF 32 00 FF        LD  (DIG_0), A
0390   01C2 3A 12 FF        LD  A, (EXM_COUNT)
0391   01C5 3D              DEC A
0392   01C6 32 12 FF        LD  (EXM_COUNT), A
0393   01C9 C3 7B 00        JP  EXIT_SYS
0394   01CC             
0395   01CC             
0396   01CC             EXAMINE_KEY_POS_2:
0397   01CC F1              POP  AF
0398   01CD 2A 0D FF        LD  HL, (PC_RAM)
0399   01D0 B4              OR  H
0400   01D1 67              LD  H, A
0401   01D2 22 0D FF        LD  (PC_RAM), HL
0402   01D5 F1              POP  AF
0403   01D6 CD 3A 06        CALL GET_NUM_FROM_LOW
0404   01D9 32 01 FF        LD  (DIG_1), A
0405   01DC 3A 12 FF        LD  A, (EXM_COUNT)
0406   01DF 3D              DEC A
0407   01E0 32 12 FF        LD  (EXM_COUNT), A
0408   01E3 C3 7B 00        JP  EXIT_SYS
0409   01E6             
0410   01E6             EXAMINE_KEY_POS_1:
0411   01E6 F1              POP  AF
0412   01E7 2A 0D FF        LD  HL, (PC_RAM)
0413   01EA CB 07           RLC  A
0414   01EC CB 07           RLC  A
0415   01EE CB 07           RLC  A
0416   01F0 CB 07           RLC  A
0417   01F2 6F              LD  L, A
0418   01F3 22 0D FF        LD  (PC_RAM), HL
0419   01F6 F1              POP  AF
0420   01F7 CD 3A 06        CALL GET_NUM_FROM_LOW
0421   01FA 32 02 FF        LD  (DIG_2), A
0422   01FD 3A 12 FF        LD  A, (EXM_COUNT)
0423   0200 3D              DEC A
0424   0201 32 12 FF        LD  (EXM_COUNT), A
0425   0204 C3 7B 00        JP  EXIT_SYS
0426   0207             
0427   0207             
0428   0207             EXAMINE_KEY_POS_0:
0429   0207 F1              POP  AF
0430   0208 2A 0D FF        LD  HL, (PC_RAM)
0431   020B B5              OR  L
0432   020C 6F              LD  L, A
0433   020D 22 0D FF        LD  (PC_RAM), HL
0434   0210 F1              POP  AF
0435   0211 CD 3A 06        CALL GET_NUM_FROM_LOW
0436   0214 32 03 FF        LD  (DIG_3), A
0437   0217 C3 5B 05        JP  GO_MONITOR
0438   021A             
0439   021A             ; =========================================================
0440   021A             ; MODIFY RAM Mode
0441   021A             ; =========================================================
0442   021A             MODIFY_RAM:
0443   021A             
0444   021A CD 49 04        CALL GET_KEY_A
0445   021D FE FF           CP  $FF
0446   021F CA 7B 00        JP  Z, EXIT_SYS
0447   0222             
0448   0222 F5              PUSH  AF
0449   0223 F5              PUSH  AF
0450   0224 3A 13 FF        LD  A, (MDF_COUNT)
0451   0227 FE 01           CP  1
0452   0229 CA 37 02        JP  Z, MODIFY_KEY_POS_1
0453   022C             
0454   022C 3A 13 FF        LD  A, (MDF_COUNT)
0455   022F FE 00           CP  0
0456   0231 CA 55 02        JP  Z, MODIFY_KEY_POS_0
0457   0234             
0458   0234 C3 7B 00        JP  EXIT_SYS
0459   0237             
0460   0237             MODIFY_KEY_POS_1:
0461   0237 F1              POP  AF
0462   0238 CB 07           RLC  A
0463   023A CB 07           RLC  A
0464   023C CB 07           RLC  A
0465   023E CB 07           RLC  A
0466   0240 2A 0D FF        LD  HL, (PC_RAM)
0467   0243 77              LD  (HL), A
0468   0244             
0469   0244 F1              POP  AF
0470   0245 CD 3A 06        CALL GET_NUM_FROM_LOW
0471   0248 32 06 FF        LD  (DIG_6), A
0472   024B 3A 13 FF        LD  A, (MDF_COUNT)
0473   024E 3D              DEC A
0474   024F 32 13 FF        LD  (MDF_COUNT), A
0475   0252 C3 7B 00        JP  EXIT_SYS
0476   0255             
0477   0255             MODIFY_KEY_POS_0:
0478   0255 F1              POP  AF
0479   0256 2A 0D FF        LD  HL, (PC_RAM)
0480   0259 46              LD  B, (HL)
0481   025A B0              OR  B
0482   025B 2A 0D FF        LD  HL, (PC_RAM)
0483   025E 77              LD  (HL), A
0484   025F             
0485   025F F1              POP  AF
0486   0260 CD 3A 06        CALL GET_NUM_FROM_LOW
0487   0263 32 07 FF        LD  (DIG_7), A
0488   0266 C3 5B 05        JP  GO_MONITOR
0489   0269                 
0490   0269             
0491   0269               
0492   0269             
0493   0269             SHOW_REG_PC:
0494   0269 CD 49 04        CALL  GET_KEY_A
0495   026C FE 00           CP  0
0496   026E CA 5B 05        JP Z, GO_MONITOR
0497   0271 CD 00 06        CALL  CLEAR_DISPLAY
0498   0274             
0499   0274 3E 50           LD  A, $50               ; R
0500   0276 32 00 FF        LD  (DIG_0), A
0501   0279             
0502   0279 3E 73           LD  A, $73               ; P
0503   027B 32 01 FF        LD  (DIG_1), A
0504   027E             
0505   027E 3E 39           LD  A, $39
0506   0280 32 02 FF        LD  (DIG_2), A           ; C
0507   0283             
0508   0283 2A 14 FF        LD HL, (USR_PC)
0509   0286 CD EC 06        CALL PRINT_END_HL
0510   0289 C3 7B 00        JP  EXIT_SYS
0511   028C             
0512   028C             
0513   028C             SHOW_REG_SP:
0514   028C CD 49 04        CALL  GET_KEY_A
0515   028F FE 00           CP  0
0516   0291 CA 5B 05        JP Z, GO_MONITOR
0517   0294             
0518   0294 CD 00 06        CALL  CLEAR_DISPLAY
0519   0297             
0520   0297 3E 50           LD  A, $50               ; R
0521   0299 32 00 FF        LD  (DIG_0), A
0522   029C             
0523   029C 3E 6D           LD  A, $6D               ; S
0524   029E 32 01 FF        LD  (DIG_1), A
0525   02A1             
0526   02A1 3E 73           LD  A, $73               ; P
0527   02A3 32 02 FF        LD  (DIG_2), A
0528   02A6             
0529   02A6 2A 16 FF        LD HL, (USR_SP)
0530   02A9 CD EC 06        CALL PRINT_END_HL
0531   02AC C3 7B 00        JP  EXIT_SYS
0532   02AF             
0533   02AF             
0534   02AF             SHOW_REG_AF:
0535   02AF CD 49 04        CALL  GET_KEY_A
0536   02B2 FE 00           CP  0
0537   02B4 CA 5B 05        JP Z, GO_MONITOR
0538   02B7 FE 03           CP  $03
0539   02B9 CA BE 05        JP Z, GO_SHOW_REG_AFaux
0540   02BC             
0541   02BC CD 00 06        CALL  CLEAR_DISPLAY
0542   02BF             
0543   02BF 3E 50           LD  A, $50               ; R
0544   02C1 32 00 FF        LD  (DIG_0), A
0545   02C4             
0546   02C4 3E 77           LD  A, $77               ; A
0547   02C6 32 01 FF        LD  (DIG_1), A
0548   02C9             
0549   02C9 3E 71           LD  A, $71               ; F
0550   02CB 32 02 FF        LD  (DIG_2), A
0551   02CE             
0552   02CE 2A 1E FF        LD HL, (USR_AF)
0553   02D1 CD EC 06        CALL PRINT_END_HL
0554   02D4 C3 7B 00        JP  EXIT_SYS
0555   02D7             
0556   02D7             
0557   02D7             SHOW_REG_BC:
0558   02D7 CD 49 04        CALL  GET_KEY_A
0559   02DA FE 00           CP  0
0560   02DC CA 5B 05        JP Z, GO_MONITOR
0561   02DF FE 04           CP  $04
0562   02E1 CA C9 05        JP Z, GO_SHOW_REG_BCaux
0563   02E4             
0564   02E4 CD 00 06        CALL  CLEAR_DISPLAY
0565   02E7             
0566   02E7 3E 50           LD  A, $50               ; R
0567   02E9 32 00 FF        LD  (DIG_0), A
0568   02EC             
0569   02EC 3E 7C           LD  A, $7C               ; B
0570   02EE 32 01 FF        LD  (DIG_1), A
0571   02F1             
0572   02F1 3E 39           LD  A, $39               ; C
0573   02F3 32 02 FF        LD  (DIG_2), A
0574   02F6             
0575   02F6 2A 1A FF        LD HL, (USR_BC)
0576   02F9 CD EC 06        CALL PRINT_END_HL
0577   02FC C3 7B 00        JP  EXIT_SYS
0578   02FF             
0579   02FF             SHOW_REG_DE:
0580   02FF CD 49 04        CALL  GET_KEY_A
0581   0302 FE 00           CP  0
0582   0304 CA 5B 05        JP Z, GO_MONITOR
0583   0307 FE 05           CP  $05
0584   0309 CA D4 05        JP Z, GO_SHOW_REG_DEaux
0585   030C             
0586   030C CD 00 06        CALL  CLEAR_DISPLAY
0587   030F             
0588   030F 3E 50           LD  A, $50               ; R
0589   0311 32 00 FF        LD  (DIG_0), A
0590   0314             
0591   0314 3E 5E           LD  A, $5E               ; D
0592   0316 32 01 FF        LD  (DIG_1), A
0593   0319             
0594   0319 3E 79           LD  A, $79               ; E
0595   031B 32 02 FF        LD  (DIG_2), A
0596   031E             
0597   031E 2A 1C FF        LD HL, (USR_DE)
0598   0321 CD EC 06        CALL PRINT_END_HL
0599   0324 C3 7B 00        JP  EXIT_SYS
0600   0327             
0601   0327             SHOW_REG_HL:
0602   0327 CD 49 04        CALL  GET_KEY_A
0603   032A FE 00           CP  0
0604   032C CA 5B 05        JP Z, GO_MONITOR
0605   032F FE 06           CP  $06
0606   0331 CA DF 05        JP Z, GO_SHOW_REG_HLaux
0607   0334             
0608   0334 CD 00 06        CALL  CLEAR_DISPLAY
0609   0337             
0610   0337 3E 50           LD  A, $50               ; R
0611   0339 32 00 FF        LD  (DIG_0), A
0612   033C             
0613   033C 3E 76           LD  A, $76               ; H
0614   033E 32 01 FF        LD  (DIG_1), A
0615   0341             
0616   0341 3E 38           LD  A, $38               ; L
0617   0343 32 02 FF        LD  (DIG_2), A
0618   0346             
0619   0346 2A 18 FF        LD HL, (USR_HL)
0620   0349 CD EC 06        CALL PRINT_END_HL
0621   034C C3 7B 00        JP  EXIT_SYS
0622   034F             
0623   034F             SHOW_REG_IX:
0624   034F CD 49 04        CALL  GET_KEY_A
0625   0352 FE 00           CP  0
0626   0354 CA 5B 05        JP Z, GO_MONITOR
0627   0357 CD 00 06        CALL  CLEAR_DISPLAY
0628   035A             
0629   035A 3E 50           LD  A, $50               ; R
0630   035C 32 00 FF        LD  (DIG_0), A
0631   035F             
0632   035F 3E 06           LD  A, $06               ; I
0633   0361 32 01 FF        LD  (DIG_1), A
0634   0364             
0635   0364 3E 70           LD  A, $70               ; X
0636   0366 32 02 FF        LD  (DIG_2), A
0637   0369             
0638   0369 2A 20 FF        LD HL, (USR_IX)
0639   036C CD EC 06        CALL PRINT_END_HL
0640   036F C3 7B 00        JP  EXIT_SYS
0641   0372             
0642   0372             SHOW_REG_IY:
0643   0372 CD 49 04        CALL  GET_KEY_A
0644   0375 FE 00           CP  0
0645   0377 CA 5B 05        JP Z, GO_MONITOR
0646   037A CD 00 06        CALL  CLEAR_DISPLAY
0647   037D             
0648   037D 3E 50           LD  A, $50               ; R
0649   037F 32 00 FF        LD  (DIG_0), A
0650   0382             
0651   0382 3E 06           LD  A, $06               ; I
0652   0384 32 01 FF        LD  (DIG_1), A
0653   0387             
0654   0387 3E 6E           LD  A, $6E               ; Y
0655   0389 32 02 FF        LD  (DIG_2), A
0656   038C             
0657   038C 2A 22 FF        LD HL, (USR_IY)
0658   038F CD EC 06        CALL PRINT_END_HL
0659   0392 C3 7B 00        JP  EXIT_SYS
0660   0395             
0661   0395             SHOW_REG_AFaux:
0662   0395 CD 49 04        CALL  GET_KEY_A
0663   0398 FE 00           CP  0
0664   039A CA 5B 05        JP Z, GO_MONITOR
0665   039D FE 03           CP  $03
0666   039F CA 7C 05        JP Z, GO_SHOW_REG_AF
0667   03A2             
0668   03A2 CD 00 06        CALL  CLEAR_DISPLAY
0669   03A5             
0670   03A5 3E 50           LD  A, $50               ; R
0671   03A7 32 00 FF        LD  (DIG_0), A
0672   03AA             
0673   03AA 3E 77           LD  A, $77               ; A
0674   03AC 32 01 FF        LD  (DIG_1), A
0675   03AF             
0676   03AF 3E 71           LD  A, $71               ; F
0677   03B1 32 02 FF        LD  (DIG_2), A
0678   03B4             
0679   03B4 3E 20           LD  A, $20               ; '
0680   03B6 32 03 FF        LD  (DIG_3), A
0681   03B9             
0682   03B9 2A 24 FF        LD HL, (USR_AFA)
0683   03BC CD EC 06        CALL PRINT_END_HL
0684   03BF C3 7B 00        JP  EXIT_SYS
0685   03C2             
0686   03C2             
0687   03C2             SHOW_REG_BCaux:
0688   03C2 CD 49 04        CALL  GET_KEY_A
0689   03C5 FE 00           CP  0
0690   03C7 CA 5B 05        JP Z, GO_MONITOR
0691   03CA FE 04           CP  $04
0692   03CC CA 87 05        JP Z, GO_SHOW_REG_BC
0693   03CF             
0694   03CF CD 00 06        CALL  CLEAR_DISPLAY
0695   03D2             
0696   03D2 3E 50           LD  A, $50               ; R
0697   03D4 32 00 FF        LD  (DIG_0), A
0698   03D7             
0699   03D7 3E 7C           LD  A, $7C               ; B
0700   03D9 32 01 FF        LD  (DIG_1), A
0701   03DC             
0702   03DC 3E 39           LD  A, $39               ; C
0703   03DE 32 02 FF        LD  (DIG_2), A
0704   03E1             
0705   03E1 3E 20           LD  A, $20               ; '
0706   03E3 32 03 FF        LD  (DIG_3), A
0707   03E6             
0708   03E6 2A 26 FF        LD HL, (USR_BCA)
0709   03E9 CD EC 06        CALL PRINT_END_HL
0710   03EC C3 7B 00        JP  EXIT_SYS
0711   03EF             
0712   03EF             SHOW_REG_DEaux:
0713   03EF CD 49 04        CALL  GET_KEY_A
0714   03F2 FE 00           CP  0
0715   03F4 CA 5B 05        JP Z, GO_MONITOR
0716   03F7 FE 05           CP  $05
0717   03F9 CA 92 05        JP Z, GO_SHOW_REG_DE
0718   03FC             
0719   03FC CD 00 06        CALL  CLEAR_DISPLAY
0720   03FF             
0721   03FF 3E 50           LD  A, $50               ; R
0722   0401 32 00 FF        LD  (DIG_0), A
0723   0404             
0724   0404 3E 5E           LD  A, $5E               ; D
0725   0406 32 01 FF        LD  (DIG_1), A
0726   0409             
0727   0409 3E 79           LD  A, $79               ; E
0728   040B 32 02 FF        LD  (DIG_2), A
0729   040E             
0730   040E 3E 20           LD  A, $20               ; '
0731   0410 32 03 FF        LD  (DIG_3), A
0732   0413             
0733   0413 2A 28 FF        LD HL, (USR_DEA)
0734   0416 CD EC 06        CALL PRINT_END_HL
0735   0419 C3 7B 00        JP  EXIT_SYS
0736   041C             
0737   041C             SHOW_REG_HLaux:
0738   041C CD 49 04        CALL  GET_KEY_A
0739   041F FE 00           CP  0
0740   0421 CA 5B 05        JP Z, GO_MONITOR
0741   0424 FE 06           CP  $06
0742   0426 CA 9D 05        JP Z, GO_SHOW_REG_HL
0743   0429             
0744   0429 CD 00 06        CALL  CLEAR_DISPLAY
0745   042C             
0746   042C 3E 50           LD  A, $50               ; R
0747   042E 32 00 FF        LD  (DIG_0), A
0748   0431             
0749   0431 3E 76           LD  A, $76               ; H
0750   0433 32 01 FF        LD  (DIG_1), A
0751   0436             
0752   0436 3E 38           LD  A, $38               ; L
0753   0438 32 02 FF        LD  (DIG_2), A
0754   043B             
0755   043B 3E 20           LD  A, $20               ; '
0756   043D 32 03 FF        LD  (DIG_3), A
0757   0440             
0758   0440 2A 2A FF        LD HL, (USR_HLA)
0759   0443 CD EC 06        CALL PRINT_END_HL
0760   0446 C3 7B 00        JP  EXIT_SYS
0761   0449             
0762   0449             
0763   0449             ; =========================================================
0764   0449             ; GET KEY IN A, IF A == FFh then no KEY
0765   0449             ; =========================================================
0766   0449             GET_KEY_A:
0767   0449 3A 0B FF        LD  A, (KEY_TIMEOUT)
0768   044C FE 00           CP  0
0769   044E CA 54 04        JP  Z, RET_KEY
0770   0451 3E FF           LD  A, $FF
0771   0453 C9              RET
0772   0454             
0773   0454             RET_KEY:
0774   0454 3E 64           LD A, CKEY_TIMEOUT
0775   0456 32 0B FF        LD (KEY_TIMEOUT), A
0776   0459             
0777   0459 3A 08 FF        LD  A, (KEY_PRESS)
0778   045C F5              PUSH  AF
0779   045D 3E FF           LD  A, $FF
0780   045F 32 08 FF        LD  (KEY_PRESS), A
0781   0462 F1              POP  AF
0782   0463 C9              RET
0783   0464             
0784   0464             
0785   0464             ; =========================================================
0786   0464             ; MONITOR Mode
0787   0464             ; =========================================================
0788   0464             USER_MODE:
0789   0464 3A 09 FF        LD  A, (INPUT)
0790   0467 FE FB           CP  $FB
0791   0469 CA 5B 05        JP  Z, GO_MONITOR
0792   046C                 
0793   046C                 ; Copy USER_DISPx to DIG_x
0794   046C 21 D0 FF        LD	HL, USER_DISP0
0795   046F 11 00 FF    	LD	DE, DIG_0
0796   0472 01 08 00    	LD	BC, $0008
0797   0475 ED B0       	LDIR
0798   0477             
0799   0477 C3 7B 00        JP  EXIT_SYS
0800   047A             
0801   047A             MONITOR_MODE:
0802   047A                 ; Mostra o endereço
0803   047A 2A 0D FF        LD  HL, (PC_RAM)
0804   047D CD 8F 06        CALL PRINT_HL
0805   0480             
0806   0480                 ; Limpa digitos
0807   0480 3E 00           LD  A, 0
0808   0482 32 04 FF        LD  (DIG_4), A
0809   0485 32 05 FF        LD  (DIG_5), A
0810   0488             
0811   0488                 ; Mostra os dados no endereço
0812   0488 2A 0D FF        LD  HL, (PC_RAM)
0813   048B 7E              LD  A, (HL)
0814   048C CD 62 06        CALL  PRINT_A
0815   048F             
0816   048F             
0817   048F CD 49 04        CALL  GET_KEY_A
0818   0492             
0819   0492                 ; Incrementa endereço
0820   0492 32 0A FF        LD (TMP_KEY), A
0821   0495 FE 0A           CP  $0A
0822   0497 CA 17 05        JP  Z,  PC_RAM_INC
0823   049A             
0824   049A                 ; Decrementa endereço
0825   049A 3A 0A FF        LD  A, (TMP_KEY)
0826   049D FE 0B           CP  $0B
0827   049F CA 0D 05        JP  Z,  PC_RAM_DEC
0828   04A2             
0829   04A2                 ; Examina memoria
0830   04A2 3A 0A FF        LD  A, (TMP_KEY)
0831   04A5 FE 0E           CP  $0E
0832   04A7 CA 21 05        JP  Z,  GO_EXAMINE
0833   04AA             
0834   04AA                 ; + moDify Memory
0835   04AA 3A 0A FF        LD  A, (TMP_KEY)
0836   04AD FE 0C           CP  $0C
0837   04AF CA 3C 05        JP  Z,  GO_ADD_MODIFY
0838   04B2             
0839   04B2                 ; moDify Memory
0840   04B2 3A 0A FF        LD  A, (TMP_KEY)
0841   04B5 FE 0D           CP  $0D
0842   04B7 CA 46 05        JP  Z,  GO_MODIFY
0843   04BA             
0844   04BA                 ; RUN
0845   04BA 3A 0A FF        LD  A, (TMP_KEY)
0846   04BD FE 0F           CP  $0F
0847   04BF CA EA 05        JP  Z,  FIRE
0848   04C2             
0849   04C2                 ; Show register PC
0850   04C2 3A 0A FF        LD  A, (TMP_KEY)
0851   04C5 FE 01           CP  $01
0852   04C7 CA 66 05        JP  Z, GO_SHOW_REG_PC
0853   04CA             
0854   04CA                 ; Show register SP
0855   04CA 3A 0A FF        LD  A, (TMP_KEY)
0856   04CD FE 02           CP  $02
0857   04CF CA 71 05        JP  Z, GO_SHOW_REG_SP
0858   04D2             
0859   04D2                 ; Show register AF
0860   04D2 3A 0A FF        LD  A, (TMP_KEY)
0861   04D5 FE 03           CP  $03
0862   04D7 CA 7C 05        JP  Z, GO_SHOW_REG_AF
0863   04DA             
0864   04DA                 ; Show register BC
0865   04DA 3A 0A FF        LD  A, (TMP_KEY)
0866   04DD FE 04           CP  $04
0867   04DF CA 87 05        JP  Z, GO_SHOW_REG_BC
0868   04E2             
0869   04E2                 ; Show register DE
0870   04E2 3A 0A FF        LD  A, (TMP_KEY)
0871   04E5 FE 05           CP  $05
0872   04E7 CA 92 05        JP  Z, GO_SHOW_REG_DE
0873   04EA             
0874   04EA                 ; Show register HL
0875   04EA 3A 0A FF        LD  A, (TMP_KEY)
0876   04ED FE 06           CP  $06
0877   04EF CA 9D 05        JP  Z, GO_SHOW_REG_HL
0878   04F2             
0879   04F2                 ; Show register IX
0880   04F2 3A 0A FF        LD  A, (TMP_KEY)
0881   04F5 FE 07           CP  $07
0882   04F7 CA A8 05        JP  Z, GO_SHOW_REG_IX
0883   04FA             
0884   04FA                 ; Show register iY
0885   04FA 3A 0A FF        LD  A, (TMP_KEY)
0886   04FD FE 08           CP  $08
0887   04FF CA B3 05        JP  Z, GO_SHOW_REG_IY
0888   0502             
0889   0502                 ; Back to user mode
0890   0502 3A 0A FF        LD  A, (TMP_KEY)
0891   0505 FE 09           CP  $09
0892   0507 CA F8 05        JP  Z, GO_USER_MODE
0893   050A             
0894   050A C3 7B 00        JP  EXIT_SYS
0895   050D                 
0896   050D             
0897   050D             PC_RAM_DEC:
0898   050D 2A 0D FF        LD  HL, (PC_RAM)
0899   0510 2B              DEC  HL
0900   0511 22 0D FF        LD  (PC_RAM), HL
0901   0514 C3 7B 00        JP  EXIT_SYS
0902   0517             
0903   0517             PC_RAM_INC:
0904   0517 2A 0D FF        LD  HL, (PC_RAM)
0905   051A 23              INC  HL
0906   051B 22 0D FF        LD  (PC_RAM), HL
0907   051E C3 7B 00        JP  EXIT_SYS
0908   0521             
0909   0521             GO_EXAMINE:
0910   0521 3E 03           LD  A, $03
0911   0523 32 12 FF        LD (EXM_COUNT), A        ; Set count 4 digits, position display
0912   0526 3E 02           LD  A, $02
0913   0528 32 0F FF        LD (SYSMODE), A          ; Examine mode
0914   052B 3E 40           LD A, 01000000b
0915   052D 32 00 FF        LD (DIG_0), A
0916   0530 32 01 FF        LD (DIG_1), A
0917   0533 32 02 FF        LD (DIG_2), A
0918   0536 32 03 FF        LD (DIG_3), A
0919   0539 C3 7B 00        JP  EXIT_SYS
0920   053C             
0921   053C             GO_ADD_MODIFY:
0922   053C 2A 0D FF        LD  HL, (PC_RAM)
0923   053F 23              INC HL
0924   0540 22 0D FF        LD  (PC_RAM), HL
0925   0543 CD 8F 06        CALL  PRINT_HL
0926   0546             GO_MODIFY:
0927   0546 3E 01           LD  A, $01                  ; Set count 2 digits, position display
0928   0548 32 13 FF        LD  (MDF_COUNT), A
0929   054B 3E 03           LD  A, $03                  ; moDify mode (Memory)
0930   054D 32 0F FF        LD  (SYSMODE), A
0931   0550 3E 40           LD  A, 01000000b
0932   0552 32 06 FF        LD  (DIG_6), A
0933   0555 32 07 FF        LD  (DIG_7), A
0934   0558 C3 7B 00        JP  EXIT_SYS
0935   055B             
0936   055B             GO_MONITOR:
0937   055B CD 00 06        CALL  CLEAR_DISPLAY
0938   055E 3E 01           LD  A, $01
0939   0560 32 0F FF        LD  (SYSMODE), A
0940   0563 C3 7B 00        JP  EXIT_SYS
0941   0566             
0942   0566             GO_SHOW_REG_PC:
0943   0566 CD 00 06        CALL CLEAR_DISPLAY
0944   0569 3E 04           LD  A, $04
0945   056B 32 0F FF        LD  (SYSMODE), A
0946   056E C3 7B 00        JP  EXIT_SYS
0947   0571             
0948   0571             GO_SHOW_REG_SP:
0949   0571 CD 00 06        CALL CLEAR_DISPLAY
0950   0574 3E 05           LD  A, $05
0951   0576 32 0F FF        LD  (SYSMODE), A
0952   0579 C3 7B 00        JP  EXIT_SYS
0953   057C             
0954   057C             GO_SHOW_REG_AF:
0955   057C CD 00 06        CALL CLEAR_DISPLAY
0956   057F 3E 06           LD  A, $06
0957   0581 32 0F FF        LD  (SYSMODE), A
0958   0584 C3 7B 00        JP  EXIT_SYS
0959   0587             
0960   0587             GO_SHOW_REG_BC:
0961   0587 CD 00 06        CALL CLEAR_DISPLAY
0962   058A 3E 07           LD  A, $07
0963   058C 32 0F FF        LD  (SYSMODE), A
0964   058F C3 7B 00        JP  EXIT_SYS
0965   0592             
0966   0592             GO_SHOW_REG_DE:
0967   0592 CD 00 06        CALL CLEAR_DISPLAY
0968   0595 3E 08           LD  A, $08
0969   0597 32 0F FF        LD  (SYSMODE), A
0970   059A C3 7B 00        JP  EXIT_SYS
0971   059D             
0972   059D             GO_SHOW_REG_HL:
0973   059D CD 00 06        CALL CLEAR_DISPLAY
0974   05A0 3E 09           LD  A, $09
0975   05A2 32 0F FF        LD  (SYSMODE), A
0976   05A5 C3 7B 00        JP  EXIT_SYS
0977   05A8             
0978   05A8             GO_SHOW_REG_IX:
0979   05A8 CD 00 06        CALL CLEAR_DISPLAY
0980   05AB 3E 0A           LD  A, $0A
0981   05AD 32 0F FF        LD  (SYSMODE), A
0982   05B0 C3 7B 00        JP  EXIT_SYS
0983   05B3             
0984   05B3             GO_SHOW_REG_IY:
0985   05B3 CD 00 06        CALL CLEAR_DISPLAY
0986   05B6 3E 0B           LD  A, $0B
0987   05B8 32 0F FF        LD  (SYSMODE), A
0988   05BB C3 7B 00        JP  EXIT_SYS
0989   05BE             
0990   05BE             GO_SHOW_REG_AFaux:
0991   05BE CD 00 06        CALL CLEAR_DISPLAY
0992   05C1 3E 0C           LD  A, $0C
0993   05C3 32 0F FF        LD  (SYSMODE), A
0994   05C6 C3 7B 00        JP  EXIT_SYS
0995   05C9             
0996   05C9             GO_SHOW_REG_BCaux:
0997   05C9 CD 00 06        CALL CLEAR_DISPLAY
0998   05CC 3E 0D           LD  A, $0D
0999   05CE 32 0F FF        LD  (SYSMODE), A
1000   05D1 C3 7B 00        JP  EXIT_SYS
1001   05D4             
1002   05D4             GO_SHOW_REG_DEaux:
1003   05D4 CD 00 06        CALL CLEAR_DISPLAY
1004   05D7 3E 0E           LD  A, $0E
1005   05D9 32 0F FF        LD  (SYSMODE), A
1006   05DC C3 7B 00        JP  EXIT_SYS
1007   05DF             
1008   05DF             GO_SHOW_REG_HLaux:
1009   05DF CD 00 06        CALL CLEAR_DISPLAY
1010   05E2 3E 0F           LD  A, $0F
1011   05E4 32 0F FF        LD  (SYSMODE), A
1012   05E7 C3 7B 00        JP  EXIT_SYS
1013   05EA             
1014   05EA             FIRE:
1015   05EA 3E 01           LD  A, 1
1016   05EC 32 0F FF        LD (SYSMODE), A          ; Monitor mode
1017   05EF 2A 0D FF        LD  HL, (PC_RAM)
1018   05F2 22 14 FF        LD  (USR_PC), HL
1019   05F5 C3 7B 00        JP  EXIT_SYS
1020   05F8             
1021   05F8             GO_USER_MODE:
1022   05F8 3E 00           LD  A, 0
1023   05FA 32 0F FF        LD  (SYSMODE), A
1024   05FD C3 7B 00        JP  EXIT_SYS
1025   0600             
1026   0600             ; =========================================================
1027   0600             ; LIMPA DISPLAY
1028   0600             ; =========================================================
1029   0600             CLEAR_DISPLAY:
1030   0600 F5              PUSH  AF
1031   0601 3E 00           LD  A, 0
1032   0603 32 00 FF        LD  (DIG_0), A
1033   0606 32 01 FF        LD  (DIG_1), A
1034   0609 32 02 FF        LD  (DIG_2), A
1035   060C 32 03 FF        LD  (DIG_3), A
1036   060F 32 04 FF        LD  (DIG_4), A
1037   0612 32 05 FF        LD  (DIG_5), A
1038   0615 32 06 FF        LD  (DIG_6), A
1039   0618 32 07 FF        LD  (DIG_7), A
1040   061B F1              POP  AF
1041   061C C9              RET
1042   061D             
1043   061D             ; =========================================================
1044   061D             ; LIMPA USER DISPLAY
1045   061D             ; =========================================================
1046   061D             CLEAR_USER_DISPLAY:
1047   061D F5              PUSH  AF
1048   061E 3E 00           LD  A, 0
1049   0620 32 D0 FF        LD  (USER_DISP0), A
1050   0623 32 D1 FF        LD  (USER_DISP1), A
1051   0626 32 D2 FF        LD  (USER_DISP2), A
1052   0629 32 D3 FF        LD  (USER_DISP3), A
1053   062C 32 D4 FF        LD  (USER_DISP4), A
1054   062F 32 D5 FF        LD  (USER_DISP5), A
1055   0632 32 D6 FF        LD  (USER_DISP6), A
1056   0635 32 D7 FF        LD  (USER_DISP7), A
1057   0638 F1              POP  AF
1058   0639 C9              RET
1059   063A             
1060   063A             
1061   063A             ; =========================================================
1062   063A             ; PEGA LOW NUM EM A E RETORNA CHAR 7SEG EM A
1063   063A             ; =========================================================
1064   063A             GET_NUM_FROM_LOW:
1065   063A E5              PUSH    HL
1066   063B C5              PUSH    BC
1067   063C 21 BC 07        LD      HL, LED_FONT
1068   063F E6 0F           AND     $0F
1069   0641 01 00 00        LD      BC, 0
1070   0644 4F              LD      C, A
1071   0645 09              ADD     HL, BC
1072   0646 7E              LD      A, (HL)
1073   0647 C1              POP     BC
1074   0648 E1              POP     HL
1075   0649 C9              RET
1076   064A             
1077   064A             ; =========================================================
1078   064A             ; PEGA HIGH NUM EM A E RETORNA CHAR 7SEG EM A
1079   064A             ; =========================================================
1080   064A             GET_NUM_FROM_HIGH:
1081   064A E5              PUSH    HL
1082   064B C5              PUSH    BC
1083   064C 21 BC 07        LD      HL, LED_FONT
1084   064F E6 F0           AND     $F0
1085   0651 CB 0F           RRC     A
1086   0653 CB 0F           RRC     A
1087   0655 CB 0F           RRC     A
1088   0657 CB 0F           RRC     A
1089   0659 01 00 00        LD      BC, 0
1090   065C 4F              LD      C, A
1091   065D 09              ADD     HL, BC
1092   065E 7E              LD      A, (HL)
1093   065F C1              POP     BC
1094   0660 E1              POP     HL
1095   0661 C9              RET
1096   0662             
1097   0662             ; =========================================================
1098   0662             ; Mostra o que esta em A nos digitos 6 e 7
1099   0662             ; =========================================================
1100   0662             PRINT_A:
1101   0662 E5              PUSH    HL
1102   0663 C5              PUSH    BC
1103   0664 F5              PUSH    AF
1104   0665 F5              PUSH    AF
1105   0666             
1106   0666 21 BC 07        LD	HL, LED_FONT
1107   0669 E6 0F           AND $0F
1108   066B 01 00 00        LD      BC, 0
1109   066E 4F              LD      C, A
1110   066F 09              ADD HL, BC
1111   0670 7E              LD  A, (HL)
1112   0671 32 07 FF        LD  (DIG_7), A
1113   0674             
1114   0674 F1              POP    AF
1115   0675 21 BC 07        LD	HL, LED_FONT
1116   0678 E6 F0           AND  $F0
1117   067A CB 0F           RRC  A
1118   067C CB 0F           RRC  A
1119   067E CB 0F           RRC  A
1120   0680 CB 0F           RRC  A
1121   0682 01 00 00        LD      BC, 0
1122   0685 4F              LD      C, A
1123   0686 09              ADD HL, BC
1124   0687 7E              LD  A, (HL)
1125   0688 32 06 FF        LD  (DIG_6), A
1126   068B             
1127   068B F1              POP     AF
1128   068C C1              POP     BC
1129   068D E1              POP     HL
1130   068E C9              RET
1131   068F             
1132   068F             ; =========================================================
1133   068F             ; Mostra o que esta em HL - Display(HHLLXXXX)
1134   068F             ; =========================================================
1135   068F             PRINT_HL:
1136   068F F5              PUSH  AF
1137   0690 E5              PUSH  HL
1138   0691 C5              PUSH  BC
1139   0692             
1140   0692 E5              PUSH  HL
1141   0693 E5              PUSH  HL
1142   0694 E5              PUSH  HL
1143   0695             
1144   0695 7D              LD  A, L
1145   0696 21 BC 07        LD	HL, LED_FONT
1146   0699 E6 0F           AND $0F
1147   069B 01 00 00        LD      BC, 0
1148   069E 4F              LD      C, A
1149   069F 09              ADD HL, BC
1150   06A0 7E              LD  A, (HL)
1151   06A1 21 03 FF        LD  HL, DIG_3
1152   06A4 77              LD  (HL), A
1153   06A5             
1154   06A5 E1              POP  HL
1155   06A6 7D              LD  A, L
1156   06A7 21 BC 07        LD	HL, LED_FONT
1157   06AA E6 F0           AND  $F0
1158   06AC CB 0F           RRC  A
1159   06AE CB 0F           RRC  A
1160   06B0 CB 0F           RRC  A
1161   06B2 CB 0F           RRC  A
1162   06B4 01 00 00        LD      BC, 0
1163   06B7 4F              LD      C, A
1164   06B8 09              ADD HL, BC
1165   06B9 7E              LD  A, (HL)
1166   06BA 21 02 FF        LD  HL, DIG_2
1167   06BD 77              LD  (HL), A
1168   06BE             
1169   06BE E1              POP  HL
1170   06BF 7C              LD  A, H
1171   06C0 21 BC 07        LD	HL, LED_FONT
1172   06C3 E6 0F           AND $0F
1173   06C5 01 00 00        LD      BC, 0
1174   06C8 4F              LD      C, A
1175   06C9 09              ADD HL, BC
1176   06CA 7E              LD  A, (HL)
1177   06CB 21 01 FF        LD  HL, DIG_1
1178   06CE 77              LD  (HL), A
1179   06CF             
1180   06CF E1              POP  HL
1181   06D0 7C              LD  A, H
1182   06D1 21 BC 07        LD	HL, LED_FONT
1183   06D4 E6 F0           AND  $F0
1184   06D6 CB 0F           RRC  A
1185   06D8 CB 0F           RRC  A
1186   06DA CB 0F           RRC  A
1187   06DC CB 0F           RRC  A
1188   06DE 01 00 00        LD      BC, 0
1189   06E1 4F              LD      C, A
1190   06E2 09              ADD HL, BC
1191   06E3 7E              LD  A, (HL)
1192   06E4 21 00 FF        LD  HL, DIG_0
1193   06E7 77              LD  (HL), A
1194   06E8             
1195   06E8 C1              POP  BC
1196   06E9 E1              POP  HL
1197   06EA F1              POP  AF
1198   06EB             
1199   06EB C9              RET
1200   06EC             
1201   06EC             ; =========================================================
1202   06EC             ; Mostra o que esta em HL - Display(XXXXHHLL)
1203   06EC             ; =========================================================
1204   06EC             PRINT_END_HL:
1205   06EC F5              PUSH  AF
1206   06ED E5              PUSH  HL
1207   06EE C5              PUSH  BC
1208   06EF             
1209   06EF E5              PUSH  HL
1210   06F0 E5              PUSH  HL
1211   06F1 E5              PUSH  HL
1212   06F2             
1213   06F2 7D              LD  A, L
1214   06F3 21 BC 07        LD	HL, LED_FONT
1215   06F6 E6 0F           AND $0F
1216   06F8 01 00 00        LD      BC, 0
1217   06FB 4F              LD      C, A
1218   06FC 09              ADD HL, BC
1219   06FD 7E              LD  A, (HL)
1220   06FE 21 07 FF        LD  HL, DIG_7
1221   0701 77              LD  (HL), A
1222   0702             
1223   0702 E1              POP  HL
1224   0703 7D              LD  A, L
1225   0704 21 BC 07        LD	HL, LED_FONT
1226   0707 E6 F0           AND  $F0
1227   0709 CB 0F           RRC  A
1228   070B CB 0F           RRC  A
1229   070D CB 0F           RRC  A
1230   070F CB 0F           RRC  A
1231   0711 01 00 00        LD      BC, 0
1232   0714 4F              LD      C, A
1233   0715 09              ADD HL, BC
1234   0716 7E              LD  A, (HL)
1235   0717 21 06 FF        LD  HL, DIG_6
1236   071A 77              LD  (HL), A
1237   071B             
1238   071B E1              POP  HL
1239   071C 7C              LD  A, H
1240   071D 21 BC 07        LD	HL, LED_FONT
1241   0720 E6 0F           AND $0F
1242   0722 01 00 00        LD      BC, 0
1243   0725 4F              LD      C, A
1244   0726 09              ADD HL, BC
1245   0727 7E              LD  A, (HL)
1246   0728 21 05 FF        LD  HL, DIG_5
1247   072B 77              LD  (HL), A
1248   072C             
1249   072C E1              POP  HL
1250   072D 7C              LD  A, H
1251   072E 21 BC 07        LD	HL, LED_FONT
1252   0731 E6 F0           AND  $F0
1253   0733 CB 0F           RRC  A
1254   0735 CB 0F           RRC  A
1255   0737 CB 0F           RRC  A
1256   0739 CB 0F           RRC  A
1257   073B 01 00 00        LD      BC, 0
1258   073E 4F              LD      C, A
1259   073F 09              ADD HL, BC
1260   0740 7E              LD  A, (HL)
1261   0741 21 04 FF        LD  HL, DIG_4
1262   0744 77              LD  (HL), A
1263   0745             
1264   0745 C1              POP  BC
1265   0746 E1              POP  HL
1266   0747 F1              POP  AF
1267   0748             
1268   0748 C9              RET
1269   0749             
1270   0749             ; =========================================================
1271   0749             ; Start Sistem ?
1272   0749             ; =========================================================
1273   0749             START:
1274   0749 31 00 FF        LD  SP, STACK
1275   074C 21 00 80        LD  HL, START_RAM
1276   074F 22 0D FF        LD  (PC_RAM), HL
1277   0752             
1278   0752                 ; start vars
1279   0752 3E 64           LD  A, CKEY_TIMEOUT
1280   0754 32 0B FF        LD  (KEY_TIMEOUT), A
1281   0757             
1282   0757 3E 01           LD  A, 1                 ; Monitor mode
1283   0759 32 0F FF        LD  (SYSMODE), A
1284   075C             
1285   075C 3E FF           LD A, $FF
1286   075E 32 08 FF        LD (KEY_PRESS), A
1287   0761             
1288   0761 ED 56           IM  1
1289   0763 FB              EI
1290   0764             
1291   0764 AF              XOR A
1292   0765 D3 40           OUT (Port40), A
1293   0767             
1294   0767             
1295   0767 3E 00           LD  A, $00
1296   0769 32 00 FF        LD  (DIG_0), A
1297   076C             
1298   076C 3E 00           LD  A, $00
1299   076E 32 01 FF        LD  (DIG_1), A
1300   0771             
1301   0771 3E 00           LD  A, $0
1302   0773 32 02 FF        LD  (DIG_2), A
1303   0776             
1304   0776 3E 00           LD  A, $00
1305   0778 32 03 FF        LD  (DIG_3), A
1306   077B             
1307   077B 3E 00           LD  A, $00
1308   077D 32 04 FF        LD  (DIG_4), A
1309   0780             
1310   0780 3E 00           LD  A, $00
1311   0782 32 05 FF        LD  (DIG_5), A
1312   0785             
1313   0785 3E 00           LD  A, $00
1314   0787 32 06 FF        LD  (DIG_6), A
1315   078A             
1316   078A 3E 00           LD  A, $00
1317   078C 32 07 FF        LD  (DIG_7), A
1318   078F             
1319   078F             START_LOOP:
1320   078F             
1321   078F C3 8F 07        JP START_LOOP
1322   0792             
1323   0792             
1324   0792             
1325   0792             
1326   0792             
1327   0792             
1328   0792             
1329   0792             
1330   0792             
1331   0792             ; =========================================================
1332   0792             ; Delay
1333   0792             ; =========================================================
1334   0792             delay:
1335   0792 C5          	push bc                       ; 2.75 us
1336   0793 06 FF           ld b, 255                     ; 1.75 us
1337   0795             delay_loop_b:
1338   0795 0E FF       	ld c, 255                     ; 1.75 us
1339   0797             delay_loop:
1340   0797 0D          	dec c                         ; 1 us
1341   0798 C2 97 07        jp nz, delay_loop             ; true = 3 us, false 1.75 us
1342   079B 05              dec b                         ; 1 us
1343   079C C2 95 07        jp nz, delay_loop_b           ; true = 3 us, false 1.75 us
1344   079F C1              pop bc                        ; 2.50 us
1345   07A0 C9              ret                           ; 2.50 us
1346   07A1             
1347   07A1             
1348   07A1             ;============================================================================
1349   07A1             ;	Subroutine	Delay_A
1350   07A1             ;
1351   07A1             ;	Entry:	A = Millisecond count
1352   07A1             ;============================================================================
1353   07A1 E5          DELAY_A:	PUSH	HL			; Save count
1354   07A2 21 10 FF    		LD	HL,TicCounter
1355   07A5 86          		ADD	A,(HL)			; A = cycle count
1356   07A6 BE          DlyLp		CP	(HL)			; Wait required TicCounter times
1357   07A7 C2 A6 07    		JP	NZ,DlyLp		;  loop if not done
1358   07AA E1          		POP	HL
1359   07AB C9          		RET
1360   07AC             
1361   07AC             
1362   07AC 0E 01       DELAY_100mS	LD	C,1
1363   07AE C5          DELAY_C		PUSH	BC
1364   07AF 06 00       		LD	B,0
1365   07B1 C5          DELAY_LP	PUSH	BC
1366   07B2 10 FE       		DJNZ	$		;13   * 256 / 4 = 832uSec
1367   07B4 C1          		POP	BC
1368   07B5 10 FA       		DJNZ	DELAY_LP	;~100mSEC
1369   07B7 0D          		DEC	C
1370   07B8 20 F7       		JR  NZ,	DELAY_LP	;*4 ~= 7mSec
1371   07BA C1          		POP	BC
1372   07BB C9          		RET
1373   07BC             
1374   07BC             ; Mapa char to display 0-F
1375   07BC 3F065B4F666DLED_FONT .db $3F, $06, $5B, $4F, $66, $6D, $7D, $07, $7F, $67 ; 0-9
1375   07C2 7D077F67
1376   07C6 777C395E7971         .DB $77, $7C, $39, $5E, $79, $71                     ; A-F
1377   07CC             
1378   07CC             
1379   07CC             
1380   07CC             ; ---------------------------------------------------------
1381   07CC             ; RAM MAP - Utilitys Program | $FE00 - $FEFF
1382   07CC             ; ---------------------------------------------------------
1383   07CC             DIEGO      .equ    $FE00   ;(2) Temp Digits to countDown
1384   07CC             
1385   07CC             BLINK_TESTE:
1386   07CC 3E 01           LD  A, 1
1387   07CE             BLINK_TESTE_LOOP:
1388   07CE EE 01           XOR 1
1389   07D0 D3 C0           OUT (PortC0), A 
1390   07D2 C3 CE 07        JP BLINK_TESTE_LOOP
1391   07D5             
1392   07D5             
1393   07D5             BLINK_DELAY_C:
1394   07D5 3E 01           LD  A, 1
1395   07D7             BLINK_DELAY_C_LOOP:
1396   07D7 EE 01           XOR 1
1397   07D9 D3 C0           OUT (PortC0), A
1398   07DB CD AC 07        CALL DELAY_100mS
1399   07DE C3 D7 07        JP BLINK_DELAY_C_LOOP
1400   07E1             
1401   07E1             
1402   07E1             BLINK_DELAY_A:
1403   07E1 3E 01           LD  A, 1
1404   07E3             BLINK_DELAY_A_LOOP:
1405   07E3 EE 01           XOR 1
1406   07E5 D3 C0           OUT (PortC0), A
1407   07E7 F5              PUSH  AF
1408   07E8 3E 64           LD  A, 100
1409   07EA CD A1 07        CALL DELAY_A
1410   07ED F1              POP AF
1411   07EE C3 E3 07        JP BLINK_DELAY_A_LOOP
1412   07F1             
1413   07F1             
1414   07F1             
1415   07F1             TESTE_SOM:
1416   07F1 3E 00           LD  A, 0
1417   07F3 32 0F FF        LD  (SYSMODE), A
1418   07F6 3E 00           LD  A, 0
1419   07F8 47              LD  B, A
1420   07F9 CD 1D 06        CALL CLEAR_USER_DISPLAY
1421   07FC 3E 6D           LD  A, $6D ; S
1422   07FE 32 D0 FF        LD  (USER_DISP0), A
1423   0801 3E 3F           LD  A, $3F ; O
1424   0803 32 D1 FF        LD  (USER_DISP1), A
1425   0806 3E 1C           LD  A, $1C ; U
1426   0808 32 D2 FF        LD  (USER_DISP2), A
1427   080B 3E 54           LD  A, $54 ; N
1428   080D 32 D3 FF        LD  (USER_DISP3), A
1429   0810 3E 5E           LD  A, $5E ; D
1430   0812 32 D4 FF        LD  (USER_DISP4), A
1431   0815             LOOP_SOM:
1432   0815 78              LD  A, B
1433   0816 CD 3A 06        CALL GET_NUM_FROM_LOW
1434   0819 32 D7 FF        LD  (USER_DISP7), A
1435   081C 78              LD  A, B
1436   081D CD 4A 06        CALL GET_NUM_FROM_HIGH
1437   0820 32 D6 FF        LD  (USER_DISP6), A
1438   0823             
1439   0823 CD 49 04        CALL GET_KEY_A
1440   0826 FE 0A           CP  $0A
1441   0828 CA 38 08        JP  Z, SOM_INC
1442   082B FE 0B           CP  $0B
1443   082D CA 43 08        JP  Z, SOM_DEC
1444   0830 FE 0F           CP  $0F
1445   0832 CA 4E 08        JP  Z, SOM_LOOP_INC
1446   0835 C3 15 08        JP  LOOP_SOM
1447   0838             
1448   0838             
1449   0838             SOM_INC:
1450   0838 04              INC B
1451   0839 0E C0           LD  C, $C0
1452   083B ED 41           OUT (C), B
1453   083D CD AC 07        CALL DELAY_100mS
1454   0840 C3 15 08        JP  LOOP_SOM
1455   0843             
1456   0843             SOM_DEC:
1457   0843 05              DEC B
1458   0844 0E C0           LD  C, $C0
1459   0846 ED 41           OUT (C), B
1460   0848 CD AC 07        CALL DELAY_100mS
1461   084B C3 15 08        JP  LOOP_SOM
1462   084E             
1463   084E             SOM_LOOP_INC:
1464   084E 78              LD  A, B
1465   084F CD 3A 06        CALL GET_NUM_FROM_LOW
1466   0852 32 D7 FF        LD  (USER_DISP7), A
1467   0855 78              LD  A, B
1468   0856 CD 4A 06        CALL GET_NUM_FROM_HIGH
1469   0859 32 D6 FF        LD  (USER_DISP6), A
1470   085C 04              INC B
1471   085D 0E C0           LD  C, $C0
1472   085F ED 41           OUT (C), B
1473   0861 CD AC 07        CALL DELAY_100mS
1474   0864 CD AC 07        CALL DELAY_100mS
1475   0867 C3 4E 08        JP  SOM_LOOP_INC
1476   086A             
1477   086A             
1478   086A             
1479   086A             
1480   086A             
1481   086A             
1482   086A             
1483   086A             
1484   086A             
1485   086A             
1486   1000             .org $1000
1487   1000 CD 1D 06        CALL CLEAR_USER_DISPLAY
1488   1003 3E 00           LD  A, 0                 ; user mode
1489   1005 32 0F FF        LD (SYSMODE), A
1490   1008             
1491   1008 06 08           LD  B, $08
1492   100A 21 D0 FF        LD  HL, USER_DISP0
1493   100D 3E 08           LD  A, 8
1494   100F             
1495   100F             LEDS_LOOP:
1496   100F CD 1D 06        CALL CLEAR_USER_DISPLAY
1497   1012 70              LD  (HL), B
1498   1013 CD AC 07        CALL DELAY_100mS
1499   1016 23              INC HL
1500   1017 3D              DEC A
1501   1018 FE 00           CP 0
1502   101A C2 0F 10        JP NZ, LEDS_LOOP
1503   101D             
1504   101D 3E 08           LD A, 8
1505   101F 21 D7 FF        LD  HL, USER_DISP7
1506   1022 06 40           LD  B, $40
1507   1024             
1508   1024             LEDS_LOOP2:
1509   1024 CD 1D 06        CALL CLEAR_USER_DISPLAY
1510   1027 70              LD  (HL), B
1511   1028 CD AC 07        CALL DELAY_100mS
1512   102B 2B              DEC HL
1513   102C 3D              DEC A
1514   102D FE 00           CP 0
1515   102F C2 24 10        JP NZ, LEDS_LOOP2
1516   1032             
1517   1032 3E 08           LD  A, 8
1518   1034 21 D0 FF        LD  HL, USER_DISP0
1519   1037 06 08           LD  B, $08
1520   1039 C3 0F 10        JP LEDS_LOOP
1521   103C             
1522   103C             
1523   103C             
1524   103C             
1525   103C             
1526   103C             
1527   103C             
1528   103C             
1529   103C             
1530   103C             
1531   4000             .org $4000
1532   4000             
1533   4000                 ; timer count down
1534   4000             
1535   4000 CD 1D 06        CALL CLEAR_USER_DISPLAY
1536   4003 3E 39           LD  A, $39
1537   4005 32 D0 FF        LD  (USER_DISP0), A
1538   4008             
1539   4008 3E 3F           LD  A, $3F
1540   400A 32 D1 FF        LD  (USER_DISP1), A
1541   400D             
1542   400D 3E 1C           LD  A, $1C
1543   400F 32 D2 FF        LD  (USER_DISP2), A
1544   4012             
1545   4012 3E 54           LD  A, $54
1546   4014 32 D3 FF        LD  (USER_DISP3), A
1547   4017             
1548   4017 3E 78           LD  A, $78
1549   4019 32 D4 FF        LD  (USER_DISP4), A
1550   401C             
1551   401C 3E 00           LD  A, $00
1552   401E 32 D5 FF        LD  (USER_DISP5), A
1553   4021             
1554   4021             
1555   4021             
1556   4021 3E 40           LD  A, $40
1557   4023 32 D6 FF        LD  (USER_DISP6), A
1558   4026             
1559   4026 3E 40           LD  A, $40
1560   4028 32 D7 FF        LD  (USER_DISP7), A
1561   402B             
1562   402B 3E 00           LD  A, 0                 ; user mode
1563   402D 32 0F FF        LD (SYSMODE), A
1564   4030             
1565   4030             READ:
1566   4030 CD 49 04        CALL GET_KEY_A
1567   4033 FE FF           CP  $FF
1568   4035 CA 30 40        JP  Z, READ
1569   4038             
1570   4038 CD 49 40        CALL  MODIFY_KEY_POS_1D
1571   403B             
1572   403B             READ2
1573   403B CD 49 04        CALL GET_KEY_A
1574   403E FE FF           CP  $FF
1575   4040 CA 3B 40        JP  Z, READ2
1576   4043             
1577   4043 CD 55 40        CALL MODIFY_KEY_POS_0D
1578   4046             
1579   4046 C3 60 40        JP  LOOP
1580   4049             
1581   4049             
1582   4049             MODIFY_KEY_POS_1D:
1583   4049 21 00 FE        LD  HL, DIEGO
1584   404C 23              INC HL
1585   404D 77              LD  (HL), A
1586   404E CD 3A 06        CALL GET_NUM_FROM_LOW
1587   4051 32 D6 FF        LD  (USER_DISP6), A
1588   4054 C9              RET
1589   4055             
1590   4055             MODIFY_KEY_POS_0D:
1591   4055 21 00 FE        LD  HL, DIEGO
1592   4058 77              LD  (HL), A
1593   4059 CD 3A 06        CALL GET_NUM_FROM_LOW
1594   405C 32 D7 FF        LD  (USER_DISP7), A
1595   405F C9              RET
1596   4060             
1597   4060             LOOP:
1598   4060 2A 00 FE        LD  HL, (DIEGO)
1599   4063             
1600   4063             LOOP_DOWN:
1601   4063 7C              LD  A, H
1602   4064 CD 3A 06        CALL GET_NUM_FROM_LOW
1603   4067 32 D6 FF        LD  (USER_DISP6), A
1604   406A             
1605   406A 7D              LD  A, L
1606   406B CD 3A 06        CALL GET_NUM_FROM_LOW
1607   406E 32 D7 FF        LD  (USER_DISP7), A
1608   4071             
1609   4071 0E 07           LD C, 7    ; 10 x 100ms = 1seg
1610   4073 CD AE 07        CALL DELAY_C
1611   4076             
1612   4076 7D              LD A, L
1613   4077 FE 00           CP 0
1614   4079 CA 81 40        JP Z, DEC_H
1615   407C 3D              DEC A
1616   407D 6F              LD L, A
1617   407E C3 63 40        JP LOOP_DOWN
1618   4081             
1619   4081             DEC_H:
1620   4081 7C              LD  A, H
1621   4082 FE 00           CP 0
1622   4084 CA 8F 40        JP Z, CHECK_L
1623   4087 3D              DEC A
1624   4088 67              LD H, A
1625   4089 3E 09           LD A, 9
1626   408B 6F              LD L, A
1627   408C C3 63 40        JP LOOP_DOWN
1628   408F             
1629   408F             CHECK_L:
1630   408F 7D              LD  A, L
1631   4090 FE 00           CP 0
1632   4092 CA 95 40        JP Z, BEEP
1633   4095             
1634   4095             BEEP:
1635   4095 3E 80           LD  A, $80
1636   4097 D3 C0           OUT  (PortC0), A
1637   4099 CD AC 07        CALL DELAY_100mS
1638   409C             
1639   409C 3E C0           LD  A, $C0
1640   409E D3 C0           OUT  (PortC0), A
1641   40A0 CD AC 07        CALL DELAY_100mS
1642   40A3 C3 95 40        JP BEEP
1643   40A6             
1644   40A6             
1645   40A6             
1646   40A6             
1647   40A6             
1648   40A6             
1649   40A6             .end
1650   40A6             
1651   40A6             ; =========================================================
1652   40A6             ; Tabela display
1653   40A6             ; =========================================================
1654   40A6             ; 
1655   40A6             ;   0 - $3F
1656   40A6             ;   1 - $06
1657   40A6             ;   2 - $5B
1658   40A6             ;   3 - $4F
1659   40A6             ;   4 - $66
1660   40A6             ;   5 - $6D
1661   40A6             ;   6 - $7D
1662   40A6             ;   7 - $07
1663   40A6             ;   8 - $7F
1664   40A6             ;   9 - $67
1665   40A6             ; 
1666   40A6             ;   A - $77
1667   40A6             ;   B - $7C
1668   40A6             ;   C - $39
1669   40A6             ;   D - $5E
1670   40A6             ;   E - $79
1671   40A6             ;   F - $71
1672   40A6             ;   G - $6F
1673   40A6             ;   H - $76
1674   40A6             ;   I - $06
1675   40A6             ;   J - $1E
1676   40A6             ;   K - $7A
1677   40A6             ;   L - $38
1678   40A6             ;   M - $37
1679   40A6             ;   N - $54
1680   40A6             ;   O - $3F
1681   40A6             ;   P - $73
1682   40A6             ;   Q - $67
1683   40A6             ;   R - $50
1684   40A6             ;   S - $6D
1685   40A6             ;   T - $78
1686   40A6             ;   U - $1C
1687   40A6             ;   V - $3E
1688   40A6             ;   W - $1D
1689   40A6             ;   X - $70
1690   40A6             ;   Y - $6E
1691   40A6             ;   Z - $49
1692   40A6             
1693   40A6             ;   + - $46
1694   40A6             ;   , - $04
1695   40A6             ;   - - $40
1696   40A6             ;   . - $80
1697   40A6             ;   Ñ - $55
1698   40A6             ;   : - $41
1699   40A6             ;   ; - $88
1700   40A6             ;   _ - $08
1701   40A6             ;   ~ - $01
tasm: Number of errors = 0
