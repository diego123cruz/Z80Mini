0001   0000             ; ---------------------------------------------------------
0002   0000             ;   Z80 Mini  -  inicio 01/2022
0003   0000             ;   Diego Cruz - github.com/diego123cruz
0004   0000             ;
0005   0000             ;   Hardware baseado em: http://www.sunrise-ev.com/z80.htm
0006   0000             ;   Software próprio - em construção
0007   0000             ; ---------------------------------------------------------
0008   0000             ;   Z80@4Mhz
0009   0000             ;   ROM 32k - 28C256
0010   0000             ;   RAM 32k - 65256
0011   0000             ;   Display 7 segmentos 8 digitos
0012   0000             ;   Teclado 16 teclas + Fn (Tecla de função? ou outra coisa?)
0013   0000             ;   Entrada 40h
0014   0000             ;   Saida 40h
0015   0000             ;
0016   0000             ;
0017   0000             ; ---------------------------------------------------------
0018   0000             ;   Display 7 Segmentos - In(Port40) AND 00000111b
0019   0000             ; ---------------------------------------------------------
0020   0000             ;
0021   0000             ;   ------------------------------------------------
0022   0000             ;   | 00h | 01h | 02h | 03h | 04h | 05h | 06h | 07h |
0023   0000             ;   ------------------------------------------------
0024   0000             ;
0025   0000             ;               A(0)
0026   0000             ;            ---------
0027   0000             ;           |         |
0028   0000             ;      F(5) |         | B(1)
0029   0000             ;           |   G(6)  |
0030   0000             ;            ---------
0031   0000             ;           |         |
0032   0000             ;      E(4) |         | C(2)
0033   0000             ;           |         |
0034   0000             ;            ---------         Ponto(7)
0035   0000             ;               D(3) 
0036   0000             ;
0037   0000             ;
0038   0000             ;
0039   0000             ;
0040   0000             ;
0041   0000             ; ---------------------------------------------------------
0042   0000             ; Teclado 
0043   0000             ; ---------------------------------------------------------
0044   0000             ;   
0045   0000             ;   Keys:        
0046   0000             ;       Fn - In(Port40) AND 00010000b - pulldown
0047   0000             ;       0 - In(Port40) AND 00000111b
0048   0000             ;
0049   0000             ;
0050   0000             ;
0051   0000             ;
0052   0000             
0053   0000             
0054   0000             ; ---------------------------------------------------------
0055   0000             ; Constantes
0056   0000             ; ---------------------------------------------------------
0057   0000             
0058   0000             Port40        .equ    $40
0059   0000             PortC0        .equ    $C0
0060   0000             START_RAM     .equ    $8000
0061   0000             STACK         .equ    $FF00  
0062   0000             CKEY_TIMEOUT  .equ    100  ; 100ms +-
0063   0000             
0064   0000             ; ---------------------------------------------------------
0065   0000             ; RAM MAP - Monitor | $FF00 - $FFFF
0066   0000             ; ---------------------------------------------------------
0067   0000             ; Cada digito fica em um ponto da memoria RAM
0068   0000             DIG_0       .equ    $FF00   ;(1) endereço do digito 0 na memoria RAM
0069   0000             DIG_1       .equ    $FF01   ;(1) endereço do digito 1 na memoria RAM
0070   0000             DIG_2       .equ    $FF02   ;(1) endereço do digito 2 na memoria RAM
0071   0000             DIG_3       .equ    $FF03   ;(1) endereço do digito 3 na memoria RAM
0072   0000             DIG_4       .equ    $FF04   ;(1) endereço do digito 4 na memoria RAM
0073   0000             DIG_5       .equ    $FF05   ;(1) endereço do digito 5 na memoria RAM
0074   0000             DIG_6       .equ    $FF06   ;(1) endereço do digito 6 na memoria RAM
0075   0000             DIG_7       .equ    $FF07   ;(1) endereço do digito 7 na memoria RAM
0076   0000             KEY_PRESS   .equ    $FF08   ;(1) key atual
0077   0000             INPUT       .equ    $FF09   ;(1) temp input from int
0078   0000             TMP_KEY     .equ    $FF0A   ;(1) tmp key
0079   0000             KEY_TIMEOUT .equ    $FF0B   ;(1) tempo para retornar a tecla, CKEY_TIMEOUT
0080   0000             SHOW_DIG    .equ    $FF0C   ;(1) Atual digito no display
0081   0000             PC_RAM      .equ    $FF0D   ;(2) save pc to user start $8000
0082   0000             
0083   0000             SYSMODE     .equ    $FF0F   ;(1) System mode. 
0084   0000                                         ; 0 - User Mode
0085   0000                                         ; 1 - Monitor
0086   0000                                         ; 2 - Examine Memoria
0087   0000                                         ; 3 - Change Data(Memory)
0088   0000                                         ; 4 - Show register PC
0089   0000                                         ; 5 - Show register SP
0090   0000                                         ; 6 - Show register AF
0091   0000                                         ; 7 - Show register BC
0092   0000                                         ; 8 - Show register DE
0093   0000                                         ; 9 - Show register HL
0094   0000                                         ; A - Show register IX
0095   0000                                         ; B - Show register IY
0096   0000                                         ; C - Show register AF'
0097   0000                                         ; D - Show register BC'
0098   0000                                         ; E - Show register DE'
0099   0000                                         ; F - Show register HL'
0100   0000                                         ; 76 - HALT
0101   0000             TicCounter  .equ    $FF10   ;(2) TicCounter inc 1ms
0102   0000             EXM_COUNT   .equ    $FF12   ;(1) Count digits Examine function, 4 digits
0103   0000             MDF_COUNT   .equ    $FF13   ;(1) Count digits moDify function, 2 digits
0104   0000             USR_PC      .equ    $FF14   ;(2) PC 
0105   0000             USR_SP      .equ    $FF16   ;(2) SP
0106   0000             USR_HL      .equ    $FF18   ;(2) HL
0107   0000             USR_BC      .equ    $FF1A   ;(2) BC
0108   0000             USR_DE      .equ    $FF1C   ;(2) DE
0109   0000             USR_AF      .equ    $FF1E   ;(2) AF
0110   0000             USR_IX      .equ    $FF20   ;(2) IX
0111   0000             USR_IY      .equ    $FF22   ;(2) IY
0112   0000             USR_AFA     .equ    $FF24   ;(2) AF' (Aux)
0113   0000             USR_BCA     .equ    $FF26   ;(2) BC' (Aux)
0114   0000             USR_DEA     .equ    $FF28   ;(2) DE' (Aux)
0115   0000             USR_HLA     .equ    $FF2A   ;(2) HL' (Aux)
0116   0000             ; SP Temp   .equ    $FF2C
0117   0000             CPU_FLAGS   .equ    $FF2C   ;(1) Flags atual (AF ou AF') SYSMODE
0118   0000             INT_VEC     .equ    $FF2D   ;(2) vector int38
0119   0000             
0120   0000             
0121   0000             
0122   0000             ; Copy USER_DISPx to DIG_x WHEN USER_MODE
0123   0000             USER_DISP0  .equ    $FFD0   ; Mode User - Display Dig 0  - 01234567
0124   0000             USER_DISP1  .equ    $FFD1   ; Mode User - Display Dig 1  - 01234567
0125   0000             USER_DISP2  .equ    $FFD2   ; Mode User - Display Dig 2  - 01234567
0126   0000             USER_DISP3  .equ    $FFD3   ; Mode User - Display Dig 3  - 01234567
0127   0000             USER_DISP4  .equ    $FFD4   ; Mode User - Display Dig 4  - 01234567
0128   0000             USER_DISP5  .equ    $FFD5   ; Mode User - Display Dig 5  - 01234567
0129   0000             USER_DISP6  .equ    $FFD6   ; Mode User - Display Dig 6  - 01234567
0130   0000             USER_DISP7  .equ    $FFD7   ; Mode User - Display Dig 7  - 01234567
0131   0000             
0132   0000             
0133   0000             
0134   0000             ; =========================================================
0135   0000             ; Start ROM
0136   0000             ; =========================================================
0137   0000             .org    $0000
0138   0000 21 53 00        LD  HL, INT38
0139   0003 22 2D FF        LD  (INT_VEC), HL
0140   0006 C3 5F 0A        JP  START
0141   0009             
0142   0009             ; =========================================================
0143   0009             ; Livre para colocar funções 0003h - 0037h 
0144   0009             ; =========================================================
0145   0009             
0146   0009             ; DELAY_100mS
0147   0009             
0148   0009             ; char7segFromA
0149   0009             
0150   0009             ; animacaoLeds
0151   0009             
0152   0009             ; Limpar RAM (FF).... etc
0153   0009             
0154   0009             
0155   0009             ; =========================================================
0156   0009             ; Int 38h - Monitor 
0157   0009             ; =========================================================
0158   0038             .org    $38
0159   0038 F3              DI
0160   0039 22 18 FF        LD (USR_HL), HL          ; Save HL
0161   003C 2A 2D FF        LD HL, (INT_VEC)
0162   003F E9              JP (HL)
0163   0040             
0164   0040             
0165   0040             INT_HALT:
0166   0040 F3              DI
0167   0041 F5              PUSH AF
0168   0042 E5              PUSH HL
0169   0043             
0170   0043 21 53 00        LD  HL, INT38
0171   0046 22 2D FF        LD  (INT_VEC), HL
0172   0049             
0173   0049 3E 76           LD A, $76
0174   004B 32 0F FF        LD (SYSMODE), A
0175   004E             
0176   004E E1              POP HL
0177   004F F1              POP AF
0178   0050                 
0179   0050 C3 9E 0A        JP START_WARM
0180   0053             
0181   0053             
0182   0053             INT38:
0183   0053 ED 73 16 FF     LD (USR_SP), SP          ; Save SP
0184   0057                 ;LD (USR_HL), HL          ; Save HL
0185   0057 E1              POP  HL                  ; Recupera PC da stack
0186   0058 22 14 FF        LD (USR_PC), HL          ; Save PC
0187   005B E5              PUSH HL                  ;
0188   005C 21 2C FF        LD HL, $FF2C             ; Carrega Temp SP to HL
0189   005F F9              LD SP, HL                ; Set temp HL
0190   0060 D9              EXX                      ; Inverte HL e HL', DE.... BC....
0191   0061 E5              PUSH  HL                 ; Save HL'
0192   0062 D5              PUSH  DE                 ; Save DE'                
0193   0063 C5              PUSH  BC                 ; Save BC'
0194   0064 08              EX    AF, AF'
0195   0065 F5              PUSH  AF                 ; Save AF'
0196   0066 08              EX    AF, AF'
0197   0067 D9              EXX                      ; Troca HL' e HL,, DE... BC...
0198   0068 FD E5           PUSH  IY                 ; Save IY
0199   006A DD E5           PUSH  IX                 ; Save IX
0200   006C F5              PUSH  AF                 ; Save AF
0201   006D D5              PUSH  DE                 ; Save DE
0202   006E C5              PUSH  BC                 ; Save BC
0203   006F 2A 16 FF        LD HL, (USR_SP)          ; Recupera SP
0204   0072 F9              LD SP, HL                ; Devolve SP original
0205   0073             
0206   0073                 ; check HALT
0207   0073 2A 16 FF        LD HL, (USR_SP)
0208   0076 CD A6 0A        CALL LD_HL_HL
0209   0079 2B              DEC HL
0210   007A 7E              LD  A, (HL)
0211   007B FE 76           CP  $76    ; halt code
0212   007D CA 83 00        JP  Z, C_HALT
0213   0080 C3 B7 00        jp SKIP_CHK
0214   0083             
0215   0083             C_HALT:
0216   0083 21 40 00        LD HL, INT_HALT
0217   0086 22 2D FF        LD (INT_VEC), HL
0218   0089             
0219   0089 3E 76           LD A, $76
0220   008B 32 0F FF        LD  (SYSMODE), A
0221   008E             
0222   008E E1              POP HL                   ; Troca o PC
0223   008F 2A 14 FF        LD HL, (USR_PC)          ; Recupera PC
0224   0092 E5              PUSH HL                  ; Devolve PC to stack
0225   0093             
0226   0093 2A 24 FF        LD HL, (USR_AFA)          ; Load AF' in HL
0227   0096 E5              PUSH  HL                 ; Push AF'
0228   0097 F1              POP AF                   ; Recovery AF'
0229   0098 08              EX AF, AF'
0230   0099             
0231   0099 2A 2A FF        LD HL, (USR_HLA)          ; Recovery HL'
0232   009C ED 5B 28 FF     LD DE, (USR_DEA)          ; Recovery DE'
0233   00A0 ED 4B 26 FF     LD BC, (USR_BCA)          ; Recovery BC'
0234   00A4 D9              EXX
0235   00A5             
0236   00A5 2A 1E FF        LD HL, (USR_AF)          ; Load AF in HL
0237   00A8 E5              PUSH  HL                 ; Push AF
0238   00A9 F1              POP AF                   ; Recovery AF
0239   00AA             
0240   00AA 2A 18 FF        LD HL, (USR_HL)          ; Recovery HL
0241   00AD ED 5B 1C FF     LD DE, (USR_DE)          ; Recovery DE
0242   00B1 ED 4B 1A FF     LD BC, (USR_BC)          ; Recovery BC
0243   00B5             
0244   00B5 FB              EI
0245   00B6 76              HALT                     ; aguarda proxima int
0246   00B7             
0247   00B7             SKIP_CHK:
0248   00B7                 ; TicCounter
0249   00B7 2A 10 FF        LD  HL, (TicCounter)     ; Increment 1ms, used to DELAY_A
0250   00BA 23              INC  HL
0251   00BB 22 10 FF        LD  (TicCounter), HL
0252   00BE             
0253   00BE                 ; Timeout Key
0254   00BE 3A 0B FF         LD A, (KEY_TIMEOUT)
0255   00C1 FE 00            CP 0
0256   00C3 CA CA 00         JP Z, ENTER_MAIN
0257   00C6 3D               DEC A
0258   00C7 32 0B FF         LD (KEY_TIMEOUT), A
0259   00CA             
0260   00CA                 ; Main
0261   00CA             ENTER_MAIN:
0262   00CA CD 05 01        CALL UPDATE_DISPLAYS
0263   00CD CD 21 01        CALL UPDATE_KEYS
0264   00D0 CD 70 01        CALL UPDATE_FLAGS
0265   00D3             
0266   00D3                 ; Show atual digit
0267   00D3 3A 0C FF        LD  A, (SHOW_DIG)
0268   00D6 D3 40           OUT (Port40), A
0269   00D8             
0270   00D8                 ;CALL    TRATAMENTO_INT38H; Get key, update display   
0271   00D8 C3 20 02        JP      SYS_MAIN         ; Execute function monitor
0272   00DB             
0273   00DB             EXIT_SYS:
0274   00DB E1              POP HL                   ; Troca o PC
0275   00DC 2A 14 FF        LD HL, (USR_PC)          ; Recupera PC
0276   00DF E5              PUSH HL                  ; Devolve PC to stack
0277   00E0             
0278   00E0 2A 24 FF        LD HL, (USR_AFA)          ; Load AF' in HL
0279   00E3 E5              PUSH  HL                 ; Push AF'
0280   00E4 F1              POP AF                   ; Recovery AF'
0281   00E5 08              EX AF, AF'
0282   00E6             
0283   00E6 2A 2A FF        LD HL, (USR_HLA)          ; Recovery HL'
0284   00E9 ED 5B 28 FF     LD DE, (USR_DEA)          ; Recovery DE'
0285   00ED ED 4B 26 FF     LD BC, (USR_BCA)          ; Recovery BC'
0286   00F1 D9              EXX
0287   00F2             
0288   00F2 2A 1E FF        LD HL, (USR_AF)          ; Load AF in HL
0289   00F5 E5              PUSH  HL                 ; Push AF
0290   00F6 F1              POP AF                   ; Recovery AF
0291   00F7             
0292   00F7 2A 18 FF        LD HL, (USR_HL)          ; Recovery HL
0293   00FA ED 5B 1C FF     LD DE, (USR_DE)          ; Recovery DE
0294   00FE ED 4B 1A FF     LD BC, (USR_BC)          ; Recovery BC
0295   0102             
0296   0102 FB              EI                       ; Enable interrupt
0297   0103 ED 4D           RETI                     ; Return interrupt
0298   0105             
0299   0105             
0300   0105             ; =========================================================
0301   0105             ; Update display - Tratamento Int 38h
0302   0105             ; =========================================================
0303   0105             UPDATE_DISPLAYS:    
0304   0105 DB 40           IN    A, (Port40)
0305   0107 32 09 FF        LD    (INPUT), A
0306   010A E6 07           AND   $07
0307   010C FE 08           CP    $08
0308   010E D2 20 01        JP    NC, UPDATE_DISPLAYS_RET ; IF A > 7 RET
0309   0111 3C              INC   A
0310   0112 FE 08           CP    $08
0311   0114 C2 19 01        JP    NZ, UPDATE_DISPLAYS_OK
0312   0117 3E 00           LD    A, $00
0313   0119             UPDATE_DISPLAYS_OK:
0314   0119 26 FF           LD    H, $FF
0315   011B 6F              LD    L, A
0316   011C 7E              LD    A, (HL)
0317   011D 32 0C FF        LD   (SHOW_DIG), A
0318   0120             UPDATE_DISPLAYS_RET:
0319   0120 C9              RET
0320   0121             
0321   0121             ; =========================================================
0322   0121             ; Update KEY - Tratamento Int 38h
0323   0121             ; =========================================================
0324   0121             UPDATE_KEYS:    
0325   0121 DB 40           IN    A, (Port40)
0326   0123 32 09 FF        LD    (INPUT), A
0327   0126 E6 07           AND   $07
0328   0128 FE 08           CP    $08
0329   012A D2 53 01        JP    NC, UPDATE_KEY_RET ; IF A > 7 RET
0330   012D 3A 09 FF        LD  A,  (INPUT)
0331   0130 CB 5F           BIT  3, A
0332   0132 CA 54 01        JP  Z, TRATAB3
0333   0135 3A 09 FF        LD  A,  (INPUT)
0334   0138 CB 67           BIT  4, A
0335   013A CA 5A 01        JP  Z, TRATAB4
0336   013D C3 53 01        JP  UPDATE_KEY_RET
0337   0140             UPDATE_KEY_GET:
0338   0140 32 09 FF        LD    (INPUT), A
0339   0143 E6 07           AND   $07
0340   0145 01 00 00        LD    BC, 0
0341   0148 4F              LD    C, A
0342   0149 09              ADD   HL, BC
0343   014A 7E              LD    A, (HL)
0344   014B 32 08 FF        LD   (KEY_PRESS), A
0345   014E 3E 64           LD A, CKEY_TIMEOUT
0346   0150 32 0B FF        LD (KEY_TIMEOUT), A
0347   0153             UPDATE_KEY_RET:
0348   0153 C9              RET
0349   0154             
0350   0154             TRATAB3:
0351   0154 21 60 01        LD    HL, KEYSB3
0352   0157 C3 40 01        JP  UPDATE_KEY_GET
0353   015A             
0354   015A             TRATAB4:
0355   015A 21 68 01        LD    HL, KEYSB4
0356   015D C3 40 01        JP  UPDATE_KEY_GET
0357   0160             
0358   0160 000104070F02KEYSB3 .db $00, $01, $04, $07, $0F, $02, $05, $08
0358   0166 0508
0359   0168 0E0306090D0CKEYSB4 .db $0E, $03, $06, $09, $0D, $0C, $0B, $0A
0359   016E 0B0A
0360   0170             
0361   0170             
0362   0170             ; =========================================================
0363   0170             ; Update Flags - Tratamento Int 38h
0364   0170             ; =========================================================
0365   0170             UPDATE_FLAGS:
0366   0170 3A 0F FF        LD    A, (SYSMODE)
0367   0173 FE 06           CP    $06
0368   0175 CA 7E 01        JP    Z, UPDATE_FLAGS_MAIN
0369   0178 FE 0C           CP    $0C
0370   017A CA 7E 01        JP    Z, UPDATE_FLAGS_MAIN
0371   017D             UPDATE_FLAGS_RET:
0372   017D C9              RET
0373   017E             
0374   017E             UPDATE_FLAGS_MAIN:
0375   017E 3A 09 FF        LD    A, (INPUT)
0376   0181 E6 07           AND   $07
0377   0183             
0378   0183 FE 07           CP    $07
0379   0185 CA AE 01        JP    Z, UPDATE_FLAG_S
0380   0188 FE 00           CP    $00
0381   018A CA BA 01        JP    Z, UPDATE_FLAG_Z
0382   018D FE 01           CP    $01
0383   018F CA C6 01        JP    Z, UPDATE_FLAG_X1
0384   0192 FE 02           CP    $02
0385   0194 CA D2 01        JP    Z, UPDATE_FLAG_H
0386   0197 FE 03           CP    $03
0387   0199 CA DE 01        JP    Z, UPDATE_FLAG_X2
0388   019C FE 04           CP    $04
0389   019E CA EA 01        JP    Z, UPDATE_FLAG_PV
0390   01A1 FE 05           CP    $05
0391   01A3 CA F6 01        JP    Z, UPDATE_FLAG_N
0392   01A6 FE 06           CP    $06
0393   01A8 CA 02 02        JP    Z, UPDATE_FLAG_C
0394   01AB C3 7D 01        JP    UPDATE_FLAGS_RET
0395   01AE             
0396   01AE             UPDATE_FLAG_S:
0397   01AE CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0398   01B1 3A 2C FF        LD  A, (CPU_FLAGS)
0399   01B4 CB 7F           BIT 7, A
0400   01B6 CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0401   01B9 C9              RET
0402   01BA             
0403   01BA             UPDATE_FLAG_Z:
0404   01BA CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0405   01BD 3A 2C FF        LD  A, (CPU_FLAGS)
0406   01C0 CB 77           BIT 6, A
0407   01C2 CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0408   01C5 C9              RET
0409   01C6             
0410   01C6             UPDATE_FLAG_X1:
0411   01C6 CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0412   01C9 3A 2C FF        LD  A, (CPU_FLAGS)
0413   01CC CB 6F           BIT 5, A
0414   01CE CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0415   01D1 C9              RET
0416   01D2             
0417   01D2             UPDATE_FLAG_H:
0418   01D2 CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0419   01D5 3A 2C FF        LD  A, (CPU_FLAGS)
0420   01D8 CB 67           BIT 4, A
0421   01DA CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0422   01DD C9              RET
0423   01DE             
0424   01DE             UPDATE_FLAG_X2:
0425   01DE CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0426   01E1 3A 2C FF        LD  A, (CPU_FLAGS)
0427   01E4 CB 5F           BIT 3, A
0428   01E6 CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0429   01E9 C9              RET
0430   01EA             
0431   01EA             UPDATE_FLAG_PV:
0432   01EA CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0433   01ED 3A 2C FF        LD  A, (CPU_FLAGS)
0434   01F0 CB 57           BIT 2, A
0435   01F2 CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0436   01F5 C9              RET
0437   01F6             
0438   01F6             UPDATE_FLAG_N:
0439   01F6 CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0440   01F9 3A 2C FF        LD  A, (CPU_FLAGS)
0441   01FC CB 4F           BIT 1, A
0442   01FE CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0443   0201 C9              RET
0444   0202             
0445   0202             UPDATE_FLAG_C:
0446   0202 CD 0E 02        CALL  SHOW_DIG_FLAG_ON
0447   0205 3A 2C FF        LD  A, (CPU_FLAGS)
0448   0208 CB 47           BIT 0, A
0449   020A CC 17 02        CALL Z, SHOW_DIG_FLAG_OFF
0450   020D C9              RET
0451   020E             
0452   020E             SHOW_DIG_FLAG_ON:
0453   020E 3A 0C FF        LD  A, (SHOW_DIG)
0454   0211 F6 80           OR  $80
0455   0213 32 0C FF        LD  (SHOW_DIG), A
0456   0216 C9              RET
0457   0217             
0458   0217             SHOW_DIG_FLAG_OFF:
0459   0217 3A 0C FF        LD  A, (SHOW_DIG)
0460   021A E6 7F           AND  $7F
0461   021C 32 0C FF        LD  (SHOW_DIG), A 
0462   021F C9              RET
0463   0220             
0464   0220             ; =========================================================
0465   0220             ; SYS MAIN
0466   0220             ; =========================================================
0467   0220             SYS_MAIN:
0468   0220 3A 0F FF        LD  A, (SYSMODE)
0469   0223 FE 00           CP  $00                  ; User mode can back to monitor
0470   0225 CA 7A 07        JP  Z, USER_MODE        
0471   0228             
0472   0228 3A 0F FF        LD  A, (SYSMODE)
0473   022B FE 01           CP  $01                  ; monitor
0474   022D CA 90 07        JP  Z, MONITOR_MODE
0475   0230             
0476   0230 3A 0F FF        LD  A,  (SYSMODE)
0477   0233 FE 02           CP  $02                  ; Examine RAM
0478   0235 CA AB 02        JP  Z, EXAMINE_RAM
0479   0238             
0480   0238 3A 0F FF        LD  A, (SYSMODE)
0481   023B FE 03           CP  $03                  ; Modify Data (Memory)
0482   023D CA 44 03        JP  Z,  MODIFY_RAM
0483   0240             
0484   0240 3A 0F FF        LD  A, (SYSMODE)
0485   0243 FE 04           CP  $04                  ; Show register PC
0486   0245 CA 93 03        JP  Z,  SHOW_REG_PC
0487   0248             
0488   0248 3A 0F FF        LD  A, (SYSMODE)
0489   024B FE 05           CP  $05                  ; Show register SP
0490   024D CA DB 03        JP  Z,  SHOW_REG_SP
0491   0250             
0492   0250 3A 0F FF        LD  A, (SYSMODE)
0493   0253 FE 06           CP  $06                  ; Show register AF
0494   0255 CA 26 04        JP  Z,  SHOW_REG_AF
0495   0258             
0496   0258 3A 0F FF        LD  A, (SYSMODE)
0497   025B FE 07           CP  $07                  ; Show register BC
0498   025D CA 75 04        JP  Z,  SHOW_REG_BC
0499   0260             
0500   0260 3A 0F FF        LD  A, (SYSMODE)
0501   0263 FE 08           CP  $08                  ; Show register DE
0502   0265 CA C0 04        JP  Z,  SHOW_REG_DE
0503   0268             
0504   0268 3A 0F FF        LD  A, (SYSMODE)
0505   026B FE 09           CP  $09                  ; Show register HL
0506   026D CA 0B 05        JP  Z,  SHOW_REG_HL
0507   0270             
0508   0270 3A 0F FF        LD  A, (SYSMODE)
0509   0273 FE 0A           CP  $0A                  ; Show register IX
0510   0275 CA 56 05        JP  Z,  SHOW_REG_IX
0511   0278             
0512   0278 3A 0F FF        LD  A, (SYSMODE)
0513   027B FE 0B           CP  $0B                  ; Show register IY
0514   027D CA A1 05        JP  Z,  SHOW_REG_IY
0515   0280             
0516   0280 3A 0F FF        LD  A, (SYSMODE)
0517   0283 FE 0C           CP  $0C                  ; Show register AF'
0518   0285 CA EC 05        JP  Z,  SHOW_REG_AFaux
0519   0288             
0520   0288 3A 0F FF        LD  A, (SYSMODE)
0521   028B FE 0D           CP  $0D                  ; Show register BC'
0522   028D CA 40 06        JP  Z,  SHOW_REG_BCaux
0523   0290             
0524   0290 3A 0F FF        LD  A, (SYSMODE)
0525   0293 FE 0E           CP  $0E                  ; Show register DE'
0526   0295 CA 90 06        JP  Z,  SHOW_REG_DEaux
0527   0298             
0528   0298 3A 0F FF        LD  A, (SYSMODE)
0529   029B FE 0F           CP  $0F                  ; Show register HL'
0530   029D CA E0 06        JP  Z,  SHOW_REG_HLaux
0531   02A0             
0532   02A0             
0533   02A0 3A 0F FF        LD  A, (SYSMODE)
0534   02A3 FE 76           CP  $76
0535   02A5 CA 30 07        JP  Z, SHOW_HALT
0536   02A8             
0537   02A8 C3 DB 00        JP  EXIT_SYS
0538   02AB             
0539   02AB             
0540   02AB             ; =========================================================
0541   02AB             ; Examine RAM Mode
0542   02AB             ; =========================================================
0543   02AB             EXAMINE_RAM:
0544   02AB CD 5F 07        CALL GET_KEY_A
0545   02AE FE FF           CP  $FF
0546   02B0 CA DB 00        JP  Z, EXIT_SYS
0547   02B3             
0548   02B3 F5              PUSH  AF
0549   02B4 F5              PUSH  AF
0550   02B5 3A 12 FF        LD  A, (EXM_COUNT)
0551   02B8 FE 03           CP  3
0552   02BA CA D8 02        JP  Z, EXAMINE_KEY_POS_3
0553   02BD             
0554   02BD 3A 12 FF        LD  A, (EXM_COUNT)
0555   02C0 FE 02           CP  2
0556   02C2 CA F6 02        JP  Z, EXAMINE_KEY_POS_2
0557   02C5             
0558   02C5 3A 12 FF        LD  A, (EXM_COUNT)
0559   02C8 FE 01           CP  1
0560   02CA CA 10 03        JP  Z, EXAMINE_KEY_POS_1
0561   02CD             
0562   02CD 3A 12 FF        LD  A, (EXM_COUNT)
0563   02D0 FE 00           CP  0
0564   02D2 CA 31 03        JP  Z, EXAMINE_KEY_POS_0
0565   02D5             
0566   02D5 C3 DB 00        JP  EXIT_SYS
0567   02D8             
0568   02D8             EXAMINE_KEY_POS_3:
0569   02D8 F1              POP  AF
0570   02D9 CB 07           RLC  A
0571   02DB CB 07           RLC  A
0572   02DD CB 07           RLC  A
0573   02DF CB 07           RLC  A
0574   02E1 67              LD  H, A
0575   02E2 22 0D FF        LD  (PC_RAM), HL
0576   02E5 F1              POP  AF
0577   02E6 CD 50 09        CALL GET_NUM_FROM_LOW
0578   02E9 32 00 FF        LD  (DIG_0), A
0579   02EC 3A 12 FF        LD  A, (EXM_COUNT)
0580   02EF 3D              DEC A
0581   02F0 32 12 FF        LD  (EXM_COUNT), A
0582   02F3 C3 DB 00        JP  EXIT_SYS
0583   02F6             
0584   02F6             
0585   02F6             EXAMINE_KEY_POS_2:
0586   02F6 F1              POP  AF
0587   02F7 2A 0D FF        LD  HL, (PC_RAM)
0588   02FA B4              OR  H
0589   02FB 67              LD  H, A
0590   02FC 22 0D FF        LD  (PC_RAM), HL
0591   02FF F1              POP  AF
0592   0300 CD 50 09        CALL GET_NUM_FROM_LOW
0593   0303 32 01 FF        LD  (DIG_1), A
0594   0306 3A 12 FF        LD  A, (EXM_COUNT)
0595   0309 3D              DEC A
0596   030A 32 12 FF        LD  (EXM_COUNT), A
0597   030D C3 DB 00        JP  EXIT_SYS
0598   0310             
0599   0310             EXAMINE_KEY_POS_1:
0600   0310 F1              POP  AF
0601   0311 2A 0D FF        LD  HL, (PC_RAM)
0602   0314 CB 07           RLC  A
0603   0316 CB 07           RLC  A
0604   0318 CB 07           RLC  A
0605   031A CB 07           RLC  A
0606   031C 6F              LD  L, A
0607   031D 22 0D FF        LD  (PC_RAM), HL
0608   0320 F1              POP  AF
0609   0321 CD 50 09        CALL GET_NUM_FROM_LOW
0610   0324 32 02 FF        LD  (DIG_2), A
0611   0327 3A 12 FF        LD  A, (EXM_COUNT)
0612   032A 3D              DEC A
0613   032B 32 12 FF        LD  (EXM_COUNT), A
0614   032E C3 DB 00        JP  EXIT_SYS
0615   0331             
0616   0331             
0617   0331             EXAMINE_KEY_POS_0:
0618   0331 F1              POP  AF
0619   0332 2A 0D FF        LD  HL, (PC_RAM)
0620   0335 B5              OR  L
0621   0336 6F              LD  L, A
0622   0337 22 0D FF        LD  (PC_RAM), HL
0623   033A F1              POP  AF
0624   033B CD 50 09        CALL GET_NUM_FROM_LOW
0625   033E 32 03 FF        LD  (DIG_3), A
0626   0341 C3 71 08        JP  GO_MONITOR
0627   0344             
0628   0344             ; =========================================================
0629   0344             ; MODIFY RAM Mode
0630   0344             ; =========================================================
0631   0344             MODIFY_RAM:
0632   0344             
0633   0344 CD 5F 07        CALL GET_KEY_A
0634   0347 FE FF           CP  $FF
0635   0349 CA DB 00        JP  Z, EXIT_SYS
0636   034C             
0637   034C F5              PUSH  AF
0638   034D F5              PUSH  AF
0639   034E 3A 13 FF        LD  A, (MDF_COUNT)
0640   0351 FE 01           CP  1
0641   0353 CA 61 03        JP  Z, MODIFY_KEY_POS_1
0642   0356             
0643   0356 3A 13 FF        LD  A, (MDF_COUNT)
0644   0359 FE 00           CP  0
0645   035B CA 7F 03        JP  Z, MODIFY_KEY_POS_0
0646   035E             
0647   035E C3 DB 00        JP  EXIT_SYS
0648   0361             
0649   0361             MODIFY_KEY_POS_1:
0650   0361 F1              POP  AF
0651   0362 CB 07           RLC  A
0652   0364 CB 07           RLC  A
0653   0366 CB 07           RLC  A
0654   0368 CB 07           RLC  A
0655   036A 2A 0D FF        LD  HL, (PC_RAM)
0656   036D 77              LD  (HL), A
0657   036E             
0658   036E F1              POP  AF
0659   036F CD 50 09        CALL GET_NUM_FROM_LOW
0660   0372 32 06 FF        LD  (DIG_6), A
0661   0375 3A 13 FF        LD  A, (MDF_COUNT)
0662   0378 3D              DEC A
0663   0379 32 13 FF        LD  (MDF_COUNT), A
0664   037C C3 DB 00        JP  EXIT_SYS
0665   037F             
0666   037F             MODIFY_KEY_POS_0:
0667   037F F1              POP  AF
0668   0380 2A 0D FF        LD  HL, (PC_RAM)
0669   0383 46              LD  B, (HL)
0670   0384 B0              OR  B
0671   0385 2A 0D FF        LD  HL, (PC_RAM)
0672   0388 77              LD  (HL), A
0673   0389             
0674   0389 F1              POP  AF
0675   038A CD 50 09        CALL GET_NUM_FROM_LOW
0676   038D 32 07 FF        LD  (DIG_7), A
0677   0390 C3 71 08        JP  GO_MONITOR
0678   0393                 
0679   0393             
0680   0393             SHOW_REG_PC:
0681   0393 CD 5F 07        CALL  GET_KEY_A
0682   0396 FE 00           CP  $00
0683   0398 CA 71 08        JP Z, GO_MONITOR
0684   039B FE 01           CP  $01
0685   039D CA 7C 08        JP Z, GO_SHOW_REG_PC
0686   03A0 FE 02           CP  $02
0687   03A2 CA 87 08        JP Z, GO_SHOW_REG_SP
0688   03A5 FE 03           CP  $03
0689   03A7 CA 92 08        JP Z, GO_SHOW_REG_AF
0690   03AA FE 04           CP  $04
0691   03AC CA 9D 08        JP Z, GO_SHOW_REG_BC
0692   03AF FE 05           CP  $05
0693   03B1 CA A8 08        JP Z, GO_SHOW_REG_DE
0694   03B4 FE 06           CP  $06
0695   03B6 CA B3 08        JP Z, GO_SHOW_REG_HL
0696   03B9 FE 07           CP  $07
0697   03BB CA BE 08        JP Z, GO_SHOW_REG_IX
0698   03BE FE 08           CP  $08
0699   03C0 CA C9 08        JP Z, GO_SHOW_REG_IY
0700   03C3             
0701   03C3 3E 50           LD  A, $50               ; R
0702   03C5 32 00 FF        LD  (DIG_0), A
0703   03C8             
0704   03C8 3E 73           LD  A, $73               ; P
0705   03CA 32 01 FF        LD  (DIG_1), A
0706   03CD             
0707   03CD 3E 39           LD  A, $39
0708   03CF 32 02 FF        LD  (DIG_2), A           ; C
0709   03D2             
0710   03D2 2A 14 FF        LD HL, (USR_PC)
0711   03D5 CD 02 0A        CALL PRINT_END_HL
0712   03D8 C3 DB 00        JP  EXIT_SYS
0713   03DB             
0714   03DB             
0715   03DB             SHOW_REG_SP:
0716   03DB CD 5F 07        CALL  GET_KEY_A
0717   03DE FE 00           CP  $00
0718   03E0 CA 71 08        JP Z, GO_MONITOR
0719   03E3 FE 01           CP  $01
0720   03E5 CA 7C 08        JP Z, GO_SHOW_REG_PC
0721   03E8 FE 02           CP  $02
0722   03EA CA 87 08        JP Z, GO_SHOW_REG_SP
0723   03ED FE 03           CP  $03
0724   03EF CA 92 08        JP Z, GO_SHOW_REG_AF
0725   03F2 FE 04           CP  $04
0726   03F4 CA 9D 08        JP Z, GO_SHOW_REG_BC
0727   03F7 FE 05           CP  $05
0728   03F9 CA A8 08        JP Z, GO_SHOW_REG_DE
0729   03FC FE 06           CP  $06
0730   03FE CA B3 08        JP Z, GO_SHOW_REG_HL
0731   0401 FE 07           CP  $07
0732   0403 CA BE 08        JP Z, GO_SHOW_REG_IX
0733   0406 FE 08           CP  $08
0734   0408 CA C9 08        JP Z, GO_SHOW_REG_IY
0735   040B             
0736   040B CD 16 09        CALL  CLEAR_DISPLAY
0737   040E             
0738   040E 3E 50           LD  A, $50               ; R
0739   0410 32 00 FF        LD  (DIG_0), A
0740   0413             
0741   0413 3E 6D           LD  A, $6D               ; S
0742   0415 32 01 FF        LD  (DIG_1), A
0743   0418             
0744   0418 3E 73           LD  A, $73               ; P
0745   041A 32 02 FF        LD  (DIG_2), A
0746   041D             
0747   041D 2A 16 FF        LD HL, (USR_SP)
0748   0420 CD 02 0A        CALL PRINT_END_HL
0749   0423 C3 DB 00        JP  EXIT_SYS
0750   0426             
0751   0426             
0752   0426             SHOW_REG_AF:
0753   0426 CD 5F 07        CALL  GET_KEY_A
0754   0429 FE 00           CP  $00
0755   042B CA 71 08        JP Z, GO_MONITOR
0756   042E FE 01           CP  $01
0757   0430 CA 7C 08        JP Z, GO_SHOW_REG_PC
0758   0433 FE 02           CP  $02
0759   0435 CA 87 08        JP Z, GO_SHOW_REG_SP
0760   0438 FE 03           CP  $03
0761   043A CA D4 08        JP Z, GO_SHOW_REG_AFaux
0762   043D FE 04           CP  $04
0763   043F CA 9D 08        JP Z, GO_SHOW_REG_BC
0764   0442 FE 05           CP  $05
0765   0444 CA A8 08        JP Z, GO_SHOW_REG_DE
0766   0447 FE 06           CP  $06
0767   0449 CA B3 08        JP Z, GO_SHOW_REG_HL
0768   044C FE 07           CP  $07
0769   044E CA BE 08        JP Z, GO_SHOW_REG_IX
0770   0451 FE 08           CP  $08
0771   0453 CA C9 08        JP Z, GO_SHOW_REG_IY
0772   0456             
0773   0456 CD 16 09        CALL  CLEAR_DISPLAY
0774   0459             
0775   0459 3E 50           LD  A, $50               ; R
0776   045B 32 00 FF        LD  (DIG_0), A
0777   045E             
0778   045E 3E 77           LD  A, $77               ; A
0779   0460 32 01 FF        LD  (DIG_1), A
0780   0463             
0781   0463 3E 71           LD  A, $71               ; F
0782   0465 32 02 FF        LD  (DIG_2), A
0783   0468             
0784   0468 2A 1E FF        LD  HL, (USR_AF)
0785   046B 7D              LD  A, L
0786   046C 32 2C FF        LD (CPU_FLAGS), A
0787   046F CD 02 0A        CALL PRINT_END_HL
0788   0472 C3 DB 00        JP  EXIT_SYS
0789   0475             
0790   0475             
0791   0475             SHOW_REG_BC:
0792   0475 CD 5F 07        CALL  GET_KEY_A
0793   0478 FE 00           CP  $00
0794   047A CA 71 08        JP Z, GO_MONITOR
0795   047D FE 01           CP  $01
0796   047F CA 7C 08        JP Z, GO_SHOW_REG_PC
0797   0482 FE 02           CP  $02
0798   0484 CA 87 08        JP Z, GO_SHOW_REG_SP
0799   0487 FE 03           CP  $03
0800   0489 CA 92 08        JP Z, GO_SHOW_REG_AF
0801   048C FE 04           CP  $04
0802   048E CA DF 08        JP Z, GO_SHOW_REG_BCaux
0803   0491 FE 05           CP  $05
0804   0493 CA A8 08        JP Z, GO_SHOW_REG_DE
0805   0496 FE 06           CP  $06
0806   0498 CA B3 08        JP Z, GO_SHOW_REG_HL
0807   049B FE 07           CP  $07
0808   049D CA BE 08        JP Z, GO_SHOW_REG_IX
0809   04A0 FE 08           CP  $08
0810   04A2 CA C9 08        JP Z, GO_SHOW_REG_IY
0811   04A5             
0812   04A5 CD 16 09        CALL  CLEAR_DISPLAY
0813   04A8             
0814   04A8 3E 50           LD  A, $50               ; R
0815   04AA 32 00 FF        LD  (DIG_0), A
0816   04AD             
0817   04AD 3E 7C           LD  A, $7C               ; B
0818   04AF 32 01 FF        LD  (DIG_1), A
0819   04B2             
0820   04B2 3E 39           LD  A, $39               ; C
0821   04B4 32 02 FF        LD  (DIG_2), A
0822   04B7             
0823   04B7 2A 1A FF        LD HL, (USR_BC)
0824   04BA CD 02 0A        CALL PRINT_END_HL
0825   04BD C3 DB 00        JP  EXIT_SYS
0826   04C0             
0827   04C0             SHOW_REG_DE:
0828   04C0 CD 5F 07        CALL  GET_KEY_A
0829   04C3 FE 00           CP  $00
0830   04C5 CA 71 08        JP Z, GO_MONITOR
0831   04C8 FE 01           CP  $01
0832   04CA CA 7C 08        JP Z, GO_SHOW_REG_PC
0833   04CD FE 02           CP  $02
0834   04CF CA 87 08        JP Z, GO_SHOW_REG_SP
0835   04D2 FE 03           CP  $03
0836   04D4 CA 92 08        JP Z, GO_SHOW_REG_AF
0837   04D7 FE 04           CP  $04
0838   04D9 CA 9D 08        JP Z, GO_SHOW_REG_BC
0839   04DC FE 05           CP  $05
0840   04DE CA EA 08        JP Z, GO_SHOW_REG_DEaux
0841   04E1 FE 06           CP  $06
0842   04E3 CA B3 08        JP Z, GO_SHOW_REG_HL
0843   04E6 FE 07           CP  $07
0844   04E8 CA BE 08        JP Z, GO_SHOW_REG_IX
0845   04EB FE 08           CP  $08
0846   04ED CA C9 08        JP Z, GO_SHOW_REG_IY
0847   04F0             
0848   04F0 CD 16 09        CALL  CLEAR_DISPLAY
0849   04F3             
0850   04F3 3E 50           LD  A, $50               ; R
0851   04F5 32 00 FF        LD  (DIG_0), A
0852   04F8             
0853   04F8 3E 5E           LD  A, $5E               ; D
0854   04FA 32 01 FF        LD  (DIG_1), A
0855   04FD             
0856   04FD 3E 79           LD  A, $79               ; E
0857   04FF 32 02 FF        LD  (DIG_2), A
0858   0502             
0859   0502 2A 1C FF        LD HL, (USR_DE)
0860   0505 CD 02 0A        CALL PRINT_END_HL
0861   0508 C3 DB 00        JP  EXIT_SYS
0862   050B             
0863   050B             SHOW_REG_HL:
0864   050B CD 5F 07        CALL  GET_KEY_A
0865   050E FE 00           CP  $00
0866   0510 CA 71 08        JP Z, GO_MONITOR
0867   0513 FE 01           CP  $01
0868   0515 CA 7C 08        JP Z, GO_SHOW_REG_PC
0869   0518 FE 02           CP  $02
0870   051A CA 87 08        JP Z, GO_SHOW_REG_SP
0871   051D FE 03           CP  $03
0872   051F CA 92 08        JP Z, GO_SHOW_REG_AF
0873   0522 FE 04           CP  $04
0874   0524 CA 9D 08        JP Z, GO_SHOW_REG_BC
0875   0527 FE 05           CP  $05
0876   0529 CA A8 08        JP Z, GO_SHOW_REG_DE
0877   052C FE 06           CP  $06
0878   052E CA F5 08        JP Z, GO_SHOW_REG_HLaux
0879   0531 FE 07           CP  $07
0880   0533 CA BE 08        JP Z, GO_SHOW_REG_IX
0881   0536 FE 08           CP  $08
0882   0538 CA C9 08        JP Z, GO_SHOW_REG_IY
0883   053B             
0884   053B CD 16 09        CALL  CLEAR_DISPLAY
0885   053E             
0886   053E 3E 50           LD  A, $50               ; R
0887   0540 32 00 FF        LD  (DIG_0), A
0888   0543             
0889   0543 3E 76           LD  A, $76               ; H
0890   0545 32 01 FF        LD  (DIG_1), A
0891   0548             
0892   0548 3E 38           LD  A, $38               ; L
0893   054A 32 02 FF        LD  (DIG_2), A
0894   054D             
0895   054D 2A 18 FF        LD HL, (USR_HL)
0896   0550 CD 02 0A        CALL PRINT_END_HL
0897   0553 C3 DB 00        JP  EXIT_SYS
0898   0556             
0899   0556             SHOW_REG_IX:
0900   0556 CD 5F 07        CALL  GET_KEY_A
0901   0559 FE 00           CP  $00
0902   055B CA 71 08        JP Z, GO_MONITOR
0903   055E FE 01           CP  $01
0904   0560 CA 7C 08        JP Z, GO_SHOW_REG_PC
0905   0563 FE 02           CP  $02
0906   0565 CA 87 08        JP Z, GO_SHOW_REG_SP
0907   0568 FE 03           CP  $03
0908   056A CA 92 08        JP Z, GO_SHOW_REG_AF
0909   056D FE 04           CP  $04
0910   056F CA 9D 08        JP Z, GO_SHOW_REG_BC
0911   0572 FE 05           CP  $05
0912   0574 CA A8 08        JP Z, GO_SHOW_REG_DE
0913   0577 FE 06           CP  $06
0914   0579 CA B3 08        JP Z, GO_SHOW_REG_HL
0915   057C FE 07           CP  $07
0916   057E CA BE 08        JP Z, GO_SHOW_REG_IX
0917   0581 FE 08           CP  $08
0918   0583 CA C9 08        JP Z, GO_SHOW_REG_IY
0919   0586             
0920   0586 CD 16 09        CALL  CLEAR_DISPLAY
0921   0589             
0922   0589 3E 50           LD  A, $50               ; R
0923   058B 32 00 FF        LD  (DIG_0), A
0924   058E             
0925   058E 3E 06           LD  A, $06               ; I
0926   0590 32 01 FF        LD  (DIG_1), A
0927   0593             
0928   0593 3E 70           LD  A, $70               ; X
0929   0595 32 02 FF        LD  (DIG_2), A
0930   0598             
0931   0598 2A 20 FF        LD HL, (USR_IX)
0932   059B CD 02 0A        CALL PRINT_END_HL
0933   059E C3 DB 00        JP  EXIT_SYS
0934   05A1             
0935   05A1             SHOW_REG_IY:
0936   05A1 CD 5F 07        CALL  GET_KEY_A
0937   05A4 FE 00           CP  $00
0938   05A6 CA 71 08        JP Z, GO_MONITOR
0939   05A9 FE 01           CP  $01
0940   05AB CA 7C 08        JP Z, GO_SHOW_REG_PC
0941   05AE FE 02           CP  $02
0942   05B0 CA 87 08        JP Z, GO_SHOW_REG_SP
0943   05B3 FE 03           CP  $03
0944   05B5 CA 92 08        JP Z, GO_SHOW_REG_AF
0945   05B8 FE 04           CP  $04
0946   05BA CA 9D 08        JP Z, GO_SHOW_REG_BC
0947   05BD FE 05           CP  $05
0948   05BF CA A8 08        JP Z, GO_SHOW_REG_DE
0949   05C2 FE 06           CP  $06
0950   05C4 CA B3 08        JP Z, GO_SHOW_REG_HL
0951   05C7 FE 07           CP  $07
0952   05C9 CA BE 08        JP Z, GO_SHOW_REG_IX
0953   05CC FE 08           CP  $08
0954   05CE CA C9 08        JP Z, GO_SHOW_REG_IY
0955   05D1             
0956   05D1 CD 16 09        CALL  CLEAR_DISPLAY
0957   05D4             
0958   05D4 3E 50           LD  A, $50               ; R
0959   05D6 32 00 FF        LD  (DIG_0), A
0960   05D9             
0961   05D9 3E 06           LD  A, $06               ; I
0962   05DB 32 01 FF        LD  (DIG_1), A
0963   05DE             
0964   05DE 3E 6E           LD  A, $6E               ; Y
0965   05E0 32 02 FF        LD  (DIG_2), A
0966   05E3             
0967   05E3 2A 22 FF        LD HL, (USR_IY)
0968   05E6 CD 02 0A        CALL PRINT_END_HL
0969   05E9 C3 DB 00        JP  EXIT_SYS
0970   05EC             
0971   05EC             SHOW_REG_AFaux:
0972   05EC CD 5F 07        CALL  GET_KEY_A
0973   05EF FE 00           CP  $00
0974   05F1 CA 71 08        JP Z, GO_MONITOR
0975   05F4 FE 01           CP  $01
0976   05F6 CA 7C 08        JP Z, GO_SHOW_REG_PC
0977   05F9 FE 02           CP  $02
0978   05FB CA 87 08        JP Z, GO_SHOW_REG_SP
0979   05FE FE 03           CP  $03
0980   0600 CA 92 08        JP Z, GO_SHOW_REG_AF
0981   0603 FE 04           CP  $04
0982   0605 CA 9D 08        JP Z, GO_SHOW_REG_BC
0983   0608 FE 05           CP  $05
0984   060A CA A8 08        JP Z, GO_SHOW_REG_DE
0985   060D FE 06           CP  $06
0986   060F CA B3 08        JP Z, GO_SHOW_REG_HL
0987   0612 FE 07           CP  $07
0988   0614 CA BE 08        JP Z, GO_SHOW_REG_IX
0989   0617 FE 08           CP  $08
0990   0619 CA C9 08        JP Z, GO_SHOW_REG_IY
0991   061C             
0992   061C CD 16 09        CALL  CLEAR_DISPLAY
0993   061F             
0994   061F 3E 50           LD  A, $50               ; R
0995   0621 32 00 FF        LD  (DIG_0), A
0996   0624             
0997   0624 3E 77           LD  A, $77               ; A
0998   0626 32 01 FF        LD  (DIG_1), A
0999   0629             
1000   0629 3E 71           LD  A, $71               ; F
1001   062B 32 02 FF        LD  (DIG_2), A
1002   062E             
1003   062E 3E 20           LD  A, $20               ; '
1004   0630 32 03 FF        LD  (DIG_3), A
1005   0633             
1006   0633 2A 24 FF        LD HL, (USR_AFA)
1007   0636 7D              LD  A, L
1008   0637 32 2C FF        LD (CPU_FLAGS), A
1009   063A CD 02 0A        CALL PRINT_END_HL
1010   063D C3 DB 00        JP  EXIT_SYS
1011   0640             
1012   0640             
1013   0640             SHOW_REG_BCaux:
1014   0640 CD 5F 07        CALL  GET_KEY_A
1015   0643 FE 00           CP  $00
1016   0645 CA 71 08        JP Z, GO_MONITOR
1017   0648 FE 01           CP  $01
1018   064A CA 7C 08        JP Z, GO_SHOW_REG_PC
1019   064D FE 02           CP  $02
1020   064F CA 87 08        JP Z, GO_SHOW_REG_SP
1021   0652 FE 03           CP  $03
1022   0654 CA 92 08        JP Z, GO_SHOW_REG_AF
1023   0657 FE 04           CP  $04
1024   0659 CA 9D 08        JP Z, GO_SHOW_REG_BC
1025   065C FE 05           CP  $05
1026   065E CA A8 08        JP Z, GO_SHOW_REG_DE
1027   0661 FE 06           CP  $06
1028   0663 CA B3 08        JP Z, GO_SHOW_REG_HL
1029   0666 FE 07           CP  $07
1030   0668 CA BE 08        JP Z, GO_SHOW_REG_IX
1031   066B FE 08           CP  $08
1032   066D CA C9 08        JP Z, GO_SHOW_REG_IY
1033   0670             
1034   0670 CD 16 09        CALL  CLEAR_DISPLAY
1035   0673             
1036   0673 3E 50           LD  A, $50               ; R
1037   0675 32 00 FF        LD  (DIG_0), A
1038   0678             
1039   0678 3E 7C           LD  A, $7C               ; B
1040   067A 32 01 FF        LD  (DIG_1), A
1041   067D             
1042   067D 3E 39           LD  A, $39               ; C
1043   067F 32 02 FF        LD  (DIG_2), A
1044   0682             
1045   0682 3E 20           LD  A, $20               ; '
1046   0684 32 03 FF        LD  (DIG_3), A
1047   0687             
1048   0687 2A 26 FF        LD HL, (USR_BCA)
1049   068A CD 02 0A        CALL PRINT_END_HL
1050   068D C3 DB 00        JP  EXIT_SYS
1051   0690             
1052   0690             SHOW_REG_DEaux:
1053   0690 CD 5F 07        CALL  GET_KEY_A
1054   0693 FE 00           CP  $00
1055   0695 CA 71 08        JP Z, GO_MONITOR
1056   0698 FE 01           CP  $01
1057   069A CA 7C 08        JP Z, GO_SHOW_REG_PC
1058   069D FE 02           CP  $02
1059   069F CA 87 08        JP Z, GO_SHOW_REG_SP
1060   06A2 FE 03           CP  $03
1061   06A4 CA 92 08        JP Z, GO_SHOW_REG_AF
1062   06A7 FE 04           CP  $04
1063   06A9 CA 9D 08        JP Z, GO_SHOW_REG_BC
1064   06AC FE 05           CP  $05
1065   06AE CA A8 08        JP Z, GO_SHOW_REG_DE
1066   06B1 FE 06           CP  $06
1067   06B3 CA B3 08        JP Z, GO_SHOW_REG_HL
1068   06B6 FE 07           CP  $07
1069   06B8 CA BE 08        JP Z, GO_SHOW_REG_IX
1070   06BB FE 08           CP  $08
1071   06BD CA C9 08        JP Z, GO_SHOW_REG_IY
1072   06C0             
1073   06C0 CD 16 09        CALL  CLEAR_DISPLAY
1074   06C3             
1075   06C3 3E 50           LD  A, $50               ; R
1076   06C5 32 00 FF        LD  (DIG_0), A
1077   06C8             
1078   06C8 3E 5E           LD  A, $5E               ; D
1079   06CA 32 01 FF        LD  (DIG_1), A
1080   06CD             
1081   06CD 3E 79           LD  A, $79               ; E
1082   06CF 32 02 FF        LD  (DIG_2), A
1083   06D2             
1084   06D2 3E 20           LD  A, $20               ; '
1085   06D4 32 03 FF        LD  (DIG_3), A
1086   06D7             
1087   06D7 2A 28 FF        LD HL, (USR_DEA)
1088   06DA CD 02 0A        CALL PRINT_END_HL
1089   06DD C3 DB 00        JP  EXIT_SYS
1090   06E0             
1091   06E0             SHOW_REG_HLaux:
1092   06E0 CD 5F 07        CALL  GET_KEY_A
1093   06E3 FE 00           CP  $00
1094   06E5 CA 71 08        JP Z, GO_MONITOR
1095   06E8 FE 01           CP  $01
1096   06EA CA 7C 08        JP Z, GO_SHOW_REG_PC
1097   06ED FE 02           CP  $02
1098   06EF CA 87 08        JP Z, GO_SHOW_REG_SP
1099   06F2 FE 03           CP  $03
1100   06F4 CA 92 08        JP Z, GO_SHOW_REG_AF
1101   06F7 FE 04           CP  $04
1102   06F9 CA 9D 08        JP Z, GO_SHOW_REG_BC
1103   06FC FE 05           CP  $05
1104   06FE CA A8 08        JP Z, GO_SHOW_REG_DE
1105   0701 FE 06           CP  $06
1106   0703 CA B3 08        JP Z, GO_SHOW_REG_HL
1107   0706 FE 07           CP  $07
1108   0708 CA BE 08        JP Z, GO_SHOW_REG_IX
1109   070B FE 08           CP  $08
1110   070D CA C9 08        JP Z, GO_SHOW_REG_IY
1111   0710             
1112   0710 CD 16 09        CALL  CLEAR_DISPLAY
1113   0713             
1114   0713 3E 50           LD  A, $50               ; R
1115   0715 32 00 FF        LD  (DIG_0), A
1116   0718             
1117   0718 3E 76           LD  A, $76               ; H
1118   071A 32 01 FF        LD  (DIG_1), A
1119   071D             
1120   071D 3E 38           LD  A, $38               ; L
1121   071F 32 02 FF        LD  (DIG_2), A
1122   0722             
1123   0722 3E 20           LD  A, $20               ; '
1124   0724 32 03 FF        LD  (DIG_3), A
1125   0727             
1126   0727 2A 2A FF        LD HL, (USR_HLA)
1127   072A CD 02 0A        CALL PRINT_END_HL
1128   072D C3 DB 00        JP  EXIT_SYS
1129   0730             
1130   0730             SHOW_HALT:
1131   0730 3A 09 FF        LD  A, (INPUT)
1132   0733 FE FB           CP  $FB
1133   0735 CA 71 08        JP  Z, GO_MONITOR
1134   0738             
1135   0738 3E 40           LD  A, $40               ; -
1136   073A 32 00 FF        LD  (DIG_0), A
1137   073D 32 01 FF        LD  (DIG_1), A
1138   0740             
1139   0740 3E 76           LD  A, $76               ; H
1140   0742 32 02 FF        LD  (DIG_2), A
1141   0745             
1142   0745 3E 77           LD  A, $77               ; A
1143   0747 32 03 FF        LD  (DIG_3), A
1144   074A             
1145   074A 3E 38           LD  A, $38               ; L
1146   074C 32 04 FF        LD  (DIG_4), A
1147   074F             
1148   074F 3E 78           LD  A, $78               ; T
1149   0751 32 05 FF        LD  (DIG_5), A
1150   0754             
1151   0754 3E 40           LD  A, $40               ; -
1152   0756 32 06 FF        LD  (DIG_6), A
1153   0759 32 07 FF        LD  (DIG_7), A
1154   075C             
1155   075C C3 DB 00        JP EXIT_SYS
1156   075F             
1157   075F             ; =========================================================
1158   075F             ; GET KEY IN A, IF A == FFh then no KEY
1159   075F             ; =========================================================
1160   075F             GET_KEY_A:
1161   075F 3A 0B FF        LD  A, (KEY_TIMEOUT)
1162   0762 FE 00           CP  0
1163   0764 CA 6A 07        JP  Z, RET_KEY
1164   0767 3E FF           LD  A, $FF
1165   0769 C9              RET
1166   076A             
1167   076A             RET_KEY:
1168   076A 3E 64           LD A, CKEY_TIMEOUT
1169   076C 32 0B FF        LD (KEY_TIMEOUT), A
1170   076F             
1171   076F 3A 08 FF        LD  A, (KEY_PRESS)
1172   0772 F5              PUSH  AF
1173   0773 3E FF           LD  A, $FF
1174   0775 32 08 FF        LD  (KEY_PRESS), A
1175   0778 F1              POP  AF
1176   0779 C9              RET
1177   077A             
1178   077A             
1179   077A             ; =========================================================
1180   077A             ; MONITOR Mode
1181   077A             ; =========================================================
1182   077A             USER_MODE:
1183   077A 3A 09 FF        LD  A, (INPUT)
1184   077D FE FB           CP  $FB
1185   077F CA 71 08        JP  Z, GO_MONITOR
1186   0782                 
1187   0782                 ; Copy USER_DISPx to DIG_x
1188   0782 21 D0 FF        LD	HL, USER_DISP0
1189   0785 11 00 FF    	LD	DE, DIG_0
1190   0788 01 08 00    	LD	BC, $0008
1191   078B ED B0       	LDIR
1192   078D             
1193   078D C3 DB 00        JP  EXIT_SYS
1194   0790             
1195   0790             MONITOR_MODE:
1196   0790                 ; Mostra o endereço
1197   0790 2A 0D FF        LD  HL, (PC_RAM)
1198   0793 CD A5 09        CALL PRINT_HL
1199   0796             
1200   0796                 ; Limpa digitos
1201   0796 3E 00           LD  A, 0
1202   0798 32 04 FF        LD  (DIG_4), A
1203   079B 32 05 FF        LD  (DIG_5), A
1204   079E             
1205   079E                 ; Mostra os dados no endereço
1206   079E 2A 0D FF        LD  HL, (PC_RAM)
1207   07A1 7E              LD  A, (HL)
1208   07A2 CD 78 09        CALL  PRINT_A
1209   07A5             
1210   07A5             
1211   07A5 CD 5F 07        CALL  GET_KEY_A
1212   07A8             
1213   07A8                 ; Incrementa endereço
1214   07A8 32 0A FF        LD (TMP_KEY), A
1215   07AB FE 0A           CP  $0A
1216   07AD CA 2D 08        JP  Z,  PC_RAM_INC
1217   07B0             
1218   07B0                 ; Decrementa endereço
1219   07B0 3A 0A FF        LD  A, (TMP_KEY)
1220   07B3 FE 0B           CP  $0B
1221   07B5 CA 23 08        JP  Z,  PC_RAM_DEC
1222   07B8             
1223   07B8                 ; Examina memoria
1224   07B8 3A 0A FF        LD  A, (TMP_KEY)
1225   07BB FE 0E           CP  $0E
1226   07BD CA 37 08        JP  Z,  GO_EXAMINE
1227   07C0             
1228   07C0                 ; + moDify Memory
1229   07C0 3A 0A FF        LD  A, (TMP_KEY)
1230   07C3 FE 0C           CP  $0C
1231   07C5 CA 52 08        JP  Z,  GO_ADD_MODIFY
1232   07C8             
1233   07C8                 ; moDify Memory
1234   07C8 3A 0A FF        LD  A, (TMP_KEY)
1235   07CB FE 0D           CP  $0D
1236   07CD CA 5C 08        JP  Z,  GO_MODIFY
1237   07D0             
1238   07D0                 ; RUN
1239   07D0 3A 0A FF        LD  A, (TMP_KEY)
1240   07D3 FE 0F           CP  $0F
1241   07D5 CA 00 09        JP  Z,  FIRE
1242   07D8             
1243   07D8                 ; Show register PC
1244   07D8 3A 0A FF        LD  A, (TMP_KEY)
1245   07DB FE 01           CP  $01
1246   07DD CA 7C 08        JP  Z, GO_SHOW_REG_PC
1247   07E0             
1248   07E0                 ; Show register SP
1249   07E0 3A 0A FF        LD  A, (TMP_KEY)
1250   07E3 FE 02           CP  $02
1251   07E5 CA 87 08        JP  Z, GO_SHOW_REG_SP
1252   07E8             
1253   07E8                 ; Show register AF
1254   07E8 3A 0A FF        LD  A, (TMP_KEY)
1255   07EB FE 03           CP  $03
1256   07ED CA 92 08        JP  Z, GO_SHOW_REG_AF
1257   07F0             
1258   07F0                 ; Show register BC
1259   07F0 3A 0A FF        LD  A, (TMP_KEY)
1260   07F3 FE 04           CP  $04
1261   07F5 CA 9D 08        JP  Z, GO_SHOW_REG_BC
1262   07F8             
1263   07F8                 ; Show register DE
1264   07F8 3A 0A FF        LD  A, (TMP_KEY)
1265   07FB FE 05           CP  $05
1266   07FD CA A8 08        JP  Z, GO_SHOW_REG_DE
1267   0800             
1268   0800                 ; Show register HL
1269   0800 3A 0A FF        LD  A, (TMP_KEY)
1270   0803 FE 06           CP  $06
1271   0805 CA B3 08        JP  Z, GO_SHOW_REG_HL
1272   0808             
1273   0808                 ; Show register IX
1274   0808 3A 0A FF        LD  A, (TMP_KEY)
1275   080B FE 07           CP  $07
1276   080D CA BE 08        JP  Z, GO_SHOW_REG_IX
1277   0810             
1278   0810                 ; Show register iY
1279   0810 3A 0A FF        LD  A, (TMP_KEY)
1280   0813 FE 08           CP  $08
1281   0815 CA C9 08        JP  Z, GO_SHOW_REG_IY
1282   0818             
1283   0818                 ; Back to user mode
1284   0818 3A 0A FF        LD  A, (TMP_KEY)
1285   081B FE 09           CP  $09
1286   081D CA 0E 09        JP  Z, GO_USER_MODE
1287   0820             
1288   0820 C3 DB 00        JP  EXIT_SYS
1289   0823                 
1290   0823             
1291   0823             PC_RAM_DEC:
1292   0823 2A 0D FF        LD  HL, (PC_RAM)
1293   0826 2B              DEC  HL
1294   0827 22 0D FF        LD  (PC_RAM), HL
1295   082A C3 DB 00        JP  EXIT_SYS
1296   082D             
1297   082D             PC_RAM_INC:
1298   082D 2A 0D FF        LD  HL, (PC_RAM)
1299   0830 23              INC  HL
1300   0831 22 0D FF        LD  (PC_RAM), HL
1301   0834 C3 DB 00        JP  EXIT_SYS
1302   0837             
1303   0837             GO_EXAMINE:
1304   0837 3E 03           LD  A, $03
1305   0839 32 12 FF        LD (EXM_COUNT), A        ; Set count 4 digits, position display
1306   083C 3E 02           LD  A, $02
1307   083E 32 0F FF        LD (SYSMODE), A          ; Examine mode
1308   0841 3E 40           LD A, 01000000b
1309   0843 32 00 FF        LD (DIG_0), A
1310   0846 32 01 FF        LD (DIG_1), A
1311   0849 32 02 FF        LD (DIG_2), A
1312   084C 32 03 FF        LD (DIG_3), A
1313   084F C3 DB 00        JP  EXIT_SYS
1314   0852             
1315   0852             GO_ADD_MODIFY:
1316   0852 2A 0D FF        LD  HL, (PC_RAM)
1317   0855 23              INC HL
1318   0856 22 0D FF        LD  (PC_RAM), HL
1319   0859 CD A5 09        CALL  PRINT_HL
1320   085C             GO_MODIFY:
1321   085C 3E 01           LD  A, $01                  ; Set count 2 digits, position display
1322   085E 32 13 FF        LD  (MDF_COUNT), A
1323   0861 3E 03           LD  A, $03                  ; moDify mode (Memory)
1324   0863 32 0F FF        LD  (SYSMODE), A
1325   0866 3E 40           LD  A, 01000000b
1326   0868 32 06 FF        LD  (DIG_6), A
1327   086B 32 07 FF        LD  (DIG_7), A
1328   086E C3 DB 00        JP  EXIT_SYS
1329   0871             
1330   0871             GO_MONITOR:
1331   0871 CD 16 09        CALL  CLEAR_DISPLAY
1332   0874 3E 01           LD  A, $01
1333   0876 32 0F FF        LD  (SYSMODE), A
1334   0879 C3 DB 00        JP  EXIT_SYS
1335   087C             
1336   087C             GO_SHOW_REG_PC:
1337   087C CD 16 09        CALL CLEAR_DISPLAY
1338   087F 3E 04           LD  A, $04
1339   0881 32 0F FF        LD  (SYSMODE), A
1340   0884 C3 DB 00        JP  EXIT_SYS
1341   0887             
1342   0887             GO_SHOW_REG_SP:
1343   0887 CD 16 09        CALL CLEAR_DISPLAY
1344   088A 3E 05           LD  A, $05
1345   088C 32 0F FF        LD  (SYSMODE), A
1346   088F C3 DB 00        JP  EXIT_SYS
1347   0892             
1348   0892             GO_SHOW_REG_AF:
1349   0892 CD 16 09        CALL CLEAR_DISPLAY
1350   0895 3E 06           LD  A, $06
1351   0897 32 0F FF        LD  (SYSMODE), A
1352   089A C3 DB 00        JP  EXIT_SYS
1353   089D             
1354   089D             GO_SHOW_REG_BC:
1355   089D CD 16 09        CALL CLEAR_DISPLAY
1356   08A0 3E 07           LD  A, $07
1357   08A2 32 0F FF        LD  (SYSMODE), A
1358   08A5 C3 DB 00        JP  EXIT_SYS
1359   08A8             
1360   08A8             GO_SHOW_REG_DE:
1361   08A8 CD 16 09        CALL CLEAR_DISPLAY
1362   08AB 3E 08           LD  A, $08
1363   08AD 32 0F FF        LD  (SYSMODE), A
1364   08B0 C3 DB 00        JP  EXIT_SYS
1365   08B3             
1366   08B3             GO_SHOW_REG_HL:
1367   08B3 CD 16 09        CALL CLEAR_DISPLAY
1368   08B6 3E 09           LD  A, $09
1369   08B8 32 0F FF        LD  (SYSMODE), A
1370   08BB C3 DB 00        JP  EXIT_SYS
1371   08BE             
1372   08BE             GO_SHOW_REG_IX:
1373   08BE CD 16 09        CALL CLEAR_DISPLAY
1374   08C1 3E 0A           LD  A, $0A
1375   08C3 32 0F FF        LD  (SYSMODE), A
1376   08C6 C3 DB 00        JP  EXIT_SYS
1377   08C9             
1378   08C9             GO_SHOW_REG_IY:
1379   08C9 CD 16 09        CALL CLEAR_DISPLAY
1380   08CC 3E 0B           LD  A, $0B
1381   08CE 32 0F FF        LD  (SYSMODE), A
1382   08D1 C3 DB 00        JP  EXIT_SYS
1383   08D4             
1384   08D4             GO_SHOW_REG_AFaux:
1385   08D4 CD 16 09        CALL CLEAR_DISPLAY
1386   08D7 3E 0C           LD  A, $0C
1387   08D9 32 0F FF        LD  (SYSMODE), A
1388   08DC C3 DB 00        JP  EXIT_SYS
1389   08DF             
1390   08DF             GO_SHOW_REG_BCaux:
1391   08DF CD 16 09        CALL CLEAR_DISPLAY
1392   08E2 3E 0D           LD  A, $0D
1393   08E4 32 0F FF        LD  (SYSMODE), A
1394   08E7 C3 DB 00        JP  EXIT_SYS
1395   08EA             
1396   08EA             GO_SHOW_REG_DEaux:
1397   08EA CD 16 09        CALL CLEAR_DISPLAY
1398   08ED 3E 0E           LD  A, $0E
1399   08EF 32 0F FF        LD  (SYSMODE), A
1400   08F2 C3 DB 00        JP  EXIT_SYS
1401   08F5             
1402   08F5             GO_SHOW_REG_HLaux:
1403   08F5 CD 16 09        CALL CLEAR_DISPLAY
1404   08F8 3E 0F           LD  A, $0F
1405   08FA 32 0F FF        LD  (SYSMODE), A
1406   08FD C3 DB 00        JP  EXIT_SYS
1407   0900             
1408   0900             
1409   0900             FIRE:
1410   0900 3E 01           LD  A, 1
1411   0902 32 0F FF        LD (SYSMODE), A          ; Monitor mode
1412   0905 2A 0D FF        LD  HL, (PC_RAM)
1413   0908 22 14 FF        LD  (USR_PC), HL
1414   090B C3 DB 00        JP  EXIT_SYS
1415   090E             
1416   090E             GO_USER_MODE:
1417   090E 3E 00           LD  A, 0
1418   0910 32 0F FF        LD  (SYSMODE), A
1419   0913 C3 DB 00        JP  EXIT_SYS
1420   0916             
1421   0916             ; =========================================================
1422   0916             ; LIMPA DISPLAY
1423   0916             ; =========================================================
1424   0916             CLEAR_DISPLAY:
1425   0916 F5              PUSH  AF
1426   0917 3E 00           LD  A, 0
1427   0919 32 00 FF        LD  (DIG_0), A
1428   091C 32 01 FF        LD  (DIG_1), A
1429   091F 32 02 FF        LD  (DIG_2), A
1430   0922 32 03 FF        LD  (DIG_3), A
1431   0925 32 04 FF        LD  (DIG_4), A
1432   0928 32 05 FF        LD  (DIG_5), A
1433   092B 32 06 FF        LD  (DIG_6), A
1434   092E 32 07 FF        LD  (DIG_7), A
1435   0931 F1              POP  AF
1436   0932 C9              RET
1437   0933             
1438   0933             ; =========================================================
1439   0933             ; LIMPA USER DISPLAY
1440   0933             ; =========================================================
1441   0933             CLEAR_USER_DISPLAY:
1442   0933 F5              PUSH  AF
1443   0934 3E 00           LD  A, 0
1444   0936 32 D0 FF        LD  (USER_DISP0), A
1445   0939 32 D1 FF        LD  (USER_DISP1), A
1446   093C 32 D2 FF        LD  (USER_DISP2), A
1447   093F 32 D3 FF        LD  (USER_DISP3), A
1448   0942 32 D4 FF        LD  (USER_DISP4), A
1449   0945 32 D5 FF        LD  (USER_DISP5), A
1450   0948 32 D6 FF        LD  (USER_DISP6), A
1451   094B 32 D7 FF        LD  (USER_DISP7), A
1452   094E F1              POP  AF
1453   094F C9              RET
1454   0950             
1455   0950             
1456   0950             ; =========================================================
1457   0950             ; PEGA LOW NUM EM A E RETORNA CHAR 7SEG EM A
1458   0950             ; =========================================================
1459   0950             GET_NUM_FROM_LOW:
1460   0950 E5              PUSH    HL
1461   0951 C5              PUSH    BC
1462   0952 21 D5 0A        LD      HL, LED_FONT
1463   0955 E6 0F           AND     $0F
1464   0957 01 00 00        LD      BC, 0
1465   095A 4F              LD      C, A
1466   095B 09              ADD     HL, BC
1467   095C 7E              LD      A, (HL)
1468   095D C1              POP     BC
1469   095E E1              POP     HL
1470   095F C9              RET
1471   0960             
1472   0960             ; =========================================================
1473   0960             ; PEGA HIGH NUM EM A E RETORNA CHAR 7SEG EM A
1474   0960             ; =========================================================
1475   0960             GET_NUM_FROM_HIGH:
1476   0960 E5              PUSH    HL
1477   0961 C5              PUSH    BC
1478   0962 21 D5 0A        LD      HL, LED_FONT
1479   0965 E6 F0           AND     $F0
1480   0967 CB 0F           RRC     A
1481   0969 CB 0F           RRC     A
1482   096B CB 0F           RRC     A
1483   096D CB 0F           RRC     A
1484   096F 01 00 00        LD      BC, 0
1485   0972 4F              LD      C, A
1486   0973 09              ADD     HL, BC
1487   0974 7E              LD      A, (HL)
1488   0975 C1              POP     BC
1489   0976 E1              POP     HL
1490   0977 C9              RET
1491   0978             
1492   0978             ; =========================================================
1493   0978             ; Mostra o que esta em A nos digitos 6 e 7
1494   0978             ; =========================================================
1495   0978             PRINT_A:
1496   0978 E5              PUSH    HL
1497   0979 C5              PUSH    BC
1498   097A F5              PUSH    AF
1499   097B F5              PUSH    AF
1500   097C             
1501   097C 21 D5 0A        LD	HL, LED_FONT
1502   097F E6 0F           AND $0F
1503   0981 01 00 00        LD      BC, 0
1504   0984 4F              LD      C, A
1505   0985 09              ADD HL, BC
1506   0986 7E              LD  A, (HL)
1507   0987 32 07 FF        LD  (DIG_7), A
1508   098A             
1509   098A F1              POP    AF
1510   098B 21 D5 0A        LD	HL, LED_FONT
1511   098E E6 F0           AND  $F0
1512   0990 CB 0F           RRC  A
1513   0992 CB 0F           RRC  A
1514   0994 CB 0F           RRC  A
1515   0996 CB 0F           RRC  A
1516   0998 01 00 00        LD      BC, 0
1517   099B 4F              LD      C, A
1518   099C 09              ADD HL, BC
1519   099D 7E              LD  A, (HL)
1520   099E 32 06 FF        LD  (DIG_6), A
1521   09A1             
1522   09A1 F1              POP     AF
1523   09A2 C1              POP     BC
1524   09A3 E1              POP     HL
1525   09A4 C9              RET
1526   09A5             
1527   09A5             ; =========================================================
1528   09A5             ; Mostra o que esta em HL - Display(HHLLXXXX)
1529   09A5             ; =========================================================
1530   09A5             PRINT_HL:
1531   09A5 F5              PUSH  AF
1532   09A6 E5              PUSH  HL
1533   09A7 C5              PUSH  BC
1534   09A8             
1535   09A8 E5              PUSH  HL
1536   09A9 E5              PUSH  HL
1537   09AA E5              PUSH  HL
1538   09AB             
1539   09AB 7D              LD  A, L
1540   09AC 21 D5 0A        LD	HL, LED_FONT
1541   09AF E6 0F           AND $0F
1542   09B1 01 00 00        LD      BC, 0
1543   09B4 4F              LD      C, A
1544   09B5 09              ADD HL, BC
1545   09B6 7E              LD  A, (HL)
1546   09B7 21 03 FF        LD  HL, DIG_3
1547   09BA 77              LD  (HL), A
1548   09BB             
1549   09BB E1              POP  HL
1550   09BC 7D              LD  A, L
1551   09BD 21 D5 0A        LD	HL, LED_FONT
1552   09C0 E6 F0           AND  $F0
1553   09C2 CB 0F           RRC  A
1554   09C4 CB 0F           RRC  A
1555   09C6 CB 0F           RRC  A
1556   09C8 CB 0F           RRC  A
1557   09CA 01 00 00        LD      BC, 0
1558   09CD 4F              LD      C, A
1559   09CE 09              ADD HL, BC
1560   09CF 7E              LD  A, (HL)
1561   09D0 21 02 FF        LD  HL, DIG_2
1562   09D3 77              LD  (HL), A
1563   09D4             
1564   09D4 E1              POP  HL
1565   09D5 7C              LD  A, H
1566   09D6 21 D5 0A        LD	HL, LED_FONT
1567   09D9 E6 0F           AND $0F
1568   09DB 01 00 00        LD      BC, 0
1569   09DE 4F              LD      C, A
1570   09DF 09              ADD HL, BC
1571   09E0 7E              LD  A, (HL)
1572   09E1 21 01 FF        LD  HL, DIG_1
1573   09E4 77              LD  (HL), A
1574   09E5             
1575   09E5 E1              POP  HL
1576   09E6 7C              LD  A, H
1577   09E7 21 D5 0A        LD	HL, LED_FONT
1578   09EA E6 F0           AND  $F0
1579   09EC CB 0F           RRC  A
1580   09EE CB 0F           RRC  A
1581   09F0 CB 0F           RRC  A
1582   09F2 CB 0F           RRC  A
1583   09F4 01 00 00        LD      BC, 0
1584   09F7 4F              LD      C, A
1585   09F8 09              ADD HL, BC
1586   09F9 7E              LD  A, (HL)
1587   09FA 21 00 FF        LD  HL, DIG_0
1588   09FD 77              LD  (HL), A
1589   09FE             
1590   09FE C1              POP  BC
1591   09FF E1              POP  HL
1592   0A00 F1              POP  AF
1593   0A01             
1594   0A01 C9              RET
1595   0A02             
1596   0A02             ; =========================================================
1597   0A02             ; Mostra o que esta em HL - Display(XXXXHHLL)
1598   0A02             ; =========================================================
1599   0A02             PRINT_END_HL:
1600   0A02 F5              PUSH  AF
1601   0A03 E5              PUSH  HL
1602   0A04 C5              PUSH  BC
1603   0A05             
1604   0A05 E5              PUSH  HL
1605   0A06 E5              PUSH  HL
1606   0A07 E5              PUSH  HL
1607   0A08             
1608   0A08 7D              LD  A, L
1609   0A09 21 D5 0A        LD	HL, LED_FONT
1610   0A0C E6 0F           AND $0F
1611   0A0E 01 00 00        LD      BC, 0
1612   0A11 4F              LD      C, A
1613   0A12 09              ADD HL, BC
1614   0A13 7E              LD  A, (HL)
1615   0A14 21 07 FF        LD  HL, DIG_7
1616   0A17 77              LD  (HL), A
1617   0A18             
1618   0A18 E1              POP  HL
1619   0A19 7D              LD  A, L
1620   0A1A 21 D5 0A        LD	HL, LED_FONT
1621   0A1D E6 F0           AND  $F0
1622   0A1F CB 0F           RRC  A
1623   0A21 CB 0F           RRC  A
1624   0A23 CB 0F           RRC  A
1625   0A25 CB 0F           RRC  A
1626   0A27 01 00 00        LD      BC, 0
1627   0A2A 4F              LD      C, A
1628   0A2B 09              ADD HL, BC
1629   0A2C 7E              LD  A, (HL)
1630   0A2D 21 06 FF        LD  HL, DIG_6
1631   0A30 77              LD  (HL), A
1632   0A31             
1633   0A31 E1              POP  HL
1634   0A32 7C              LD  A, H
1635   0A33 21 D5 0A        LD	HL, LED_FONT
1636   0A36 E6 0F           AND $0F
1637   0A38 01 00 00        LD      BC, 0
1638   0A3B 4F              LD      C, A
1639   0A3C 09              ADD HL, BC
1640   0A3D 7E              LD  A, (HL)
1641   0A3E 21 05 FF        LD  HL, DIG_5
1642   0A41 77              LD  (HL), A
1643   0A42             
1644   0A42 E1              POP  HL
1645   0A43 7C              LD  A, H
1646   0A44 21 D5 0A        LD	HL, LED_FONT
1647   0A47 E6 F0           AND  $F0
1648   0A49 CB 0F           RRC  A
1649   0A4B CB 0F           RRC  A
1650   0A4D CB 0F           RRC  A
1651   0A4F CB 0F           RRC  A
1652   0A51 01 00 00        LD      BC, 0
1653   0A54 4F              LD      C, A
1654   0A55 09              ADD HL, BC
1655   0A56 7E              LD  A, (HL)
1656   0A57 21 04 FF        LD  HL, DIG_4
1657   0A5A 77              LD  (HL), A
1658   0A5B             
1659   0A5B C1              POP  BC
1660   0A5C E1              POP  HL
1661   0A5D F1              POP  AF
1662   0A5E             
1663   0A5E C9              RET
1664   0A5F             
1665   0A5F             ; =========================================================
1666   0A5F             ; Start Sistem ?
1667   0A5F             ; =========================================================
1668   0A5F             START:
1669   0A5F 31 00 FF        LD  SP, STACK
1670   0A62 E5              PUSH HL                  ; Save HL
1671   0A63 F5              PUSH AF                  ; Save AF
1672   0A64             
1673   0A64 3E 01           LD  A, 1                 ; Monitor mode
1674   0A66 32 0F FF        LD  (SYSMODE), A
1675   0A69             
1676   0A69             START_COM:
1677   0A69 21 00 80        LD  HL, START_RAM
1678   0A6C 22 0D FF        LD  (PC_RAM), HL
1679   0A6F             
1680   0A6F                 ; start vars
1681   0A6F 3E 64           LD  A, CKEY_TIMEOUT
1682   0A71 32 0B FF        LD  (KEY_TIMEOUT), A
1683   0A74             
1684   0A74 3E FF           LD A, $FF
1685   0A76 32 08 FF        LD (KEY_PRESS), A
1686   0A79             
1687   0A79 3E 00           LD  A, $00
1688   0A7B 32 00 FF        LD  (DIG_0), A
1689   0A7E 32 01 FF        LD  (DIG_1), A
1690   0A81 32 02 FF        LD  (DIG_2), A
1691   0A84 32 03 FF        LD  (DIG_3), A
1692   0A87 32 04 FF        LD  (DIG_4), A
1693   0A8A 32 05 FF        LD  (DIG_5), A
1694   0A8D 32 06 FF        LD  (DIG_6), A
1695   0A90 32 07 FF        LD  (DIG_7), A
1696   0A93             
1697   0A93 ED 56           IM  1
1698   0A95 FB              EI
1699   0A96             
1700   0A96 AF              XOR A
1701   0A97 D3 40           OUT (Port40), A
1702   0A99             
1703   0A99 F1              POP AF                   ; Recovery AF
1704   0A9A E1              POP HL                   ; Recovery HL
1705   0A9B             START_LOOP:
1706   0A9B C3 9B 0A        JP START_LOOP
1707   0A9E             
1708   0A9E             START_WARM:
1709   0A9E 31 00 FF        LD  SP, STACK
1710   0AA1 E5              PUSH HL                  ; Save HL
1711   0AA2 F5              PUSH AF                  ; Save AF
1712   0AA3 C3 69 0A        JP START_COM
1713   0AA6             
1714   0AA6             
1715   0AA6             ; =========================================================
1716   0AA6             ; HL = (HL)
1717   0AA6             ; =========================================================
1718   0AA6             LD_HL_HL:
1719   0AA6 7E          	LD      A,(HL)		;7
1720   0AA7 23          	INC     HL		;6
1721   0AA8 66          	LD      H,(HL)		;7
1722   0AA9 6F          	LD      L,A		;4
1723   0AAA C9          	RET			;10
1724   0AAB             
1725   0AAB             ; =========================================================
1726   0AAB             ; Delay
1727   0AAB             ; =========================================================
1728   0AAB             delay:
1729   0AAB C5          	push bc                       ; 2.75 us
1730   0AAC 06 FF           ld b, 255                     ; 1.75 us
1731   0AAE             delay_loop_b:
1732   0AAE 0E FF       	ld c, 255                     ; 1.75 us
1733   0AB0             delay_loop:
1734   0AB0 0D          	dec c                         ; 1 us
1735   0AB1 C2 B0 0A        jp nz, delay_loop             ; true = 3 us, false 1.75 us
1736   0AB4 05              dec b                         ; 1 us
1737   0AB5 C2 AE 0A        jp nz, delay_loop_b           ; true = 3 us, false 1.75 us
1738   0AB8 C1              pop bc                        ; 2.50 us
1739   0AB9 C9              ret                           ; 2.50 us
1740   0ABA             
1741   0ABA             
1742   0ABA             ;============================================================================
1743   0ABA             ;	Subroutine	Delay_A
1744   0ABA             ;
1745   0ABA             ;	Entry:	A = Millisecond count
1746   0ABA             ;============================================================================
1747   0ABA E5          DELAY_A:	PUSH	HL			; Save count
1748   0ABB 21 10 FF    		LD	HL,TicCounter
1749   0ABE 86          		ADD	A,(HL)			; A = cycle count
1750   0ABF BE          DlyLp		CP	(HL)			; Wait required TicCounter times
1751   0AC0 C2 BF 0A    		JP	NZ,DlyLp		;  loop if not done
1752   0AC3 E1          		POP	HL
1753   0AC4 C9          		RET
1754   0AC5             
1755   0AC5             
1756   0AC5 0E 01       DELAY_100mS	LD	C,1
1757   0AC7 C5          DELAY_C		PUSH	BC
1758   0AC8 06 00       		LD	B,0
1759   0ACA C5          DELAY_LP	PUSH	BC
1760   0ACB 10 FE       		DJNZ	$		;13   * 256 / 4 = 832uSec
1761   0ACD C1          		POP	BC
1762   0ACE 10 FA       		DJNZ	DELAY_LP	;~100mSEC
1763   0AD0 0D          		DEC	C
1764   0AD1 20 F7       		JR  NZ,	DELAY_LP	;*4 ~= 7mSec
1765   0AD3 C1          		POP	BC
1766   0AD4 C9          		RET
1767   0AD5             
1768   0AD5             ; Mapa char to display 0-F
1769   0AD5 3F065B4F666DLED_FONT .db $3F, $06, $5B, $4F, $66, $6D, $7D, $07, $7F, $67 ; 0-9
1769   0ADB 7D077F67
1770   0ADF 777C395E7971         .DB $77, $7C, $39, $5E, $79, $71                     ; A-F
1771   0AE5             
1772   0AE5             
1773   0AE5             
1774   0AE5             
1775   0AE5             ; ---------------------------------------------------------
1776   0AE5             ;   FFFFFFFF      I     MM           MM
1777   0AE5             ;   F             I     M  M       M  M
1778   0AE5             ;   F             I     M    M   M    M
1779   0AE5             ;   FFFFFFF       I     M      M      M
1780   0AE5             ;   F             I     M             M
1781   0AE5             ;   F             I     M             M
1782   0AE5             ;   F             I     M             M
1783   0AE5             ;
1784   0AE5             ; ---------------------------------------------------------
1785   0AE5             
1786   0AE5             
1787   0AE5             
1788   0AE5             
1789   0AE5             
1790   0AE5             
1791   0AE5             ; ---------------------------------------------------------
1792   0AE5             ; Utilitys Program .ORG 1000h
1793   0AE5             ; ---------------------------------------------------------
1794   1000             .org 1000h
1795   1000 C3 15 10    JP_CLEAR_RAM_FF              JP CLEAR_RAM_FF               ; 1000
1796   1003 C3 3F 10    JP_LOAD_FROM_IR              JP LOAD_FROM_IR               ; 1003
1797   1006 C3 A3 10    JP_TESTE_SOM                 JP TESTE_SOM                  ; 1006
1798   1009 C3 1C 11    JP_ANIMATE_LED1              JP ANIMATE_LED1               ; 1009
1799   100C C3 58 11    JP_COUNT_DOWN_ALERME         JP COUNT_DOWN_ALERME          ; 100C
1800   100F C3 FE 11    JP_CONTROLE_SONY             JP CONTROLE_SONY              ; 100F
1801   1012 C3 02 13    JP_CALC_SUM                  JP CALC_SUM                   ; 1012
1802   1015             
1803   1015             
1804   1015             
1805   1015             
1806   1015             
1807   1015             
1808   1015             
1809   1015             
1810   1015             ; ---------------------------------------------------------
1811   1015             ; RAM MAP - Utilitys Program | $FE00 - $FEFF
1812   1015             ; ---------------------------------------------------------
1813   1015             DIEGO      .equ    $FE00   ;(2) Temp Digits to countDown
1814   1015             
1815   1015             
1816   1015             ; ---------------------------------------------------------
1817   1015             ; Utilitys Program | CLEAR RAM
1818   1015             ; ---------------------------------------------------------
1819   1015             CLEAR_RAM_FF:
1820   1015 21 00 FE        LD  HL, $FE00
1821   1018 06 FF           LD  B, $FF
1822   101A             CLEAR_RAM_FF_LOOP:
1823   101A 2B              DEC HL
1824   101B 70              LD (HL), B
1825   101C 7C              LD A, H
1826   101D FE 80           CP $80
1827   101F CA 25 10        JP Z, CLEAR_RAM_FF_CHECK_L
1828   1022 C3 1A 10        JP CLEAR_RAM_FF_LOOP
1829   1025             
1830   1025             CLEAR_RAM_FF_CHECK_L:
1831   1025 7D              LD A, L
1832   1026 FE 00           CP $00
1833   1028 CA 2E 10        JP Z, CLEAR_RAM_FF_END
1834   102B C3 1A 10        JP CLEAR_RAM_FF_LOOP
1835   102E             CLEAR_RAM_FF_END:
1836   102E 3E C3           LD A, $C3
1837   1030 32 FD FD        LD ($FDFD), A
1838   1033 AF              XOR A
1839   1034 32 FE FD        LD ($FDFE), A
1840   1037 3E 80           LD A, $80
1841   1039 32 FF FD        LD ($FDFF), A
1842   103C CA 9B 0A        JP Z, START_LOOP
1843   103F             
1844   103F             
1845   103F             ; ---------------------------------------------------------
1846   103F             ; Utilitys Program | LOAD RAM FROM IR (NanoTac)
1847   103F             ; ---------------------------------------------------------
1848   103F             LOAD_FROM_IR:
1849   103F F3              DI                       ; deliga monitor (int38)
1850   1040 21 00 80        LD HL, $8000           ; inicio ram
1851   1043             LFI_START:
1852   1043 01 00 00        LD  BC, 0                ; B - time, C - Count
1853   1046 16 00           LD  D, 0                 ; D, Data
1854   1048             LFI_CK1:                         ; aguarda nivel 0
1855   1048 DB 40           IN A, (Port40)
1856   104A CB 7F           BIT 7, A
1857   104C C2 48 10        JP NZ, LFI_CK1
1858   104F             LFI_COD_START:               ; Recebe Start (9)
1859   104F 04              INC B                    ; B = time, INC B
1860   1050 CD F7 12        CALL CONTROLE_DELAY
1861   1053 DB 40           IN  A, (Port40)
1862   1055 CB 7F           BIT 7, A
1863   1057 CA 4F 10        JP Z, LFI_COD_START      ; loop até nivel 1
1864   105A             
1865   105A 78              LD A, B
1866   105B FE 09           CP 9                     ; start time = 9
1867   105D C2 43 10        JP NZ, LFI_START         ; se não é start - reinicia
1868   1060             
1869   1060             LFI_GET_NEXT:
1870   1060             ; agora começa a pegar os commandos
1871   1060 16 00           LD  D, 0                 ; zera data
1872   1062 0E 07           LD  C, 7                 ; data tem 8 bits
1873   1064             LFI_LOOP:                    ; Aguarda nivel 0
1874   1064 DB 40           IN A, (Port40)
1875   1066 CB 7F           BIT 7, A
1876   1068 C2 64 10        JP NZ, LFI_LOOP
1877   106B             
1878   106B 06 00           LD  B, 0                  ; B = time
1879   106D             LFI_LOOP2:                    ; Recebeu alguma coisa
1880   106D 04              INC B
1881   106E CD 98 10        CALL LFI_DELAY
1882   1071 DB 40           IN  A, (Port40)
1883   1073 CB 7F           BIT 7, A
1884   1075 CA 6D 10        JP Z, LFI_LOOP2  ; aguarda nivel 1
1885   1078             
1886   1078 78              LD A, B
1887   1079 FE 09           CP 9
1888   107B CA 5F 0A        JP Z, START              ; Back to minitor
1889   107E FE 05           CP 5                     ; 5 HIGH, 3 LOW
1890   1080 C2 85 10        JP NZ, LFI_ZERO
1891   1083 CB C2           SET 0, D
1892   1085             
1893   1085             LFI_ZERO:
1894   1085 79              LD A, C
1895   1086 FE 00           CP 0
1896   1088 CA 93 10        JP Z, LFI_BYTE_OK 
1897   108B             
1898   108B CB 02           RLC D
1899   108D 06 00           LD B, 0
1900   108F 0D              DEC C
1901   1090             
1902   1090 C3 64 10        JP LFI_LOOP
1903   1093             
1904   1093                 
1905   1093             
1906   1093             LFI_BYTE_OK:
1907   1093 72              LD  (HL), D
1908   1094 23              INC HL
1909   1095 C3 60 10        JP LFI_GET_NEXT
1910   1098             
1911   1098             
1912   1098             LFI_DELAY:
1913   1098 F5              PUSH AF
1914   1099 3E 32           LD A, 50
1915   109B             LFI_DELAY_LOOP:
1916   109B 3D              DEC A
1917   109C FE 00           CP 0
1918   109E C2 9B 10        JP NZ, LFI_DELAY_LOOP
1919   10A1 F1              POP AF
1920   10A2 C9              RET
1921   10A3             
1922   10A3             
1923   10A3             
1924   10A3             ; ---------------------------------------------------------
1925   10A3             ; Utilitys Program | TESTE SOM 
1926   10A3             ; 
1927   10A3             ; Key F     = $00 - $FF na saida C0
1928   10A3             ; Key A e B = Incrementa e Decrementa Saida C0
1929   10A3             ; ---------------------------------------------------------
1930   10A3             TESTE_SOM:
1931   10A3 3E 00           LD  A, 0
1932   10A5 32 0F FF        LD  (SYSMODE), A
1933   10A8 3E 00           LD  A, 0
1934   10AA 47              LD  B, A
1935   10AB CD 33 09        CALL CLEAR_USER_DISPLAY
1936   10AE 3E 6D           LD  A, $6D ; S
1937   10B0 32 D0 FF        LD  (USER_DISP0), A
1938   10B3 3E 3F           LD  A, $3F ; O
1939   10B5 32 D1 FF        LD  (USER_DISP1), A
1940   10B8 3E 1C           LD  A, $1C ; U
1941   10BA 32 D2 FF        LD  (USER_DISP2), A
1942   10BD 3E 54           LD  A, $54 ; N
1943   10BF 32 D3 FF        LD  (USER_DISP3), A
1944   10C2 3E 5E           LD  A, $5E ; D
1945   10C4 32 D4 FF        LD  (USER_DISP4), A
1946   10C7             LOOP_SOM:
1947   10C7 78              LD  A, B
1948   10C8 CD 50 09        CALL GET_NUM_FROM_LOW
1949   10CB 32 D7 FF        LD  (USER_DISP7), A
1950   10CE 78              LD  A, B
1951   10CF CD 60 09        CALL GET_NUM_FROM_HIGH
1952   10D2 32 D6 FF        LD  (USER_DISP6), A
1953   10D5             
1954   10D5 CD 5F 07        CALL GET_KEY_A
1955   10D8 FE 0A           CP  $0A
1956   10DA CA EA 10        JP  Z, SOM_INC
1957   10DD FE 0B           CP  $0B
1958   10DF CA F5 10        JP  Z, SOM_DEC
1959   10E2 FE 0F           CP  $0F
1960   10E4 CA 00 11        JP  Z, SOM_LOOP_INC
1961   10E7 C3 C7 10        JP  LOOP_SOM
1962   10EA             
1963   10EA             
1964   10EA             SOM_INC:
1965   10EA 04              INC B
1966   10EB 0E C0           LD  C, $C0
1967   10ED ED 41           OUT (C), B
1968   10EF CD C5 0A        CALL DELAY_100mS
1969   10F2 C3 C7 10        JP  LOOP_SOM
1970   10F5             
1971   10F5             SOM_DEC:
1972   10F5 05              DEC B
1973   10F6 0E C0           LD  C, $C0
1974   10F8 ED 41           OUT (C), B
1975   10FA CD C5 0A        CALL DELAY_100mS
1976   10FD C3 C7 10        JP  LOOP_SOM
1977   1100             
1978   1100             SOM_LOOP_INC:
1979   1100 78              LD  A, B
1980   1101 CD 50 09        CALL GET_NUM_FROM_LOW
1981   1104 32 D7 FF        LD  (USER_DISP7), A
1982   1107 78              LD  A, B
1983   1108 CD 60 09        CALL GET_NUM_FROM_HIGH
1984   110B 32 D6 FF        LD  (USER_DISP6), A
1985   110E 04              INC B
1986   110F 0E C0           LD  C, $C0
1987   1111 ED 41           OUT (C), B
1988   1113 CD C5 0A        CALL DELAY_100mS
1989   1116 CD C5 0A        CALL DELAY_100mS
1990   1119 C3 00 11        JP  SOM_LOOP_INC
1991   111C             
1992   111C             
1993   111C             ; ---------------------------------------------------------
1994   111C             ; Utilitys Program | Animação led
1995   111C             ; ---------------------------------------------------------
1996   111C             ANIMATE_LED1:
1997   111C CD 33 09        CALL CLEAR_USER_DISPLAY
1998   111F 3E 00           LD  A, 0                 ; user mode
1999   1121 32 0F FF        LD (SYSMODE), A
2000   1124             
2001   1124 06 08           LD  B, $08
2002   1126 21 D0 FF        LD  HL, USER_DISP0
2003   1129 3E 08           LD  A, 8
2004   112B             
2005   112B             LEDS_LOOP:
2006   112B CD 33 09        CALL CLEAR_USER_DISPLAY
2007   112E 70              LD  (HL), B
2008   112F CD C5 0A        CALL DELAY_100mS
2009   1132 23              INC HL
2010   1133 3D              DEC A
2011   1134 FE 00           CP 0
2012   1136 C2 2B 11        JP NZ, LEDS_LOOP
2013   1139             
2014   1139 3E 08           LD A, 8
2015   113B 21 D7 FF        LD  HL, USER_DISP7
2016   113E 06 40           LD  B, $40
2017   1140             
2018   1140             LEDS_LOOP2:
2019   1140 CD 33 09        CALL CLEAR_USER_DISPLAY
2020   1143 70              LD  (HL), B
2021   1144 CD C5 0A        CALL DELAY_100mS
2022   1147 2B              DEC HL
2023   1148 3D              DEC A
2024   1149 FE 00           CP 0
2025   114B C2 40 11        JP NZ, LEDS_LOOP2
2026   114E             
2027   114E 3E 08           LD  A, 8
2028   1150 21 D0 FF        LD  HL, USER_DISP0
2029   1153 06 08           LD  B, $08
2030   1155 C3 2B 11        JP LEDS_LOOP
2031   1158             
2032   1158             
2033   1158             ; ---------------------------------------------------------
2034   1158             ; Utilitys Program | CountDown XX
2035   1158             ; OBS: Usa a placa de som para o alarme
2036   1158             ; ---------------------------------------------------------
2037   1158             COUNT_DOWN_ALERME:
2038   1158                 ; timer count down
2039   1158             
2040   1158 CD 33 09        CALL CLEAR_USER_DISPLAY
2041   115B 3E 39           LD  A, $39
2042   115D 32 D0 FF        LD  (USER_DISP0), A
2043   1160             
2044   1160 3E 3F           LD  A, $3F
2045   1162 32 D1 FF        LD  (USER_DISP1), A
2046   1165             
2047   1165 3E 1C           LD  A, $1C
2048   1167 32 D2 FF        LD  (USER_DISP2), A
2049   116A             
2050   116A 3E 54           LD  A, $54
2051   116C 32 D3 FF        LD  (USER_DISP3), A
2052   116F             
2053   116F 3E 78           LD  A, $78
2054   1171 32 D4 FF        LD  (USER_DISP4), A
2055   1174             
2056   1174 3E 00           LD  A, $00
2057   1176 32 D5 FF        LD  (USER_DISP5), A
2058   1179             
2059   1179             
2060   1179             
2061   1179 3E 40           LD  A, $40
2062   117B 32 D6 FF        LD  (USER_DISP6), A
2063   117E             
2064   117E 3E 40           LD  A, $40
2065   1180 32 D7 FF        LD  (USER_DISP7), A
2066   1183             
2067   1183 3E 00           LD  A, 0                 ; user mode
2068   1185 32 0F FF        LD (SYSMODE), A
2069   1188             
2070   1188             READ:
2071   1188 CD 5F 07        CALL GET_KEY_A
2072   118B FE FF           CP  $FF
2073   118D CA 88 11        JP  Z, READ
2074   1190             
2075   1190 CD A1 11        CALL  MODIFY_KEY_POS_1D
2076   1193             
2077   1193             READ2
2078   1193 CD 5F 07        CALL GET_KEY_A
2079   1196 FE FF           CP  $FF
2080   1198 CA 93 11        JP  Z, READ2
2081   119B             
2082   119B CD AD 11        CALL MODIFY_KEY_POS_0D
2083   119E             
2084   119E C3 B8 11        JP  LOOP
2085   11A1             
2086   11A1             
2087   11A1             MODIFY_KEY_POS_1D:
2088   11A1 21 00 FE        LD  HL, DIEGO
2089   11A4 23              INC HL
2090   11A5 77              LD  (HL), A
2091   11A6 CD 50 09        CALL GET_NUM_FROM_LOW
2092   11A9 32 D6 FF        LD  (USER_DISP6), A
2093   11AC C9              RET
2094   11AD             
2095   11AD             MODIFY_KEY_POS_0D:
2096   11AD 21 00 FE        LD  HL, DIEGO
2097   11B0 77              LD  (HL), A
2098   11B1 CD 50 09        CALL GET_NUM_FROM_LOW
2099   11B4 32 D7 FF        LD  (USER_DISP7), A
2100   11B7 C9              RET
2101   11B8             
2102   11B8             LOOP:
2103   11B8 2A 00 FE        LD  HL, (DIEGO)
2104   11BB             
2105   11BB             LOOP_DOWN:
2106   11BB 7C              LD  A, H
2107   11BC CD 50 09        CALL GET_NUM_FROM_LOW
2108   11BF 32 D6 FF        LD  (USER_DISP6), A
2109   11C2             
2110   11C2 7D              LD  A, L
2111   11C3 CD 50 09        CALL GET_NUM_FROM_LOW
2112   11C6 32 D7 FF        LD  (USER_DISP7), A
2113   11C9             
2114   11C9 0E 07           LD C, 7    ; 10 x 100ms = 1seg
2115   11CB CD C7 0A        CALL DELAY_C
2116   11CE             
2117   11CE 7D              LD A, L
2118   11CF FE 00           CP 0
2119   11D1 CA D9 11        JP Z, DEC_H
2120   11D4 3D              DEC A
2121   11D5 6F              LD L, A
2122   11D6 C3 BB 11        JP LOOP_DOWN
2123   11D9             
2124   11D9             DEC_H:
2125   11D9 7C              LD  A, H
2126   11DA FE 00           CP 0
2127   11DC CA E7 11        JP Z, CHECK_L
2128   11DF 3D              DEC A
2129   11E0 67              LD H, A
2130   11E1 3E 09           LD A, 9
2131   11E3 6F              LD L, A
2132   11E4 C3 BB 11        JP LOOP_DOWN
2133   11E7             
2134   11E7             CHECK_L:
2135   11E7 7D              LD  A, L
2136   11E8 FE 00           CP 0
2137   11EA CA ED 11        JP Z, BEEP
2138   11ED             
2139   11ED             BEEP:
2140   11ED 3E 80           LD  A, $80
2141   11EF D3 C0           OUT  (PortC0), A
2142   11F1 CD C5 0A        CALL DELAY_100mS
2143   11F4             
2144   11F4 3E C0           LD  A, $C0
2145   11F6 D3 C0           OUT  (PortC0), A
2146   11F8 CD C5 0A        CALL DELAY_100mS
2147   11FB C3 ED 11        JP BEEP
2148   11FE             
2149   11FE             
2150   11FE             ; ---------------------------------------------------------
2151   11FE             ; Utilitys Program | IR Sensor
2152   11FE             ; ---------------------------------------------------------
2153   11FE             CONTROLE_SONY:
2154   11FE 3E 00           LD A, 0
2155   1200 32 00 80        LD ($8000), A            ; BUzzer
2156   1203             CONTROLE_IR:
2157   1203 F3              DI                       ; deliga monitor (int38)
2158   1204             
2159   1204 01 00 00        LD  BC, 0                ; B - time, C - Count
2160   1207 16 00           LD  D, 0                 ; D, Data
2161   1209             CIR:                         ; aguarda nivel 0
2162   1209 DB 40           IN A, (Port40)
2163   120B CB 7F           BIT 7, A
2164   120D C2 09 12        JP NZ, CIR
2165   1210             CIR_START:                   ; Recebe Start (9)
2166   1210 04              INC B                    ; B = time, INC B
2167   1211 CD F7 12        CALL CONTROLE_DELAY
2168   1214 DB 40           IN  A, (Port40)
2169   1216 CB 7F           BIT 7, A
2170   1218 CA 10 12        JP Z, CIR_START          ; loop até nivel 1
2171   121B             
2172   121B 78              LD A, B
2173   121C FE 09           CP 9                     ; start time = 9
2174   121E C2 03 12        JP NZ, CONTROLE_IR       ; se não é start - reinicia
2175   1221             
2176   1221             ; agora começa a pegar os commandos
2177   1221 16 00           LD  D, 0                     ; zera data
2178   1223 0E 06           LD  C, 6                     ; data tem 7 bits
2179   1225             CONTROLE_IR_LOOP:            ; Aguarda nivel 0
2180   1225 DB 40           IN A, (Port40)
2181   1227 CB 7F           BIT 7, A
2182   1229 C2 25 12        JP NZ, CONTROLE_IR_LOOP
2183   122C             
2184   122C 06 00           LD  B, 0                ; B = time
2185   122E             CONTROLE_IR_LOOP2:           ; Recebeu alguma coisa
2186   122E 04              INC B
2187   122F CD F7 12        CALL CONTROLE_DELAY
2188   1232 DB 40           IN  A, (Port40)
2189   1234 CB 7F           BIT 7, A
2190   1236 CA 2E 12        JP Z, CONTROLE_IR_LOOP2  ; aguarda nivel 1
2191   1239             
2192   1239 78              LD A, B
2193   123A FE 05           CP 5                     ; 5 HIGH, 3 LOW
2194   123C C2 41 12        JP NZ, CIR_ZERO
2195   123F CB C2           SET 0, D
2196   1241             
2197   1241             CIR_ZERO:
2198   1241 79              LD A, C
2199   1242 FE 00           CP 0
2200   1244 CA 4F 12        JP Z, CONTROLE_OK 
2201   1247             
2202   1247 CB 02           RLC D
2203   1249 06 00           LD B, 0
2204   124B 0D              DEC C
2205   124C             
2206   124C C3 25 12        JP CONTROLE_IR_LOOP
2207   124F             
2208   124F                 
2209   124F             
2210   124F             CONTROLE_OK:
2211   124F 7A              LD  A, D
2212   1250 32 00 90        LD ($9000), A           ; Save data $9000
2213   1253             
2214   1253             ; commando recebido em D
2215   1253 7A              LD A, D
2216   1254 FE 53           CP $53                   ; ok
2217   1256 CA DB 12        JP Z, CIR_OK
2218   1259 FE 63           CP $63                   ; Exit
2219   125B CA EE 12        JP Z, CIR_SAIR
2220   125E FE 54           CP $54                   ; power
2221   1260 CA C8 12        JP Z, CIR_TOGGLE_BUZZER
2222   1263 FE 52           CP $52
2223   1265 CA 7C 12        JP Z, CIR_R              ; red
2224   1268 FE 32           CP $32
2225   126A CA 8F 12        JP Z, CIR_G              ; green
2226   126D FE 72           CP $72
2227   126F CA A2 12        JP Z, CIR_Y              ; yellow
2228   1272 FE 12           CP $12
2229   1274 CA B5 12        JP Z, CIR_B              ; blue
2230   1277             
2231   1277 D3 40           OUT (Port40), A
2232   1279 C3 03 12        JP CONTROLE_IR
2233   127C             
2234   127C             
2235   127C             CIR_R:
2236   127C 3A 00 80        LD A, ($8000)
2237   127F EE 20           XOR $20
2238   1281 D3 C0           OUT (PortC0), A
2239   1283 32 00 80        LD ($8000), A
2240   1286 CD C5 0A        CALL DELAY_100mS
2241   1289 CD C5 0A        CALL DELAY_100mS
2242   128C C3 03 12        JP CONTROLE_IR
2243   128F             
2244   128F             CIR_G:
2245   128F 3A 00 80        LD A, ($8000)
2246   1292 EE 80           XOR $80
2247   1294 D3 C0           OUT (PortC0), A
2248   1296 32 00 80        LD ($8000), A
2249   1299 CD C5 0A        CALL DELAY_100mS
2250   129C CD C5 0A        CALL DELAY_100mS
2251   129F C3 03 12        JP CONTROLE_IR
2252   12A2             
2253   12A2             CIR_Y:
2254   12A2 3A 00 80        LD A, ($8000)
2255   12A5 EE 40           XOR $40
2256   12A7 D3 C0           OUT (PortC0), A
2257   12A9 32 00 80        LD ($8000), A
2258   12AC CD C5 0A        CALL DELAY_100mS
2259   12AF CD C5 0A        CALL DELAY_100mS
2260   12B2 C3 03 12        JP CONTROLE_IR
2261   12B5             
2262   12B5             CIR_B:
2263   12B5 3A 00 80        LD A, ($8000)
2264   12B8 EE 10           XOR $10
2265   12BA D3 C0           OUT (PortC0), A
2266   12BC 32 00 80        LD ($8000), A
2267   12BF CD C5 0A        CALL DELAY_100mS
2268   12C2 CD C5 0A        CALL DELAY_100mS
2269   12C5 C3 03 12        JP CONTROLE_IR
2270   12C8             
2271   12C8             
2272   12C8             CIR_TOGGLE_BUZZER:
2273   12C8 3A 00 80        LD A, ($8000)
2274   12CB EE 08           XOR $08
2275   12CD D3 C0           OUT (PortC0), A
2276   12CF 32 00 80        LD ($8000), A
2277   12D2 CD C5 0A        CALL DELAY_100mS
2278   12D5 CD C5 0A        CALL DELAY_100mS
2279   12D8 C3 03 12        JP CONTROLE_IR
2280   12DB             
2281   12DB             CIR_OK:
2282   12DB 3A 00 80        LD A, ($8000)
2283   12DE EE 01           XOR $01
2284   12E0 D3 C0           OUT (PortC0), A
2285   12E2 32 00 80        LD ($8000), A
2286   12E5 CD C5 0A        CALL DELAY_100mS
2287   12E8 CD C5 0A        CALL DELAY_100mS
2288   12EB C3 03 12        JP CONTROLE_IR
2289   12EE             
2290   12EE             CIR_SAIR:
2291   12EE                 ; retorna int
2292   12EE ED 56           IM  1
2293   12F0 FB              EI
2294   12F1 AF              XOR A
2295   12F2 D3 40           OUT (Port40), A
2296   12F4                 
2297   12F4             CONTROLE_IR_LOOP3:
2298   12F4 C3 F4 12        JP CONTROLE_IR_LOOP3
2299   12F7             
2300   12F7             
2301   12F7             CONTROLE_DELAY:
2302   12F7 F5              PUSH AF
2303   12F8 3E 32           LD A, 50
2304   12FA             CONTROLE_DELAY_LOOP:
2305   12FA 3D              DEC A
2306   12FB FE 00           CP 0
2307   12FD C2 FA 12        JP NZ, CONTROLE_DELAY_LOOP
2308   1300 F1              POP AF
2309   1301 C9              RET
2310   1302             
2311   1302             
2312   1302             
2313   1302             ; ---------------------------------------------------------
2314   1302             ; Utilitys Program | PROGRAM CALC XX + XX 
2315   1302             ; ---------------------------------------------------------
2316   1302             CALC_SUM:
2317   1302             NUM1     .equ      $8000
2318   1302             NUM2     .equ      $8001
2319   1302             RESULT1  .equ      $8002
2320   1302             RESULT2  .equ      $8003
2321   1302             
2322   1302 3E 00           LD  A, 0                 ; user mode
2323   1304 32 0F FF        LD (SYSMODE), A
2324   1307             
2325   1307 CD 33 09        CALL CLEAR_USER_DISPLAY
2326   130A             
2327   130A 3E 40           LD  A, $40
2328   130C 32 D6 FF        LD  (USER_DISP6), A
2329   130F             
2330   130F 3E 40           LD  A, $40
2331   1311 32 D7 FF        LD  (USER_DISP7), A
2332   1314             
2333   1314 3E 00           LD A, 0
2334   1316 32 02 80        LD (RESULT1), A
2335   1319 32 03 80        LD (RESULT2), A
2336   131C             
2337   131C             READ01:
2338   131C CD 5F 07        CALL GET_KEY_A
2339   131F FE FF           CP  $FF
2340   1321 CA 1C 13        JP  Z, READ01
2341   1324 F5              PUSH AF
2342   1325 CB 07           RLC A
2343   1327 CB 07           RLC A
2344   1329 CB 07           RLC A
2345   132B CB 07           RLC A
2346   132D 32 00 80        LD  (NUM1), A
2347   1330 F1              POP AF
2348   1331 CD 50 09        CALL GET_NUM_FROM_LOW
2349   1334 32 D6 FF        LD (USER_DISP6), A
2350   1337             
2351   1337             READ02:
2352   1337 CD 5F 07        CALL GET_KEY_A
2353   133A FE FF           CP  $FF
2354   133C CA 37 13        JP  Z, READ02
2355   133F F5              PUSH AF
2356   1340 47              LD B, A
2357   1341 3A 00 80        LD A, (NUM1)
2358   1344 B0              OR B
2359   1345 32 00 80        LD (NUM1), A
2360   1348             
2361   1348 F1              POP AF
2362   1349 CD 50 09        CALL GET_NUM_FROM_LOW
2363   134C 32 D7 FF        LD (USER_DISP7), A
2364   134F             
2365   134F 3E FF           LD A, $FF
2366   1351 CD BA 0A        CALL DELAY_A
2367   1354             ; NUM2
2368   1354 3E 40           LD  A, $40
2369   1356 32 D6 FF        LD  (USER_DISP6), A
2370   1359             
2371   1359 3E 40           LD  A, $40
2372   135B 32 D7 FF        LD  (USER_DISP7), A
2373   135E             
2374   135E             READ03:
2375   135E CD 5F 07        CALL GET_KEY_A
2376   1361 FE FF           CP  $FF
2377   1363 CA 5E 13        JP  Z, READ03
2378   1366 F5              PUSH AF
2379   1367 CB 07           RLC A
2380   1369 CB 07           RLC A
2381   136B CB 07           RLC A
2382   136D CB 07           RLC A
2383   136F 32 01 80        LD  (NUM2), A
2384   1372 F1              POP AF
2385   1373 CD 50 09        CALL GET_NUM_FROM_LOW
2386   1376 32 D6 FF        LD (USER_DISP6), A
2387   1379             
2388   1379             READ04:
2389   1379 CD 5F 07        CALL GET_KEY_A
2390   137C FE FF           CP  $FF
2391   137E CA 79 13        JP  Z, READ04
2392   1381             
2393   1381 F5              PUSH AF
2394   1382 CD 50 09        CALL GET_NUM_FROM_LOW
2395   1385 32 D7 FF        LD (USER_DISP7), A
2396   1388 F1              POP AF
2397   1389 47              LD B, A
2398   138A 3A 01 80        LD A, (NUM2)
2399   138D B0              OR B
2400   138E 32 01 80        LD (NUM2), A
2401   1391             
2402   1391 3A 00 80        LD A, (NUM1)
2403   1394 47              LD B, A
2404   1395 3A 01 80        LD A, (NUM2)
2405   1398 80              ADD A, B
2406   1399 27              DAA
2407   139A 32 03 80        LD (RESULT2), A
2408   139D             
2409   139D D2 A7 13        JP NC, CALC_SUM_SHOW
2410   13A0 3A 02 80        LD A, (RESULT1)
2411   13A3 3C              INC A
2412   13A4 32 02 80        LD (RESULT1),A
2413   13A7             
2414   13A7             CALC_SUM_SHOW:
2415   13A7 3E FF           LD A, $FF
2416   13A9 CD BA 0A        CALL DELAY_A
2417   13AC             
2418   13AC 3A 02 80        LD A, (RESULT1)
2419   13AF FE 00           CP 0
2420   13B1 CA BA 13        JP Z, SHOW_NEXT
2421   13B4 CD 50 09        CALL GET_NUM_FROM_LOW
2422   13B7 32 D5 FF        LD (USER_DISP5), A
2423   13BA             
2424   13BA             SHOW_NEXT:
2425   13BA 3A 03 80        LD A, (RESULT2)
2426   13BD CD 60 09        CALL GET_NUM_FROM_HIGH
2427   13C0 32 D6 FF        LD (USER_DISP6), A
2428   13C3             
2429   13C3 3A 03 80        LD A, (RESULT2)
2430   13C6 CD 50 09        CALL GET_NUM_FROM_LOW
2431   13C9 32 D7 FF        LD (USER_DISP7), A
2432   13CC             
2433   13CC             CALC_SUM_LOOP:
2434   13CC C3 CC 13        JP  CALC_SUM_LOOP
2435   13CF             
2436   13CF             
2437   13CF             ; ---------------------------------------------------------
2438   13CF             ; Utilitys Program | PROGRAM X
2439   13CF             ; ---------------------------------------------------------
2440   13CF 3E 00           LD  A, 0                 ; user mode
2441   13D1 32 0F FF        LD (SYSMODE), A
2442   13D4             
2443   13D4             
2444   13D4             ; =========================================================
2445   13D4             ; Tabela display
2446   13D4             ; =========================================================
2447   13D4             ; 
2448   13D4             ;   0 - $3F     A - $77     K - $7A     U - $1C     . - $80
2449   13D4             ;   1 - $06     B - $7C     L - $38     V - $3E     Ñ - $55
2450   13D4             ;   2 - $5B     C - $39     M - $37     W - $1D     : - $41
2451   13D4             ;   3 - $4F     D - $5E     N - $54     X - $70     ; - $88
2452   13D4             ;   4 - $66     E - $79     O - $3F     Y - $6E     _ - $08
2453   13D4             ;   5 - $6D     F - $71     P - $73     Z - $49     ~ - $01
2454   13D4             ;   6 - $7D     G - $6F     Q - $67                 ' - $20
2455   13D4             ;   7 - $07     H - $76     R - $50     + - $46     
2456   13D4             ;   8 - $7F     I - $06     S - $6D     , - $04     
2457   13D4             ;   9 - $67     J - $1E     T - $78     - - $40     
2458   13D4             
2459   13D4             .end
tasm: Number of errors = 0
