0001   0000             ; ---------------------------------------------------------
0002   0000             ;   Z80 Mini  -  inicio 01/2022
0003   0000             ;   Diego Cruz - github.com/diego123cruz
0004   0000             ;
0005   0000             ;   Hardware baseado em: http://www.sunrise-ev.com/z80.htm
0006   0000             ;   Software próprio - em construção
0007   0000             ; ---------------------------------------------------------
0008   0000             ;   Z80@4Mhz
0009   0000             ;   ROM 32k - 28C256
0010   0000             ;   RAM 32k - 65256
0011   0000             ;   Display 7 segmentos 8 digitos
0012   0000             ;   Teclado 16 teclas + Fn (Tecla de função? ou outra coisa?)
0013   0000             ;   Entrada 40h
0014   0000             ;   Saida 40h
0015   0000             ;
0016   0000             ;
0017   0000             ; ---------------------------------------------------------
0018   0000             ;   Display 7 Segmentos - In(Port40) AND 00000111b
0019   0000             ; ---------------------------------------------------------
0020   0000             ;
0021   0000             ;   ------------------------------------------------
0022   0000             ;   | 00h | 01h | 02h | 03h | 04h | 05h | 06h | 07h |
0023   0000             ;   ------------------------------------------------
0024   0000             ;
0025   0000             ;               A(0)
0026   0000             ;            ---------
0027   0000             ;           |         |
0028   0000             ;      F(5) |         | B(1)
0029   0000             ;           |   G(6)  |
0030   0000             ;            ---------
0031   0000             ;           |         |
0032   0000             ;      E(4) |         | C(2)
0033   0000             ;           |         |
0034   0000             ;            ---------         Ponto(7)
0035   0000             ;               D(3) 
0036   0000             ;
0037   0000             ;
0038   0000             ;
0039   0000             ;
0040   0000             ;
0041   0000             ; ---------------------------------------------------------
0042   0000             ; Teclado 
0043   0000             ; ---------------------------------------------------------
0044   0000             ;   
0045   0000             ;   Keys:        
0046   0000             ;       Fn - In(Port40) AND 00010000b - pulldown
0047   0000             ;       0 - In(Port40) AND 00000111b
0048   0000             ;
0049   0000             ;
0050   0000             ;
0051   0000             ;
0052   0000             
0053   0000             
0054   0000             ; ---------------------------------------------------------
0055   0000             ; Constantes
0056   0000             ; ---------------------------------------------------------
0057   0000             
0058   0000             Port40        .equ    $40
0059   0000             PortC0        .equ    $C0
0060   0000             START_RAM     .equ    $8000
0061   0000             STACK         .equ    $FF00  
0062   0000             CKEY_TIMEOUT  .equ    100  ; 100ms +-
0063   0000             
0064   0000             ; ---------------------------------------------------------
0065   0000             ; RAM MAP - Monitor | $FF00 - $FFFF
0066   0000             ; ---------------------------------------------------------
0067   0000             ; Cada digito fica em um ponto da memoria RAM
0068   0000             DIG_0       .equ    $FF00   ;(1) endereço do digito 0 na memoria RAM
0069   0000             DIG_1       .equ    $FF01   ;(1) endereço do digito 1 na memoria RAM
0070   0000             DIG_2       .equ    $FF02   ;(1) endereço do digito 2 na memoria RAM
0071   0000             DIG_3       .equ    $FF03   ;(1) endereço do digito 3 na memoria RAM
0072   0000             DIG_4       .equ    $FF04   ;(1) endereço do digito 4 na memoria RAM
0073   0000             DIG_5       .equ    $FF05   ;(1) endereço do digito 5 na memoria RAM
0074   0000             DIG_6       .equ    $FF06   ;(1) endereço do digito 6 na memoria RAM
0075   0000             DIG_7       .equ    $FF07   ;(1) endereço do digito 7 na memoria RAM
0076   0000             KEY_PRESS   .equ    $FF08   ;(1) key atual
0077   0000             INPUT       .equ    $FF09   ;(1) temp input from int
0078   0000             TMP_KEY     .equ    $FF0A   ;(1) tmp key
0079   0000             KEY_TIMEOUT .equ    $FF0B   ;(1) tempo para retornar a tecla, CKEY_TIMEOUT
0080   0000             SHOW_DIG    .equ    $FF0C   ;(1) Atual digito no display
0081   0000             PC_RAM      .equ    $FF0D   ;(2) save pc to user start $8000
0082   0000             
0083   0000             SYSMODE     .equ    $FF0F   ;(1) System mode. 
0084   0000                                         ; 0 - User Mode
0085   0000                                         ; 1 - Monitor
0086   0000                                         ; 2 - Examine Memoria
0087   0000                                         ; 3 - Change Data(Memory)
0088   0000                                         ; 4 - Show register PC
0089   0000                                         ; 5 - Show register SP
0090   0000                                         ; 6 - Show register AF
0091   0000                                         ; 7 - Show register BC
0092   0000                                         ; 8 - Show register DE
0093   0000                                         ; 9 - Show register HL
0094   0000                                         ; A - Show register IX
0095   0000                                         ; B - Show register IY
0096   0000                                         ; C - Show register AF'
0097   0000                                         ; D - Show register BC'
0098   0000                                         ; E - Show register DE'
0099   0000                                         ; F - Show register HL'
0100   0000                                         ; 76 - HALT
0101   0000             TicCounter  .equ    $FF10   ;(2) TicCounter inc 1ms
0102   0000             EXM_COUNT   .equ    $FF12   ;(1) Count digits Examine function, 4 digits
0103   0000             MDF_COUNT   .equ    $FF13   ;(1) Count digits moDify function, 2 digits
0104   0000             USR_PC      .equ    $FF14   ;(2) PC 
0105   0000             USR_SP      .equ    $FF16   ;(2) SP
0106   0000             USR_HL      .equ    $FF18   ;(2) HL
0107   0000             USR_BC      .equ    $FF1A   ;(2) BC
0108   0000             USR_DE      .equ    $FF1C   ;(2) DE
0109   0000             USR_AF      .equ    $FF1E   ;(2) AF
0110   0000             USR_IX      .equ    $FF20   ;(2) IX
0111   0000             USR_IY      .equ    $FF22   ;(2) IY
0112   0000             USR_AFA     .equ    $FF24   ;(2) AF' (Aux)
0113   0000             USR_BCA     .equ    $FF26   ;(2) BC' (Aux)
0114   0000             USR_DEA     .equ    $FF28   ;(2) DE' (Aux)
0115   0000             USR_HLA     .equ    $FF2A   ;(2) HL' (Aux)
0116   0000             ; SP Temp   .equ    $FF2C
0117   0000             CPU_FLAGS   .equ    $FF2C   ;(1) Flags atual (AF ou AF') SYSMODE
0118   0000             
0119   0000             
0120   0000             
0121   0000             ; Copy USER_DISPx to DIG_x WHEN USER_MODE
0122   0000             USER_DISP0  .equ    $FFD0   ; Mode User - Display Dig 0  - 01234567
0123   0000             USER_DISP1  .equ    $FFD1   ; Mode User - Display Dig 1  - 01234567
0124   0000             USER_DISP2  .equ    $FFD2   ; Mode User - Display Dig 2  - 01234567
0125   0000             USER_DISP3  .equ    $FFD3   ; Mode User - Display Dig 3  - 01234567
0126   0000             USER_DISP4  .equ    $FFD4   ; Mode User - Display Dig 4  - 01234567
0127   0000             USER_DISP5  .equ    $FFD5   ; Mode User - Display Dig 5  - 01234567
0128   0000             USER_DISP6  .equ    $FFD6   ; Mode User - Display Dig 6  - 01234567
0129   0000             USER_DISP7  .equ    $FFD7   ; Mode User - Display Dig 7  - 01234567
0130   0000             
0131   0000             
0132   0000             
0133   0000             ; =========================================================
0134   0000             ; Start ROM
0135   0000             ; =========================================================
0136   0000             .org    $0000
0137   0000 C3 67 0A        JP  START
0138   0003             
0139   0003             ; =========================================================
0140   0003             ; Livre para colocar funções 0003h - 0037h 
0141   0003             ; =========================================================
0142   0003             
0143   0003             ; DELAY_100mS
0144   0003             
0145   0003             ; char7segFromA
0146   0003             
0147   0003             ; animacaoLeds
0148   0003             
0149   0003             ; Limpar RAM (FF).... etc
0150   0003             
0151   0003             
0152   0003             ; =========================================================
0153   0003             ; Int 38h - Monitor 
0154   0003             ; =========================================================
0155   0038             .org    $38
0156   0038 C3 8D 00        JP INT38
0157   003B             
0158   003B             ; =========================================================
0159   003B             ; Int 66h - HALT (Pin HALT is connected to NMI)
0160   003B             ; =========================================================
0161   0066             .org    $66
0162   0066 F3              DI                       ; Disable interrupt
0163   0067             
0164   0067 ED 73 16 FF     LD (USR_SP), SP          ; Save SP
0165   006B 22 18 FF        LD (USR_HL), HL          ; Save HL
0166   006E E1              POP  HL                  ; Recupera PC da stack
0167   006F 22 14 FF        LD (USR_PC), HL          ; Save PC
0168   0072 E5              PUSH HL                  ;
0169   0073 21 2C FF        LD HL, $FF2C             ; Carrega Temp SP to HL
0170   0076 F9              LD SP, HL                ; Set temp HL
0171   0077 D9              EXX                      ; Inverte HL e HL', DE.... BC....
0172   0078 E5              PUSH  HL                 ; Save HL'
0173   0079 D5              PUSH  DE                 ; Save DE'                
0174   007A C5              PUSH  BC                 ; Save BC'
0175   007B 08              EX    AF, AF'
0176   007C F5              PUSH  AF                 ; Save AF'
0177   007D 08              EX    AF, AF'
0178   007E D9              EXX                      ; Troca HL' e HL,, DE... BC...
0179   007F FD E5           PUSH  IY                 ; Save IY
0180   0081 DD E5           PUSH  IX                 ; Save IX
0181   0083 F5              PUSH  AF                 ; Save AF
0182   0084 D5              PUSH  DE                 ; Save DE
0183   0085 C5              PUSH  BC                 ; Save BC
0184   0086 2A 16 FF        LD HL, (USR_SP)          ; Recupera SP
0185   0089 F9              LD SP, HL                ; Devolve SP original
0186   008A             
0187   008A C3 FA 08        JP GO_HALT
0188   008D             
0189   008D             
0190   008D             
0191   008D             INT38:
0192   008D F3              DI                       ; Disable interrupt
0193   008E             
0194   008E ED 73 16 FF     LD (USR_SP), SP          ; Save SP
0195   0092 22 18 FF        LD (USR_HL), HL          ; Save HL
0196   0095 E1              POP  HL                  ; Recupera PC da stack
0197   0096 22 14 FF        LD (USR_PC), HL          ; Save PC
0198   0099 E5              PUSH HL                  ;
0199   009A 21 2C FF        LD HL, $FF2C             ; Carrega Temp SP to HL
0200   009D F9              LD SP, HL                ; Set temp HL
0201   009E D9              EXX                      ; Inverte HL e HL', DE.... BC....
0202   009F E5              PUSH  HL                 ; Save HL'
0203   00A0 D5              PUSH  DE                 ; Save DE'                
0204   00A1 C5              PUSH  BC                 ; Save BC'
0205   00A2 08              EX    AF, AF'
0206   00A3 F5              PUSH  AF                 ; Save AF'
0207   00A4 08              EX    AF, AF'
0208   00A5 D9              EXX                      ; Troca HL' e HL,, DE... BC...
0209   00A6 FD E5           PUSH  IY                 ; Save IY
0210   00A8 DD E5           PUSH  IX                 ; Save IX
0211   00AA F5              PUSH  AF                 ; Save AF
0212   00AB D5              PUSH  DE                 ; Save DE
0213   00AC C5              PUSH  BC                 ; Save BC
0214   00AD 2A 16 FF        LD HL, (USR_SP)          ; Recupera SP
0215   00B0 F9              LD SP, HL                ; Devolve SP original
0216   00B1             
0217   00B1                 ; TicCounter
0218   00B1 2A 10 FF        LD  HL, (TicCounter)     ; Increment 1ms, used to DELAY_A
0219   00B4 23              INC  HL
0220   00B5 22 10 FF        LD  (TicCounter), HL
0221   00B8             
0222   00B8                 ; Timeout Key
0223   00B8 3A 0B FF         LD A, (KEY_TIMEOUT)
0224   00BB FE 00            CP 0
0225   00BD CA C4 00         JP Z, ENTER_MAIN
0226   00C0 3D               DEC A
0227   00C1 32 0B FF         LD (KEY_TIMEOUT), A
0228   00C4             
0229   00C4                 ; Main
0230   00C4             ENTER_MAIN:
0231   00C4 CD FF 00        CALL UPDATE_DISPLAYS
0232   00C7 CD 1B 01        CALL UPDATE_KEYS
0233   00CA CD 6A 01        CALL UPDATE_FLAGS
0234   00CD             
0235   00CD                 ; Show atual digit
0236   00CD 3A 0C FF        LD  A, (SHOW_DIG)
0237   00D0 D3 40           OUT (Port40), A
0238   00D2             
0239   00D2                 ;CALL    TRATAMENTO_INT38H; Get key, update display   
0240   00D2 C3 1A 02        JP      SYS_MAIN         ; Execute function monitor
0241   00D5             
0242   00D5             EXIT_SYS:
0243   00D5 E1              POP HL                   ; Troca o PC
0244   00D6 2A 14 FF        LD HL, (USR_PC)          ; Recupera PC
0245   00D9 E5              PUSH HL                  ; Devolve PC to stack
0246   00DA             
0247   00DA 2A 24 FF        LD HL, (USR_AFA)          ; Load AF' in HL
0248   00DD E5              PUSH  HL                 ; Push AF'
0249   00DE F1              POP AF                   ; Recovery AF'
0250   00DF 08              EX AF, AF'
0251   00E0             
0252   00E0 2A 2A FF        LD HL, (USR_HLA)          ; Recovery HL'
0253   00E3 ED 5B 28 FF     LD DE, (USR_DEA)          ; Recovery DE'
0254   00E7 ED 4B 26 FF     LD BC, (USR_BCA)          ; Recovery BC'
0255   00EB D9              EXX
0256   00EC             
0257   00EC 2A 1E FF        LD HL, (USR_AF)          ; Load AF in HL
0258   00EF E5              PUSH  HL                 ; Push AF
0259   00F0 F1              POP AF                   ; Recovery AF
0260   00F1             
0261   00F1 2A 18 FF        LD HL, (USR_HL)          ; Recovery HL
0262   00F4 ED 5B 1C FF     LD DE, (USR_DE)          ; Recovery DE
0263   00F8 ED 4B 1A FF     LD BC, (USR_BC)          ; Recovery BC
0264   00FC             
0265   00FC FB              EI                       ; Enable interrupt
0266   00FD ED 4D           RETI                     ; Return interrupt
0267   00FF             
0268   00FF             
0269   00FF             ; =========================================================
0270   00FF             ; Update display - Tratamento Int 38h
0271   00FF             ; =========================================================
0272   00FF             UPDATE_DISPLAYS:    
0273   00FF DB 40           IN    A, (Port40)
0274   0101 32 09 FF        LD    (INPUT), A
0275   0104 E6 07           AND   $07
0276   0106 FE 08           CP    $08
0277   0108 D2 1A 01        JP    NC, UPDATE_DISPLAYS_RET ; IF A > 7 RET
0278   010B 3C              INC   A
0279   010C FE 08           CP    $08
0280   010E C2 13 01        JP    NZ, UPDATE_DISPLAYS_OK
0281   0111 3E 00           LD    A, $00
0282   0113             UPDATE_DISPLAYS_OK:
0283   0113 26 FF           LD    H, $FF
0284   0115 6F              LD    L, A
0285   0116 7E              LD    A, (HL)
0286   0117 32 0C FF        LD   (SHOW_DIG), A
0287   011A             UPDATE_DISPLAYS_RET:
0288   011A C9              RET
0289   011B             
0290   011B             ; =========================================================
0291   011B             ; Update KEY - Tratamento Int 38h
0292   011B             ; =========================================================
0293   011B             UPDATE_KEYS:    
0294   011B DB 40           IN    A, (Port40)
0295   011D 32 09 FF        LD    (INPUT), A
0296   0120 E6 07           AND   $07
0297   0122 FE 08           CP    $08
0298   0124 D2 4D 01        JP    NC, UPDATE_KEY_RET ; IF A > 7 RET
0299   0127 3A 09 FF        LD  A,  (INPUT)
0300   012A CB 5F           BIT  3, A
0301   012C CA 4E 01        JP  Z, TRATAB3
0302   012F 3A 09 FF        LD  A,  (INPUT)
0303   0132 CB 67           BIT  4, A
0304   0134 CA 54 01        JP  Z, TRATAB4
0305   0137 C3 4D 01        JP  UPDATE_KEY_RET
0306   013A             UPDATE_KEY_GET:
0307   013A 32 09 FF        LD    (INPUT), A
0308   013D E6 07           AND   $07
0309   013F 01 00 00        LD    BC, 0
0310   0142 4F              LD    C, A
0311   0143 09              ADD   HL, BC
0312   0144 7E              LD    A, (HL)
0313   0145 32 08 FF        LD   (KEY_PRESS), A
0314   0148 3E 64           LD A, CKEY_TIMEOUT
0315   014A 32 0B FF        LD (KEY_TIMEOUT), A
0316   014D             UPDATE_KEY_RET:
0317   014D C9              RET
0318   014E             
0319   014E             TRATAB3:
0320   014E 21 5A 01        LD    HL, KEYSB3
0321   0151 C3 3A 01        JP  UPDATE_KEY_GET
0322   0154             
0323   0154             TRATAB4:
0324   0154 21 62 01        LD    HL, KEYSB4
0325   0157 C3 3A 01        JP  UPDATE_KEY_GET
0326   015A             
0327   015A 000104070F02KEYSB3 .db $00, $01, $04, $07, $0F, $02, $05, $08
0327   0160 0508
0328   0162 0E0306090D0CKEYSB4 .db $0E, $03, $06, $09, $0D, $0C, $0B, $0A
0328   0168 0B0A
0329   016A             
0330   016A             
0331   016A             ; =========================================================
0332   016A             ; Update Flags - Tratamento Int 38h
0333   016A             ; =========================================================
0334   016A             UPDATE_FLAGS:
0335   016A 3A 0F FF        LD    A, (SYSMODE)
0336   016D FE 06           CP    $06
0337   016F CA 78 01        JP    Z, UPDATE_FLAGS_MAIN
0338   0172 FE 0C           CP    $0C
0339   0174 CA 78 01        JP    Z, UPDATE_FLAGS_MAIN
0340   0177             UPDATE_FLAGS_RET:
0341   0177 C9              RET
0342   0178             
0343   0178             UPDATE_FLAGS_MAIN:
0344   0178 3A 09 FF        LD    A, (INPUT)
0345   017B E6 07           AND   $07
0346   017D             
0347   017D FE 07           CP    $07
0348   017F CA A8 01        JP    Z, UPDATE_FLAG_S
0349   0182 FE 00           CP    $00
0350   0184 CA B4 01        JP    Z, UPDATE_FLAG_Z
0351   0187 FE 01           CP    $01
0352   0189 CA C0 01        JP    Z, UPDATE_FLAG_X1
0353   018C FE 02           CP    $02
0354   018E CA CC 01        JP    Z, UPDATE_FLAG_H
0355   0191 FE 03           CP    $03
0356   0193 CA D8 01        JP    Z, UPDATE_FLAG_X2
0357   0196 FE 04           CP    $04
0358   0198 CA E4 01        JP    Z, UPDATE_FLAG_PV
0359   019B FE 05           CP    $05
0360   019D CA F0 01        JP    Z, UPDATE_FLAG_N
0361   01A0 FE 06           CP    $06
0362   01A2 CA FC 01        JP    Z, UPDATE_FLAG_C
0363   01A5 C3 77 01        JP    UPDATE_FLAGS_RET
0364   01A8             
0365   01A8             UPDATE_FLAG_S:
0366   01A8 CD 08 02        CALL  SHOW_DIG_FLAG_ON
0367   01AB 3A 2C FF        LD  A, (CPU_FLAGS)
0368   01AE CB 7F           BIT 7, A
0369   01B0 CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0370   01B3 C9              RET
0371   01B4             
0372   01B4             UPDATE_FLAG_Z:
0373   01B4 CD 08 02        CALL  SHOW_DIG_FLAG_ON
0374   01B7 3A 2C FF        LD  A, (CPU_FLAGS)
0375   01BA CB 77           BIT 6, A
0376   01BC CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0377   01BF C9              RET
0378   01C0             
0379   01C0             UPDATE_FLAG_X1:
0380   01C0 CD 08 02        CALL  SHOW_DIG_FLAG_ON
0381   01C3 3A 2C FF        LD  A, (CPU_FLAGS)
0382   01C6 CB 6F           BIT 5, A
0383   01C8 CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0384   01CB C9              RET
0385   01CC             
0386   01CC             UPDATE_FLAG_H:
0387   01CC CD 08 02        CALL  SHOW_DIG_FLAG_ON
0388   01CF 3A 2C FF        LD  A, (CPU_FLAGS)
0389   01D2 CB 67           BIT 4, A
0390   01D4 CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0391   01D7 C9              RET
0392   01D8             
0393   01D8             UPDATE_FLAG_X2:
0394   01D8 CD 08 02        CALL  SHOW_DIG_FLAG_ON
0395   01DB 3A 2C FF        LD  A, (CPU_FLAGS)
0396   01DE CB 5F           BIT 3, A
0397   01E0 CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0398   01E3 C9              RET
0399   01E4             
0400   01E4             UPDATE_FLAG_PV:
0401   01E4 CD 08 02        CALL  SHOW_DIG_FLAG_ON
0402   01E7 3A 2C FF        LD  A, (CPU_FLAGS)
0403   01EA CB 57           BIT 2, A
0404   01EC CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0405   01EF C9              RET
0406   01F0             
0407   01F0             UPDATE_FLAG_N:
0408   01F0 CD 08 02        CALL  SHOW_DIG_FLAG_ON
0409   01F3 3A 2C FF        LD  A, (CPU_FLAGS)
0410   01F6 CB 4F           BIT 1, A
0411   01F8 CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0412   01FB C9              RET
0413   01FC             
0414   01FC             UPDATE_FLAG_C:
0415   01FC CD 08 02        CALL  SHOW_DIG_FLAG_ON
0416   01FF 3A 2C FF        LD  A, (CPU_FLAGS)
0417   0202 CB 47           BIT 0, A
0418   0204 CC 11 02        CALL Z, SHOW_DIG_FLAG_OFF
0419   0207 C9              RET
0420   0208             
0421   0208             SHOW_DIG_FLAG_ON:
0422   0208 3A 0C FF        LD  A, (SHOW_DIG)
0423   020B F6 80           OR  $80
0424   020D 32 0C FF        LD  (SHOW_DIG), A
0425   0210 C9              RET
0426   0211             
0427   0211             SHOW_DIG_FLAG_OFF:
0428   0211 3A 0C FF        LD  A, (SHOW_DIG)
0429   0214 E6 7F           AND  $7F
0430   0216 32 0C FF        LD  (SHOW_DIG), A 
0431   0219 C9              RET
0432   021A             
0433   021A             ; =========================================================
0434   021A             ; SYS MAIN
0435   021A             ; =========================================================
0436   021A             SYS_MAIN:
0437   021A 3A 0F FF        LD  A, (SYSMODE)
0438   021D FE 00           CP  $00                  ; User mode can back to monitor
0439   021F CA 74 07        JP  Z, USER_MODE        
0440   0222             
0441   0222 3A 0F FF        LD  A, (SYSMODE)
0442   0225 FE 01           CP  $01                  ; monitor
0443   0227 CA 8A 07        JP  Z, MONITOR_MODE
0444   022A             
0445   022A 3A 0F FF        LD  A,  (SYSMODE)
0446   022D FE 02           CP  $02                  ; Examine RAM
0447   022F CA A5 02        JP  Z, EXAMINE_RAM
0448   0232             
0449   0232 3A 0F FF        LD  A, (SYSMODE)
0450   0235 FE 03           CP  $03                  ; Modify Data (Memory)
0451   0237 CA 3E 03        JP  Z,  MODIFY_RAM
0452   023A             
0453   023A 3A 0F FF        LD  A, (SYSMODE)
0454   023D FE 04           CP  $04                  ; Show register PC
0455   023F CA 8D 03        JP  Z,  SHOW_REG_PC
0456   0242             
0457   0242 3A 0F FF        LD  A, (SYSMODE)
0458   0245 FE 05           CP  $05                  ; Show register SP
0459   0247 CA D5 03        JP  Z,  SHOW_REG_SP
0460   024A             
0461   024A 3A 0F FF        LD  A, (SYSMODE)
0462   024D FE 06           CP  $06                  ; Show register AF
0463   024F CA 20 04        JP  Z,  SHOW_REG_AF
0464   0252             
0465   0252 3A 0F FF        LD  A, (SYSMODE)
0466   0255 FE 07           CP  $07                  ; Show register BC
0467   0257 CA 6F 04        JP  Z,  SHOW_REG_BC
0468   025A             
0469   025A 3A 0F FF        LD  A, (SYSMODE)
0470   025D FE 08           CP  $08                  ; Show register DE
0471   025F CA BA 04        JP  Z,  SHOW_REG_DE
0472   0262             
0473   0262 3A 0F FF        LD  A, (SYSMODE)
0474   0265 FE 09           CP  $09                  ; Show register HL
0475   0267 CA 05 05        JP  Z,  SHOW_REG_HL
0476   026A             
0477   026A 3A 0F FF        LD  A, (SYSMODE)
0478   026D FE 0A           CP  $0A                  ; Show register IX
0479   026F CA 50 05        JP  Z,  SHOW_REG_IX
0480   0272             
0481   0272 3A 0F FF        LD  A, (SYSMODE)
0482   0275 FE 0B           CP  $0B                  ; Show register IY
0483   0277 CA 9B 05        JP  Z,  SHOW_REG_IY
0484   027A             
0485   027A 3A 0F FF        LD  A, (SYSMODE)
0486   027D FE 0C           CP  $0C                  ; Show register AF'
0487   027F CA E6 05        JP  Z,  SHOW_REG_AFaux
0488   0282             
0489   0282 3A 0F FF        LD  A, (SYSMODE)
0490   0285 FE 0D           CP  $0D                  ; Show register BC'
0491   0287 CA 3A 06        JP  Z,  SHOW_REG_BCaux
0492   028A             
0493   028A 3A 0F FF        LD  A, (SYSMODE)
0494   028D FE 0E           CP  $0E                  ; Show register DE'
0495   028F CA 8A 06        JP  Z,  SHOW_REG_DEaux
0496   0292             
0497   0292 3A 0F FF        LD  A, (SYSMODE)
0498   0295 FE 0F           CP  $0F                  ; Show register HL'
0499   0297 CA DA 06        JP  Z,  SHOW_REG_HLaux
0500   029A             
0501   029A             
0502   029A 3A 0F FF        LD  A, (SYSMODE)
0503   029D FE 76           CP  $76
0504   029F CA 2A 07        JP  Z, SHOW_HALT
0505   02A2             
0506   02A2 C3 D5 00        JP  EXIT_SYS
0507   02A5             
0508   02A5             
0509   02A5             ; =========================================================
0510   02A5             ; Examine RAM Mode
0511   02A5             ; =========================================================
0512   02A5             EXAMINE_RAM:
0513   02A5 CD 59 07        CALL GET_KEY_A
0514   02A8 FE FF           CP  $FF
0515   02AA CA D5 00        JP  Z, EXIT_SYS
0516   02AD             
0517   02AD F5              PUSH  AF
0518   02AE F5              PUSH  AF
0519   02AF 3A 12 FF        LD  A, (EXM_COUNT)
0520   02B2 FE 03           CP  3
0521   02B4 CA D2 02        JP  Z, EXAMINE_KEY_POS_3
0522   02B7             
0523   02B7 3A 12 FF        LD  A, (EXM_COUNT)
0524   02BA FE 02           CP  2
0525   02BC CA F0 02        JP  Z, EXAMINE_KEY_POS_2
0526   02BF             
0527   02BF 3A 12 FF        LD  A, (EXM_COUNT)
0528   02C2 FE 01           CP  1
0529   02C4 CA 0A 03        JP  Z, EXAMINE_KEY_POS_1
0530   02C7             
0531   02C7 3A 12 FF        LD  A, (EXM_COUNT)
0532   02CA FE 00           CP  0
0533   02CC CA 2B 03        JP  Z, EXAMINE_KEY_POS_0
0534   02CF             
0535   02CF C3 D5 00        JP  EXIT_SYS
0536   02D2             
0537   02D2             EXAMINE_KEY_POS_3:
0538   02D2 F1              POP  AF
0539   02D3 CB 07           RLC  A
0540   02D5 CB 07           RLC  A
0541   02D7 CB 07           RLC  A
0542   02D9 CB 07           RLC  A
0543   02DB 67              LD  H, A
0544   02DC 22 0D FF        LD  (PC_RAM), HL
0545   02DF F1              POP  AF
0546   02E0 CD 58 09        CALL GET_NUM_FROM_LOW
0547   02E3 32 00 FF        LD  (DIG_0), A
0548   02E6 3A 12 FF        LD  A, (EXM_COUNT)
0549   02E9 3D              DEC A
0550   02EA 32 12 FF        LD  (EXM_COUNT), A
0551   02ED C3 D5 00        JP  EXIT_SYS
0552   02F0             
0553   02F0             
0554   02F0             EXAMINE_KEY_POS_2:
0555   02F0 F1              POP  AF
0556   02F1 2A 0D FF        LD  HL, (PC_RAM)
0557   02F4 B4              OR  H
0558   02F5 67              LD  H, A
0559   02F6 22 0D FF        LD  (PC_RAM), HL
0560   02F9 F1              POP  AF
0561   02FA CD 58 09        CALL GET_NUM_FROM_LOW
0562   02FD 32 01 FF        LD  (DIG_1), A
0563   0300 3A 12 FF        LD  A, (EXM_COUNT)
0564   0303 3D              DEC A
0565   0304 32 12 FF        LD  (EXM_COUNT), A
0566   0307 C3 D5 00        JP  EXIT_SYS
0567   030A             
0568   030A             EXAMINE_KEY_POS_1:
0569   030A F1              POP  AF
0570   030B 2A 0D FF        LD  HL, (PC_RAM)
0571   030E CB 07           RLC  A
0572   0310 CB 07           RLC  A
0573   0312 CB 07           RLC  A
0574   0314 CB 07           RLC  A
0575   0316 6F              LD  L, A
0576   0317 22 0D FF        LD  (PC_RAM), HL
0577   031A F1              POP  AF
0578   031B CD 58 09        CALL GET_NUM_FROM_LOW
0579   031E 32 02 FF        LD  (DIG_2), A
0580   0321 3A 12 FF        LD  A, (EXM_COUNT)
0581   0324 3D              DEC A
0582   0325 32 12 FF        LD  (EXM_COUNT), A
0583   0328 C3 D5 00        JP  EXIT_SYS
0584   032B             
0585   032B             
0586   032B             EXAMINE_KEY_POS_0:
0587   032B F1              POP  AF
0588   032C 2A 0D FF        LD  HL, (PC_RAM)
0589   032F B5              OR  L
0590   0330 6F              LD  L, A
0591   0331 22 0D FF        LD  (PC_RAM), HL
0592   0334 F1              POP  AF
0593   0335 CD 58 09        CALL GET_NUM_FROM_LOW
0594   0338 32 03 FF        LD  (DIG_3), A
0595   033B C3 6B 08        JP  GO_MONITOR
0596   033E             
0597   033E             ; =========================================================
0598   033E             ; MODIFY RAM Mode
0599   033E             ; =========================================================
0600   033E             MODIFY_RAM:
0601   033E             
0602   033E CD 59 07        CALL GET_KEY_A
0603   0341 FE FF           CP  $FF
0604   0343 CA D5 00        JP  Z, EXIT_SYS
0605   0346             
0606   0346 F5              PUSH  AF
0607   0347 F5              PUSH  AF
0608   0348 3A 13 FF        LD  A, (MDF_COUNT)
0609   034B FE 01           CP  1
0610   034D CA 5B 03        JP  Z, MODIFY_KEY_POS_1
0611   0350             
0612   0350 3A 13 FF        LD  A, (MDF_COUNT)
0613   0353 FE 00           CP  0
0614   0355 CA 79 03        JP  Z, MODIFY_KEY_POS_0
0615   0358             
0616   0358 C3 D5 00        JP  EXIT_SYS
0617   035B             
0618   035B             MODIFY_KEY_POS_1:
0619   035B F1              POP  AF
0620   035C CB 07           RLC  A
0621   035E CB 07           RLC  A
0622   0360 CB 07           RLC  A
0623   0362 CB 07           RLC  A
0624   0364 2A 0D FF        LD  HL, (PC_RAM)
0625   0367 77              LD  (HL), A
0626   0368             
0627   0368 F1              POP  AF
0628   0369 CD 58 09        CALL GET_NUM_FROM_LOW
0629   036C 32 06 FF        LD  (DIG_6), A
0630   036F 3A 13 FF        LD  A, (MDF_COUNT)
0631   0372 3D              DEC A
0632   0373 32 13 FF        LD  (MDF_COUNT), A
0633   0376 C3 D5 00        JP  EXIT_SYS
0634   0379             
0635   0379             MODIFY_KEY_POS_0:
0636   0379 F1              POP  AF
0637   037A 2A 0D FF        LD  HL, (PC_RAM)
0638   037D 46              LD  B, (HL)
0639   037E B0              OR  B
0640   037F 2A 0D FF        LD  HL, (PC_RAM)
0641   0382 77              LD  (HL), A
0642   0383             
0643   0383 F1              POP  AF
0644   0384 CD 58 09        CALL GET_NUM_FROM_LOW
0645   0387 32 07 FF        LD  (DIG_7), A
0646   038A C3 6B 08        JP  GO_MONITOR
0647   038D                 
0648   038D             
0649   038D             SHOW_REG_PC:
0650   038D CD 59 07        CALL  GET_KEY_A
0651   0390 FE 00           CP  $00
0652   0392 CA 6B 08        JP Z, GO_MONITOR
0653   0395 FE 01           CP  $01
0654   0397 CA 76 08        JP Z, GO_SHOW_REG_PC
0655   039A FE 02           CP  $02
0656   039C CA 81 08        JP Z, GO_SHOW_REG_SP
0657   039F FE 03           CP  $03
0658   03A1 CA 8C 08        JP Z, GO_SHOW_REG_AF
0659   03A4 FE 04           CP  $04
0660   03A6 CA 97 08        JP Z, GO_SHOW_REG_BC
0661   03A9 FE 05           CP  $05
0662   03AB CA A2 08        JP Z, GO_SHOW_REG_DE
0663   03AE FE 06           CP  $06
0664   03B0 CA AD 08        JP Z, GO_SHOW_REG_HL
0665   03B3 FE 07           CP  $07
0666   03B5 CA B8 08        JP Z, GO_SHOW_REG_IX
0667   03B8 FE 08           CP  $08
0668   03BA CA C3 08        JP Z, GO_SHOW_REG_IY
0669   03BD             
0670   03BD 3E 50           LD  A, $50               ; R
0671   03BF 32 00 FF        LD  (DIG_0), A
0672   03C2             
0673   03C2 3E 73           LD  A, $73               ; P
0674   03C4 32 01 FF        LD  (DIG_1), A
0675   03C7             
0676   03C7 3E 39           LD  A, $39
0677   03C9 32 02 FF        LD  (DIG_2), A           ; C
0678   03CC             
0679   03CC 2A 14 FF        LD HL, (USR_PC)
0680   03CF CD 0A 0A        CALL PRINT_END_HL
0681   03D2 C3 D5 00        JP  EXIT_SYS
0682   03D5             
0683   03D5             
0684   03D5             SHOW_REG_SP:
0685   03D5 CD 59 07        CALL  GET_KEY_A
0686   03D8 FE 00           CP  $00
0687   03DA CA 6B 08        JP Z, GO_MONITOR
0688   03DD FE 01           CP  $01
0689   03DF CA 76 08        JP Z, GO_SHOW_REG_PC
0690   03E2 FE 02           CP  $02
0691   03E4 CA 81 08        JP Z, GO_SHOW_REG_SP
0692   03E7 FE 03           CP  $03
0693   03E9 CA 8C 08        JP Z, GO_SHOW_REG_AF
0694   03EC FE 04           CP  $04
0695   03EE CA 97 08        JP Z, GO_SHOW_REG_BC
0696   03F1 FE 05           CP  $05
0697   03F3 CA A2 08        JP Z, GO_SHOW_REG_DE
0698   03F6 FE 06           CP  $06
0699   03F8 CA AD 08        JP Z, GO_SHOW_REG_HL
0700   03FB FE 07           CP  $07
0701   03FD CA B8 08        JP Z, GO_SHOW_REG_IX
0702   0400 FE 08           CP  $08
0703   0402 CA C3 08        JP Z, GO_SHOW_REG_IY
0704   0405             
0705   0405 CD 1E 09        CALL  CLEAR_DISPLAY
0706   0408             
0707   0408 3E 50           LD  A, $50               ; R
0708   040A 32 00 FF        LD  (DIG_0), A
0709   040D             
0710   040D 3E 6D           LD  A, $6D               ; S
0711   040F 32 01 FF        LD  (DIG_1), A
0712   0412             
0713   0412 3E 73           LD  A, $73               ; P
0714   0414 32 02 FF        LD  (DIG_2), A
0715   0417             
0716   0417 2A 16 FF        LD HL, (USR_SP)
0717   041A CD 0A 0A        CALL PRINT_END_HL
0718   041D C3 D5 00        JP  EXIT_SYS
0719   0420             
0720   0420             
0721   0420             SHOW_REG_AF:
0722   0420 CD 59 07        CALL  GET_KEY_A
0723   0423 FE 00           CP  $00
0724   0425 CA 6B 08        JP Z, GO_MONITOR
0725   0428 FE 01           CP  $01
0726   042A CA 76 08        JP Z, GO_SHOW_REG_PC
0727   042D FE 02           CP  $02
0728   042F CA 81 08        JP Z, GO_SHOW_REG_SP
0729   0432 FE 03           CP  $03
0730   0434 CA CE 08        JP Z, GO_SHOW_REG_AFaux
0731   0437 FE 04           CP  $04
0732   0439 CA 97 08        JP Z, GO_SHOW_REG_BC
0733   043C FE 05           CP  $05
0734   043E CA A2 08        JP Z, GO_SHOW_REG_DE
0735   0441 FE 06           CP  $06
0736   0443 CA AD 08        JP Z, GO_SHOW_REG_HL
0737   0446 FE 07           CP  $07
0738   0448 CA B8 08        JP Z, GO_SHOW_REG_IX
0739   044B FE 08           CP  $08
0740   044D CA C3 08        JP Z, GO_SHOW_REG_IY
0741   0450             
0742   0450 CD 1E 09        CALL  CLEAR_DISPLAY
0743   0453             
0744   0453 3E 50           LD  A, $50               ; R
0745   0455 32 00 FF        LD  (DIG_0), A
0746   0458             
0747   0458 3E 77           LD  A, $77               ; A
0748   045A 32 01 FF        LD  (DIG_1), A
0749   045D             
0750   045D 3E 71           LD  A, $71               ; F
0751   045F 32 02 FF        LD  (DIG_2), A
0752   0462             
0753   0462 2A 1E FF        LD  HL, (USR_AF)
0754   0465 7D              LD  A, L
0755   0466 32 2C FF        LD (CPU_FLAGS), A
0756   0469 CD 0A 0A        CALL PRINT_END_HL
0757   046C C3 D5 00        JP  EXIT_SYS
0758   046F             
0759   046F             
0760   046F             SHOW_REG_BC:
0761   046F CD 59 07        CALL  GET_KEY_A
0762   0472 FE 00           CP  $00
0763   0474 CA 6B 08        JP Z, GO_MONITOR
0764   0477 FE 01           CP  $01
0765   0479 CA 76 08        JP Z, GO_SHOW_REG_PC
0766   047C FE 02           CP  $02
0767   047E CA 81 08        JP Z, GO_SHOW_REG_SP
0768   0481 FE 03           CP  $03
0769   0483 CA 8C 08        JP Z, GO_SHOW_REG_AF
0770   0486 FE 04           CP  $04
0771   0488 CA D9 08        JP Z, GO_SHOW_REG_BCaux
0772   048B FE 05           CP  $05
0773   048D CA A2 08        JP Z, GO_SHOW_REG_DE
0774   0490 FE 06           CP  $06
0775   0492 CA AD 08        JP Z, GO_SHOW_REG_HL
0776   0495 FE 07           CP  $07
0777   0497 CA B8 08        JP Z, GO_SHOW_REG_IX
0778   049A FE 08           CP  $08
0779   049C CA C3 08        JP Z, GO_SHOW_REG_IY
0780   049F             
0781   049F CD 1E 09        CALL  CLEAR_DISPLAY
0782   04A2             
0783   04A2 3E 50           LD  A, $50               ; R
0784   04A4 32 00 FF        LD  (DIG_0), A
0785   04A7             
0786   04A7 3E 7C           LD  A, $7C               ; B
0787   04A9 32 01 FF        LD  (DIG_1), A
0788   04AC             
0789   04AC 3E 39           LD  A, $39               ; C
0790   04AE 32 02 FF        LD  (DIG_2), A
0791   04B1             
0792   04B1 2A 1A FF        LD HL, (USR_BC)
0793   04B4 CD 0A 0A        CALL PRINT_END_HL
0794   04B7 C3 D5 00        JP  EXIT_SYS
0795   04BA             
0796   04BA             SHOW_REG_DE:
0797   04BA CD 59 07        CALL  GET_KEY_A
0798   04BD FE 00           CP  $00
0799   04BF CA 6B 08        JP Z, GO_MONITOR
0800   04C2 FE 01           CP  $01
0801   04C4 CA 76 08        JP Z, GO_SHOW_REG_PC
0802   04C7 FE 02           CP  $02
0803   04C9 CA 81 08        JP Z, GO_SHOW_REG_SP
0804   04CC FE 03           CP  $03
0805   04CE CA 8C 08        JP Z, GO_SHOW_REG_AF
0806   04D1 FE 04           CP  $04
0807   04D3 CA 97 08        JP Z, GO_SHOW_REG_BC
0808   04D6 FE 05           CP  $05
0809   04D8 CA E4 08        JP Z, GO_SHOW_REG_DEaux
0810   04DB FE 06           CP  $06
0811   04DD CA AD 08        JP Z, GO_SHOW_REG_HL
0812   04E0 FE 07           CP  $07
0813   04E2 CA B8 08        JP Z, GO_SHOW_REG_IX
0814   04E5 FE 08           CP  $08
0815   04E7 CA C3 08        JP Z, GO_SHOW_REG_IY
0816   04EA             
0817   04EA CD 1E 09        CALL  CLEAR_DISPLAY
0818   04ED             
0819   04ED 3E 50           LD  A, $50               ; R
0820   04EF 32 00 FF        LD  (DIG_0), A
0821   04F2             
0822   04F2 3E 5E           LD  A, $5E               ; D
0823   04F4 32 01 FF        LD  (DIG_1), A
0824   04F7             
0825   04F7 3E 79           LD  A, $79               ; E
0826   04F9 32 02 FF        LD  (DIG_2), A
0827   04FC             
0828   04FC 2A 1C FF        LD HL, (USR_DE)
0829   04FF CD 0A 0A        CALL PRINT_END_HL
0830   0502 C3 D5 00        JP  EXIT_SYS
0831   0505             
0832   0505             SHOW_REG_HL:
0833   0505 CD 59 07        CALL  GET_KEY_A
0834   0508 FE 00           CP  $00
0835   050A CA 6B 08        JP Z, GO_MONITOR
0836   050D FE 01           CP  $01
0837   050F CA 76 08        JP Z, GO_SHOW_REG_PC
0838   0512 FE 02           CP  $02
0839   0514 CA 81 08        JP Z, GO_SHOW_REG_SP
0840   0517 FE 03           CP  $03
0841   0519 CA 8C 08        JP Z, GO_SHOW_REG_AF
0842   051C FE 04           CP  $04
0843   051E CA 97 08        JP Z, GO_SHOW_REG_BC
0844   0521 FE 05           CP  $05
0845   0523 CA A2 08        JP Z, GO_SHOW_REG_DE
0846   0526 FE 06           CP  $06
0847   0528 CA EF 08        JP Z, GO_SHOW_REG_HLaux
0848   052B FE 07           CP  $07
0849   052D CA B8 08        JP Z, GO_SHOW_REG_IX
0850   0530 FE 08           CP  $08
0851   0532 CA C3 08        JP Z, GO_SHOW_REG_IY
0852   0535             
0853   0535 CD 1E 09        CALL  CLEAR_DISPLAY
0854   0538             
0855   0538 3E 50           LD  A, $50               ; R
0856   053A 32 00 FF        LD  (DIG_0), A
0857   053D             
0858   053D 3E 76           LD  A, $76               ; H
0859   053F 32 01 FF        LD  (DIG_1), A
0860   0542             
0861   0542 3E 38           LD  A, $38               ; L
0862   0544 32 02 FF        LD  (DIG_2), A
0863   0547             
0864   0547 2A 18 FF        LD HL, (USR_HL)
0865   054A CD 0A 0A        CALL PRINT_END_HL
0866   054D C3 D5 00        JP  EXIT_SYS
0867   0550             
0868   0550             SHOW_REG_IX:
0869   0550 CD 59 07        CALL  GET_KEY_A
0870   0553 FE 00           CP  $00
0871   0555 CA 6B 08        JP Z, GO_MONITOR
0872   0558 FE 01           CP  $01
0873   055A CA 76 08        JP Z, GO_SHOW_REG_PC
0874   055D FE 02           CP  $02
0875   055F CA 81 08        JP Z, GO_SHOW_REG_SP
0876   0562 FE 03           CP  $03
0877   0564 CA 8C 08        JP Z, GO_SHOW_REG_AF
0878   0567 FE 04           CP  $04
0879   0569 CA 97 08        JP Z, GO_SHOW_REG_BC
0880   056C FE 05           CP  $05
0881   056E CA A2 08        JP Z, GO_SHOW_REG_DE
0882   0571 FE 06           CP  $06
0883   0573 CA AD 08        JP Z, GO_SHOW_REG_HL
0884   0576 FE 07           CP  $07
0885   0578 CA B8 08        JP Z, GO_SHOW_REG_IX
0886   057B FE 08           CP  $08
0887   057D CA C3 08        JP Z, GO_SHOW_REG_IY
0888   0580             
0889   0580 CD 1E 09        CALL  CLEAR_DISPLAY
0890   0583             
0891   0583 3E 50           LD  A, $50               ; R
0892   0585 32 00 FF        LD  (DIG_0), A
0893   0588             
0894   0588 3E 06           LD  A, $06               ; I
0895   058A 32 01 FF        LD  (DIG_1), A
0896   058D             
0897   058D 3E 70           LD  A, $70               ; X
0898   058F 32 02 FF        LD  (DIG_2), A
0899   0592             
0900   0592 2A 20 FF        LD HL, (USR_IX)
0901   0595 CD 0A 0A        CALL PRINT_END_HL
0902   0598 C3 D5 00        JP  EXIT_SYS
0903   059B             
0904   059B             SHOW_REG_IY:
0905   059B CD 59 07        CALL  GET_KEY_A
0906   059E FE 00           CP  $00
0907   05A0 CA 6B 08        JP Z, GO_MONITOR
0908   05A3 FE 01           CP  $01
0909   05A5 CA 76 08        JP Z, GO_SHOW_REG_PC
0910   05A8 FE 02           CP  $02
0911   05AA CA 81 08        JP Z, GO_SHOW_REG_SP
0912   05AD FE 03           CP  $03
0913   05AF CA 8C 08        JP Z, GO_SHOW_REG_AF
0914   05B2 FE 04           CP  $04
0915   05B4 CA 97 08        JP Z, GO_SHOW_REG_BC
0916   05B7 FE 05           CP  $05
0917   05B9 CA A2 08        JP Z, GO_SHOW_REG_DE
0918   05BC FE 06           CP  $06
0919   05BE CA AD 08        JP Z, GO_SHOW_REG_HL
0920   05C1 FE 07           CP  $07
0921   05C3 CA B8 08        JP Z, GO_SHOW_REG_IX
0922   05C6 FE 08           CP  $08
0923   05C8 CA C3 08        JP Z, GO_SHOW_REG_IY
0924   05CB             
0925   05CB CD 1E 09        CALL  CLEAR_DISPLAY
0926   05CE             
0927   05CE 3E 50           LD  A, $50               ; R
0928   05D0 32 00 FF        LD  (DIG_0), A
0929   05D3             
0930   05D3 3E 06           LD  A, $06               ; I
0931   05D5 32 01 FF        LD  (DIG_1), A
0932   05D8             
0933   05D8 3E 6E           LD  A, $6E               ; Y
0934   05DA 32 02 FF        LD  (DIG_2), A
0935   05DD             
0936   05DD 2A 22 FF        LD HL, (USR_IY)
0937   05E0 CD 0A 0A        CALL PRINT_END_HL
0938   05E3 C3 D5 00        JP  EXIT_SYS
0939   05E6             
0940   05E6             SHOW_REG_AFaux:
0941   05E6 CD 59 07        CALL  GET_KEY_A
0942   05E9 FE 00           CP  $00
0943   05EB CA 6B 08        JP Z, GO_MONITOR
0944   05EE FE 01           CP  $01
0945   05F0 CA 76 08        JP Z, GO_SHOW_REG_PC
0946   05F3 FE 02           CP  $02
0947   05F5 CA 81 08        JP Z, GO_SHOW_REG_SP
0948   05F8 FE 03           CP  $03
0949   05FA CA 8C 08        JP Z, GO_SHOW_REG_AF
0950   05FD FE 04           CP  $04
0951   05FF CA 97 08        JP Z, GO_SHOW_REG_BC
0952   0602 FE 05           CP  $05
0953   0604 CA A2 08        JP Z, GO_SHOW_REG_DE
0954   0607 FE 06           CP  $06
0955   0609 CA AD 08        JP Z, GO_SHOW_REG_HL
0956   060C FE 07           CP  $07
0957   060E CA B8 08        JP Z, GO_SHOW_REG_IX
0958   0611 FE 08           CP  $08
0959   0613 CA C3 08        JP Z, GO_SHOW_REG_IY
0960   0616             
0961   0616 CD 1E 09        CALL  CLEAR_DISPLAY
0962   0619             
0963   0619 3E 50           LD  A, $50               ; R
0964   061B 32 00 FF        LD  (DIG_0), A
0965   061E             
0966   061E 3E 77           LD  A, $77               ; A
0967   0620 32 01 FF        LD  (DIG_1), A
0968   0623             
0969   0623 3E 71           LD  A, $71               ; F
0970   0625 32 02 FF        LD  (DIG_2), A
0971   0628             
0972   0628 3E 20           LD  A, $20               ; '
0973   062A 32 03 FF        LD  (DIG_3), A
0974   062D             
0975   062D 2A 24 FF        LD HL, (USR_AFA)
0976   0630 7D              LD  A, L
0977   0631 32 2C FF        LD (CPU_FLAGS), A
0978   0634 CD 0A 0A        CALL PRINT_END_HL
0979   0637 C3 D5 00        JP  EXIT_SYS
0980   063A             
0981   063A             
0982   063A             SHOW_REG_BCaux:
0983   063A CD 59 07        CALL  GET_KEY_A
0984   063D FE 00           CP  $00
0985   063F CA 6B 08        JP Z, GO_MONITOR
0986   0642 FE 01           CP  $01
0987   0644 CA 76 08        JP Z, GO_SHOW_REG_PC
0988   0647 FE 02           CP  $02
0989   0649 CA 81 08        JP Z, GO_SHOW_REG_SP
0990   064C FE 03           CP  $03
0991   064E CA 8C 08        JP Z, GO_SHOW_REG_AF
0992   0651 FE 04           CP  $04
0993   0653 CA 97 08        JP Z, GO_SHOW_REG_BC
0994   0656 FE 05           CP  $05
0995   0658 CA A2 08        JP Z, GO_SHOW_REG_DE
0996   065B FE 06           CP  $06
0997   065D CA AD 08        JP Z, GO_SHOW_REG_HL
0998   0660 FE 07           CP  $07
0999   0662 CA B8 08        JP Z, GO_SHOW_REG_IX
1000   0665 FE 08           CP  $08
1001   0667 CA C3 08        JP Z, GO_SHOW_REG_IY
1002   066A             
1003   066A CD 1E 09        CALL  CLEAR_DISPLAY
1004   066D             
1005   066D 3E 50           LD  A, $50               ; R
1006   066F 32 00 FF        LD  (DIG_0), A
1007   0672             
1008   0672 3E 7C           LD  A, $7C               ; B
1009   0674 32 01 FF        LD  (DIG_1), A
1010   0677             
1011   0677 3E 39           LD  A, $39               ; C
1012   0679 32 02 FF        LD  (DIG_2), A
1013   067C             
1014   067C 3E 20           LD  A, $20               ; '
1015   067E 32 03 FF        LD  (DIG_3), A
1016   0681             
1017   0681 2A 26 FF        LD HL, (USR_BCA)
1018   0684 CD 0A 0A        CALL PRINT_END_HL
1019   0687 C3 D5 00        JP  EXIT_SYS
1020   068A             
1021   068A             SHOW_REG_DEaux:
1022   068A CD 59 07        CALL  GET_KEY_A
1023   068D FE 00           CP  $00
1024   068F CA 6B 08        JP Z, GO_MONITOR
1025   0692 FE 01           CP  $01
1026   0694 CA 76 08        JP Z, GO_SHOW_REG_PC
1027   0697 FE 02           CP  $02
1028   0699 CA 81 08        JP Z, GO_SHOW_REG_SP
1029   069C FE 03           CP  $03
1030   069E CA 8C 08        JP Z, GO_SHOW_REG_AF
1031   06A1 FE 04           CP  $04
1032   06A3 CA 97 08        JP Z, GO_SHOW_REG_BC
1033   06A6 FE 05           CP  $05
1034   06A8 CA A2 08        JP Z, GO_SHOW_REG_DE
1035   06AB FE 06           CP  $06
1036   06AD CA AD 08        JP Z, GO_SHOW_REG_HL
1037   06B0 FE 07           CP  $07
1038   06B2 CA B8 08        JP Z, GO_SHOW_REG_IX
1039   06B5 FE 08           CP  $08
1040   06B7 CA C3 08        JP Z, GO_SHOW_REG_IY
1041   06BA             
1042   06BA CD 1E 09        CALL  CLEAR_DISPLAY
1043   06BD             
1044   06BD 3E 50           LD  A, $50               ; R
1045   06BF 32 00 FF        LD  (DIG_0), A
1046   06C2             
1047   06C2 3E 5E           LD  A, $5E               ; D
1048   06C4 32 01 FF        LD  (DIG_1), A
1049   06C7             
1050   06C7 3E 79           LD  A, $79               ; E
1051   06C9 32 02 FF        LD  (DIG_2), A
1052   06CC             
1053   06CC 3E 20           LD  A, $20               ; '
1054   06CE 32 03 FF        LD  (DIG_3), A
1055   06D1             
1056   06D1 2A 28 FF        LD HL, (USR_DEA)
1057   06D4 CD 0A 0A        CALL PRINT_END_HL
1058   06D7 C3 D5 00        JP  EXIT_SYS
1059   06DA             
1060   06DA             SHOW_REG_HLaux:
1061   06DA CD 59 07        CALL  GET_KEY_A
1062   06DD FE 00           CP  $00
1063   06DF CA 6B 08        JP Z, GO_MONITOR
1064   06E2 FE 01           CP  $01
1065   06E4 CA 76 08        JP Z, GO_SHOW_REG_PC
1066   06E7 FE 02           CP  $02
1067   06E9 CA 81 08        JP Z, GO_SHOW_REG_SP
1068   06EC FE 03           CP  $03
1069   06EE CA 8C 08        JP Z, GO_SHOW_REG_AF
1070   06F1 FE 04           CP  $04
1071   06F3 CA 97 08        JP Z, GO_SHOW_REG_BC
1072   06F6 FE 05           CP  $05
1073   06F8 CA A2 08        JP Z, GO_SHOW_REG_DE
1074   06FB FE 06           CP  $06
1075   06FD CA AD 08        JP Z, GO_SHOW_REG_HL
1076   0700 FE 07           CP  $07
1077   0702 CA B8 08        JP Z, GO_SHOW_REG_IX
1078   0705 FE 08           CP  $08
1079   0707 CA C3 08        JP Z, GO_SHOW_REG_IY
1080   070A             
1081   070A CD 1E 09        CALL  CLEAR_DISPLAY
1082   070D             
1083   070D 3E 50           LD  A, $50               ; R
1084   070F 32 00 FF        LD  (DIG_0), A
1085   0712             
1086   0712 3E 76           LD  A, $76               ; H
1087   0714 32 01 FF        LD  (DIG_1), A
1088   0717             
1089   0717 3E 38           LD  A, $38               ; L
1090   0719 32 02 FF        LD  (DIG_2), A
1091   071C             
1092   071C 3E 20           LD  A, $20               ; '
1093   071E 32 03 FF        LD  (DIG_3), A
1094   0721             
1095   0721 2A 2A FF        LD HL, (USR_HLA)
1096   0724 CD 0A 0A        CALL PRINT_END_HL
1097   0727 C3 D5 00        JP  EXIT_SYS
1098   072A             
1099   072A             SHOW_HALT:
1100   072A 3A 09 FF        LD  A, (INPUT)
1101   072D FE FB           CP  $FB
1102   072F CA 6B 08        JP  Z, GO_MONITOR
1103   0732             
1104   0732 3E 40           LD  A, $40               ; -
1105   0734 32 00 FF        LD  (DIG_0), A
1106   0737 32 01 FF        LD  (DIG_1), A
1107   073A             
1108   073A 3E 76           LD  A, $76               ; H
1109   073C 32 02 FF        LD  (DIG_2), A
1110   073F             
1111   073F 3E 77           LD  A, $77               ; A
1112   0741 32 03 FF        LD  (DIG_3), A
1113   0744             
1114   0744 3E 38           LD  A, $38               ; L
1115   0746 32 04 FF        LD  (DIG_4), A
1116   0749             
1117   0749 3E 78           LD  A, $78               ; T
1118   074B 32 05 FF        LD  (DIG_5), A
1119   074E             
1120   074E 3E 40           LD  A, $40               ; -
1121   0750 32 06 FF        LD  (DIG_6), A
1122   0753 32 07 FF        LD  (DIG_7), A
1123   0756             
1124   0756 C3 D5 00        JP EXIT_SYS
1125   0759             
1126   0759             ; =========================================================
1127   0759             ; GET KEY IN A, IF A == FFh then no KEY
1128   0759             ; =========================================================
1129   0759             GET_KEY_A:
1130   0759 3A 0B FF        LD  A, (KEY_TIMEOUT)
1131   075C FE 00           CP  0
1132   075E CA 64 07        JP  Z, RET_KEY
1133   0761 3E FF           LD  A, $FF
1134   0763 C9              RET
1135   0764             
1136   0764             RET_KEY:
1137   0764 3E 64           LD A, CKEY_TIMEOUT
1138   0766 32 0B FF        LD (KEY_TIMEOUT), A
1139   0769             
1140   0769 3A 08 FF        LD  A, (KEY_PRESS)
1141   076C F5              PUSH  AF
1142   076D 3E FF           LD  A, $FF
1143   076F 32 08 FF        LD  (KEY_PRESS), A
1144   0772 F1              POP  AF
1145   0773 C9              RET
1146   0774             
1147   0774             
1148   0774             ; =========================================================
1149   0774             ; MONITOR Mode
1150   0774             ; =========================================================
1151   0774             USER_MODE:
1152   0774 3A 09 FF        LD  A, (INPUT)
1153   0777 FE FB           CP  $FB
1154   0779 CA 6B 08        JP  Z, GO_MONITOR
1155   077C                 
1156   077C                 ; Copy USER_DISPx to DIG_x
1157   077C 21 D0 FF        LD	HL, USER_DISP0
1158   077F 11 00 FF    	LD	DE, DIG_0
1159   0782 01 08 00    	LD	BC, $0008
1160   0785 ED B0       	LDIR
1161   0787             
1162   0787 C3 D5 00        JP  EXIT_SYS
1163   078A             
1164   078A             MONITOR_MODE:
1165   078A                 ; Mostra o endereço
1166   078A 2A 0D FF        LD  HL, (PC_RAM)
1167   078D CD AD 09        CALL PRINT_HL
1168   0790             
1169   0790                 ; Limpa digitos
1170   0790 3E 00           LD  A, 0
1171   0792 32 04 FF        LD  (DIG_4), A
1172   0795 32 05 FF        LD  (DIG_5), A
1173   0798             
1174   0798                 ; Mostra os dados no endereço
1175   0798 2A 0D FF        LD  HL, (PC_RAM)
1176   079B 7E              LD  A, (HL)
1177   079C CD 80 09        CALL  PRINT_A
1178   079F             
1179   079F             
1180   079F CD 59 07        CALL  GET_KEY_A
1181   07A2             
1182   07A2                 ; Incrementa endereço
1183   07A2 32 0A FF        LD (TMP_KEY), A
1184   07A5 FE 0A           CP  $0A
1185   07A7 CA 27 08        JP  Z,  PC_RAM_INC
1186   07AA             
1187   07AA                 ; Decrementa endereço
1188   07AA 3A 0A FF        LD  A, (TMP_KEY)
1189   07AD FE 0B           CP  $0B
1190   07AF CA 1D 08        JP  Z,  PC_RAM_DEC
1191   07B2             
1192   07B2                 ; Examina memoria
1193   07B2 3A 0A FF        LD  A, (TMP_KEY)
1194   07B5 FE 0E           CP  $0E
1195   07B7 CA 31 08        JP  Z,  GO_EXAMINE
1196   07BA             
1197   07BA                 ; + moDify Memory
1198   07BA 3A 0A FF        LD  A, (TMP_KEY)
1199   07BD FE 0C           CP  $0C
1200   07BF CA 4C 08        JP  Z,  GO_ADD_MODIFY
1201   07C2             
1202   07C2                 ; moDify Memory
1203   07C2 3A 0A FF        LD  A, (TMP_KEY)
1204   07C5 FE 0D           CP  $0D
1205   07C7 CA 56 08        JP  Z,  GO_MODIFY
1206   07CA             
1207   07CA                 ; RUN
1208   07CA 3A 0A FF        LD  A, (TMP_KEY)
1209   07CD FE 0F           CP  $0F
1210   07CF CA 08 09        JP  Z,  FIRE
1211   07D2             
1212   07D2                 ; Show register PC
1213   07D2 3A 0A FF        LD  A, (TMP_KEY)
1214   07D5 FE 01           CP  $01
1215   07D7 CA 76 08        JP  Z, GO_SHOW_REG_PC
1216   07DA             
1217   07DA                 ; Show register SP
1218   07DA 3A 0A FF        LD  A, (TMP_KEY)
1219   07DD FE 02           CP  $02
1220   07DF CA 81 08        JP  Z, GO_SHOW_REG_SP
1221   07E2             
1222   07E2                 ; Show register AF
1223   07E2 3A 0A FF        LD  A, (TMP_KEY)
1224   07E5 FE 03           CP  $03
1225   07E7 CA 8C 08        JP  Z, GO_SHOW_REG_AF
1226   07EA             
1227   07EA                 ; Show register BC
1228   07EA 3A 0A FF        LD  A, (TMP_KEY)
1229   07ED FE 04           CP  $04
1230   07EF CA 97 08        JP  Z, GO_SHOW_REG_BC
1231   07F2             
1232   07F2                 ; Show register DE
1233   07F2 3A 0A FF        LD  A, (TMP_KEY)
1234   07F5 FE 05           CP  $05
1235   07F7 CA A2 08        JP  Z, GO_SHOW_REG_DE
1236   07FA             
1237   07FA                 ; Show register HL
1238   07FA 3A 0A FF        LD  A, (TMP_KEY)
1239   07FD FE 06           CP  $06
1240   07FF CA AD 08        JP  Z, GO_SHOW_REG_HL
1241   0802             
1242   0802                 ; Show register IX
1243   0802 3A 0A FF        LD  A, (TMP_KEY)
1244   0805 FE 07           CP  $07
1245   0807 CA B8 08        JP  Z, GO_SHOW_REG_IX
1246   080A             
1247   080A                 ; Show register iY
1248   080A 3A 0A FF        LD  A, (TMP_KEY)
1249   080D FE 08           CP  $08
1250   080F CA C3 08        JP  Z, GO_SHOW_REG_IY
1251   0812             
1252   0812                 ; Back to user mode
1253   0812 3A 0A FF        LD  A, (TMP_KEY)
1254   0815 FE 09           CP  $09
1255   0817 CA 16 09        JP  Z, GO_USER_MODE
1256   081A             
1257   081A C3 D5 00        JP  EXIT_SYS
1258   081D                 
1259   081D             
1260   081D             PC_RAM_DEC:
1261   081D 2A 0D FF        LD  HL, (PC_RAM)
1262   0820 2B              DEC  HL
1263   0821 22 0D FF        LD  (PC_RAM), HL
1264   0824 C3 D5 00        JP  EXIT_SYS
1265   0827             
1266   0827             PC_RAM_INC:
1267   0827 2A 0D FF        LD  HL, (PC_RAM)
1268   082A 23              INC  HL
1269   082B 22 0D FF        LD  (PC_RAM), HL
1270   082E C3 D5 00        JP  EXIT_SYS
1271   0831             
1272   0831             GO_EXAMINE:
1273   0831 3E 03           LD  A, $03
1274   0833 32 12 FF        LD (EXM_COUNT), A        ; Set count 4 digits, position display
1275   0836 3E 02           LD  A, $02
1276   0838 32 0F FF        LD (SYSMODE), A          ; Examine mode
1277   083B 3E 40           LD A, 01000000b
1278   083D 32 00 FF        LD (DIG_0), A
1279   0840 32 01 FF        LD (DIG_1), A
1280   0843 32 02 FF        LD (DIG_2), A
1281   0846 32 03 FF        LD (DIG_3), A
1282   0849 C3 D5 00        JP  EXIT_SYS
1283   084C             
1284   084C             GO_ADD_MODIFY:
1285   084C 2A 0D FF        LD  HL, (PC_RAM)
1286   084F 23              INC HL
1287   0850 22 0D FF        LD  (PC_RAM), HL
1288   0853 CD AD 09        CALL  PRINT_HL
1289   0856             GO_MODIFY:
1290   0856 3E 01           LD  A, $01                  ; Set count 2 digits, position display
1291   0858 32 13 FF        LD  (MDF_COUNT), A
1292   085B 3E 03           LD  A, $03                  ; moDify mode (Memory)
1293   085D 32 0F FF        LD  (SYSMODE), A
1294   0860 3E 40           LD  A, 01000000b
1295   0862 32 06 FF        LD  (DIG_6), A
1296   0865 32 07 FF        LD  (DIG_7), A
1297   0868 C3 D5 00        JP  EXIT_SYS
1298   086B             
1299   086B             GO_MONITOR:
1300   086B CD 1E 09        CALL  CLEAR_DISPLAY
1301   086E 3E 01           LD  A, $01
1302   0870 32 0F FF        LD  (SYSMODE), A
1303   0873 C3 D5 00        JP  EXIT_SYS
1304   0876             
1305   0876             GO_SHOW_REG_PC:
1306   0876 CD 1E 09        CALL CLEAR_DISPLAY
1307   0879 3E 04           LD  A, $04
1308   087B 32 0F FF        LD  (SYSMODE), A
1309   087E C3 D5 00        JP  EXIT_SYS
1310   0881             
1311   0881             GO_SHOW_REG_SP:
1312   0881 CD 1E 09        CALL CLEAR_DISPLAY
1313   0884 3E 05           LD  A, $05
1314   0886 32 0F FF        LD  (SYSMODE), A
1315   0889 C3 D5 00        JP  EXIT_SYS
1316   088C             
1317   088C             GO_SHOW_REG_AF:
1318   088C CD 1E 09        CALL CLEAR_DISPLAY
1319   088F 3E 06           LD  A, $06
1320   0891 32 0F FF        LD  (SYSMODE), A
1321   0894 C3 D5 00        JP  EXIT_SYS
1322   0897             
1323   0897             GO_SHOW_REG_BC:
1324   0897 CD 1E 09        CALL CLEAR_DISPLAY
1325   089A 3E 07           LD  A, $07
1326   089C 32 0F FF        LD  (SYSMODE), A
1327   089F C3 D5 00        JP  EXIT_SYS
1328   08A2             
1329   08A2             GO_SHOW_REG_DE:
1330   08A2 CD 1E 09        CALL CLEAR_DISPLAY
1331   08A5 3E 08           LD  A, $08
1332   08A7 32 0F FF        LD  (SYSMODE), A
1333   08AA C3 D5 00        JP  EXIT_SYS
1334   08AD             
1335   08AD             GO_SHOW_REG_HL:
1336   08AD CD 1E 09        CALL CLEAR_DISPLAY
1337   08B0 3E 09           LD  A, $09
1338   08B2 32 0F FF        LD  (SYSMODE), A
1339   08B5 C3 D5 00        JP  EXIT_SYS
1340   08B8             
1341   08B8             GO_SHOW_REG_IX:
1342   08B8 CD 1E 09        CALL CLEAR_DISPLAY
1343   08BB 3E 0A           LD  A, $0A
1344   08BD 32 0F FF        LD  (SYSMODE), A
1345   08C0 C3 D5 00        JP  EXIT_SYS
1346   08C3             
1347   08C3             GO_SHOW_REG_IY:
1348   08C3 CD 1E 09        CALL CLEAR_DISPLAY
1349   08C6 3E 0B           LD  A, $0B
1350   08C8 32 0F FF        LD  (SYSMODE), A
1351   08CB C3 D5 00        JP  EXIT_SYS
1352   08CE             
1353   08CE             GO_SHOW_REG_AFaux:
1354   08CE CD 1E 09        CALL CLEAR_DISPLAY
1355   08D1 3E 0C           LD  A, $0C
1356   08D3 32 0F FF        LD  (SYSMODE), A
1357   08D6 C3 D5 00        JP  EXIT_SYS
1358   08D9             
1359   08D9             GO_SHOW_REG_BCaux:
1360   08D9 CD 1E 09        CALL CLEAR_DISPLAY
1361   08DC 3E 0D           LD  A, $0D
1362   08DE 32 0F FF        LD  (SYSMODE), A
1363   08E1 C3 D5 00        JP  EXIT_SYS
1364   08E4             
1365   08E4             GO_SHOW_REG_DEaux:
1366   08E4 CD 1E 09        CALL CLEAR_DISPLAY
1367   08E7 3E 0E           LD  A, $0E
1368   08E9 32 0F FF        LD  (SYSMODE), A
1369   08EC C3 D5 00        JP  EXIT_SYS
1370   08EF             
1371   08EF             GO_SHOW_REG_HLaux:
1372   08EF CD 1E 09        CALL CLEAR_DISPLAY
1373   08F2 3E 0F           LD  A, $0F
1374   08F4 32 0F FF        LD  (SYSMODE), A
1375   08F7 C3 D5 00        JP  EXIT_SYS
1376   08FA             
1377   08FA             GO_HALT:
1378   08FA 3E 76           LD  A, $76
1379   08FC 32 0F FF        LD  (SYSMODE), A
1380   08FF 21 A3 0A        LD  HL, START_LOOP
1381   0902 22 14 FF        LD  (USR_PC), HL
1382   0905 C3 D5 00        JP  EXIT_SYS
1383   0908             
1384   0908             FIRE:
1385   0908 3E 01           LD  A, 1
1386   090A 32 0F FF        LD (SYSMODE), A          ; Monitor mode
1387   090D 2A 0D FF        LD  HL, (PC_RAM)
1388   0910 22 14 FF        LD  (USR_PC), HL
1389   0913 C3 D5 00        JP  EXIT_SYS
1390   0916             
1391   0916             GO_USER_MODE:
1392   0916 3E 00           LD  A, 0
1393   0918 32 0F FF        LD  (SYSMODE), A
1394   091B C3 D5 00        JP  EXIT_SYS
1395   091E             
1396   091E             ; =========================================================
1397   091E             ; LIMPA DISPLAY
1398   091E             ; =========================================================
1399   091E             CLEAR_DISPLAY:
1400   091E F5              PUSH  AF
1401   091F 3E 00           LD  A, 0
1402   0921 32 00 FF        LD  (DIG_0), A
1403   0924 32 01 FF        LD  (DIG_1), A
1404   0927 32 02 FF        LD  (DIG_2), A
1405   092A 32 03 FF        LD  (DIG_3), A
1406   092D 32 04 FF        LD  (DIG_4), A
1407   0930 32 05 FF        LD  (DIG_5), A
1408   0933 32 06 FF        LD  (DIG_6), A
1409   0936 32 07 FF        LD  (DIG_7), A
1410   0939 F1              POP  AF
1411   093A C9              RET
1412   093B             
1413   093B             ; =========================================================
1414   093B             ; LIMPA USER DISPLAY
1415   093B             ; =========================================================
1416   093B             CLEAR_USER_DISPLAY:
1417   093B F5              PUSH  AF
1418   093C 3E 00           LD  A, 0
1419   093E 32 D0 FF        LD  (USER_DISP0), A
1420   0941 32 D1 FF        LD  (USER_DISP1), A
1421   0944 32 D2 FF        LD  (USER_DISP2), A
1422   0947 32 D3 FF        LD  (USER_DISP3), A
1423   094A 32 D4 FF        LD  (USER_DISP4), A
1424   094D 32 D5 FF        LD  (USER_DISP5), A
1425   0950 32 D6 FF        LD  (USER_DISP6), A
1426   0953 32 D7 FF        LD  (USER_DISP7), A
1427   0956 F1              POP  AF
1428   0957 C9              RET
1429   0958             
1430   0958             
1431   0958             ; =========================================================
1432   0958             ; PEGA LOW NUM EM A E RETORNA CHAR 7SEG EM A
1433   0958             ; =========================================================
1434   0958             GET_NUM_FROM_LOW:
1435   0958 E5              PUSH    HL
1436   0959 C5              PUSH    BC
1437   095A 21 D0 0A        LD      HL, LED_FONT
1438   095D E6 0F           AND     $0F
1439   095F 01 00 00        LD      BC, 0
1440   0962 4F              LD      C, A
1441   0963 09              ADD     HL, BC
1442   0964 7E              LD      A, (HL)
1443   0965 C1              POP     BC
1444   0966 E1              POP     HL
1445   0967 C9              RET
1446   0968             
1447   0968             ; =========================================================
1448   0968             ; PEGA HIGH NUM EM A E RETORNA CHAR 7SEG EM A
1449   0968             ; =========================================================
1450   0968             GET_NUM_FROM_HIGH:
1451   0968 E5              PUSH    HL
1452   0969 C5              PUSH    BC
1453   096A 21 D0 0A        LD      HL, LED_FONT
1454   096D E6 F0           AND     $F0
1455   096F CB 0F           RRC     A
1456   0971 CB 0F           RRC     A
1457   0973 CB 0F           RRC     A
1458   0975 CB 0F           RRC     A
1459   0977 01 00 00        LD      BC, 0
1460   097A 4F              LD      C, A
1461   097B 09              ADD     HL, BC
1462   097C 7E              LD      A, (HL)
1463   097D C1              POP     BC
1464   097E E1              POP     HL
1465   097F C9              RET
1466   0980             
1467   0980             ; =========================================================
1468   0980             ; Mostra o que esta em A nos digitos 6 e 7
1469   0980             ; =========================================================
1470   0980             PRINT_A:
1471   0980 E5              PUSH    HL
1472   0981 C5              PUSH    BC
1473   0982 F5              PUSH    AF
1474   0983 F5              PUSH    AF
1475   0984             
1476   0984 21 D0 0A        LD	HL, LED_FONT
1477   0987 E6 0F           AND $0F
1478   0989 01 00 00        LD      BC, 0
1479   098C 4F              LD      C, A
1480   098D 09              ADD HL, BC
1481   098E 7E              LD  A, (HL)
1482   098F 32 07 FF        LD  (DIG_7), A
1483   0992             
1484   0992 F1              POP    AF
1485   0993 21 D0 0A        LD	HL, LED_FONT
1486   0996 E6 F0           AND  $F0
1487   0998 CB 0F           RRC  A
1488   099A CB 0F           RRC  A
1489   099C CB 0F           RRC  A
1490   099E CB 0F           RRC  A
1491   09A0 01 00 00        LD      BC, 0
1492   09A3 4F              LD      C, A
1493   09A4 09              ADD HL, BC
1494   09A5 7E              LD  A, (HL)
1495   09A6 32 06 FF        LD  (DIG_6), A
1496   09A9             
1497   09A9 F1              POP     AF
1498   09AA C1              POP     BC
1499   09AB E1              POP     HL
1500   09AC C9              RET
1501   09AD             
1502   09AD             ; =========================================================
1503   09AD             ; Mostra o que esta em HL - Display(HHLLXXXX)
1504   09AD             ; =========================================================
1505   09AD             PRINT_HL:
1506   09AD F5              PUSH  AF
1507   09AE E5              PUSH  HL
1508   09AF C5              PUSH  BC
1509   09B0             
1510   09B0 E5              PUSH  HL
1511   09B1 E5              PUSH  HL
1512   09B2 E5              PUSH  HL
1513   09B3             
1514   09B3 7D              LD  A, L
1515   09B4 21 D0 0A        LD	HL, LED_FONT
1516   09B7 E6 0F           AND $0F
1517   09B9 01 00 00        LD      BC, 0
1518   09BC 4F              LD      C, A
1519   09BD 09              ADD HL, BC
1520   09BE 7E              LD  A, (HL)
1521   09BF 21 03 FF        LD  HL, DIG_3
1522   09C2 77              LD  (HL), A
1523   09C3             
1524   09C3 E1              POP  HL
1525   09C4 7D              LD  A, L
1526   09C5 21 D0 0A        LD	HL, LED_FONT
1527   09C8 E6 F0           AND  $F0
1528   09CA CB 0F           RRC  A
1529   09CC CB 0F           RRC  A
1530   09CE CB 0F           RRC  A
1531   09D0 CB 0F           RRC  A
1532   09D2 01 00 00        LD      BC, 0
1533   09D5 4F              LD      C, A
1534   09D6 09              ADD HL, BC
1535   09D7 7E              LD  A, (HL)
1536   09D8 21 02 FF        LD  HL, DIG_2
1537   09DB 77              LD  (HL), A
1538   09DC             
1539   09DC E1              POP  HL
1540   09DD 7C              LD  A, H
1541   09DE 21 D0 0A        LD	HL, LED_FONT
1542   09E1 E6 0F           AND $0F
1543   09E3 01 00 00        LD      BC, 0
1544   09E6 4F              LD      C, A
1545   09E7 09              ADD HL, BC
1546   09E8 7E              LD  A, (HL)
1547   09E9 21 01 FF        LD  HL, DIG_1
1548   09EC 77              LD  (HL), A
1549   09ED             
1550   09ED E1              POP  HL
1551   09EE 7C              LD  A, H
1552   09EF 21 D0 0A        LD	HL, LED_FONT
1553   09F2 E6 F0           AND  $F0
1554   09F4 CB 0F           RRC  A
1555   09F6 CB 0F           RRC  A
1556   09F8 CB 0F           RRC  A
1557   09FA CB 0F           RRC  A
1558   09FC 01 00 00        LD      BC, 0
1559   09FF 4F              LD      C, A
1560   0A00 09              ADD HL, BC
1561   0A01 7E              LD  A, (HL)
1562   0A02 21 00 FF        LD  HL, DIG_0
1563   0A05 77              LD  (HL), A
1564   0A06             
1565   0A06 C1              POP  BC
1566   0A07 E1              POP  HL
1567   0A08 F1              POP  AF
1568   0A09             
1569   0A09 C9              RET
1570   0A0A             
1571   0A0A             ; =========================================================
1572   0A0A             ; Mostra o que esta em HL - Display(XXXXHHLL)
1573   0A0A             ; =========================================================
1574   0A0A             PRINT_END_HL:
1575   0A0A F5              PUSH  AF
1576   0A0B E5              PUSH  HL
1577   0A0C C5              PUSH  BC
1578   0A0D             
1579   0A0D E5              PUSH  HL
1580   0A0E E5              PUSH  HL
1581   0A0F E5              PUSH  HL
1582   0A10             
1583   0A10 7D              LD  A, L
1584   0A11 21 D0 0A        LD	HL, LED_FONT
1585   0A14 E6 0F           AND $0F
1586   0A16 01 00 00        LD      BC, 0
1587   0A19 4F              LD      C, A
1588   0A1A 09              ADD HL, BC
1589   0A1B 7E              LD  A, (HL)
1590   0A1C 21 07 FF        LD  HL, DIG_7
1591   0A1F 77              LD  (HL), A
1592   0A20             
1593   0A20 E1              POP  HL
1594   0A21 7D              LD  A, L
1595   0A22 21 D0 0A        LD	HL, LED_FONT
1596   0A25 E6 F0           AND  $F0
1597   0A27 CB 0F           RRC  A
1598   0A29 CB 0F           RRC  A
1599   0A2B CB 0F           RRC  A
1600   0A2D CB 0F           RRC  A
1601   0A2F 01 00 00        LD      BC, 0
1602   0A32 4F              LD      C, A
1603   0A33 09              ADD HL, BC
1604   0A34 7E              LD  A, (HL)
1605   0A35 21 06 FF        LD  HL, DIG_6
1606   0A38 77              LD  (HL), A
1607   0A39             
1608   0A39 E1              POP  HL
1609   0A3A 7C              LD  A, H
1610   0A3B 21 D0 0A        LD	HL, LED_FONT
1611   0A3E E6 0F           AND $0F
1612   0A40 01 00 00        LD      BC, 0
1613   0A43 4F              LD      C, A
1614   0A44 09              ADD HL, BC
1615   0A45 7E              LD  A, (HL)
1616   0A46 21 05 FF        LD  HL, DIG_5
1617   0A49 77              LD  (HL), A
1618   0A4A             
1619   0A4A E1              POP  HL
1620   0A4B 7C              LD  A, H
1621   0A4C 21 D0 0A        LD	HL, LED_FONT
1622   0A4F E6 F0           AND  $F0
1623   0A51 CB 0F           RRC  A
1624   0A53 CB 0F           RRC  A
1625   0A55 CB 0F           RRC  A
1626   0A57 CB 0F           RRC  A
1627   0A59 01 00 00        LD      BC, 0
1628   0A5C 4F              LD      C, A
1629   0A5D 09              ADD HL, BC
1630   0A5E 7E              LD  A, (HL)
1631   0A5F 21 04 FF        LD  HL, DIG_4
1632   0A62 77              LD  (HL), A
1633   0A63             
1634   0A63 C1              POP  BC
1635   0A64 E1              POP  HL
1636   0A65 F1              POP  AF
1637   0A66             
1638   0A66 C9              RET
1639   0A67             
1640   0A67             ; =========================================================
1641   0A67             ; Start Sistem ?
1642   0A67             ; =========================================================
1643   0A67             START:
1644   0A67 31 00 FF        LD  SP, STACK
1645   0A6A E5              PUSH HL                  ; Save HL
1646   0A6B F5              PUSH AF                  ; Save AF
1647   0A6C             
1648   0A6C 21 00 80        LD  HL, START_RAM
1649   0A6F 22 0D FF        LD  (PC_RAM), HL
1650   0A72             
1651   0A72                 ; start vars
1652   0A72 3E 64           LD  A, CKEY_TIMEOUT
1653   0A74 32 0B FF        LD  (KEY_TIMEOUT), A
1654   0A77             
1655   0A77 3E 01           LD  A, 1                 ; Monitor mode
1656   0A79 32 0F FF        LD  (SYSMODE), A
1657   0A7C             
1658   0A7C 3E FF           LD A, $FF
1659   0A7E 32 08 FF        LD (KEY_PRESS), A
1660   0A81             
1661   0A81 3E 00           LD  A, $00
1662   0A83 32 00 FF        LD  (DIG_0), A
1663   0A86 32 01 FF        LD  (DIG_1), A
1664   0A89 32 02 FF        LD  (DIG_2), A
1665   0A8C 32 03 FF        LD  (DIG_3), A
1666   0A8F 32 04 FF        LD  (DIG_4), A
1667   0A92 32 05 FF        LD  (DIG_5), A
1668   0A95 32 06 FF        LD  (DIG_6), A
1669   0A98 32 07 FF        LD  (DIG_7), A
1670   0A9B             
1671   0A9B             
1672   0A9B ED 56           IM  1
1673   0A9D FB              EI
1674   0A9E             
1675   0A9E AF              XOR A
1676   0A9F D3 40           OUT (Port40), A
1677   0AA1             
1678   0AA1 F1              POP AF                   ; Recovery AF
1679   0AA2 E1              POP HL                   ; Recovery HL
1680   0AA3             START_LOOP:
1681   0AA3             
1682   0AA3 C3 A3 0A        JP START_LOOP
1683   0AA6             
1684   0AA6             
1685   0AA6             
1686   0AA6             
1687   0AA6             
1688   0AA6             
1689   0AA6             
1690   0AA6             
1691   0AA6             
1692   0AA6             ; =========================================================
1693   0AA6             ; Delay
1694   0AA6             ; =========================================================
1695   0AA6             delay:
1696   0AA6 C5          	push bc                       ; 2.75 us
1697   0AA7 06 FF           ld b, 255                     ; 1.75 us
1698   0AA9             delay_loop_b:
1699   0AA9 0E FF       	ld c, 255                     ; 1.75 us
1700   0AAB             delay_loop:
1701   0AAB 0D          	dec c                         ; 1 us
1702   0AAC C2 AB 0A        jp nz, delay_loop             ; true = 3 us, false 1.75 us
1703   0AAF 05              dec b                         ; 1 us
1704   0AB0 C2 A9 0A        jp nz, delay_loop_b           ; true = 3 us, false 1.75 us
1705   0AB3 C1              pop bc                        ; 2.50 us
1706   0AB4 C9              ret                           ; 2.50 us
1707   0AB5             
1708   0AB5             
1709   0AB5             ;============================================================================
1710   0AB5             ;	Subroutine	Delay_A
1711   0AB5             ;
1712   0AB5             ;	Entry:	A = Millisecond count
1713   0AB5             ;============================================================================
1714   0AB5 E5          DELAY_A:	PUSH	HL			; Save count
1715   0AB6 21 10 FF    		LD	HL,TicCounter
1716   0AB9 86          		ADD	A,(HL)			; A = cycle count
1717   0ABA BE          DlyLp		CP	(HL)			; Wait required TicCounter times
1718   0ABB C2 BA 0A    		JP	NZ,DlyLp		;  loop if not done
1719   0ABE E1          		POP	HL
1720   0ABF C9          		RET
1721   0AC0             
1722   0AC0             
1723   0AC0 0E 01       DELAY_100mS	LD	C,1
1724   0AC2 C5          DELAY_C		PUSH	BC
1725   0AC3 06 00       		LD	B,0
1726   0AC5 C5          DELAY_LP	PUSH	BC
1727   0AC6 10 FE       		DJNZ	$		;13   * 256 / 4 = 832uSec
1728   0AC8 C1          		POP	BC
1729   0AC9 10 FA       		DJNZ	DELAY_LP	;~100mSEC
1730   0ACB 0D          		DEC	C
1731   0ACC 20 F7       		JR  NZ,	DELAY_LP	;*4 ~= 7mSec
1732   0ACE C1          		POP	BC
1733   0ACF C9          		RET
1734   0AD0             
1735   0AD0             ; Mapa char to display 0-F
1736   0AD0 3F065B4F666DLED_FONT .db $3F, $06, $5B, $4F, $66, $6D, $7D, $07, $7F, $67 ; 0-9
1736   0AD6 7D077F67
1737   0ADA 777C395E7971         .DB $77, $7C, $39, $5E, $79, $71                     ; A-F
1738   0AE0             
1739   0AE0             
1740   0AE0             
1741   0AE0             
1742   0AE0             ; ---------------------------------------------------------
1743   0AE0             ;   FFFFFFFF      I     MM           MM
1744   0AE0             ;   F             I     M  M       M  M
1745   0AE0             ;   F             I     M    M   M    M
1746   0AE0             ;   FFFFFFF       I     M      M      M
1747   0AE0             ;   F             I     M             M
1748   0AE0             ;   F             I     M             M
1749   0AE0             ;   F             I     M             M
1750   0AE0             ;
1751   0AE0             ; ---------------------------------------------------------
1752   0AE0             
1753   0AE0             
1754   0AE0             
1755   0AE0             
1756   0AE0             
1757   0AE0             
1758   0AE0             ; ---------------------------------------------------------
1759   0AE0             ; Utilitys Program .ORG 2000h
1760   0AE0             ; ---------------------------------------------------------
1761   2000             .org 2000h
1762   2000 C3 15 20    JP_CLEAR_RAM_FF              JP CLEAR_RAM_FF               ; 2000
1763   2003 C3 3F 20    JP_LOAD_FROM_IR              JP LOAD_FROM_IR               ; 2003
1764   2006 C3 A3 20    JP_TESTE_SOM                 JP TESTE_SOM                  ; 2006
1765   2009 C3 1C 21    JP_ANIMATE_LED1              JP ANIMATE_LED1               ; 2009
1766   200C C3 58 21    JP_COUNT_DOWN_ALERME         JP COUNT_DOWN_ALERME          ; 200C
1767   200F C3 FE 21    JP_CONTROLE_SONY             JP CONTROLE_SONY              ; 200F
1768   2012 C3 02 23    JP_CALC_SUM                  JP CALC_SUM                   ; 2012
1769   2015             
1770   2015             
1771   2015             
1772   2015             
1773   2015             
1774   2015             
1775   2015             
1776   2015             
1777   2015             ; ---------------------------------------------------------
1778   2015             ; RAM MAP - Utilitys Program | $FE00 - $FEFF
1779   2015             ; ---------------------------------------------------------
1780   2015             DIEGO      .equ    $FE00   ;(2) Temp Digits to countDown
1781   2015             
1782   2015             
1783   2015             ; ---------------------------------------------------------
1784   2015             ; Utilitys Program | CLEAR RAM
1785   2015             ; ---------------------------------------------------------
1786   2015             CLEAR_RAM_FF:
1787   2015 21 00 FE        LD  HL, $FE00
1788   2018 06 FF           LD  B, $FF
1789   201A             CLEAR_RAM_FF_LOOP:
1790   201A 2B              DEC HL
1791   201B 70              LD (HL), B
1792   201C 7C              LD A, H
1793   201D FE 80           CP $80
1794   201F CA 25 20        JP Z, CLEAR_RAM_FF_CHECK_L
1795   2022 C3 1A 20        JP CLEAR_RAM_FF_LOOP
1796   2025             
1797   2025             CLEAR_RAM_FF_CHECK_L:
1798   2025 7D              LD A, L
1799   2026 FE 00           CP $00
1800   2028 CA 2E 20        JP Z, CLEAR_RAM_FF_END
1801   202B C3 1A 20        JP CLEAR_RAM_FF_LOOP
1802   202E             CLEAR_RAM_FF_END:
1803   202E 3E C3           LD A, $C3
1804   2030 32 FD FD        LD ($FDFD), A
1805   2033 AF              XOR A
1806   2034 32 FE FD        LD ($FDFE), A
1807   2037 3E 80           LD A, $80
1808   2039 32 FF FD        LD ($FDFF), A
1809   203C CA A3 0A        JP Z, START_LOOP
1810   203F             
1811   203F             
1812   203F             ; ---------------------------------------------------------
1813   203F             ; Utilitys Program | LOAD RAM FROM IR (NanoTac)
1814   203F             ; ---------------------------------------------------------
1815   203F             LOAD_FROM_IR:
1816   203F F3              DI                       ; deliga monitor (int38)
1817   2040 21 00 80        LD HL, $8000           ; inicio ram
1818   2043             LFI_START:
1819   2043 01 00 00        LD  BC, 0                ; B - time, C - Count
1820   2046 16 00           LD  D, 0                 ; D, Data
1821   2048             LFI_CK1:                         ; aguarda nivel 0
1822   2048 DB 40           IN A, (Port40)
1823   204A CB 7F           BIT 7, A
1824   204C C2 48 20        JP NZ, LFI_CK1
1825   204F             LFI_COD_START:               ; Recebe Start (9)
1826   204F 04              INC B                    ; B = time, INC B
1827   2050 CD F7 22        CALL CONTROLE_DELAY
1828   2053 DB 40           IN  A, (Port40)
1829   2055 CB 7F           BIT 7, A
1830   2057 CA 4F 20        JP Z, LFI_COD_START      ; loop até nivel 1
1831   205A             
1832   205A 78              LD A, B
1833   205B FE 09           CP 9                     ; start time = 9
1834   205D C2 43 20        JP NZ, LFI_START         ; se não é start - reinicia
1835   2060             
1836   2060             LFI_GET_NEXT:
1837   2060             ; agora começa a pegar os commandos
1838   2060 16 00           LD  D, 0                 ; zera data
1839   2062 0E 07           LD  C, 7                 ; data tem 8 bits
1840   2064             LFI_LOOP:                    ; Aguarda nivel 0
1841   2064 DB 40           IN A, (Port40)
1842   2066 CB 7F           BIT 7, A
1843   2068 C2 64 20        JP NZ, LFI_LOOP
1844   206B             
1845   206B 06 00           LD  B, 0                  ; B = time
1846   206D             LFI_LOOP2:                    ; Recebeu alguma coisa
1847   206D 04              INC B
1848   206E CD 98 20        CALL LFI_DELAY
1849   2071 DB 40           IN  A, (Port40)
1850   2073 CB 7F           BIT 7, A
1851   2075 CA 6D 20        JP Z, LFI_LOOP2  ; aguarda nivel 1
1852   2078             
1853   2078 78              LD A, B
1854   2079 FE 09           CP 9
1855   207B CA 67 0A        JP Z, START              ; Back to minitor
1856   207E FE 05           CP 5                     ; 5 HIGH, 3 LOW
1857   2080 C2 85 20        JP NZ, LFI_ZERO
1858   2083 CB C2           SET 0, D
1859   2085             
1860   2085             LFI_ZERO:
1861   2085 79              LD A, C
1862   2086 FE 00           CP 0
1863   2088 CA 93 20        JP Z, LFI_BYTE_OK 
1864   208B             
1865   208B CB 02           RLC D
1866   208D 06 00           LD B, 0
1867   208F 0D              DEC C
1868   2090             
1869   2090 C3 64 20        JP LFI_LOOP
1870   2093             
1871   2093                 
1872   2093             
1873   2093             LFI_BYTE_OK:
1874   2093 72              LD  (HL), D
1875   2094 23              INC HL
1876   2095 C3 60 20        JP LFI_GET_NEXT
1877   2098             
1878   2098             
1879   2098             LFI_DELAY:
1880   2098 F5              PUSH AF
1881   2099 3E 32           LD A, 50
1882   209B             LFI_DELAY_LOOP:
1883   209B 3D              DEC A
1884   209C FE 00           CP 0
1885   209E C2 9B 20        JP NZ, LFI_DELAY_LOOP
1886   20A1 F1              POP AF
1887   20A2 C9              RET
1888   20A3             
1889   20A3             
1890   20A3             
1891   20A3             ; ---------------------------------------------------------
1892   20A3             ; Utilitys Program | TESTE SOM 
1893   20A3             ; 
1894   20A3             ; Key F     = $00 - $FF na saida C0
1895   20A3             ; Key A e B = Incrementa e Decrementa Saida C0
1896   20A3             ; ---------------------------------------------------------
1897   20A3             TESTE_SOM:
1898   20A3 3E 00           LD  A, 0
1899   20A5 32 0F FF        LD  (SYSMODE), A
1900   20A8 3E 00           LD  A, 0
1901   20AA 47              LD  B, A
1902   20AB CD 3B 09        CALL CLEAR_USER_DISPLAY
1903   20AE 3E 6D           LD  A, $6D ; S
1904   20B0 32 D0 FF        LD  (USER_DISP0), A
1905   20B3 3E 3F           LD  A, $3F ; O
1906   20B5 32 D1 FF        LD  (USER_DISP1), A
1907   20B8 3E 1C           LD  A, $1C ; U
1908   20BA 32 D2 FF        LD  (USER_DISP2), A
1909   20BD 3E 54           LD  A, $54 ; N
1910   20BF 32 D3 FF        LD  (USER_DISP3), A
1911   20C2 3E 5E           LD  A, $5E ; D
1912   20C4 32 D4 FF        LD  (USER_DISP4), A
1913   20C7             LOOP_SOM:
1914   20C7 78              LD  A, B
1915   20C8 CD 58 09        CALL GET_NUM_FROM_LOW
1916   20CB 32 D7 FF        LD  (USER_DISP7), A
1917   20CE 78              LD  A, B
1918   20CF CD 68 09        CALL GET_NUM_FROM_HIGH
1919   20D2 32 D6 FF        LD  (USER_DISP6), A
1920   20D5             
1921   20D5 CD 59 07        CALL GET_KEY_A
1922   20D8 FE 0A           CP  $0A
1923   20DA CA EA 20        JP  Z, SOM_INC
1924   20DD FE 0B           CP  $0B
1925   20DF CA F5 20        JP  Z, SOM_DEC
1926   20E2 FE 0F           CP  $0F
1927   20E4 CA 00 21        JP  Z, SOM_LOOP_INC
1928   20E7 C3 C7 20        JP  LOOP_SOM
1929   20EA             
1930   20EA             
1931   20EA             SOM_INC:
1932   20EA 04              INC B
1933   20EB 0E C0           LD  C, $C0
1934   20ED ED 41           OUT (C), B
1935   20EF CD C0 0A        CALL DELAY_100mS
1936   20F2 C3 C7 20        JP  LOOP_SOM
1937   20F5             
1938   20F5             SOM_DEC:
1939   20F5 05              DEC B
1940   20F6 0E C0           LD  C, $C0
1941   20F8 ED 41           OUT (C), B
1942   20FA CD C0 0A        CALL DELAY_100mS
1943   20FD C3 C7 20        JP  LOOP_SOM
1944   2100             
1945   2100             SOM_LOOP_INC:
1946   2100 78              LD  A, B
1947   2101 CD 58 09        CALL GET_NUM_FROM_LOW
1948   2104 32 D7 FF        LD  (USER_DISP7), A
1949   2107 78              LD  A, B
1950   2108 CD 68 09        CALL GET_NUM_FROM_HIGH
1951   210B 32 D6 FF        LD  (USER_DISP6), A
1952   210E 04              INC B
1953   210F 0E C0           LD  C, $C0
1954   2111 ED 41           OUT (C), B
1955   2113 CD C0 0A        CALL DELAY_100mS
1956   2116 CD C0 0A        CALL DELAY_100mS
1957   2119 C3 00 21        JP  SOM_LOOP_INC
1958   211C             
1959   211C             
1960   211C             ; ---------------------------------------------------------
1961   211C             ; Utilitys Program | Animação led
1962   211C             ; ---------------------------------------------------------
1963   211C             ANIMATE_LED1:
1964   211C CD 3B 09        CALL CLEAR_USER_DISPLAY
1965   211F 3E 00           LD  A, 0                 ; user mode
1966   2121 32 0F FF        LD (SYSMODE), A
1967   2124             
1968   2124 06 08           LD  B, $08
1969   2126 21 D0 FF        LD  HL, USER_DISP0
1970   2129 3E 08           LD  A, 8
1971   212B             
1972   212B             LEDS_LOOP:
1973   212B CD 3B 09        CALL CLEAR_USER_DISPLAY
1974   212E 70              LD  (HL), B
1975   212F CD C0 0A        CALL DELAY_100mS
1976   2132 23              INC HL
1977   2133 3D              DEC A
1978   2134 FE 00           CP 0
1979   2136 C2 2B 21        JP NZ, LEDS_LOOP
1980   2139             
1981   2139 3E 08           LD A, 8
1982   213B 21 D7 FF        LD  HL, USER_DISP7
1983   213E 06 40           LD  B, $40
1984   2140             
1985   2140             LEDS_LOOP2:
1986   2140 CD 3B 09        CALL CLEAR_USER_DISPLAY
1987   2143 70              LD  (HL), B
1988   2144 CD C0 0A        CALL DELAY_100mS
1989   2147 2B              DEC HL
1990   2148 3D              DEC A
1991   2149 FE 00           CP 0
1992   214B C2 40 21        JP NZ, LEDS_LOOP2
1993   214E             
1994   214E 3E 08           LD  A, 8
1995   2150 21 D0 FF        LD  HL, USER_DISP0
1996   2153 06 08           LD  B, $08
1997   2155 C3 2B 21        JP LEDS_LOOP
1998   2158             
1999   2158             
2000   2158             ; ---------------------------------------------------------
2001   2158             ; Utilitys Program | CountDown XX
2002   2158             ; OBS: Usa a placa de som para o alarme
2003   2158             ; ---------------------------------------------------------
2004   2158             COUNT_DOWN_ALERME:
2005   2158                 ; timer count down
2006   2158             
2007   2158 CD 3B 09        CALL CLEAR_USER_DISPLAY
2008   215B 3E 39           LD  A, $39
2009   215D 32 D0 FF        LD  (USER_DISP0), A
2010   2160             
2011   2160 3E 3F           LD  A, $3F
2012   2162 32 D1 FF        LD  (USER_DISP1), A
2013   2165             
2014   2165 3E 1C           LD  A, $1C
2015   2167 32 D2 FF        LD  (USER_DISP2), A
2016   216A             
2017   216A 3E 54           LD  A, $54
2018   216C 32 D3 FF        LD  (USER_DISP3), A
2019   216F             
2020   216F 3E 78           LD  A, $78
2021   2171 32 D4 FF        LD  (USER_DISP4), A
2022   2174             
2023   2174 3E 00           LD  A, $00
2024   2176 32 D5 FF        LD  (USER_DISP5), A
2025   2179             
2026   2179             
2027   2179             
2028   2179 3E 40           LD  A, $40
2029   217B 32 D6 FF        LD  (USER_DISP6), A
2030   217E             
2031   217E 3E 40           LD  A, $40
2032   2180 32 D7 FF        LD  (USER_DISP7), A
2033   2183             
2034   2183 3E 00           LD  A, 0                 ; user mode
2035   2185 32 0F FF        LD (SYSMODE), A
2036   2188             
2037   2188             READ:
2038   2188 CD 59 07        CALL GET_KEY_A
2039   218B FE FF           CP  $FF
2040   218D CA 88 21        JP  Z, READ
2041   2190             
2042   2190 CD A1 21        CALL  MODIFY_KEY_POS_1D
2043   2193             
2044   2193             READ2
2045   2193 CD 59 07        CALL GET_KEY_A
2046   2196 FE FF           CP  $FF
2047   2198 CA 93 21        JP  Z, READ2
2048   219B             
2049   219B CD AD 21        CALL MODIFY_KEY_POS_0D
2050   219E             
2051   219E C3 B8 21        JP  LOOP
2052   21A1             
2053   21A1             
2054   21A1             MODIFY_KEY_POS_1D:
2055   21A1 21 00 FE        LD  HL, DIEGO
2056   21A4 23              INC HL
2057   21A5 77              LD  (HL), A
2058   21A6 CD 58 09        CALL GET_NUM_FROM_LOW
2059   21A9 32 D6 FF        LD  (USER_DISP6), A
2060   21AC C9              RET
2061   21AD             
2062   21AD             MODIFY_KEY_POS_0D:
2063   21AD 21 00 FE        LD  HL, DIEGO
2064   21B0 77              LD  (HL), A
2065   21B1 CD 58 09        CALL GET_NUM_FROM_LOW
2066   21B4 32 D7 FF        LD  (USER_DISP7), A
2067   21B7 C9              RET
2068   21B8             
2069   21B8             LOOP:
2070   21B8 2A 00 FE        LD  HL, (DIEGO)
2071   21BB             
2072   21BB             LOOP_DOWN:
2073   21BB 7C              LD  A, H
2074   21BC CD 58 09        CALL GET_NUM_FROM_LOW
2075   21BF 32 D6 FF        LD  (USER_DISP6), A
2076   21C2             
2077   21C2 7D              LD  A, L
2078   21C3 CD 58 09        CALL GET_NUM_FROM_LOW
2079   21C6 32 D7 FF        LD  (USER_DISP7), A
2080   21C9             
2081   21C9 0E 07           LD C, 7    ; 10 x 100ms = 1seg
2082   21CB CD C2 0A        CALL DELAY_C
2083   21CE             
2084   21CE 7D              LD A, L
2085   21CF FE 00           CP 0
2086   21D1 CA D9 21        JP Z, DEC_H
2087   21D4 3D              DEC A
2088   21D5 6F              LD L, A
2089   21D6 C3 BB 21        JP LOOP_DOWN
2090   21D9             
2091   21D9             DEC_H:
2092   21D9 7C              LD  A, H
2093   21DA FE 00           CP 0
2094   21DC CA E7 21        JP Z, CHECK_L
2095   21DF 3D              DEC A
2096   21E0 67              LD H, A
2097   21E1 3E 09           LD A, 9
2098   21E3 6F              LD L, A
2099   21E4 C3 BB 21        JP LOOP_DOWN
2100   21E7             
2101   21E7             CHECK_L:
2102   21E7 7D              LD  A, L
2103   21E8 FE 00           CP 0
2104   21EA CA ED 21        JP Z, BEEP
2105   21ED             
2106   21ED             BEEP:
2107   21ED 3E 80           LD  A, $80
2108   21EF D3 C0           OUT  (PortC0), A
2109   21F1 CD C0 0A        CALL DELAY_100mS
2110   21F4             
2111   21F4 3E C0           LD  A, $C0
2112   21F6 D3 C0           OUT  (PortC0), A
2113   21F8 CD C0 0A        CALL DELAY_100mS
2114   21FB C3 ED 21        JP BEEP
2115   21FE             
2116   21FE             
2117   21FE             ; ---------------------------------------------------------
2118   21FE             ; Utilitys Program | IR Sensor
2119   21FE             ; ---------------------------------------------------------
2120   21FE             CONTROLE_SONY:
2121   21FE 3E 00           LD A, 0
2122   2200 32 00 80        LD ($8000), A            ; BUzzer
2123   2203             CONTROLE_IR:
2124   2203 F3              DI                       ; deliga monitor (int38)
2125   2204             
2126   2204 01 00 00        LD  BC, 0                ; B - time, C - Count
2127   2207 16 00           LD  D, 0                 ; D, Data
2128   2209             CIR:                         ; aguarda nivel 0
2129   2209 DB 40           IN A, (Port40)
2130   220B CB 7F           BIT 7, A
2131   220D C2 09 22        JP NZ, CIR
2132   2210             CIR_START:                   ; Recebe Start (9)
2133   2210 04              INC B                    ; B = time, INC B
2134   2211 CD F7 22        CALL CONTROLE_DELAY
2135   2214 DB 40           IN  A, (Port40)
2136   2216 CB 7F           BIT 7, A
2137   2218 CA 10 22        JP Z, CIR_START          ; loop até nivel 1
2138   221B             
2139   221B 78              LD A, B
2140   221C FE 09           CP 9                     ; start time = 9
2141   221E C2 03 22        JP NZ, CONTROLE_IR       ; se não é start - reinicia
2142   2221             
2143   2221             ; agora começa a pegar os commandos
2144   2221 16 00           LD  D, 0                     ; zera data
2145   2223 0E 06           LD  C, 6                     ; data tem 7 bits
2146   2225             CONTROLE_IR_LOOP:            ; Aguarda nivel 0
2147   2225 DB 40           IN A, (Port40)
2148   2227 CB 7F           BIT 7, A
2149   2229 C2 25 22        JP NZ, CONTROLE_IR_LOOP
2150   222C             
2151   222C 06 00           LD  B, 0                ; B = time
2152   222E             CONTROLE_IR_LOOP2:           ; Recebeu alguma coisa
2153   222E 04              INC B
2154   222F CD F7 22        CALL CONTROLE_DELAY
2155   2232 DB 40           IN  A, (Port40)
2156   2234 CB 7F           BIT 7, A
2157   2236 CA 2E 22        JP Z, CONTROLE_IR_LOOP2  ; aguarda nivel 1
2158   2239             
2159   2239 78              LD A, B
2160   223A FE 05           CP 5                     ; 5 HIGH, 3 LOW
2161   223C C2 41 22        JP NZ, CIR_ZERO
2162   223F CB C2           SET 0, D
2163   2241             
2164   2241             CIR_ZERO:
2165   2241 79              LD A, C
2166   2242 FE 00           CP 0
2167   2244 CA 4F 22        JP Z, CONTROLE_OK 
2168   2247             
2169   2247 CB 02           RLC D
2170   2249 06 00           LD B, 0
2171   224B 0D              DEC C
2172   224C             
2173   224C C3 25 22        JP CONTROLE_IR_LOOP
2174   224F             
2175   224F                 
2176   224F             
2177   224F             CONTROLE_OK:
2178   224F 7A              LD  A, D
2179   2250 32 00 90        LD ($9000), A           ; Save data $9000
2180   2253             
2181   2253             ; commando recebido em D
2182   2253 7A              LD A, D
2183   2254 FE 53           CP $53                   ; ok
2184   2256 CA DB 22        JP Z, CIR_OK
2185   2259 FE 63           CP $63                   ; Exit
2186   225B CA EE 22        JP Z, CIR_SAIR
2187   225E FE 54           CP $54                   ; power
2188   2260 CA C8 22        JP Z, CIR_TOGGLE_BUZZER
2189   2263 FE 52           CP $52
2190   2265 CA 7C 22        JP Z, CIR_R              ; red
2191   2268 FE 32           CP $32
2192   226A CA 8F 22        JP Z, CIR_G              ; green
2193   226D FE 72           CP $72
2194   226F CA A2 22        JP Z, CIR_Y              ; yellow
2195   2272 FE 12           CP $12
2196   2274 CA B5 22        JP Z, CIR_B              ; blue
2197   2277             
2198   2277 D3 40           OUT (Port40), A
2199   2279 C3 03 22        JP CONTROLE_IR
2200   227C             
2201   227C             
2202   227C             CIR_R:
2203   227C 3A 00 80        LD A, ($8000)
2204   227F EE 20           XOR $20
2205   2281 D3 C0           OUT (PortC0), A
2206   2283 32 00 80        LD ($8000), A
2207   2286 CD C0 0A        CALL DELAY_100mS
2208   2289 CD C0 0A        CALL DELAY_100mS
2209   228C C3 03 22        JP CONTROLE_IR
2210   228F             
2211   228F             CIR_G:
2212   228F 3A 00 80        LD A, ($8000)
2213   2292 EE 80           XOR $80
2214   2294 D3 C0           OUT (PortC0), A
2215   2296 32 00 80        LD ($8000), A
2216   2299 CD C0 0A        CALL DELAY_100mS
2217   229C CD C0 0A        CALL DELAY_100mS
2218   229F C3 03 22        JP CONTROLE_IR
2219   22A2             
2220   22A2             CIR_Y:
2221   22A2 3A 00 80        LD A, ($8000)
2222   22A5 EE 40           XOR $40
2223   22A7 D3 C0           OUT (PortC0), A
2224   22A9 32 00 80        LD ($8000), A
2225   22AC CD C0 0A        CALL DELAY_100mS
2226   22AF CD C0 0A        CALL DELAY_100mS
2227   22B2 C3 03 22        JP CONTROLE_IR
2228   22B5             
2229   22B5             CIR_B:
2230   22B5 3A 00 80        LD A, ($8000)
2231   22B8 EE 10           XOR $10
2232   22BA D3 C0           OUT (PortC0), A
2233   22BC 32 00 80        LD ($8000), A
2234   22BF CD C0 0A        CALL DELAY_100mS
2235   22C2 CD C0 0A        CALL DELAY_100mS
2236   22C5 C3 03 22        JP CONTROLE_IR
2237   22C8             
2238   22C8             
2239   22C8             CIR_TOGGLE_BUZZER:
2240   22C8 3A 00 80        LD A, ($8000)
2241   22CB EE 08           XOR $08
2242   22CD D3 C0           OUT (PortC0), A
2243   22CF 32 00 80        LD ($8000), A
2244   22D2 CD C0 0A        CALL DELAY_100mS
2245   22D5 CD C0 0A        CALL DELAY_100mS
2246   22D8 C3 03 22        JP CONTROLE_IR
2247   22DB             
2248   22DB             CIR_OK:
2249   22DB 3A 00 80        LD A, ($8000)
2250   22DE EE 01           XOR $01
2251   22E0 D3 C0           OUT (PortC0), A
2252   22E2 32 00 80        LD ($8000), A
2253   22E5 CD C0 0A        CALL DELAY_100mS
2254   22E8 CD C0 0A        CALL DELAY_100mS
2255   22EB C3 03 22        JP CONTROLE_IR
2256   22EE             
2257   22EE             CIR_SAIR:
2258   22EE                 ; retorna int
2259   22EE ED 56           IM  1
2260   22F0 FB              EI
2261   22F1 AF              XOR A
2262   22F2 D3 40           OUT (Port40), A
2263   22F4                 
2264   22F4             CONTROLE_IR_LOOP3:
2265   22F4 C3 F4 22        JP CONTROLE_IR_LOOP3
2266   22F7             
2267   22F7             
2268   22F7             CONTROLE_DELAY:
2269   22F7 F5              PUSH AF
2270   22F8 3E 32           LD A, 50
2271   22FA             CONTROLE_DELAY_LOOP:
2272   22FA 3D              DEC A
2273   22FB FE 00           CP 0
2274   22FD C2 FA 22        JP NZ, CONTROLE_DELAY_LOOP
2275   2300 F1              POP AF
2276   2301 C9              RET
2277   2302             
2278   2302             
2279   2302             
2280   2302             ; ---------------------------------------------------------
2281   2302             ; Utilitys Program | PROGRAM CALC XX + XX 
2282   2302             ; ---------------------------------------------------------
2283   2302             CALC_SUM:
2284   2302             NUM1     .equ      $8000
2285   2302             NUM2     .equ      $8001
2286   2302             RESULT1  .equ      $8002
2287   2302             RESULT2  .equ      $8003
2288   2302             
2289   2302 3E 00           LD  A, 0                 ; user mode
2290   2304 32 0F FF        LD (SYSMODE), A
2291   2307             
2292   2307 CD 3B 09        CALL CLEAR_USER_DISPLAY
2293   230A             
2294   230A 3E 40           LD  A, $40
2295   230C 32 D6 FF        LD  (USER_DISP6), A
2296   230F             
2297   230F 3E 40           LD  A, $40
2298   2311 32 D7 FF        LD  (USER_DISP7), A
2299   2314             
2300   2314 3E 00           LD A, 0
2301   2316 32 02 80        LD (RESULT1), A
2302   2319 32 03 80        LD (RESULT2), A
2303   231C             
2304   231C             READ01:
2305   231C CD 59 07        CALL GET_KEY_A
2306   231F FE FF           CP  $FF
2307   2321 CA 1C 23        JP  Z, READ01
2308   2324 F5              PUSH AF
2309   2325 CB 07           RLC A
2310   2327 CB 07           RLC A
2311   2329 CB 07           RLC A
2312   232B CB 07           RLC A
2313   232D 32 00 80        LD  (NUM1), A
2314   2330 F1              POP AF
2315   2331 CD 58 09        CALL GET_NUM_FROM_LOW
2316   2334 32 D6 FF        LD (USER_DISP6), A
2317   2337             
2318   2337             READ02:
2319   2337 CD 59 07        CALL GET_KEY_A
2320   233A FE FF           CP  $FF
2321   233C CA 37 23        JP  Z, READ02
2322   233F F5              PUSH AF
2323   2340 47              LD B, A
2324   2341 3A 00 80        LD A, (NUM1)
2325   2344 B0              OR B
2326   2345 32 00 80        LD (NUM1), A
2327   2348             
2328   2348 F1              POP AF
2329   2349 CD 58 09        CALL GET_NUM_FROM_LOW
2330   234C 32 D7 FF        LD (USER_DISP7), A
2331   234F             
2332   234F 3E FF           LD A, $FF
2333   2351 CD B5 0A        CALL DELAY_A
2334   2354             ; NUM2
2335   2354 3E 40           LD  A, $40
2336   2356 32 D6 FF        LD  (USER_DISP6), A
2337   2359             
2338   2359 3E 40           LD  A, $40
2339   235B 32 D7 FF        LD  (USER_DISP7), A
2340   235E             
2341   235E             READ03:
2342   235E CD 59 07        CALL GET_KEY_A
2343   2361 FE FF           CP  $FF
2344   2363 CA 5E 23        JP  Z, READ03
2345   2366 F5              PUSH AF
2346   2367 CB 07           RLC A
2347   2369 CB 07           RLC A
2348   236B CB 07           RLC A
2349   236D CB 07           RLC A
2350   236F 32 01 80        LD  (NUM2), A
2351   2372 F1              POP AF
2352   2373 CD 58 09        CALL GET_NUM_FROM_LOW
2353   2376 32 D6 FF        LD (USER_DISP6), A
2354   2379             
2355   2379             READ04:
2356   2379 CD 59 07        CALL GET_KEY_A
2357   237C FE FF           CP  $FF
2358   237E CA 79 23        JP  Z, READ04
2359   2381             
2360   2381 F5              PUSH AF
2361   2382 CD 58 09        CALL GET_NUM_FROM_LOW
2362   2385 32 D7 FF        LD (USER_DISP7), A
2363   2388 F1              POP AF
2364   2389 47              LD B, A
2365   238A 3A 01 80        LD A, (NUM2)
2366   238D B0              OR B
2367   238E 32 01 80        LD (NUM2), A
2368   2391             
2369   2391 3A 00 80        LD A, (NUM1)
2370   2394 47              LD B, A
2371   2395 3A 01 80        LD A, (NUM2)
2372   2398 80              ADD A, B
2373   2399 27              DAA
2374   239A 32 03 80        LD (RESULT2), A
2375   239D             
2376   239D D2 A7 23        JP NC, CALC_SUM_SHOW
2377   23A0 3A 02 80        LD A, (RESULT1)
2378   23A3 3C              INC A
2379   23A4 32 02 80        LD (RESULT1),A
2380   23A7             
2381   23A7             CALC_SUM_SHOW:
2382   23A7 3E FF           LD A, $FF
2383   23A9 CD B5 0A        CALL DELAY_A
2384   23AC             
2385   23AC 3A 02 80        LD A, (RESULT1)
2386   23AF FE 00           CP 0
2387   23B1 CA BA 23        JP Z, SHOW_NEXT
2388   23B4 CD 58 09        CALL GET_NUM_FROM_LOW
2389   23B7 32 D5 FF        LD (USER_DISP5), A
2390   23BA             
2391   23BA             SHOW_NEXT:
2392   23BA 3A 03 80        LD A, (RESULT2)
2393   23BD CD 68 09        CALL GET_NUM_FROM_HIGH
2394   23C0 32 D6 FF        LD (USER_DISP6), A
2395   23C3             
2396   23C3 3A 03 80        LD A, (RESULT2)
2397   23C6 CD 58 09        CALL GET_NUM_FROM_LOW
2398   23C9 32 D7 FF        LD (USER_DISP7), A
2399   23CC             
2400   23CC             CALC_SUM_LOOP:
2401   23CC C3 CC 23        JP  CALC_SUM_LOOP
2402   23CF             
2403   23CF             
2404   23CF             ; ---------------------------------------------------------
2405   23CF             ; Utilitys Program | PROGRAM X
2406   23CF             ; ---------------------------------------------------------
2407   23CF 3E 00           LD  A, 0                 ; user mode
2408   23D1 32 0F FF        LD (SYSMODE), A
2409   23D4             
2410   23D4             
2411   23D4             ; =========================================================
2412   23D4             ; Tabela display
2413   23D4             ; =========================================================
2414   23D4             ; 
2415   23D4             ;   0 - $3F     A - $77     K - $7A     U - $1C     . - $80
2416   23D4             ;   1 - $06     B - $7C     L - $38     V - $3E     Ñ - $55
2417   23D4             ;   2 - $5B     C - $39     M - $37     W - $1D     : - $41
2418   23D4             ;   3 - $4F     D - $5E     N - $54     X - $70     ; - $88
2419   23D4             ;   4 - $66     E - $79     O - $3F     Y - $6E     _ - $08
2420   23D4             ;   5 - $6D     F - $71     P - $73     Z - $49     ~ - $01
2421   23D4             ;   6 - $7D     G - $6F     Q - $67                 ' - $20
2422   23D4             ;   7 - $07     H - $76     R - $50     + - $46     
2423   23D4             ;   8 - $7F     I - $06     S - $6D     , - $04     
2424   23D4             ;   9 - $67     J - $1E     T - $78     - - $40     
2425   23D4             
2426   23D4             .end
tasm: Number of errors = 0
